---
title: 2.4.0~rc1
tags:
- opam
- platform
authors:
- kit-ty-kate
contributors:
changelog:
versions:
unstable: false
ignore: false
github_release_tags:
- 2.4.0-rc1
---

<p>This is the first release candidate of opam 2.4.0.</p>
<p>Binaries and full archive are signed by the <a href="https://opam.ocaml.org/opam-dev-pubkey.pgp" rel="nofollow">opam dev team</a> (fingerprint <code>92C5 26AE 50DF 3947 0EB2 911B ED4C F1CA 67CB AA92</code>).</p>
<p>Please see our <a href="https://opam.ocaml.org/blog/opam-2-4-0-rc1" rel="nofollow">blog post</a> for a highlight on the major changes and upgrade instructions.</p>
<p><a href="https://github.com/ocaml/opam/blob/2.4.0-rc1/CHANGES">Changelog</a>:</p>
<h2>Changes</h2>
<ul>
<li>Fix <code>opam switch create &lt;version&gt;</code> when all compilers of that version are flagged with <code>avoid-version</code> [<a href="https://github.com/ocaml/opam/pull/6571" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3174966613" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6571" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6571/hovercard">#6571</a> <a href="https://github.com/rjbou" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/rjbou/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@rjbou</a> - fix <a href="https://github.com/ocaml/opam/issues/6563" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3161566223" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6563" data-hovercard-type="issue" data-hovercard-url="/ocaml/opam/issues/6563/hovercard">#6563</a>]</li>
<li>Opam update performance: No longer copy VCS directories when adding or updating local non-VCS repositories [<a href="https://github.com/ocaml/opam/pull/6575" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3189500707" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6575" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6575/hovercard">#6575</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a> - fix <a href="https://github.com/ocaml/opam/issues/6560" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3161244320" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6560" data-hovercard-type="issue" data-hovercard-url="/ocaml/opam/issues/6560/hovercard">#6560</a>]</li>
<li>Do not remove the generated patch file during updates when debug-mode is on [<a href="https://github.com/ocaml/opam/pull/6575" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3189500707" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6575" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6575/hovercard">#6575</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
</ul>
<h3>Release script</h3>
<ul>
<li>Switch the host of qemu-base-images from gitlab to github [<a href="https://github.com/ocaml/opam/pull/6510" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3040250096" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6510" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6510/hovercard">#6510</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
<li>Speedup the initial clone of qemu-base-images when missing [<a href="https://github.com/ocaml/opam/pull/6510" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3040250096" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6510" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6510/hovercard">#6510</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
<li>Update some of the platforms the prebuilt binaries are built on to Alpine 2.21, FreeBSD 14.3, OpenBSD 7.7 and NetBSD 10.1 [<a href="https://github.com/ocaml/opam/pull/6510" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3040250096" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6510" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6510/hovercard">#6510</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
</ul>
<h3>Build changes</h3>
<ul>
<li>Use coreutils' <code>sha512sum</code> instead of perl's <code>shasum</code> utility when using <code>./configure --with-cygwin-setup</code> [<a href="https://github.com/ocaml/opam/pull/6566" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3166209978" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6566" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6566/hovercard">#6566</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a> - fix <a href="https://github.com/ocaml/opam/issues/6557" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3158530441" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6557" data-hovercard-type="issue" data-hovercard-url="/ocaml/opam/issues/6557/hovercard">#6557</a>]</li>
<li>Upgrade the download-if-missing dependencies to <code>dune 3.19.1</code>, <code>opam-file-format 2.2.0</code>, <code>spdx_licenses 1.4.0</code> and <code>patch 3.0.0</code> [<a href="https://github.com/ocaml/opam/pull/6580" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3199659753" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6580" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6580/hovercard">#6580</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
</ul>
<h3>Testing and documentation</h3>
<ul>
<li>Improve and extend the testsuite [<a href="https://github.com/ocaml/opam/pull/6473" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="2999876727" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6473" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6473/hovercard">#6473</a> <a href="https://github.com/ocaml/opam/pull/6571" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3174966613" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6571" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6571/hovercard">#6571</a> <a href="https://github.com/rjbou" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/rjbou/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@rjbou</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
<li>Improve and extend the test infrastructure [<a href="https://github.com/ocaml/opam/pull/6575" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3189500707" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6575" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6575/hovercard">#6575</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
</ul>
<h2>API updates</h2>
<h3>opam-format</h3>
<ul>
<li><code>OpamLocal</code>: <code>fetch_repo_update</code> no longer copies vcs directories [<a href="https://github.com/ocaml/opam/pull/6575" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3189500707" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6575" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6575/hovercard">#6575</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
</ul>
<h3>opam-core</h3>
<ul>
<li><code>OpamSystem</code>: Add <code>copy_dir_except_vcs</code> [<a href="https://github.com/ocaml/opam/pull/6575" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3189500707" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6575" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6575/hovercard">#6575</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
<li><code>OpamSystem</code>: Add <code>get_files_except_vcs</code> [<a href="https://github.com/ocaml/opam/pull/6575" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3189500707" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6575" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6575/hovercard">#6575</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
</ul>
