---
title: opam 2.4.0~alpha1
tags:
- opam
- platform
authors:
- kit-ty-kate
contributors:
changelog: |
    Possibly scripts breaking changes are prefixed with ✘.  
    New option/command/subcommand are prefixed with ◈.

    ## Major changes

    ### Init

    *   Remove `ocaml-system` from the list of default compilers chosen at `opam init` time \[[#6307](https://github.com/ocaml/opam/pull/6307) [@kit-ty-kate](https://github.com/kit-ty-kate) - fix [#3509](https://github.com/ocaml/opam/issues/3509)\]

    ### Patch: update & install

    *   Patches are now applied using the `patch` OCaml library instead of GNU Patch \[[#5892](https://github.com/ocaml/opam/pull/5892) [@kit-ty-kate](https://github.com/kit-ty-kate) - fix [#6019](https://github.com/ocaml/opam/issues/6019) [#6052](https://github.com/ocaml/opam/issues/6052) [#3782](https://github.com/ocaml/opam/issues/3782) [ocaml/setup-ocaml#933](https://github.com/ocaml/setup-ocaml/pull/933)\]
        *   Context diffs are not supported anymore, only Unified diffs are (including its git extensions)
        *   Stop support of file permission changes via git extension to the unified diff specification
        *   GNU `patch` and the `diff` command are no longer runtime dependencies

    ### Depexts

    *   Support providing external dependencies with Nix by adding support for stateless depexts systems \[[#5982](https://github.com/ocaml/opam/pull/5982) [@RyanGibb](https://github.com/RyanGibb) [@rjbou](https://github.com/rjbou) [@kit-ty-kate](https://github.com/kit-ty-kate) - fix [#5124](https://github.com/ocaml/opam/issues/5124)\]

    ### Show

    *   `opam show` now displays the version number of packages flagged with `avoid-version`/`deprecated` gray \[[#6358](https://github.com/ocaml/opam/pull/6358) [@kit-ty-kate](https://github.com/kit-ty-kate) - fix [#6354](https://github.com/ocaml/opam/issues/6354)\]

    ### Install

    *   Fix `opam install <local_dir>` not updating or storing pinned packages' metadata \[[#6209](https://github.com/ocaml/opam/pull/6209) [@kit-ty-kate](https://github.com/kit-ty-kate) - fix [#5567](https://github.com/ocaml/opam/issues/5567)\]
    *   Fix `opam install --deps-only/--show-action <local_dir>` not updating (without storing) pinned packages' metadata \[[#6209](https://github.com/ocaml/opam/pull/6209) [@kit-ty-kate](https://github.com/kit-ty-kate) - fix [#5567](https://github.com/ocaml/opam/issues/5567)\]

    ### Pin

    *   ✘ Fail when trying to pin a package whose definition could not be found instead of forcing interactive edition (e.g. this could happen when making a typo in the package name of a pin-depends) \[[#6319](https://github.com/ocaml/opam/pull/6319) [@kit-ty-kate](https://github.com/kit-ty-kate) - fix [#6322](https://github.com/ocaml/opam/issues/6322)\]
    *   ◈ `opam pin`/`opam pin list` now displays the current revision of a pinned repository in a new column \[[#6274](https://github.com/ocaml/opam/pull/6274) [@desumn](https://github.com/desumn) - fix [#5533](https://github.com/ocaml/opam/issues/5533)\]

    ### Admin

    *   ◈ Add `opam admin compare-versions` to compare package versions for sanity checks \[[#6197](https://github.com/ocaml/opam/pull/6197) [@mbarbin](https://github.com/mbarbin)\]
    *   ◈ Add `opam admin migrate-extrafiles` which moves all `extra-files` of an existing opam repository into `extra-sources` \[[#5960](https://github.com/ocaml/opam/pull/5960) [@hannesm](https://github.com/hannesm) [@rjbou](https://github.com/rjbou) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   ✘ The `-i`/`--ignore-test-doc` argument has been removed from `opam admin check` \[[#6335](https://github.com/ocaml/opam/pull/6335) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   ✘ `opam admin check` now sets `with-test` and `with-doc` to `false` instead of `true` \[[#6335](https://github.com/ocaml/opam/pull/6335) [@kit-ty-kate](https://github.com/kit-ty-kate)\]

    ## Miscellaneous changes

    ### Global CLI

    *   Add `--cli`/`OPAMCLI` version 2.4 \[[#6268](https://github.com/ocaml/opam/pull/6268) [@mbarbin](https://github.com/mbarbin) [@rjbou](https://github.com/rjbou)\]

    ### Install

    *   Remove the build directories of pinned packages after successful builds \[[#6436](https://github.com/ocaml/opam/pull/6436) [@kit-ty-kate](https://github.com/kit-ty-kate)\]

    ### UI

    *   Improve the messages when a package is not up-to-date on opam upgrade \[[#6272](https://github.com/ocaml/opam/pull/6272) [@kit-ty-kate](https://github.com/kit-ty-kate) - fix [#6270](https://github.com/ocaml/opam/issues/6270)\]
    *   Use a non-underline uppercase character to denote the default when asking a question \[[#6289](https://github.com/ocaml/opam/pull/6289) [@hannesm](https://github.com/hannesm) [@kit-ty-kate](https://github.com/kit-ty-kate) - fix [#6288](https://github.com/ocaml/opam/issues/6288)\]
    *   Do not pre-write the answer to questions with the default anwser \[[#6376](https://github.com/ocaml/opam/pull/6376) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   Display Windows `NTSTATUS` exit codes in hex \[[#6401](https://github.com/ocaml/opam/pull/6401) [@dra27](https://github.com/dra27) [@MisterDA](https://github.com/MisterDA)\]

    ### Switch

    *   Fix `opam switch remove <dir>` failure when it is a linked switch \[[#6276](https://github.com/ocaml/opam/pull/6276) [@btjorge](https://github.com/btjorge) - fix [#6275](https://github.com/ocaml/opam/issues/6275)\]
    *   Fix `opam switch list-available` when given several arguments \[[#6318](https://github.com/ocaml/opam/pull/6318) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   Correctly handle `pkg.version` pattern in `opam switch list-available` \[[#6186](https://github.com/ocaml/opam/pull/6186) [@arozovyk](https://github.com/arozovyk) - fix [#6152](https://github.com/ocaml/opam/issues/6152)\]

    ### Upgrade

    *   Do not show the not-up-to-date message with packages tagged with `avoid-version`/`deprecated` \[[#6273](https://github.com/ocaml/opam/pull/6273) [@kit-ty-kate](https://github.com/kit-ty-kate) - fix [#6271](https://github.com/ocaml/opam/issues/6271)\]
    *   Fix a regression on `opam upgrade <package>` upgrading unrelated packages \[[#6373](https://github.com/ocaml/opam/pull/6373) [@AltGr](https://github.com/AltGr)\]
    *   Fix a regression on `opam upgrade --all <uninstalled-pkg>` not upgrading the whole switch \[[#6373](https://github.com/ocaml/opam/pull/6373) [@kit-ty-kate](https://github.com/kit-ty-kate)\]

    ### Source

    *   ◈ Add options `--require-checksums` and `--no-checksums` to harmonise with `opam install` \[[#5563](https://github.com/ocaml/opam/pull/5563) [@rjbou](https://github.com/rjbou)\]

    ### Lint

    *   ◈ Add W74 to `opam lint` to detect `pin-depends` packages that are neither present in the `depends` no `depopts` field \[[#6317](https://github.com/ocaml/opam/pull/6317) [@rjbou](https://github.com/rjbou) - fix [#5795](https://github.com/ocaml/opam/issues/5795)\]
    *   ◈ Add E63 to `opam lint` to check for availability guard in case an opam file contains a `subpath` field \[[#6438](https://github.com/ocaml/opam/pull/6438) [@rjbou](https://github.com/rjbou) [@kit-ty-kate](https://github.com/kit-ty-kate)\]

    ### Lock

    *   Fix `pin-depends` for `with-*` dependencies when creating a lock file \[[#5471](https://github.com/ocaml/opam/pull/5471) [@rjbou](https://github.com/rjbou) - fix [#5428](https://github.com/ocaml/opam/issues/5428)\]
    *   ◈ Add `opam lock --keep-local` to keep local pins url in `pin-depends` field \[[#6411](https://github.com/ocaml/opam/pull/6411) [@rjbou](https://github.com/rjbou) - fix [#4897](https://github.com/ocaml/opam/issues/4897)\]

    ### Env

    *   Add the `OPAMSOLVERTOLERANCE` environment variable to allow users to fix solver timeouts for good \[[#5510](https://github.com/ocaml/opam/pull/5510) [@kit-ty-kate](https://github.com/kit-ty-kate) - fix [#3230](https://github.com/ocaml/opam/issues/3230)\]
    *   Don't write empty environment update segments to `variables.sh` (`FOO += ""` no longer adds `FOO='':"$FOO"; export FOO;`) \[[#6198](https://github.com/ocaml/opam/pull/6198) [@dra27](https://github.com/dra27)\]

    ### Sandbox

    *   Respect the `DUNE_CACHE_ROOT` environment variable if it exists \[[#6326](https://github.com/ocaml/opam/pull/6326) [@smorimoto](https://github.com/smorimoto)\]
    *   Fix sandboxing support in NixOS \[[#6333](https://github.com/ocaml/opam/pull/6333) [@kit-ty-kate](https://github.com/kit-ty-kate)\]

    #### Software Heritage

    *   Rework Software heritage fallback to have a more correct archive retrieval and more fine grained error handling \[[#6036](https://github.com/ocaml/opam/pull/6036) [@rjbou](https://github.com/rjbou) - fix [#5721](https://github.com/ocaml/opam/issues/5721)\]
    *   Fix Software Heritage liveness check \[[#6036](https://github.com/ocaml/opam/pull/6036) [@rjbou](https://github.com/rjbou) - fix [#5721](https://github.com/ocaml/opam/issues/5721)\]
    *   Update the Software Heritage API requests \[[#6036](https://github.com/ocaml/opam/pull/6036) [@rjbou](https://github.com/rjbou)\]
    *   Remove `wget` support for Software Heritage fallback \[[#6036](https://github.com/ocaml/opam/pull/6036) [@rjbou](https://github.com/rjbou) - fix [#5721](https://github.com/ocaml/opam/issues/5721)\]

    ### Repository

    *   Fix `curl` download command selection when loaded from global config file \[[#6302](https://github.com/ocaml/opam/pull/6302) [@rjbou](https://github.com/rjbou)\]
    *   Check that the repositories given to `opam repository remove` actually exist \[[#5014](https://github.com/ocaml/opam/pull/5014) [@kit-ty-kate](https://github.com/kit-ty-kate) - fixes [#5012](https://github.com/ocaml/opam/issues/5012)\]
    *   ✘ Symlinks in repositories are no longer supported \[[#5892](https://github.com/ocaml/opam/pull/5892) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   Fix `subpath` handling in opam files defining a local archive \[[#6439](https://github.com/ocaml/opam/pull/6439) [@rjbou](https://github.com/rjbou)\]

    ### Init

    *   Fix the detection of `ZDOTDIR` when using `zsh` \[[#6299](https://github.com/ocaml/opam/pull/6299) [@acasta-yhliu](https://github.com/acasta-yhliu) - fix [#6281](https://github.com/ocaml/opam/issues/6281)\]

    ### External dependencies (depexts)

    *   ◈ Add `apt-rpm`/ALTLinux family support for depexts \[[#6207](https://github.com/ocaml/opam/pull/6207) [@RiderALT](https://github.com/RiderALT)\]
    *   Fix the detection of installed external packages on OpenBSD to not just consider manually installed packages \[[#6362](https://github.com/ocaml/opam/pull/6362) [@semarie](https://github.com/semarie)\]
    *   Speedup the detection of available system packages with `pacman` and `brew` \[[#6324](https://github.com/ocaml/opam/pull/6324) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   Change probing tool for SUSE-based distributions from `zypper` to `rpm` \[[#6464](https://github.com/ocaml/opam/pull/6464) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   Disable the detection of available system packages on SUSE-based distributions \[[#6464](https://github.com/ocaml/opam/pull/6464) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   Add support for stateless depexts systems, by keeping synchronised already installed systems dependencies with switch state \[[#5982](https://github.com/ocaml/opam/pull/5982) [@RyanGibb](https://github.com/RyanGibb) [@rjbou](https://github.com/rjbou) [@kit-ty-kate](https://github.com/kit-ty-kate)\]

    ### Pin

    *   Don't ask confirmation when pinning an unknown package (absent from repositories) \[[#6309](https://github.com/ocaml/opam/pull/6309) [@kit-ty-kate](https://github.com/kit-ty-kate) [@rjbou](https://github.com/rjbou) - fix [#3199](https://github.com/ocaml/opam/issues/3199)\]
    *   Do not ask to install `pin-depends` twice \[[#6375](https://github.com/ocaml/opam/pull/6375) [@kit-ty-kate](https://github.com/kit-ty-kate) - fix [#6374](https://github.com/ocaml/opam/issues/6374)\]
    *   Ensure the right version (the pinned one) of packages are used when simulating pinning \[[#6256](https://github.com/ocaml/opam/pull/6256) [@rjbou](https://github.com/rjbou) [@kit-ty-kate](https://github.com/kit-ty-kate) - fix [#6248](https://github.com/ocaml/opam/issues/6248) [#6379](https://github.com/ocaml/opam/issues/6379)\]
    *   No longer double pin of packages located in ./opam/opam \[[#6343](https://github.com/ocaml/opam/pull/6343) [@kit-ty-kate](https://github.com/kit-ty-kate) - fix [#6342](https://github.com/ocaml/opam/issues/6342)\]

    #### Build changes

    *   Simplify the making of stripped binaries by introducing the `make opam-stripped` target \[[#6208](https://github.com/ocaml/opam/pull/6208) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   Fix compilation on macOS with OCaml 5.3 by bumping the downloaded-if-missing `mccs` to 1.1+19 \[[#6192](https://github.com/ocaml/opam/pull/6192) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   Upgrade the downloaded-if-missing `opam-file-format` to 2.2.0~alpha1, `spdx_licenses` to 1.3.0 and `dune` to 3.16.1 \[[#6321](https://github.com/ocaml/opam/pull/6321) [#6370](https://github.com/ocaml/opam/pull/6370) [#6192](https://github.com/ocaml/opam/pull/6192) [@kit-ty-kate](https://github.com/kit-ty-kate) - fix [#6369](https://github.com/ocaml/opam/issues/6369)\]
    *   `menhir` is now part of the transitive dependency of opam (via `opam-file-format`) \[[#6321](https://github.com/ocaml/opam/pull/6321) [@kit-ty-kate](https://github.com/kit-ty-kate)\]

    ### Admin

    *   Fix `opam admin check` in the presence of the `with-dev-setup` variable \[[#6331](https://github.com/ocaml/opam/pull/6331) [@kit-ty-kate](https://github.com/kit-ty-kate) - fix [#6329](https://github.com/ocaml/opam/issues/6329)\]

    ### Download

    *   Add `fetch` on DragonFlyBSD and `ftp` on NetBSD to the list of download tools to use, if available \[[#6304](https://github.com/ocaml/opam/pull/6304) [#6305](https://github.com/ocaml/opam/pull/6305) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   Prefer `curl` over any other download tools on every systems, if available \[[#6305](https://github.com/ocaml/opam/pull/6305) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   Avoid issues when using `wget2` as download-tool where the requested url might return an HTML page instead of the expected content \[[#6303](https://github.com/ocaml/opam/pull/6303) [@kit-ty-kate](https://github.com/kit-ty-kate)\]

    ### Internal

    *   Allow running some opam commands on machines with limited amount of memory by running `Gc.compact` while the main process is waiting for the children processes \[[#5396](https://github.com/ocaml/opam/pull/5396) [@kkeundotnet](https://github.com/kkeundotnet)\]
    *   Use a C stub to call the `uname` function from the C standard library instead of calling the `uname` POSIX command \[[#6217](https://github.com/ocaml/opam/pull/6217) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   Only download Cygwin's `setup.exe` when the command is actually going to be displayed or used \[[#6467](https://github.com/ocaml/opam/pull/6467) [@kit-ty-kate](https://github.com/kit-ty-kate)\]

    ### Testing and documentation

    *   Improve and extend the tests \[[#5892](https://github.com/ocaml/opam/pull/5892) [#6276](https://github.com/ocaml/opam/pull/6276) [#6331](https://github.com/ocaml/opam/pull/6331) [#6343](https://github.com/ocaml/opam/pull/6343) [#6378](https://github.com/ocaml/opam/pull/6378) [#6273](https://github.com/ocaml/opam/pull/6273) [#6380](https://github.com/ocaml/opam/pull/6380) [#6373](https://github.com/ocaml/opam/pull/6373) [#6307](https://github.com/ocaml/opam/pull/6307) [#6256](https://github.com/ocaml/opam/pull/6256) [#6412](https://github.com/ocaml/opam/pull/6412) [#6438](https://github.com/ocaml/opam/pull/6438) [#6439](https://github.com/ocaml/opam/pull/6439) [#6436](https://github.com/ocaml/opam/pull/6436) [#6166](https://github.com/ocaml/opam/pull/6166) [#6209](https://github.com/ocaml/opam/pull/6209) [#6198](https://github.com/ocaml/opam/pull/6198) [#6319](https://github.com/ocaml/opam/pull/6319) [#6467](https://github.com/ocaml/opam/pull/6467) [#5643](https://github.com/ocaml/opam/pull/5643) [#5982](https://github.com/ocaml/opam/pull/5982) [@rjbou](https://github.com/rjbou) [@kit-ty-kate](https://github.com/kit-ty-kate) [@btjorge](https://github.com/btjorge)\]
    *   Improve and extend the benchmarks \[[#6212](https://github.com/ocaml/opam/pull/6212) [#6443](https://github.com/ocaml/opam/pull/6443) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   Improve and extend the test infrastructure \[[#5349](https://github.com/ocaml/opam/pull/5349) [#6296](https://github.com/ocaml/opam/pull/6296) [#6274](https://github.com/ocaml/opam/pull/6274) [#6313](https://github.com/ocaml/opam/pull/6313) [#6363](https://github.com/ocaml/opam/pull/6363) [#6192](https://github.com/ocaml/opam/pull/6192) [#5663](https://github.com/ocaml/opam/pull/5663) [#6383](https://github.com/ocaml/opam/pull/6383) [#6444](https://github.com/ocaml/opam/pull/6444) [#6447](https://github.com/ocaml/opam/pull/6447) [#6471](https://github.com/ocaml/opam/pull/6471) [#6469](https://github.com/ocaml/opam/pull/6469) [#5982](https://github.com/ocaml/opam/pull/5982) [@kit-ty-kate](https://github.com/kit-ty-kate) [@rjbou](https://github.com/rjbou) [@RyanGibb](https://github.com/RyanGibb)\]
    *   Improve and extend the documentation \[[#6226](https://github.com/ocaml/opam/pull/6226) [#6231](https://github.com/ocaml/opam/pull/6231) [#6252](https://github.com/ocaml/opam/pull/6252) [#6150](https://github.com/ocaml/opam/pull/6150) [#6267](https://github.com/ocaml/opam/pull/6267) [#6251](https://github.com/ocaml/opam/pull/6251) [#6306](https://github.com/ocaml/opam/pull/6306) [#6315](https://github.com/ocaml/opam/pull/6315) [#5659](https://github.com/ocaml/opam/pull/5659) [#6320](https://github.com/ocaml/opam/pull/6320) [#6338](https://github.com/ocaml/opam/pull/6338) [#6361](https://github.com/ocaml/opam/pull/6361) [#6358](https://github.com/ocaml/opam/pull/6358) [#5627](https://github.com/ocaml/opam/pull/5627) [#6372](https://github.com/ocaml/opam/pull/6372) [#6470](https://github.com/ocaml/opam/pull/6470) [@kit-ty-kate](https://github.com/kit-ty-kate) [@rjbou](https://github.com/rjbou) [@RyanGibb](https://github.com/RyanGibb) [@gridbugs](https://github.com/gridbugs) [@fccm2](https://github.com/fccm2) [@shym](https://github.com/shym) [@hannesm](https://github.com/hannesm) [@tobil4sk](https://github.com/tobil4sk) [@juergenhoetzel](https://github.com/juergenhoetzel) [@MisterDA](https://github.com/MisterDA)\]

    ## API updates

    ### opam-client

    *   `OpamAction.prepare_package_build`: now returns `exn option` instead of `exn option OpamProcess.job` and no longer calls the system GNU Patch \[[#5892](https://github.com/ocaml/opam/pull/5892) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamArg.InvalidCLI`: export exception \[[#6150](https://github.com/ocaml/opam/pull/6150) [@rjbou](https://github.com/rjbou)\]
    *   `OpamArg.hash_kinds`: was added \[[#5960](https://github.com/ocaml/opam/pull/5960) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamArg`: export `require_checksums` and `no_checksums`, that are shared with `build_options` \[[#5563](https://github.com/ocaml/opam/pull/5563) [@rjbou](https://github.com/rjbou)\]
    *   `OpamAuxCommands.{simulate_autopin,autopin ~simulate:true}`: now updates the `reinstall` field of the returned `switch_state` if necessary \[[#6209](https://github.com/ocaml/opam/pull/6209) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamLockCommand.lock_opam`: add `~keep_local` argument to add local pins to pin-depends (and not resolve them) \[[#6411](https://github.com/ocaml/opam/pull/6411) [@rjbou](https://github.com/rjbou)\]
    *   `OpamLockCommand.lock_opam`: make the `?only_direct` argument non-optional \[[#6411](https://github.com/ocaml/opam/pull/6411) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamRepositoryCommand.switch_repos`: expose the function \[[#5014](https://github.com/ocaml/opam/pull/5014) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamSolution.install_depexts`: instead of the package set of new package to install, now takes 2 labelled arguments `pkg_to_install` and `pkg_installed` to be able to keep synchronised stateless depext systems \[[#5982](https://github.com/ocaml/opam/pull/5982) [@rjbou](https://github.com/rjbou) [@RyanGibb](https://github.com/RyanGibb) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamSolution.install_sys_packages`: no longer takes set of package to install but `OpamSysPkg.to_install` \[[#5982](https://github.com/ocaml/opam/pull/5982) [@rjbou](https://github.com/rjbou) [@RyanGibb](https://github.com/RyanGibb) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamSolution.print_depext_msg`: takes now an `OpamSysPkg.status` instead of sets \[[#5982](https://github.com/ocaml/opam/pull/5982) [@kit-ty-kate](https://github.com/kit-ty-kate) [@RyanGibb](https://github.com/RyanGibb)\]

    ### opam-repository

    *   `OpamDownload.download`: more fine grained HTTP request error code detection for curl \[[#6036](https://github.com/ocaml/opam/pull/6036) [@rjbou](https://github.com/rjbou)\]
    *   `OpamDownload.get_output`: fix `wget` option for `POST` requests \[[#6036](https://github.com/ocaml/opam/pull/6036) [@rjbou](https://github.com/rjbou)\]
    *   `OpamDownload.get_output`: use long form for `curl` `POST` request option \[[#6036](https://github.com/ocaml/opam/pull/6036) [@rjbou](https://github.com/rjbou)\]
    *   `OpamLocal.pull_url`: fix subpath handling when the url is a local archive \[[#6439](https://github.com/ocaml/opam/pull/6439) [@rjbou](https://github.com/rjbou)\]
    *   `OpamRepository.revision`: now returns a `string` instead of a `version` \[[#6409](https://github.com/ocaml/opam/pull/6409) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamRepositoryBackend.S.revision`: now returns a `string` instead of a `version` \[[#6409](https://github.com/ocaml/opam/pull/6409) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamRepositoryBackend.get_diff`: now raises `Stdlib.Failure` if an unsupported file type or comparison is detected \[[#5892](https://github.com/ocaml/opam/pull/5892) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamRepositoryBackend.get_diff`: now returns `exn option` instead of `exn option OpamProcess.job` and no longer calls the system `diff` utility \[[#5892](https://github.com/ocaml/opam/pull/5892) [@kit-ty-kate](https://github.com/kit-ty-kate)\]

    ### opam-state

    *   `OpamStateConfig`: Make the `?lock_kind` parameters non-optional to avoid breaking the library users after they upgrade their opam root \[[#5488](https://github.com/ocaml/opam/pull/5488) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamSwitchState.load_selections`: Make the `?lock_kind` parameter non-optional to avoid breaking the library users after they upgrade their opam root \[[#5488](https://github.com/ocaml/opam/pull/5488) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamSysInteract.Cygwin.check_setup`: unexpose the function \[[#6467](https://github.com/ocaml/opam/pull/6467) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamSysInteract.package_manager_name`: no longer build the command, or run an action to retrieve system package manager name \[[#5982](https://github.com/ocaml/opam/pull/5982) [@rjbou](https://github.com/rjbou)\]
    *   `OpamSysInteract.package_status`: SUSE-based distributions now uses `rpm` instead of `zypper` and no longer return an `available` set of system packages \[[#6464](https://github.com/ocaml/opam/pull/6464) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamSysInteract.packages_status`: returns now a `OpamSysPkg.status` instead of sets \[[#5982](https://github.com/ocaml/opam/pull/5982) [@kit-ty-kate](https://github.com/kit-ty-kate) [@RyanGib](https://github.com/RyanGib)\]
    *   `OpamSysInteract.{install_packages_commands,install}: no longer takes set of package to install but` OpamSysPkg.to\_install\` \[[#5982](https://github.com/ocaml/opam/pull/5982) [@rjbou](https://github.com/rjbou) [@RyanGibb](https://github.com/RyanGibb) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamSysInteract.{install_packages_commands,install}`: takes a new argument, a switch stat option, for stateless systems that need to write on switch \[[#5982](https://github.com/ocaml/opam/pull/5982) [@RyanGibb](https://github.com/RyanGibb) [@rjbou](https://github.com/rjbou)\]
    *   `OpamSysInteract`: add `stateless_install` that return if system package manager is stateless one (per switch) \[[#5982](https://github.com/ocaml/opam/pull/5982) [@rjbou](https://github.com/rjbou)\]

    ### opam-format

    *   `OpamFile.OPAM.{*read*,write*}`: Stop modifying the `available` field when handling the builtin `x-*` fields \[[#6438](https://github.com/ocaml/opam/pull/6438) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamFile.Repos_config.t`: change the type to not allow repositories without an URL \[[#6249](https://github.com/ocaml/opam/pull/6249) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamFormula.all_relop`: a list of all operators \[[#6197](https://github.com/ocaml/opam/pull/6197) [@mbarbin](https://github.com/mbarbin)\]
    *   `OpamFormula.string_of_relop`: export function \[[#6197](https://github.com/ocaml/opam/pull/6197) [@mbarbin](https://github.com/mbarbin)\]
    *   `OpamPath`: add `nix_env` inner switch path for nix environment \[[#5982](https://github.com/ocaml/opam/pull/5982) [@RyanGibb](https://github.com/RyanGibb)\]
    *   `OpamSysPkg`; add new type `to_install` to store system package to install information, newly requested ones and already installed required ones ; and its empty recode `to_install_empty` and display function `string_of_to_install` \[[#5982](https://github.com/ocaml/opam/pull/5982) [@rjbou](https://github.com/rjbou)\]

    ### opam-core

    *   `OpamConsole.pause`: Ensure the function always prints a newline character at the end \[[#6376](https://github.com/ocaml/opam/pull/6376) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamConsole`: Replace `black` text style (unused and not very readable) by `gray` \[[#6358](https://github.com/ocaml/opam/pull/6358) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamFilename.patch`: a named-parameter `~allow_unclean` was added \[[#5892](https://github.com/ocaml/opam/pull/5892) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamFilename.patch`: now returns `exn option` instead of `exn option OpamProcess.job` and no longer calls the system GNU Patch \[[#5892](https://github.com/ocaml/opam/pull/5892) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamHash.all_kinds`: was added, which returns the list of all possible values of `OpamHash.kind` \[[#5960](https://github.com/ocaml/opam/pull/5960) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamParallel.*.{map,reduce,iter}`: Run `Gc.compact` when the main process is waiting for the children processes for the first time \[[#5396](https://github.com/ocaml/opam/pull/5396) [@kkeundotnet](https://github.com/kkeundotnet)\]
    *   `OpamStd.List.split`: Improve performance \[[#6210](https://github.com/ocaml/opam/pull/6210) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamStd.Option.equal_some`: was added, which tests equality of an option with a value \[[#6381](https://github.com/ocaml/opam/pull/6381) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamStd.Sys.get_freebsd_version`: was added, which returns the output of the `uname -U` command \[[#6217](https://github.com/ocaml/opam/pull/6217) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamStd.Sys.get_long_bit`: was added, which returns the output of the `getconf LONG_BIT` command \[[#6217](https://github.com/ocaml/opam/pull/6217) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamStd.Sys.getconf`: was removed, replaced by `get_long_bit` \[[#6217](https://github.com/ocaml/opam/pull/6217) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamStd.Sys.uname`: now returns the memoized result of the `uname` function from the C standard library \[[#6217](https://github.com/ocaml/opam/pull/6217) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamSystem.get_files`: was exposed which returns the list of files (without prefix) inside the given directory \[[#5892](https://github.com/ocaml/opam/pull/5892) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamSystem.patch`: a named-parameter `~allow_unclean` was added \[[#5892](https://github.com/ocaml/opam/pull/5892) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamSystem.patch`: do not remove the original patch file if called with `~preprocess:false` \[[#5892](https://github.com/ocaml/opam/pull/5892) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamSystem.patch`: now returns `exn option` instead of `exn option OpamProcess.job` and no longer calls the system GNU Patch \[[#5892](https://github.com/ocaml/opam/pull/5892) [@kit-ty-kate](https://github.com/kit-ty-kate)\]
    *   `OpamSystem.remove_dir`: do not fail with an exception when directory is a symbolic link \[[#6276](https://github.com/ocaml/opam/pull/6276) [@btjorge](https://github.com/btjorge) [@rjbou](https://github.com/rjbou) - fix [#6275](https://github.com/ocaml/opam/issues/6275)\]
    *   `OpamSystem`, `OpamFilename`: add `with_tmp_file` and `with_tmp_file_job` function, that create a file name in temporary directory and removes it at the end of the call \[[#6036](https://github.com/ocaml/opam/pull/6036) [@rjbou](https://github.com/rjbou)\]
versions:
unstable: true
ignore: false
github_release_tags:
- 2.4.0-alpha1
---

This is the first alpha release of opam 2.4.0.

Binaries and full archive are signed by the [opam dev team](https://opam.ocaml.org/opam-dev-pubkey.pgp) (fingerprint `92C5 26AE 50DF 3947 0EB2 911B ED4C F1CA 67CB AA92`).

Please see our [blog post](https://opam.ocaml.org/blog/opam-2-4-0-alpha1) for a highlight on the major changes and upgrade instructions.
