---
title: 2.4.0~beta1
tags:
- opam
- platform
authors:
- kit-ty-kate
contributors:
changelog:
versions:
unstable: false
ignore: false
github_release_tags:
- 2.4.0-beta1
---

<p>This is the first beta release of opam 2.4.0.</p>
<p>Binaries and full archive are signed by the <a href="https://opam.ocaml.org/opam-dev-pubkey.pgp" rel="nofollow">opam dev team</a> (fingerprint <code>92C5 26AE 50DF 3947 0EB2 911B ED4C F1CA 67CB AA92</code>).</p>
<p>Please see our <a href="https://opam.ocaml.org/blog/opam-2-4-0-beta1" rel="nofollow">blog post</a> for a highlight on the major changes and upgrade instructions.</p>
<p><a href="https://github.com/ocaml/opam/blob/2.4.0-beta1/CHANGES">Changelog</a>:</p>
<p>New option/command/subcommand are prefixed with ◈.</p>
<h2>Changes</h2>
<h3>Install of dependencies <code>--deps-only</code></h3>
<h4>Behaviour</h4>
<ul>
<li>◈ Change the behaviour of <code>--deps-only</code>, where it no longer requires unicity of package version between the request and the installed packages.  In other words, if you have <code>pkg.1</code> installed, installing dependencies of <code>pkg.2</code> no longer removes <code>pkg.1</code>. This also allows to install dependencies of conflicting packages when their dependencies are compliant. [<a href="https://github.com/ocaml/opam/pull/6520" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3074686024" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6520" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6520/hovercard">#6520</a> <a href="https://github.com/rjbou" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/rjbou/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@rjbou</a>]</li>
</ul>
<h4>Fixes</h4>
<p>Fixed some bugs in <code>opam install --deps-only</code> (and other commands simulating package pins, such as <code>--depext-only</code>) more visible in 2.4:</p>
<ul>
<li>When a package <code>pkg</code> is already installed and <code>opam install ./pkg --deps</code> is called, if there is a conflict between the installed <code>pkg</code> dependencies and the definition of the local <code>pkg</code>, the conflict was not seen and the already installed <code>pkg</code> was kept [<a href="https://github.com/ocaml/opam/pull/6530" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3118902735" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6530" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6530/hovercard">#6530</a> <a href="https://github.com/rjbou" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/rjbou/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@rjbou</a> - fix <a href="https://github.com/ocaml/opam/issues/6529" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3118900316" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6529" data-hovercard-type="issue" data-hovercard-url="/ocaml/opam/issues/6529/hovercard">#6529</a>]</li>
<li>No longer fetch and write the sources when simulating packages that were already pinned [<a href="https://github.com/ocaml/opam/pull/6533" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3118926123" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6533" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6533/hovercard">#6533</a> <a href="https://github.com/rjbou" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/rjbou/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@rjbou</a> - fix <a href="https://github.com/ocaml/opam/issues/6532" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3118915598" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6532" data-hovercard-type="issue" data-hovercard-url="/ocaml/opam/issues/6532/hovercard">#6532</a>]</li>
<li>opam was triggering the reinstall of the package based on the already pinned packages instead of the expected newly simulated pinned packages [<a href="https://github.com/ocaml/opam/pull/6522" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3086956298" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6522" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6522/hovercard">#6522</a> <a href="https://github.com/rjbou" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/rjbou/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@rjbou</a> - partial fix <a href="https://github.com/ocaml/opam/issues/6501" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3032426064" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6501" data-hovercard-type="issue" data-hovercard-url="/ocaml/opam/issues/6501/hovercard">#6501</a>]</li>
<li>opam was using the opam description of the wrong package in some cases [<a href="https://github.com/ocaml/opam/pull/6544" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3141318088" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6544" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6544/hovercard">#6544</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a> - fix <a href="https://github.com/ocaml/opam/issues/6535" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3121295844" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6535" data-hovercard-type="issue" data-hovercard-url="/ocaml/opam/issues/6535/hovercard">#6535</a>]</li>
</ul>
<h3>Reinstall</h3>
<ul>
<li>Fix a regression where the internal <code>sources</code> directory was removed unexpectedly on reinstall actions, making opam re-fetch the package [<a href="https://github.com/ocaml/opam/pull/6550" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3149631202" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6550" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6550/hovercard">#6550</a> <a href="https://github.com/rjbou" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/rjbou/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@rjbou</a> - fix <a href="https://github.com/ocaml/opam/pull/6551" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3149640187" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6551" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6551/hovercard">#6551</a>]</li>
</ul>
<h3>Update</h3>
<p>Fixed a couple of regressions in <code>opam update</code>:</p>
<ul>
<li>An unexpected stack overflow exception was raised when updating repositories with large files when opam is compiled with OCaml &lt; <code>5.1</code> [<a href="https://github.com/ocaml/opam/pull/6527" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3110474859" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6527" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6527/hovercard">#6527</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a> - fix <a href="https://github.com/ocaml/opam/issues/6513" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3041116993" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6513" data-hovercard-type="issue" data-hovercard-url="/ocaml/opam/issues/6513/hovercard">#6513</a>]</li>
<li>Updating a repository where a line was added at the end of a file without final newline character was making the update fail [<a href="https://github.com/ocaml/opam/pull/6527" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3110474859" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6527" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6527/hovercard">#6527</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a> - fix <a href="https://github.com/hannesm/patch/issues/28" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3094533652" data-permission-text="Title is private" data-url="https://github.com/hannesm/patch/issues/28" data-hovercard-type="issue" data-hovercard-url="/hannesm/patch/issues/28/hovercard">hannesm/patch#28</a>]</li>
</ul>
<h3>Windows</h3>
<ul>
<li>Improve the prebuilt Windows binaries by including Cygwin's <code>setup-x86_64.exe</code> in the binary itself as fallback, in case <code>cygwin.com</code> is inaccessible [<a href="https://github.com/ocaml/opam/pull/6538" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3133722859" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6538" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6538/hovercard">#6538</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
</ul>
<h3>Build changes</h3>
<ul>
<li>Bump the downloaded-if-missing <code>dune</code> to <code>3.19.0</code>, <code>cppo</code> to <code>1.8.0</code>, <code>ocamlgraph</code> to <code>2.2.0</code>, <code>uutf</code> to <code>1.0.4</code> and <code>patch</code> to <code>3.0.0~beta1</code> [<a href="https://github.com/ocaml/opam/pull/6527" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3110474859" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6527" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6527/hovercard">#6527</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
<li>Allows <code>./configure --without-dune</code> to build with OCaml <code>5.4</code> [<a href="https://github.com/ocaml/opam/pull/6527" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3110474859" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6527" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6527/hovercard">#6527</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
<li>Add a <code>--with-cygwin-setup</code> option to the <code>configure</code> script, only available on Windows and disabled by default, which includes the optionally given <code>setup-x86_64.exe</code> binary inside the opam binary. If the option is given without a filename, the file with be fetched from <code>cygwin.com</code> [<a href="https://github.com/ocaml/opam/pull/6526" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3108251783" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6526" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6526/hovercard">#6526</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a> <a href="https://github.com/dra27" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/dra27/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@dra27</a> <a href="https://github.com/rjbou" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/rjbou/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@rjbou</a> - fix <a href="https://github.com/ocaml/opam/issues/6498" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3028590340" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6498" data-hovercard-type="issue" data-hovercard-url="/ocaml/opam/issues/6498/hovercard">#6498</a>]</li>
</ul>
<h3>Testing and documentation</h3>
<ul>
<li>Improve and extend the testsuite [<a href="https://github.com/ocaml/opam/pull/6530" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3118902735" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6530" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6530/hovercard">#6530</a> <a href="https://github.com/ocaml/opam/pull/6533" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3118926123" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6533" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6533/hovercard">#6533</a> <a href="https://github.com/ocaml/opam/pull/6539" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3133902983" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6539" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6539/hovercard">#6539</a> <a href="https://github.com/ocaml/opam/pull/6544" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3141318088" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6544" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6544/hovercard">#6544</a> <a href="https://github.com/ocaml/opam/pull/6550" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3149631202" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6550" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6550/hovercard">#6550</a> <a href="https://github.com/ocaml/opam/pull/6520" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3074686024" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6520" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6520/hovercard">#6520</a> <a href="https://github.com/rjbou" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/rjbou/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@rjbou</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
<li>Improve and extend the test infrastructure [<a href="https://github.com/ocaml/opam/pull/6524" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3093402772" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6524" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6524/hovercard">#6524</a> <a href="https://github.com/ocaml/opam/pull/6553" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3151059611" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6553" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6553/hovercard">#6553</a> <a href="https://github.com/ocaml/opam/pull/6549" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3149618847" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6549" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6549/hovercard">#6549</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a> <a href="https://github.com/rjbou" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/rjbou/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@rjbou</a>]</li>
</ul>
<h2>API updates</h2>
<h3>opam-client</h3>
<ul>
<li><code>OpamAction.cleanup_artefacts</code>: no longer removes the internal <code>sources</code> directory if the package is installed but not pinned [<a href="https://github.com/ocaml/opam/pull/6550" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3149631202" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6550" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6550/hovercard">#6550</a> <a href="https://github.com/rjbou" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/rjbou/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@rjbou</a>]</li>
</ul>
