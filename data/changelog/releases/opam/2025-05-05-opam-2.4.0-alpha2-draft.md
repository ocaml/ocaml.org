---
title: 2.4.0~alpha2
tags:
- opam
- platform
authors:
- kit-ty-kate
contributors:
changelog:
versions:
unstable: false
ignore: false
github_release_tags:
- 2.4.0-alpha2
---

<p>This is the second alpha release of opam 2.4.0.</p>
<p>Binaries and full archive are signed by the <a href="https://opam.ocaml.org/opam-dev-pubkey.pgp" rel="nofollow">opam dev team</a> (fingerprint <code>92C5 26AE 50DF 3947 0EB2 911B ED4C F1CA 67CB AA92</code>).</p>
<p>Please see our <a href="https://opam.ocaml.org/blog/opam-2-4-0-alpha2" rel="nofollow">blog post</a> for a highlight on the major changes and upgrade instructions.</p>
<p><a href="https://github.com/ocaml/opam/blob/2.4.0-alpha2/CHANGES">Changelog</a>:</p>
<h2>Changes</h2>
<ul>
<li>Do not include compiler packages flagged with <code>avoid-version</code>/<code>deprecated</code> in the generated invariant when calling <code>opam switch create [name] &lt;version&gt;</code> [<a href="https://github.com/ocaml/opam/pull/6494" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3027662050" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6494" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6494/hovercard">#6494</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
<li>Cygwin: Fallback to the existing <code>setup-x86_64.exe</code> if its upgrade failed to be fetched [<a href="https://github.com/ocaml/opam/pull/6482" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3014125657" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6482" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6482/hovercard">#6482</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a> - fix <a href="https://github.com/ocaml/opam/issues/6495" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3028587982" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6495" data-hovercard-type="issue" data-hovercard-url="/ocaml/opam/issues/6495/hovercard">#6495</a>, partial fix <a href="https://github.com/ocaml/opam/issues/6474" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3000815802" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6474" data-hovercard-type="issue" data-hovercard-url="/ocaml/opam/issues/6474/hovercard">#6474</a>]</li>
<li>Fix a memory leak happening when running large numbers of commands or opening large number of opam files [<a href="https://github.com/ocaml/opam/pull/6485" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3017130587" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6485" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6485/hovercard">#6485</a> <a href="https://github.com/hannesm" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/hannesm/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@hannesm</a> - fix <a href="https://github.com/ocaml/opam/issues/6484" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3017051941" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6484" data-hovercard-type="issue" data-hovercard-url="/ocaml/opam/issues/6484/hovercard">#6484</a>]</li>
<li>Remove handling of the <code>OPAMSTATS</code> environment variable [<a href="https://github.com/ocaml/opam/pull/6485" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3017130587" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6485" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6485/hovercard">#6485</a> <a href="https://github.com/hannesm" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/hannesm/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@hannesm</a>]</li>
</ul>
<h3>Regression fixes from 2.4.0~alpha1</h3>
<ul>
<li>Fix a crash when updating a repository that is deleting or adding empty files [<a href="https://github.com/ocaml/opam/pull/6490" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3019907849" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6490" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6490/hovercard">#6490</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
<li>Fix an extreme performance issue (takes several hours) when applying a large repository update [<a href="https://github.com/ocaml/opam/pull/6490" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3019907849" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6490" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6490/hovercard">#6490</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
<li>Fix a crash when updating a git repository that moved a file to a new directory [<a href="https://github.com/ocaml/opam/pull/6490" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3019907849" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6490" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6490/hovercard">#6490</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
</ul>
<h3>Build changes</h3>
<ul>
<li>Update the requirement for the <code>patch</code> library to <code>3.0.0~alpha2</code> [<a href="https://github.com/ocaml/opam/pull/6490" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3019907849" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6490" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6490/hovercard">#6490</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
<li>Upgrade the downloaded-if-missing <code>patch</code> library to <code>3.0.0~alpha2</code> [<a href="https://github.com/ocaml/opam/pull/6490" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3019907849" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6490" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6490/hovercard">#6490</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
</ul>
<h3>Testing and documentation</h3>
<ul>
<li>Improve and extend the testsuite [<a href="https://github.com/ocaml/opam/pull/6490" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3019907849" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6490" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6490/hovercard">#6490</a> <a href="https://github.com/ocaml/opam/pull/6494" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3027662050" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6494" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6494/hovercard">#6494</a> <a href="https://github.com/rjbou" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/rjbou/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@rjbou</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
<li>Improve and extend the test infrastructure [<a href="https://github.com/ocaml/opam/pull/6277" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="2621820133" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6277" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6277/hovercard">#6277</a> <a href="https://github.com/rjbou" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/rjbou/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@rjbou</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
</ul>
<h2>API updates</h2>
<h3>opam-core</h3>
<ul>
<li><code>OpamArg.environment_variable</code>: make <code>STATS</code> as removed from cli 2.3 [<a href="https://github.com/ocaml/opam/pull/6485" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3017130587" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6485" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6485/hovercard">#6485</a> <a href="https://github.com/rjbou" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/rjbou/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@rjbou</a>]</li>
<li><code>OpamClientConfig</code>: remove <code>STATS</code> variant and related <code>print_stats</code> field in config record [<a href="https://github.com/ocaml/opam/pull/6485" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3017130587" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6485" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6485/hovercard">#6485</a> <a href="https://github.com/hannesm" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/hannesm/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@hannesm</a>]</li>
</ul>
<h3>opam-format</h3>
<ul>
<li><code>OpamFile</code>: remove <code>Stats</code> module [<a href="https://github.com/ocaml/opam/pull/6485" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3017130587" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6485" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6485/hovercard">#6485</a> <a href="https://github.com/hannesm" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/hannesm/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@hannesm</a>]</li>
</ul>
<h3>opam-core</h3>
<ul>
<li><code>OpamSystem</code>: remove <code>print_stats</code> function [<a href="https://github.com/ocaml/opam/pull/6485" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3017130587" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6485" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6485/hovercard">#6485</a> <a href="https://github.com/hannesm" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/hannesm/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@hannesm</a>]</li>
<li><code>OpamSystem</code>: add the <code>rmdir_cleanup</code> function [<a href="https://github.com/ocaml/opam/pull/6490" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3019907849" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6490" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6490/hovercard">#6490</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
<li><code>OpamSystem.dir_is_empty</code>: Speedup and change its type to handle unreachable directories better [<a href="https://github.com/ocaml/opam/pull/6490" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3019907849" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6490" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6490/hovercard">#6490</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
<li><code>OpamSystem.internal_patch</code>: remove parent directories when all of their content has been moved somewhere else [<a href="https://github.com/ocaml/opam/pull/6490" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3019907849" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6490" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6490/hovercard">#6490</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
<li><code>OpamSystem.internal_patch</code>: fix moving files to new directories when receiving a git diff [<a href="https://github.com/ocaml/opam/pull/6490" class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3019907849" data-permission-text="Title is private" data-url="https://github.com/ocaml/opam/issues/6490" data-hovercard-type="pull_request" data-hovercard-url="/ocaml/opam/pull/6490/hovercard">#6490</a> <a href="https://github.com/kit-ty-kate" class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/kit-ty-kate/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self">@kit-ty-kate</a>]</li>
</ul>
