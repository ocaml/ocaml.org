---
title: One Web App = One Language
description:
url: http://blog.opalang.org/2012/04/one-web-app-one-language.html
date: 2012-04-18T16:32:00-00:00
preview_image:
featured:
authors:
- HB
---

<div class="sectionbody"><div class="paragraph">When I started the Opa project five years ago, my goal was to clean up the mess and build a clean technology for writing web applications.</div><div class="paragraph">At the time, Web 2.0 applications based on AJAX were increasingly popular and most technology stacks were growing in complexity, surpassing 5 technologies: A web server, a programming language for the server, another for the client, a database and at least one framework. Not counting an ORM layer, caching mechanism, etc., etc. There was room for improvement!</div><div class="paragraph">The design was based on two principles:</div><div class="olist arabic"><ol class="arabic"><li>There should be a single, unique language for writing web applications.</li>
<li>There should be a single, clean, runtime on the servers.</li>
</ol></div><div class="paragraph">This month, two new technologies launched that rely on this first principle. And both chose JavaScript as the single language:</div><div class="ulist"><ul><li>Yahoo's Mojito framework features dynamic code migration, with the ability to shift computation at runtime from the client to the server for mobile devices, in order to reduce the amount of data transferred to the device.</li>
<li>Another framework, Meteor, automates the communication between the server and the client part of the web application.</li>
</ul></div><div class="paragraph">Both use Node.js, the increasingly popular &ldquo;application server&rdquo; for JavaScript.</div><div class="paragraph">We are really happy to witness this move that makes web application development easier. Since 2008, we have learned a lot by using a single programming language for writing web applications. Especially when growing from prototypes to real-world applications. It turns out that one of the most needed features was the ability to automatically determine where the code should run, on the client or on the server. We named that feature the Opa &ldquo;slicer&rdquo;.</div><div class="paragraph"><p>You can classically enforce a given side using &ldquo;client&rdquo; and &ldquo;server&rdquo; directives:</p></div><div class="listingblock"><div class="content"><pre><tt> <span style="font-style: italic"><span style="color: #9A1900">// Client-side</span></span>
client <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">client_function</span></span><span style="color: #990000">(</span>value<span style="color: #990000">)</span> <span style="color: #FF0000">{</span> <span style="color: #990000">...</span> <span style="color: #FF0000">}</span>
 <span style="font-style: italic"><span style="color: #9A1900">// Server-side</span></span>
server <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">server_function</span></span><span style="color: #990000">(</span>value<span style="color: #990000">)</span> <span style="color: #FF0000">{</span> <span style="color: #990000">...</span> <span style="color: #FF0000">}</span></tt></pre></div></div><div class="paragraph"><p>Most of the time, you want to omit the hint and let Opa guess. Imagine you have a DOM element of id &quot;counter&quot;, and a database named &quot;mydb&quot;:</p></div><div class="listingblock"><div class="content"><pre><tt><span style="font-style: italic"><span style="color: #9A1900">// Will be on server side:</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">db_update</span></span><span style="color: #990000">(</span>value<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #FF6600">/mydb/</span>counter <span style="color: #990000">&lt;-</span> value
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">// Will be on client-side:</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">dom_update</span></span><span style="color: #990000">(</span>value<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    #counter <span style="color: #990000">=</span> value
<span style="color: #FF0000">}</span></tt></pre></div></div><div class="paragraph"><p>Even better! Both calls (and the automated communication) can be written with a single function:</p></div><div class="listingblock"><div class="content"><pre><tt><span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">update</span></span><span style="color: #990000">(</span>value<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #FF6600">/mydb/</span>counter <span style="color: #990000">&lt;-</span> value<span style="color: #990000">;</span>
    #counter <span style="color: #990000">=</span> value
<span style="color: #FF0000">}</span></tt></pre></div></div><div class="paragraph"><p>And even with a single LOC:</p></div><div class="listingblock"><div class="content"><pre><tt><span style="font-style: italic"><span style="color: #9A1900">// Just write _what_ you want to do, without worrying about _how_ to do that</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">init</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    #counter <span style="color: #990000">=</span> <span style="color: #FF6600">/mydb/</span>counter
<span style="color: #FF0000">}</span></tt></pre></div></div><div class="paragraph">As you may imagine, automatic code repartition is a very complex problem that requires deep code analysis to make it work. In Opa, we tackle this problem by relying on an advanced static typing system. And let's be honest, the type system of Opa is the feature we are most proud of.</div><div class="paragraph">Every function in the Opa code gets a type (which is usually inferred). When the developer writes:</div><div class="listingblock"><div class="content"><pre><tt>function <span style="font-weight: bold;"><span style="color: black;">foo</span></span><span style="color: #990000;">(</span>s<span style="color: #990000;">)</span> <span style="color: red;">{</span>
   <span style="color: #990000;">String.</span><span style="font-weight: bold;"><span style="color: black;">length</span></span><span style="color: #990000;">(</span>s<span style="color: #990000;">);</span>
<span style="color: red;">}</span>
function <span style="font-weight: bold;"><span style="color: black;">bar</span></span><span style="color: #990000;">(</span>x<span style="color: #990000;">,</span> y<span style="color: #990000;">)</span> <span style="color: red;">{</span>
   <span style="font-weight: bold;"><span style="color: black;">foo</span></span><span style="color: #990000;">(</span>x<span style="color: #990000;">)</span> <span style="color: #990000;">+</span> y<span style="color: #990000;">;</span>
<span style="color: red;">}</span></tt></pre></div></div><div class="paragraph">The Opa compiler infers:</div><div class="listingblock"><div class="content"><pre><tt><span style="color: #009900;">int</span> function <span style="font-weight: bold;"><span style="color: black;">foo</span></span><span style="color: #990000;">(</span><span style="color: #009900;">string</span> s<span style="color: #990000;">)</span> <span style="color: red;">{</span>
   <span style="color: #990000;">String.</span><span style="font-weight: bold;"><span style="color: black;">length</span></span><span style="color: #990000;">(</span>s<span style="color: #990000;">);</span>
<span style="color: red;">}</span>
<span style="color: #009900;">int</span> function <span style="font-weight: bold;"><span style="color: black;">bar</span></span><span style="color: #990000;">(</span><span style="color: #009900;">string</span> x<span style="color: #990000;">,</span> <span style="color: #009900;">int</span> y<span style="color: #990000;">)</span> <span style="color: red;">{</span>
   <span style="font-weight: bold;"><span style="color: black;">foo</span></span><span style="color: #990000;">(</span>x<span style="color: #990000;">)</span> <span style="color: #990000;">+</span> y<span style="color: #990000;">;</span>
<span style="color: red;">}</span></tt></pre></div></div><div class="paragraph">Similarly, the slicer infers wether a given function may run on the client, the server, both. Over the years, we developed and refined the approach to make it usable past the prototypes. We introduced hints to quickly precise if the client-server should be asynchronous, or synchronous. Wether, the function may, or may not be, callable. And use the rich typing information to make it work.</div><div class="paragraph">The compiler may warn you that:</div><div class="listingblock"><div class="content"><pre><tt>File <span style="color: red;">&quot;errorslicer.opa&quot;</span><span style="color: #990000;">,</span> line <span style="color: #993399;">6</span><span style="color: #990000;">,</span> characters <span style="color: #993399;">17</span>-<span style="color: #993399;">19</span><span style="color: #990000;">,</span> <span style="color: #990000;">(</span><span style="color: #993399;">6</span><span style="color: #990000;">:</span><span style="color: #993399;">17</span>-<span style="color: #993399;">6</span><span style="color: #990000;">:</span><span style="color: #993399;">19</span> <span style="color: #990000;">|</span> <span style="color: #993399;">73</span>-<span style="color: #993399;">75</span><span style="color: #990000;">)</span>
A&sbquo; <span style="color: red;">'malicious'</span> is tagged as <span style="color: red;">'client'</span> but it uses <span style="color: red;">'protected'</span> values<span style="color: #990000;">:</span></tt></pre></div></div><div class="paragraph">to prevent you from doing evil things. If you're curious, the sample <a href="http://pastebin.com/LkJLwfqV">code is here</a>.</div><div class="paragraph">Opa has also built advanced support for MongoDb. And again, we make use of the rich typing information to make things simpler for the developer while automatically ensuring that the code is well written. You can <a href="http://blog.opalang.org/2012/03/programming-tools-ux-experience-how-we.html">read this post</a> by Adam on this subject.</div><div class="paragraph">Opa has become a mature technology and now brings together incredibly clean and concise code, but also security and high-quality to web applications. The feedback we received hinted that Opa's biggest drawback is that it relies on its own application server.</div><div class="paragraph">Opa already and naturally uses JavaScript, as the Opa compiler translates the client-side Opa code to JavaScript. The popularity of the Node.js platform and the good set of tools and technologies now available, convinced us that we should also support Node.js as a new server backend. After all, we already know how to translate from Opa to JavaScript!</div><div class="paragraph">We have the feeling Opa could become the killer framework for writing Node.js applications. Do you also think that would be great?</div></div>
