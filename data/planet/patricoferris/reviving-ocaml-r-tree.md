---
title: Reviving OCaml R-Tree
description:
url: https://patrick.sirref.org/ocaml-rtree/
date: 2023-08-09T00:00:00-00:00
preview_image:
authors:
- https://patrick.sirref.org/Patrick%20Ferris/
source:
ignore:
---


        <p>Antonin Guttman <a href="http://www-db.deis.unibo.it/courses/SI-LS/papers/Gut84.pdf">first proposed R-Trees in 1984</a>.</p>
        <blockquote>
          <p>In order to handle spatial data efficiently, as required in computer aided design and geo-data applications, a database system needs an index mechanism that will help it retrieve data items quickly according to their spatial locations...</p>
        </blockquote>
        <p>There are lots of excellent resources for understanding more about R-Trees and all of the wonderful variations there of (e.g. <a href="http://www.cs.ucr.edu/~ravi/CS236Papers/rstar.pdf">R*-trees</a>). This <a href="https://www.bartoszsypytkowski.com/r-tree/">blog post</a> seems to be the most popular introduction.</p>
        <section>
          <header>
            <h2>An OCaml Rtree Implementation</h2>
          </header>
          <p>In the <a href="https://www.cst.cam.ac.uk/research/eeg">Energy and Environment Group</a> we are working on various geospatial tools, one of which is written in OCaml and needed a geospatial index to speedup spatial queries over a dataset. Searching Github revealed <a href="https://github.com/mariusae/ocaml-rtree">an implementation in pure OCaml</a>. After reaching out to the author, they were more than happy for their work to be maintained in the <a href="https://github.com/geocaml">Geocaml organisation</a>, updated to the latest OCaml tools and <a href="https://github.com/ocaml/opam-repository/pull/24227">hopefully released on opam</a>.</p>
          <p>The <a href="https://github.com/geocaml/ocaml-rtree/commit/073d79ad34de15f0671f2faafb24b1edc5c2d8c7">dunification</a> went smoothly whilst fast-forwarding 15 OCaml compiler versions with no changes or problems (just dune unused variable warnings).</p>
        </section>
        <section>
          <header>
            <h2>OCaml Rtree Examples</h2>
          </header>
          <p>An R-Tree in OCaml is created from an envelope (the kind of bounding box) and a value (for storing in the tree). The value depends on the envelope as you have to provide a function to calculate an envelope from a value. Here is one way we might define a line using the provided two-dimensional <code>Rectangle</code> envelope.</p>
          <pre class="hilite">            <code><span class="ocaml-keyword-other">module</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Line</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other">struct</span><span class="ocaml-source">
</span>
<span class="ocaml-source">  </span><span class="ocaml-keyword-other">type</span><span class="ocaml-source"> </span><span class="ocaml-source">t</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span>
<span class="ocaml-source">    </span><span class="ocaml-source">{ </span><span class="ocaml-source"> </span><span class="ocaml-source">p0</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-support-type">float</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">*</span><span class="ocaml-source"> </span><span class="ocaml-support-type">float</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source"> </span><span class="ocaml-source">p1</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-support-type">float</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">*</span><span class="ocaml-source"> </span><span class="ocaml-support-type">float</span><span class="ocaml-source"> </span><span class="ocaml-source">} </span><span class="ocaml-source">
</span>
<span class="ocaml-source">
</span>
<span class="ocaml-source">  </span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">t</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span>
<span class="ocaml-source">    </span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-keyword">open</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Repr</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other">in</span><span class="ocaml-source">
</span>
<span class="ocaml-source">    </span><span class="ocaml-source">record</span><span class="ocaml-source"> </span><span class="ocaml-string-quoted-double">"</span><span class="ocaml-string-quoted-double">line</span><span class="ocaml-string-quoted-double">"</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-keyword-other">fun</span><span class="ocaml-source"> </span><span class="ocaml-source">p0</span><span class="ocaml-source"> </span><span class="ocaml-source">p1</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">-&gt;</span><span class="ocaml-source"> </span><span class="ocaml-source">{ </span><span class="ocaml-source"> </span><span class="ocaml-source">p0</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source"> </span><span class="ocaml-source">p1</span><span class="ocaml-source"> </span><span class="ocaml-source">} </span><span class="ocaml-source">) </span><span class="ocaml-source">
</span>
<span class="ocaml-source">    </span><span class="ocaml-keyword-operator">|+</span><span class="ocaml-source"> </span><span class="ocaml-source">field</span><span class="ocaml-source"> </span><span class="ocaml-string-quoted-double">"</span><span class="ocaml-string-quoted-double">p0</span><span class="ocaml-string-quoted-double">"</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-source">pair</span><span class="ocaml-source"> </span><span class="ocaml-support-type">float</span><span class="ocaml-source"> </span><span class="ocaml-support-type">float</span><span class="ocaml-source">) </span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-keyword-other">fun</span><span class="ocaml-source"> </span><span class="ocaml-source">t</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">-&gt;</span><span class="ocaml-source"> </span><span class="ocaml-source">t</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">p0</span><span class="ocaml-source">) </span><span class="ocaml-source">
</span>
<span class="ocaml-source">    </span><span class="ocaml-keyword-operator">|+</span><span class="ocaml-source"> </span><span class="ocaml-source">field</span><span class="ocaml-source"> </span><span class="ocaml-string-quoted-double">"</span><span class="ocaml-string-quoted-double">p1</span><span class="ocaml-string-quoted-double">"</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-source">pair</span><span class="ocaml-source"> </span><span class="ocaml-support-type">float</span><span class="ocaml-source"> </span><span class="ocaml-support-type">float</span><span class="ocaml-source">) </span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-keyword-other">fun</span><span class="ocaml-source"> </span><span class="ocaml-source">t</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">-&gt;</span><span class="ocaml-source"> </span><span class="ocaml-source">t</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">p1</span><span class="ocaml-source">) </span><span class="ocaml-source">
</span>
<span class="ocaml-source">    </span><span class="ocaml-keyword-operator">|&gt;</span><span class="ocaml-source"> </span><span class="ocaml-source">sealr</span><span class="ocaml-source">
</span>
<span class="ocaml-source">
</span>
<span class="ocaml-source">  </span><span class="ocaml-keyword-other">type</span><span class="ocaml-source"> </span><span class="ocaml-source">envelope</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Rtree</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-constant-language-capital-identifier">Rectangle</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t</span><span class="ocaml-source">
</span>
<span class="ocaml-source">
</span>
<span class="ocaml-source">  </span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">envelope</span><span class="ocaml-source"> </span><span class="ocaml-source">{ </span><span class="ocaml-source"> </span><span class="ocaml-source">p0</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-source">x1</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-source">y1</span><span class="ocaml-source">) </span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source"> </span><span class="ocaml-source">p1</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-source">x2</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-source">y2</span><span class="ocaml-source">) </span><span class="ocaml-source"> </span><span class="ocaml-source">} </span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span>
<span class="ocaml-source">    </span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">x0</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Float</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">min</span><span class="ocaml-source"> </span><span class="ocaml-source">x1</span><span class="ocaml-source"> </span><span class="ocaml-source">x2</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other">in</span><span class="ocaml-source">
</span>
<span class="ocaml-source">    </span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">x1</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Float</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">max</span><span class="ocaml-source"> </span><span class="ocaml-source">x1</span><span class="ocaml-source"> </span><span class="ocaml-source">x2</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other">in</span><span class="ocaml-source">
</span>
<span class="ocaml-source">    </span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">y0</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Float</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">min</span><span class="ocaml-source"> </span><span class="ocaml-source">y1</span><span class="ocaml-source"> </span><span class="ocaml-source">y2</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other">in</span><span class="ocaml-source">
</span>
<span class="ocaml-source">    </span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">y1</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Float</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">max</span><span class="ocaml-source"> </span><span class="ocaml-source">y1</span><span class="ocaml-source"> </span><span class="ocaml-source">y2</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other">in</span><span class="ocaml-source">
</span>
<span class="ocaml-source">    </span><span class="ocaml-constant-language-capital-identifier">Rtree</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-constant-language-capital-identifier">Rectangle</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">v</span><span class="ocaml-source"> ~</span><span class="ocaml-source">x0</span><span class="ocaml-source"> ~</span><span class="ocaml-source">y0</span><span class="ocaml-source"> ~</span><span class="ocaml-source">x1</span><span class="ocaml-source"> ~</span><span class="ocaml-source">y1</span><span class="ocaml-source">
</span>
<span class="ocaml-keyword-other">end</span><span class="ocaml-source">
</span></code>
          </pre>
          <p>In addition to the <code>envelope</code> function, we also need to provide a runtime representation using <code>Repr</code>. In the example, we've constructed it by hand but I recommend using <a href="https://ocaml.org/p/ppx_repr/latest">ppx_repr</a> to derive it for you. From here we can create our index.</p>
          <pre class="hilite">            <code><span class="ocaml-keyword-other">module</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">R</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Rtree</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-constant-language-capital-identifier">Make</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-language-capital-identifier">Rtree</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-constant-language-capital-identifier">Rectangle</span><span class="ocaml-source">) </span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-language-capital-identifier">Line</span><span class="ocaml-source">) </span><span class="ocaml-source">
</span>
<span class="ocaml-source">
</span></code>
          </pre>
          <section>
            <header>
              <h3>Inserting Values</h3>
            </header>
            <p>There are two ways to insert values into the index -- either by inserting them one-by-one or by bulk loading them. The latter is the recommended approach where possible as the resulting layout of the R-Tree is much better.</p>
            <pre class="hilite">              <code><span class="ocaml-keyword-other">#</span><span class="ocaml-source"> </span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">r</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span>
<span class="ocaml-source">    </span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">i</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">R</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">empty</span><span class="ocaml-source"> </span><span class="ocaml-constant-numeric-decimal-integer">4</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other">in</span><span class="ocaml-source">
</span>
<span class="ocaml-source">    </span><span class="ocaml-constant-language-capital-identifier">R</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">insert</span><span class="ocaml-source"> </span><span class="ocaml-source">i</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Line</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">{ </span><span class="ocaml-source"> </span><span class="ocaml-source">p0</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-numeric-decimal-float">1.</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-constant-numeric-decimal-float">1.</span><span class="ocaml-source">) </span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source"> </span><span class="ocaml-source">p1</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-numeric-decimal-float">2.</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-constant-numeric-decimal-float">2.</span><span class="ocaml-source">) </span><span class="ocaml-source"> </span><span class="ocaml-source">} </span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span>
<span class="ocaml-keyword-other">val</span><span class="ocaml-source"> </span><span class="ocaml-source">r</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">R</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">&lt;</span><span class="ocaml-source">abstr</span><span class="ocaml-keyword-operator">&gt;</span><span class="ocaml-source">
</span></code>
            </pre>
            <p>As you might expect, bulk loading takes a list of values instead.</p>
            <pre class="hilite">              <code><span class="ocaml-keyword-other">#</span><span class="ocaml-source"> </span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">r</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span>
<span class="ocaml-source">    </span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">lines</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span>
<span class="ocaml-source">        </span><span class="ocaml-constant-language-capital-identifier">Line</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">[ </span><span class="ocaml-source">
</span>
<span class="ocaml-source">        </span><span class="ocaml-source">{ </span><span class="ocaml-source"> </span><span class="ocaml-source">p0</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-numeric-decimal-float">0.</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-constant-numeric-decimal-float">0.</span><span class="ocaml-source">) </span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source"> </span><span class="ocaml-source">p1</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-numeric-decimal-float">1.</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-constant-numeric-decimal-float">1.</span><span class="ocaml-source">) </span><span class="ocaml-source"> </span><span class="ocaml-source">} </span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span>
<span class="ocaml-source">        </span><span class="ocaml-source">{ </span><span class="ocaml-source"> </span><span class="ocaml-source">p0</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-numeric-decimal-float">1.</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-constant-numeric-decimal-float">1.</span><span class="ocaml-source">) </span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source"> </span><span class="ocaml-source">p1</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-numeric-decimal-float">2.</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-constant-numeric-decimal-float">2.</span><span class="ocaml-source">) </span><span class="ocaml-source"> </span><span class="ocaml-source">} </span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span>
<span class="ocaml-source">        </span><span class="ocaml-source">{ </span><span class="ocaml-source"> </span><span class="ocaml-source">p0</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-numeric-decimal-float">2.</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-constant-numeric-decimal-float">2.</span><span class="ocaml-source">) </span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source"> </span><span class="ocaml-source">p1</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-numeric-decimal-float">3.</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-constant-numeric-decimal-float">3.</span><span class="ocaml-source">) </span><span class="ocaml-source"> </span><span class="ocaml-source">} </span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span>
<span class="ocaml-source">        </span><span class="ocaml-source">{ </span><span class="ocaml-source"> </span><span class="ocaml-source">p0</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-numeric-decimal-float">3.</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-constant-numeric-decimal-float">3.</span><span class="ocaml-source">) </span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source"> </span><span class="ocaml-source">p1</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-numeric-decimal-float">4.</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-constant-numeric-decimal-float">4.</span><span class="ocaml-source">) </span><span class="ocaml-source"> </span><span class="ocaml-source">} </span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span>
<span class="ocaml-source">        </span><span class="ocaml-source">] </span><span class="ocaml-source">
</span>
<span class="ocaml-source">    </span><span class="ocaml-keyword-other">in</span><span class="ocaml-source">
</span>
<span class="ocaml-source">    </span><span class="ocaml-constant-language-capital-identifier">R</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">load</span><span class="ocaml-source"> ~</span><span class="ocaml-source">max_node_load</span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-constant-numeric-decimal-integer">4</span><span class="ocaml-source"> </span><span class="ocaml-source">lines</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span>
<span class="ocaml-keyword-other">val</span><span class="ocaml-source"> </span><span class="ocaml-source">r</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">R</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">&lt;</span><span class="ocaml-source">abstr</span><span class="ocaml-keyword-operator">&gt;</span><span class="ocaml-source">
</span></code>
            </pre>
          </section>
          <section>
            <header>
              <h3>Spatial Queries</h3>
            </header>
            <p>The lines we loaded into the last index are really just four segments of the line <code>y = x</code>. Let's spatially query for the first two segments.</p>
            <pre class="hilite">              <code><span class="ocaml-keyword-other">#</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">R</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">find</span><span class="ocaml-source"> </span><span class="ocaml-source">r</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-language-capital-identifier">Rtree</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-constant-language-capital-identifier">Rectangle</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">v</span><span class="ocaml-source"> ~</span><span class="ocaml-source">x0</span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-constant-numeric-decimal-float">0.</span><span class="ocaml-source"> ~</span><span class="ocaml-source">y0</span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-constant-numeric-decimal-float">0.</span><span class="ocaml-source"> ~</span><span class="ocaml-source">x1</span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-constant-numeric-decimal-float">2.</span><span class="ocaml-source"> ~</span><span class="ocaml-source">y1</span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-constant-numeric-decimal-float">2.</span><span class="ocaml-source">) </span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span>
<span class="ocaml-keyword-operator">-</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Line</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t</span><span class="ocaml-source"> </span><span class="ocaml-source">list</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span>
<span class="ocaml-source">[ </span><span class="ocaml-source">{ </span><span class="ocaml-constant-language-capital-identifier">Line</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">p0</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-numeric-decimal-float">0.</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-constant-numeric-decimal-float">0.</span><span class="ocaml-source">) </span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source"> </span><span class="ocaml-source">p1</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-numeric-decimal-float">1.</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-constant-numeric-decimal-float">1.</span><span class="ocaml-source">) </span><span class="ocaml-source">} </span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source"> </span><span class="ocaml-source">{ </span><span class="ocaml-constant-language-capital-identifier">Line</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">p0</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-numeric-decimal-float">1.</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-constant-numeric-decimal-float">1.</span><span class="ocaml-source">) </span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source"> </span><span class="ocaml-source">p1</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-numeric-decimal-float">2.</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-constant-numeric-decimal-float">2.</span><span class="ocaml-source">) </span><span class="ocaml-source">} </span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span>
<span class="ocaml-source"> </span><span class="ocaml-source">{ </span><span class="ocaml-constant-language-capital-identifier">Line</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">p0</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-numeric-decimal-float">2.</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-constant-numeric-decimal-float">2.</span><span class="ocaml-source">) </span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source"> </span><span class="ocaml-source">p1</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-numeric-decimal-float">3.</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-constant-numeric-decimal-float">3.</span><span class="ocaml-source">) </span><span class="ocaml-source">} </span><span class="ocaml-source">] </span><span class="ocaml-source">
</span></code>
            </pre>
            <p>You can see the query actually returned the first three, that's because all bound checks are inclusive.</p>
          </section>
        </section>
        <p>The <a href="https://github.com/geocaml/ocaml-rtree/blob/d0a789b8eb6c594ed8c0f9c9a6c4b5cd7c734a03/test/image.mlL95-L106">source repository includes a fairly simple example of rendering an R-Tree</a> using <a href="https://github.com/dbuenzli/vg">Vg</a>. This can be done outside of the repository using the <code>tree</code> representation.</p>
        <pre class="hilite">          <code><span class="ocaml-keyword-other">#</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other">#</span><span class="ocaml-source">show</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">R</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">tree</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span>
<span class="ocaml-keyword-other">val</span><span class="ocaml-source"> </span><span class="ocaml-source">tree</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">R</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">-&gt;</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">R</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">tree</span><span class="ocaml-source">
</span>
<span class="ocaml-keyword-other">type</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other">nonrec</span><span class="ocaml-source"> </span><span class="ocaml-source">tree</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span>
<span class="ocaml-source">  </span><span class="ocaml-constant-language-capital-identifier">R</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">tree</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span>
<span class="ocaml-source">    </span><span class="ocaml-constant-language-capital-identifier">Node</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other">of</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-language-capital-identifier">Line</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">envelope</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">*</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">R</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">tree</span><span class="ocaml-source">) </span><span class="ocaml-source"> </span><span class="ocaml-source">list</span><span class="ocaml-source">
</span>
<span class="ocaml-source">  </span><span class="ocaml-keyword-other">|</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Leaf</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other">of</span><span class="ocaml-source"> </span><span class="ocaml-source">( </span><span class="ocaml-constant-language-capital-identifier">Line</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">envelope</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">*</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Line</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t</span><span class="ocaml-source">) </span><span class="ocaml-source"> </span><span class="ocaml-source">list</span><span class="ocaml-source">
</span>
<span class="ocaml-source">  </span><span class="ocaml-keyword-other">|</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Empty</span><span class="ocaml-source">
</span></code>
        </pre>
        <p>Here is an example rendering from the repository showing some random lines and the envelopes of the R-tree.</p>
        <p style="text-align:center">
    <img src="https://patrick.sirref.org/ocaml-blog/rtree.svg">
</p>
      
