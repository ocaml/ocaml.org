<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><id>https://tarides.com/feed.xml</id><title type="text">tarides</title><updated>2023-06-06T05:48:27-00:00</updated><entry><link href="https://tarides.com/blog/2023-05-05-optimising-archive-node-storage-for-tezos" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;For the past few years, Tarides has been responsible for the storage component of Tezos, from L1 and L2 shells up to the Tezos protocol. In 2022, our main focus was on improving storage performance and UX for running nodes and bakers. Our efforts resulted in significant improvements, including reducing the storage requirements for rolling nodes by 10x and &lt;a href=&quot;https://tarides.com/blog/2022-04-26-lightning-fast-with-irmin-tezos-storage-is-6x-faster-with-1000-tps-surpassed&quot;&gt;decreasing the memory usage of the storage layer by 80%&lt;/a&gt;. We also maintain core storage APIs necessary to scale the TPS of the network. But we didn't stop there! This year, we've already worked on improving the performance of archive nodes and delivered the project last month. In this blog post, we'll take a closer look at our work and what it means for the future of Tezos.&lt;/p&gt;
&lt;p&gt;Last year we released a &lt;a href=&quot;https://tarides.com/blog/2022-11-10-towards-minimal-disk-usage-for-tezos-bakers&quot;&gt;garbage collector (GC) for the &lt;code&gt;irmin-pack&lt;/code&gt; backend&lt;/a&gt; to reclaim disk space. The &lt;code&gt;irmin-pack&lt;/code&gt; backend is notably used by Octez to support the &lt;a href=&quot;https://tezos.com&quot;&gt;Tezos blockchain&lt;/a&gt; storage on disk. In this context, the Irmin GC is used to perform &lt;a href=&quot;https://research-development.nomadic-labs.com/pruning-the-context-and-other-seasonal-activities.html&quot;&gt;context pruning&lt;/a&gt; by &lt;a href=&quot;https://tezos.gitlab.io/user/history_modes.html&quot;&gt;rolling nodes&lt;/a&gt;. This operation reclaims disk space by deleting old blocks that are no longer required to participate in the Tezos consensus algorithm. In Git terms, the rolling nodes only maintain a &lt;a href=&quot;https://github.blog/2020-12-21-get-up-to-speed-with-partial-clone-and-shallow-clone/&quot;&gt;shallow history&lt;/a&gt; of the blockchain. On the other end, archive nodes retain the entirety of the blockchain to ensure integrity. The Irmin GC has the additional benefit of compacting the data on disk, hence improving the performances of disk operations due to better data locality.&lt;/p&gt;
&lt;p&gt;Following the context pruning release in Octez v16, we focused on improving the performances of the Irmin GC, both in its disk usage and memory. We also brought the optimisation benefit of data compaction to archive nodes. As the Tezos blockchain keeps growing, the archive nodes storage requirements are also becoming problematic, so our solution opens the possibility to use multiple hard drives to scale beyond a single disk. In the future, this could enable archive node operators to use a small SSD with excellent performance to store the most recent blocks, while storing older blocks on a larger, less expensive disk.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#archive-node-storage-optimisations&quot; aria-label=&quot;archive node storage optimisations permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Archive Node Storage Optimisations&lt;/h2&gt;
&lt;p&gt;In the following, we'll explain how and why the new archive node storage was divided into multiple volumes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The &lt;code&gt;upper&lt;/code&gt; volume contains the most recent history and is identical to the store used by a rolling node. This volume stores everything necessary to participate in endorsements and the Tezos consensus algorithm.&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;lower&lt;/code&gt; volumes are separate folders that store older blocks to preserve the blockchain's integrity and respond to RPC requests.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;When Octez interacts with the store, Irmin transparently directs reads and writes to the correct volume, which has the same API as before. New public APIs added in Irmin 3.7 allow Octez to configure the lower volumes directory and to create new lower volumes dynamically.&lt;/p&gt;
&lt;p&gt;An important consideration is that each volume is &lt;em&gt;self-contained&lt;/em&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Reading recent history and adding new blocks will only interact with the &lt;code&gt;upper&lt;/code&gt; volume, with no need to consult the lower volumes at all. This implies that archive nodes will perform exactly the same operation and access the same data layout as if one was running as a rolling node.&lt;/li&gt;
&lt;li&gt;Reading information about an old block, and recursively all of its children's objects, will only perform reads from one specific &lt;code&gt;lower&lt;/code&gt; volume pertaining to that block. As an example, it means that an RPC request to read a block will interact only with a single volume.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In other words, data locality is enforced and random reads are bounded to a much smaller region (proportional to the size of the volumes where the operation takes place).&lt;/p&gt;
&lt;p&gt;To achieve these self-contained volumes, a bit of data duplication is required. This is where the Irmin GC compaction algorithm intervenes! Each volume contains a small summary of the old data required for self-containment. Thanks to this summary, complex reads can avoid visiting other lower volumes since the required data can be found locally. This has two benefits:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;This data summary is compacted. Previously, archive nodes performance suffered from random reads into an enormous data file, which caused them to be slower than rolling nodes. With the new &lt;code&gt;upper&lt;/code&gt; volume, archive nodes will be able to perform those expensive reads from the compact summary -- in the exact same way as rolling nodes already do.&lt;/li&gt;
&lt;li&gt;As long as configured paths are preserved, each &lt;code&gt;upper&lt;/code&gt; and &lt;code&gt;lower&lt;/code&gt; volume can be stored on different disks. The initial Octez integration will not expose these capabilities directly, but as the blockchain history continues to grow, this feature will provide flexibility for the capabilities that Octez provides for archive node operators.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Furthermore, the GC compaction algorithm is also applied to the lower volumes data. The Tezos blockchain can contain temporary forks that will be abandoned later. While those blocks are important in the &lt;code&gt;upper&lt;/code&gt; volume until consensus has been reached, they can safely be removed when data is transferred to a lower volume. This saves disk space and cleans up the blockchain from unused blocks.&lt;/p&gt;
&lt;p&gt;The following graphs show the performances of the new archive nodes compared to the existing fast rolling nodes. We replay the Tezos blockchain trace, performing all operations as fast as possible (in the same way it happened, only without network interference). By recording the disk space used by the two nodes over time, we can observe how fast they can process and store new blocks on disk:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/3cd75fea0c5787c8908da50c03426953/c1b63/irminGC_1.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABD0lEQVR42m1SSY7DMAzL/x/YW39QpGniTQupgZxJO8CU4EGQRa1eRERV/RuO41jXtdYKwCb+vgJYeu+ttYjgPwCAO0lzB3E6xW3MLCKyjDF67xEB0ojMMtndMA0jmqsSNqmAEpniFLfeGDFgHebvILoRTjD4ZlwgqaqLiJTWEGGe0gxiEGF2RgUQIsx2plaFjgCmuPdealZWpQw6wxFuMQbd42T6Mf1MsRnUPm33q5lZd05NgPBgMoeAnfZkjqUqS+u91ZIC2uQnIgI5QG4R1x45L5CXyrazcq3BsxT47WYnIuK5bff7/Xa7PbfX78L2fb/yeSlljHF+idzlcbiZz8OWUrZtezwe67oe+6u1+gNJ+EzYiAQfggAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/3cd75fea0c5787c8908da50c03426953/c5bb3/irminGC_1.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;irminGC 1&quot; title=&quot;&quot; srcset=&quot;/static/3cd75fea0c5787c8908da50c03426953/04472/irminGC_1.png 170w,
/static/3cd75fea0c5787c8908da50c03426953/9f933/irminGC_1.png 340w,
/static/3cd75fea0c5787c8908da50c03426953/c5bb3/irminGC_1.png 680w,
/static/3cd75fea0c5787c8908da50c03426953/b12f7/irminGC_1.png 1020w,
/static/3cd75fea0c5787c8908da50c03426953/c1b63/irminGC_1.png 1200w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The purple sawtooth wave of the rolling node disk usage corresponds to when the Irmin garbage collector visits the &lt;code&gt;upper&lt;/code&gt; volume to release old blocks and free disk space. In production, this happens at the end of every Tezos cycles.&lt;/p&gt;
&lt;p&gt;In the case of archive nodes, this old data will not be deleted. Instead, it will be transferred and compacted to the lower volume (in yellow). This results in an increasing total disk space (in green) as the blockchain grows. The blue line shows that the data transfer can take a few minutes (depending on the hard drive that stores the &lt;code&gt;lower&lt;/code&gt; volume)! But as this data transfer is done in a background process, the new archive node is able to keep up with the fast rolling node performance like clockwork. The graph confirms this assertion, as the &lt;code&gt;upper&lt;/code&gt; disk space used by the archive node (in blue) is same as the disk space used by the rolling node (in purple). This means that both nodes were able to process new blocks at the same speed.&lt;/p&gt;
&lt;p&gt;This is not a big surprise, since archive nodes are running the same code as a rolling node in their &lt;code&gt;upper&lt;/code&gt; volume. In fact, one could imagine deleting the lower archived volumes, and the archive node would keep working as a rolling node! (Well, almost! We have a security in place to detect that an archive node was incorrectly configured and has lost parts of its history, which could happen if the &lt;code&gt;lower&lt;/code&gt; volumes are moved to a different disk.)&lt;/p&gt;
&lt;p&gt;Looking at the nodes' memory usage, we can see that the tradeoff for using the efficient &lt;code&gt;upper&lt;/code&gt; volume optimisation in archive nodes is that they must now run the Irmin garbage collector. The GC requires some extra RAM while it runs, causing spikes in memory usage:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/e478e5e71b1322f0b554c164b3506a97/c1b63/irminGC_2.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGklEQVR42mWS2W4DMQhF8//fmk6TsYf9QoWdNpXCg4XAh+XaNyIys4hw9/g1dwcw5zyOg4UBxIcBuI0xiKiq8sMAJKAWqr7zEZikO2VmDTNzVal3taoCksUtXj6RD5JVvUSD1bFKNzznZGYgTxJye1UJDJGsUm3/ZMnV2QPi3tc2fF0kwoEksQ1bT5DPBS818g0D3dy9MlXtNlbnQJqFeiy4l5Xes2FEqkWupVtG7zORynajZR1dQFaJR+c0kCuChiMzgA2zuZjzpS3YOWbLk6UGczRc5Z5mYPHMQqQ51MPR1xLlGg3vzpWvp6raA76d//GqIqbj+BLWFkxEns/n39PPOUVk/xMRGWNs393P8zS3Oeb9fv9+PC6iHwBpS7u+KOewAAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/e478e5e71b1322f0b554c164b3506a97/c5bb3/irminGC_2.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;irminGC 2&quot; title=&quot;&quot; srcset=&quot;/static/e478e5e71b1322f0b554c164b3506a97/04472/irminGC_2.png 170w,
/static/e478e5e71b1322f0b554c164b3506a97/9f933/irminGC_2.png 340w,
/static/e478e5e71b1322f0b554c164b3506a97/c5bb3/irminGC_2.png 680w,
/static/e478e5e71b1322f0b554c164b3506a97/b12f7/irminGC_2.png 1020w,
/static/e478e5e71b1322f0b554c164b3506a97/c1b63/irminGC_2.png 1200w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Otherwise the analysis of the memory graph is the same. The GC context pruning terminates a bit earlier for rolling nodes, as archive nodes have to go through the additional step of compacting old data and transferring it to the &lt;code&gt;lower&lt;/code&gt; volume (while rolling nodes just delete it). Once again, we get a confirmation that this extra work does not impact the archive node's performance. Rather, it keeps processing new blocks as fast as a rolling node! Both nodes reach the end of the cycles at the same time, triggering the next GC memory spike.&lt;/p&gt;
&lt;p&gt;While the integration of these features into Octez is still in-progress, early results show a noticeable decrease in bootstrapping time (by ~30%!) for an archive node when it is using &lt;code&gt;lower&lt;/code&gt; volumes versus when it is not. These results need further verification, but they demonstrate some of the potential expected performance improvements for archive nodes.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#other-optimisations-in-irmin-35-36-and-37&quot; aria-label=&quot;other optimisations in irmin 35 36 and 37 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Other Optimisations in Irmin 3.5, 3.6, and 3.7&lt;/h2&gt;
&lt;p&gt;Behind the scenes, further optimisations of Octez context pruning have been introduced. They provide benefits to both the existing rolling nodes and the new archive node volumes.&lt;/p&gt;
&lt;p&gt;First in Irmin 3.5, we fixed the garbage collector to bound the amount of disk space required to perform a context pruning:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/fdc8beac811d659519cd2bfd8ea23f0d/c1b63/irminGC_3.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEUlEQVR42qVSy27DMAzr/39or03iJNabg+QmTbceCkwAIciWaVL2TUSQMLM/UFVM01R4PB6FZVk+9ibcHbd937FtGzI8HGKKiDiRTaxa+UQ41O3VEwHSIewXYWATqkN5Y3jUejfFNTQvdjtri0D/RGjh6MJlK5GWk5Jt5COSTN3fLsieIkyygzAbSeRNDathpw5iGqoDYDdIEgbKcvYUIT8Jl9aQ7kQNvStUHWpeKpgM89Qwt3WsqYMlFdmoLWfsIFEQ8bC8ruuQ8/R1DPsa8do+lcVlEKmehd9n+J+o38CMW+/9JLx+l29QM2bGPM/YicD5KERUHzdfNK3nS2W+1q21qo987KeQdHi/37Gue+3/AGR7E4M2QWY/AAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/fdc8beac811d659519cd2bfd8ea23f0d/c5bb3/irminGC_3.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;irminGC 3&quot; title=&quot;&quot; srcset=&quot;/static/fdc8beac811d659519cd2bfd8ea23f0d/04472/irminGC_3.png 170w,
/static/fdc8beac811d659519cd2bfd8ea23f0d/9f933/irminGC_3.png 340w,
/static/fdc8beac811d659519cd2bfd8ea23f0d/c5bb3/irminGC_3.png 680w,
/static/fdc8beac811d659519cd2bfd8ea23f0d/b12f7/irminGC_3.png 1020w,
/static/fdc8beac811d659519cd2bfd8ea23f0d/c1b63/irminGC_3.png 1200w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This has already been made available in Octez v16 with the release of Irmin 3.5 in December 2022.&lt;/p&gt;
&lt;p&gt;In Irmin 3.6, the compaction algorithm was optimised to traverse the blockchain in disk order. Reducing random accesses yields a faster context pruning duration and lower the memory requirements by half during GC. The memory graph below shows the improvements, both in the height and width of the spikes induced by the GC, with Irmin 3.5 in green and Irmin 3.6 in orange:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/983855a61ae317b8d8a84e3ec37a191b/29007/irminGC_4.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 34.11764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8UlEQVR42n2R2U7FMAxE+/9/WnErIIl3p4OctoIHwNJRHXs8WboRESICmfkrc06ICFpr/+qK6m/7vsPdUXGe598AyDkxz7k2qW/Ma8Oq5zlh7tiO41juTzyDJSgjn7mIGiiDVbv6mrG0cfc1HFtd5adhDUg6LAOegW4CcoWFohvDw8BGUGN0JZgzqNYzIW7XCevuT+RMDB0Q6VDt6PQO4g+YdLA0yKJD5ROkAyYNLB0yA1qGr9cbhAkeigyFGy+RGUHqBDfugnBetXBduBu88rD1LFpvyMzoraH+No1xQTfMGMQozRi0IPrOr/Wd975mvwBgSCQtiW8FpgAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/983855a61ae317b8d8a84e3ec37a191b/c5bb3/irminGC_4.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;irminGC 4&quot; title=&quot;&quot; srcset=&quot;/static/983855a61ae317b8d8a84e3ec37a191b/04472/irminGC_4.png 170w,
/static/983855a61ae317b8d8a84e3ec37a191b/9f933/irminGC_4.png 340w,
/static/983855a61ae317b8d8a84e3ec37a191b/c5bb3/irminGC_4.png 680w,
/static/983855a61ae317b8d8a84e3ec37a191b/b12f7/irminGC_4.png 1020w,
/static/983855a61ae317b8d8a84e3ec37a191b/b5a09/irminGC_4.png 1360w,
/static/983855a61ae317b8d8a84e3ec37a191b/29007/irminGC_4.png 1600w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Finally in Irmin 3.7, the summary produced by the compaction algorithm and present in each &lt;code&gt;upper&lt;/code&gt; and &lt;code&gt;lower&lt;/code&gt; volumes was optimised for reading speed. As this summary is accessed often, we can see from the trace replay that operations start to perform faster once the compacted summary is available, right after the first GC:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/92e609bb6140e5881db902796622042a/29007/irminGC_5.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 34.705882352941174%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsklEQVR42p2S2w6DMAxD+f+/BbXkHk8JgzFtL5ulo1ZJcV3ahZmhqnD3DyIC+75jXVds29aY2de1RfWWOSfKtJSZbwAngIh3TbU+dJg61A5EDBkJUcEyxoCI4JvKwCwaIoNqgNgg6mA2sBTH3C37pJ3wbphIeMRlFJG3DZ6ZX8Hf1Ib1j8qw+ubRlOFx5N90JZxEr53/VF1gBVuICOfFVIGYe15Ur2u38Vp3qxX1AsaYeACmfCg4c2+S5QAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/92e609bb6140e5881db902796622042a/c5bb3/irminGC_5.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;irminGC 5&quot; title=&quot;&quot; srcset=&quot;/static/92e609bb6140e5881db902796622042a/04472/irminGC_5.png 170w,
/static/92e609bb6140e5881db902796622042a/9f933/irminGC_5.png 340w,
/static/92e609bb6140e5881db902796622042a/c5bb3/irminGC_5.png 680w,
/static/92e609bb6140e5881db902796622042a/b12f7/irminGC_5.png 1020w,
/static/92e609bb6140e5881db902796622042a/b5a09/irminGC_5.png 1360w,
/static/92e609bb6140e5881db902796622042a/29007/irminGC_5.png 1600w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;A read intensive benchmark shows the performance boost on different read patterns and volume sizes:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/24dc9eaddaa44b675924e0b8833df9f0/9b29b/irminGC_6.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 52.94117647058824%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA9hAAAPYQGoP6dpAAACK0lEQVR42n2T20tUURSHhWKgyNHQP6A/wp4SAjN66PJURC9RvYRCL0UIyahzMyG6WBjVmDP2oKY2jYjQQ4lFFwTRdC4NzcXUnAnFMJyccc7e+4tzjjgzFO2Hvdbal4+11v7tMv4zlFJIQOpWSqRUqH+dK/LL9EnTNPOC0MivJhGb6wZoa+MnmelhsqvfyOUFuc2MsSZFHqlA5jbIpSJkfq3toE1gPm8AVGYNHNUw5TX3V6KoZguE/Gami5OojgOw8MmMw6MoexUiHdrmyQLQSPv3Gtj2oiafmPFK1IyDfjOefw83LKjEhAkIj0DLPuSPcAGo9wUkA1PL3PJ/gFYrzHi5/XEdt88P9nKIBHgWzDISGAS7FZV8x1hSMP3KB879iHQRMJvbMoAN/XMcbH4ObVaY9XG2b57jNg84yuFLgMOPopxvuQvtlYj4W2ruBWlyuqCjCi1VVLImhOFf94c56nppZjjr4+LwEmec3h3gqd44je4H4K4wgLUPI9hutpvA4h4Ko2TF1aEQR5x+aK2Az14uDC5y2qEDrUbJJ7wxGlz3wV2JFp+gtiu8Dawmn/oLCFcGghxqGYLm3TDTzbn+BU7qJdt2QfgF9Z6vXGq7A3YLIjZOTWeIJocdnHvQlueKHmVblZ3jcRo9r5GP6yA2hvNNmiZPALrrIDnBtdEF2rv7oKce8X2ay8MJunqeQu8xtNVEqWx2FK+LWxV0r4vd+C1CmFYpw5bul/6aP+518xVDfNWNAAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/24dc9eaddaa44b675924e0b8833df9f0/c5bb3/irminGC_6.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;irminGC 6&quot; title=&quot;&quot; srcset=&quot;/static/24dc9eaddaa44b675924e0b8833df9f0/04472/irminGC_6.png 170w,
/static/24dc9eaddaa44b675924e0b8833df9f0/9f933/irminGC_6.png 340w,
/static/24dc9eaddaa44b675924e0b8833df9f0/c5bb3/irminGC_6.png 680w,
/static/24dc9eaddaa44b675924e0b8833df9f0/b12f7/irminGC_6.png 1020w,
/static/24dc9eaddaa44b675924e0b8833df9f0/b5a09/irminGC_6.png 1360w,
/static/24dc9eaddaa44b675924e0b8833df9f0/9b29b/irminGC_6.png 3840w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;The Irmin 3.5 and 3.6 releases brought much needed disk and memory optimisations to Octez context pruning for rolling nodes. The Irmin 3.7 release brings more improvements to rolling nodes and introduces the same optimised garbage collection design to archive nodes, allowing them to have the same small and efficient store for recent history and enabling future improvements for storing history on multiple disks. Integration of Irmin 3.7's features into Octez is in-progress and will ship in a future version of Octez. In the meantime, we welcome your comments and feedback on the optimisations and design choices. Join the conversation on the &lt;a href=&quot;https://discuss.ocaml.org/&quot;&gt;OCaml Discuss forum&lt;/a&gt;, in the &lt;a href=&quot;https://github.com/mirage/irmin/issues&quot;&gt;GitHub Issues&lt;/a&gt;, and through comments on the &lt;a href=&quot;https://forum.tezosagora.org/&quot;&gt;Tezos Agora post&lt;/a&gt;.&lt;/p&gt;</content><id>https://tarides.com/blog/2023-05-05-optimising-archive-node-storage-for-tezos</id><title type="text">Optimising Archive Node Storage for Tezos</title><updated>2023-05-05T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2023-04-28-ocaml-at-minidebconf-tn-2023" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;&lt;a href=&quot;https://tn23.mini.debconf.org/&quot;&gt;MinidebConf TN 23&lt;/a&gt; was organised by Debian Developers and Villupuram Linux Users Group (VGLUG) as a precursor to DebConf 23 in September at Kochi, India. I had an opportunity to attend and speak at MiniDebConf TN.&lt;/p&gt;
&lt;p&gt;I presented two sessions, one built on our experiences of introducing &lt;a href=&quot;https://github.com/ocaml/code-of-conduct&quot;&gt;a Code of Conduct&lt;/a&gt; to an &lt;a href=&quot;https://discuss.ocaml.org/t/adopting-the-ocaml-code-of-conduct/10870&quot;&gt;open source community&lt;/a&gt; &lt;a href=&quot;https://hackmd.io/JIWCOrBfQ7CfzPqeDw4t2Q#/&quot;&gt;(slides here&lt;/a&gt;), and one called &lt;a href=&quot;https://hackmd.io/wgB3EzlAQA6aTnQGyyp5Rw#/&quot;&gt;&lt;em&gt;An Invitation to OCaml&lt;/em&gt;&lt;/a&gt;, aimed at people with no prior OCaml experience. I was pleased to see a lot of folks getting interested in learning OCaml.&lt;/p&gt;
&lt;p&gt;Over the course of two days, I attended interesting sessions by speakers from across India and other parts of the world.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#first-day&quot; aria-label=&quot;first day permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;First Day&lt;/h3&gt;
&lt;p&gt;The conference was inaugurated by Dr. Ravikumar, a Member of Parliament (MP) from the Villupuram district. A tech-savvy politician who has presence in the fediverse, the MP emphasised the importance of adopting FOSS technologies by the government in his speech. He released the private beta of &lt;a href=&quot;https://prav.app/&quot;&gt;Prav&lt;/a&gt;, a privacy-focussed communication app.&lt;/p&gt;
&lt;p&gt;The first session was &amp;quot;Introduction to Debian&amp;quot; by Sruthi Chandran, the first and only woman Debian Developer from India. It was interesting to see how the Debian community is comprised of a diverse set of people all across the world and is completely driven by volunteers. I learnt about the &lt;em&gt;do-o-cratic model&lt;/em&gt;, where people doing the work make decisions.&lt;/p&gt;
&lt;p&gt;A professor at RV College of Engineering and a FOSS enthusiast, Dr. &lt;a href=&quot;http://deepikak.in/&quot;&gt;Deepika&lt;/a&gt;'s session on the KDE ecosystem was a great primer on motivating people to move to FOSS technologies. I found her suggestion to use the term &lt;em&gt;Swatantra Software&lt;/em&gt; to indicate Free Software (Free as in Freedom) to be a great one. Then, Martha and Kelvin, mappers by profession, took us through the journey of OpenStreetMaps from a blank state to its growth of being at par with other maps. They did a quick session on how to contribute to it.&lt;/p&gt;
&lt;p&gt;Later I presented a session on &amp;quot;Introducing a Code of Conduct&amp;quot; to an open-source community. This talk was built upon our experience of drafting and enforcing a Code of Conduct for the OCaml community, which led to completion in late 2022. This effort started earlier in the same year, with the idea of first forming a group of respected members in the community to act as the enforcement team. The effort was &lt;a href=&quot;https://discuss.ocaml.org/t/ocaml-software-foundation-january-2023-update/11217#community-3&quot;&gt;supported by the OCaml Software foundation&lt;/a&gt;. Once the team had enough strength, we worked on drafting a &lt;a href=&quot;%28https://github.com/ocaml/code-of-conduct)&quot;&gt;Code of Conduct document&lt;/a&gt;, largely inspired from existing texts, and iterating it over till it was accepted by the community.&lt;/p&gt;
&lt;p&gt;The day ended with a speakers-only round table session of &lt;em&gt;FOSSivist&lt;/em&gt;. It was a discussion with VGLUG volunteers on how to utilize Free and Open Source Software technologies to uplift the lives of underprivileged students in the district. For context, Villupuram falls in the bottom five in the literacy rate, both average and female literacy rate. VGLUG was formed by a group of volunteers actively working on identifying talented first-generation Villupuram learners and training them for a career in tech.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#second-day&quot; aria-label=&quot;second day permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Second Day&lt;/h3&gt;
&lt;p&gt;The second day saw another lineup of interesting sessions. First was an introduction to contributing to Linux kernel by &lt;a href=&quot;https://nihaal.me/&quot;&gt;Nihal&lt;/a&gt;. This was followed by &lt;a href=&quot;https://gwolf.org/&quot;&gt;Gunnar Wolf&lt;/a&gt;'s session on Debian authentication. It was evident Debian takes privacy seriously, and he urged the listeners to do so too. Bhuvana presented a session on why Diversity and Inclusion is important in tech.&lt;/p&gt;
&lt;p&gt;This was followed by my presentation on &lt;a href=&quot;https://hackmd.io/wgB3EzlAQA6aTnQGyyp5Rw#&quot;&gt;&lt;em&gt;An Invitation to OCaml&lt;/em&gt;&lt;/a&gt;. I talked about all the nice things OCaml offers, including the new and &lt;a href=&quot;https://www.youtube.com/watch?v=zJ4G0TKwzVc&quot;&gt;exciting features in OCaml 5&lt;/a&gt; with Multicore support. The talk is aimed at folks who've been programming in other languages, but new to Functional Programming. We go over why FP, slowly moving on to talk about OCaml features like immutability, type inference, garbage collection, etc. We also briefly touch upon the new features in OCaml 5, namely native support for parallelism and concurrency. It was great to chat about functional programming with folks afterwards.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ranjithsiji&quot;&gt;Renjith&lt;/a&gt;, an active Wikipedian, presented their story of moving a Malayalam daily newspaper called &lt;em&gt;Janayugom&lt;/em&gt; to an entirely FOSS tech stack. This saved the company a lot of money and stopped &lt;em&gt;Janayugom&lt;/em&gt; from shutting down. Renjith emphasised the importance of free speech in a democracy and how small maganizes and newspapers play a role in it. Then Subin presented Varnam, an Indic input tool.&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;I was impressed by the efforts taken by &lt;a href=&quot;https://vglug.org/&quot;&gt;VGLUG volunteers&lt;/a&gt; and the Debian India team to organise everything in a smooth manner. From the time we landed in Villupuram, we did not worry about anything. Transport, food, and lodging were all taken care of by VGLUG volunteers. I did not think such a vibrant community of FOSS users would operate in a rural town. The community is doing great work to uplift the lives of people in their Villupuram.&lt;/p&gt;
&lt;p&gt;Best of all, it was great to meet old friends and make new ones. I hope to spread the joy of OCaml in more places.&lt;/p&gt;</content><id>https://tarides.com/blog/2023-04-28-ocaml-at-minidebconf-tn-2023</id><title type="text">OCaml at MinidebConf TN 2023</title><updated>2023-04-28T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2023-03-22-compiler-hacking-in-cambridge-is-back" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;What&amp;rsquo;s the best way to spend a Friday evening? We think most people would agree that hacking on OCaml is pretty much at the top of that list (although full disclosure, our sample size for this data could be larger).&lt;/p&gt;
&lt;p&gt;On Friday the 24th of February, Tarides&amp;rsquo;s UK office hosted an evening of compiler hacking, presentations, and talks about all things OCaml. We&amp;rsquo;re continuing a tradition that began in 2013, making this our 19th event, when we (then known as OCaml Labs) were based at the &lt;a href=&quot;https://ocamllabs.io/compiler-hacking/&quot;&gt;Computer Lab&lt;/a&gt; in Cambridge. Just like back then, anyone with an interest in the OCaml compiler is welcome. At our recent event we had a mixture of students, industry professionals, and experts in attendance. If you'd like to create your own compiler hacking sessions, check out the &lt;a href=&quot;https://github.com/tarides/compiler-hacking/wiki&quot;&gt;wiki here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Something that&amp;rsquo;s changed since 2013 is that OCaml now represents a large chunk of the undergraduate Computer Science tripos at the University of Cambridge; not only as the implementation language for courses such as Compiler Construction &amp;amp; Semantics of Programming Language, but literally as the first language students are taught! This means that we had quite a few undergraduates turn up &amp;ndash; it was great to see such an interest in OCaml across different backgrounds.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/28ce5039a7c2f139cc25067e673c960a/94358/talk_compiler.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 131.76470588235293%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMFAgT/xAAWAQEBAQAAAAAAAAAAAAAAAAABAwL/2gAMAwEAAhADEAAAAZzKu6EYST0rtS+mXmAf/8QAHBAAAgIDAQEAAAAAAAAAAAAAAQMAAhESEwQy/9oACAEBAAEFAuRmlsV44VfZdiNa2IH1EJWwHzpiIRBUY//EABYRAAMAAAAAAAAAAAAAAAAAAAERIP/aAAgBAwEBPwFmP//EABgRAAMBAQAAAAAAAAAAAAAAAAEQEQIh/9oACAECAQE/ARkKcq//xAAgEAACAAYCAwAAAAAAAAAAAAAAAQIDERIhMRAzImGh/9oACAEBAAY/AuuM64kjzmNP0hN7HlaMFR3u2hib9HxpH//EAB4QAQACAgMAAwAAAAAAAAAAAAEAESFBMWFxUYHR/9oACAEBAAE/Id+L0iGAHUuv8Itl4Q2nexuUoCeQLu17ZmL8OCyX8H2ICsYSFhPyqf/aAAwDAQACAAMAAAAQzPxM/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEB/9oACAEDAQE/ENtGYqv/xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQIBAT8QwaSsUwv/xAAhEAEAAwABAgcAAAAAAAAAAAABABEhQTGBUWFxkcHR4f/aAAgBAQABPxAVBe4G+JnRLRbXmsZ0fmgPWBXsrQWnNR5O3B8Jv/LujveKy3o/p3iGiigghd7zBGkVv0oi0OnUllKnLOmxpv2E/9k='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/28ce5039a7c2f139cc25067e673c960a/7bf67/talk_compiler.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;David's Talk&quot; title=&quot;&quot; srcset=&quot;/static/28ce5039a7c2f139cc25067e673c960a/651be/talk_compiler.jpg 170w,
/static/28ce5039a7c2f139cc25067e673c960a/d30a3/talk_compiler.jpg 340w,
/static/28ce5039a7c2f139cc25067e673c960a/7bf67/talk_compiler.jpg 680w,
/static/28ce5039a7c2f139cc25067e673c960a/990cb/talk_compiler.jpg 1020w,
/static/28ce5039a7c2f139cc25067e673c960a/c44b8/talk_compiler.jpg 1360w,
/static/28ce5039a7c2f139cc25067e673c960a/94358/talk_compiler.jpg 3839w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#a-welcome-and-introduction-to-the-compiler&quot; aria-label=&quot;a welcome and introduction to the compiler permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A Welcome and Introduction to the Compiler&lt;/h2&gt;
&lt;p&gt;The afternoon began with our very own David Allsopp giving the first of the day&amp;rsquo;s two talks. He briefly laid the foundation for what Tarides is and what we do, but focussed on introducing OCaml and outlining some examples of things to hack on. Since we had the pleasure of hosting many undergraduate students who were new to the OCaml community, as well as some grizzled veterans (sorry, Jon!), it was important to have a selection of projects for all abilities.&lt;/p&gt;
&lt;p&gt;Suggestions included bug fixes (which are always welcomed), documentation edits and improvements (which are always needed), and &lt;a href=&quot;https://github.com/ocaml/ocaml/issues/&quot;&gt;issues&lt;/a&gt; labelled with the tag &amp;ldquo;good first issue&amp;rdquo; or &amp;ldquo;newcomer job.&amp;rdquo; Compilers that are self-bootstrapped (like OCaml) always require a &lt;a href=&quot;https://dl.acm.org/doi/pdf/10.1145/358198.358210&quot;&gt;complex build system&lt;/a&gt;, so David concluded with a demonstration of the sequence of build system targets, explaining each step along the way.&lt;/p&gt;
&lt;p&gt;Once the introduction was over, the room settled into a hive of activity, with some people furiously typing and others scratching their heads and looking thoughtful. Many of the undergrads focused on getting familiar with the OCaml compiler, whereas more experienced developers began undertaking their own hacking projects. We had invited well-known OCaml compiler hackers (including some of our own) as an awesome resource for all levels of experience. A combination of in-person hacking and an informal setting provided the perfect environment for sharing imaginative new ideas - something we&amp;rsquo;ve all been missing since the pandemic.&lt;/p&gt;
&lt;p&gt;With everyone divided up into smaller working groups, we worked our way around trying to help everyone make some progress. Groups were working on projects at all levels: some were trying to get the compiler to run &lt;code&gt;hello world&lt;/code&gt;, whilst others (Patrick!) were forward-porting advanced modal type features between major versions of the compiler. A third year undergraduate was working on debugging the OCaml compiler for her dissertation, and she was attempting to use &lt;a href=&quot;https://en.wikipedia.org/wiki/Hash_consing&quot;&gt;hash consing&lt;/a&gt; to make multiple identical values use the same bit of memory rather than multiple memory slots as a space-saving solution for the compiler.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/78aff19d70430adf340f314c7cc209b4/e7156/ryan.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 167.05882352941177%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAhABQDASIAAhEBAxEB/8QAGQAAAwEBAQAAAAAAAAAAAAAAAAMEAgEF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQAC/9oADAMBAAIQAxAAAAGheJttQsJfn45FAsZOQyOAX//EAB0QAQACAgIDAAAAAAAAAAAAAAEAAgMSECEREyD/2gAIAQEAAQUCinG42yaGQRns1nbKZtBs+W9mdPx//8QAFhEAAwAAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/ART/AP/EABYRAQEBAAAAAAAAAAAAAAAAAAARIP/aAAgBAgEBPwFVx//EAB4QAAIBAwUAAAAAAAAAAAAAAAEQMQAREiAiQVGB/9oACAEBAAY/AufSyOqFytsq2IKmo0f/xAAeEAEAAgICAwEAAAAAAAAAAAABABEhMUFxEFFhgf/aAAgBAQABPyEqvbsmgpfEuBaN7XPojNcVB7LfyWWG2mOdp9uNRqWXtWJaK/Ypal7ghaLh44Op/9oADAMBAAIAAwAAABBjELwPz//EABcRAAMBAAAAAAAAAAAAAAAAAAEQEQD/2gAIAQMBAT8QA1Kl/wD/xAAaEQACAgMAAAAAAAAAAAAAAAAAARARIUFR/9oACAECAQE/EG+FTApGo//EAB0QAQADAAIDAQAAAAAAAAAAAAEAESExQWGBoVH/2gAIAQEAAT8Qp7MamJaClwXWJGrMhi6AqBv5G1ZQWrV0j5gVpLRUpNEBF8y5fu1rl2x2cs6nxioC/CeQOKgQxernBnXuPzT/2Q=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/78aff19d70430adf340f314c7cc209b4/7bf67/ryan.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Ryan hacking on modal types&quot; title=&quot;&quot; srcset=&quot;/static/78aff19d70430adf340f314c7cc209b4/651be/ryan.jpg 170w,
/static/78aff19d70430adf340f314c7cc209b4/d30a3/ryan.jpg 340w,
/static/78aff19d70430adf340f314c7cc209b4/7bf67/ryan.jpg 680w,
/static/78aff19d70430adf340f314c7cc209b4/990cb/ryan.jpg 1020w,
/static/78aff19d70430adf340f314c7cc209b4/c44b8/ryan.jpg 1360w,
/static/78aff19d70430adf340f314c7cc209b4/e7156/ryan.jpg 3527w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#local-allocations-and-pizza&quot; aria-label=&quot;local allocations and pizza permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Local Allocations and Pizza&lt;/h2&gt;
&lt;p&gt;After a couple of hours of hacking, Stephen Dolan gave us a tour of his and Leo White&amp;rsquo;s ground-breaking work on stack allocation. This work was &lt;a href=&quot;http://stedolan.net/talks/ocaml22/#1&quot;&gt;presented at ICFP 2022&lt;/a&gt; and is a compiler feature that aims to improve performance by reducing heap allocations in OCaml programs. Local allocations let programs use space on the stack (instead of allocating on the heap), which is automatically reclaimed without requiring the assistance of the (resource-heavy) garbage collector (GC).  OCaml uses a stop-the-world parallel garbage collector for collecting recently allocated objects in the minor heap. This means that all the OCaml threads will need to stop when the minor heap is collected. Generating fewer heap allocations means less garbage, and less garbage means improved performance and reduced pause times. This is particularly important for parallel workloads.  Local allocations are already being run in production internally at Jane Street, and there are plans to bring the associated benefits to the masses by upstreaming the work to mainline OCaml.&lt;/p&gt;
&lt;p&gt;After Stephen&amp;rsquo;s talk, and a quick but much needed pizza break, everyone went back to hacking. An all-too-common problem that cropped up several times happened when trying to run the freshly-built OCaml compiler from the build tree without first installing it. The error messages in this circumstance are not particularly intuitive, complaining of a &amp;quot;bad interpreter: no such file or directory.&amp;quot; The message refers to a bootstrap issue; the program is trying to find the interpreter, but the interpreter hasn&amp;rsquo;t been installed yet. Some people solved the issue and moved straight onto the next task (a very common thing to do), but one group decided to tackle this head-on by improving the error message to provide more detail. This will help other new OCaml compiler developers and will almost certainly make life easier in our future hack events! This kind of &amp;ldquo;simple&amp;rdquo; fix is incredibly important for reducing the barrier to entry for new developers and emphasises the benefits of mixed-experience hack events with newcomers providing feedback and highlighting useful areas of improvement. We hope this work turns into a PR soon!&lt;/p&gt;
&lt;p&gt;Another project focussed on ensuring OCaml programs can take advantage of new security features in Linux. There is a relatively new &lt;a href=&quot;https://www.phoronix.com/news/Linux-6.3-Tmpfs-IDMAPPED&quot;&gt;feature of the kernel&lt;/a&gt; that allows the user to create a secure temporary file that is isolated from other users. One participant was experimenting with different versions of OCaml and Linux to see how this feature might be used in OCaml. Implementing this in the &lt;a href=&quot;https://v2.ocaml.org/api/Unix.html&quot;&gt;Unix module&lt;/a&gt; is tempting, but as it provides the &amp;quot;lowest common denominator&amp;quot; interface, it has to be compatible with all platforms, and therefore does not cater to a niche function. A better option would be to write a separate library with a separate binding to address the compatibility issues, but that would require a lot of work for one feature. This illustrates the important kinds of questions that form the debate around supporting new, platform-specific features.&lt;/p&gt;
&lt;p&gt;The prize for &amp;ldquo;oldest bug addressed&amp;rdquo; for the evening went to one of our most junior attendees, a first-year computer scientist who took on a problem first reported in 2005. The almost-20-year-old-issue involves structural comparisons of cyclical data structures and is easily reproduced by pasting &amp;ldquo;let rec x = 1 :: x in x = x&amp;rdquo; into a toplevel. A &lt;a href=&quot;https://github.com/ocaml/ocaml/pull/12039&quot;&gt;pull request fixing the problem&lt;/a&gt; was made during the evening and has generated a lot of interesting discussion!&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#until-next-time&quot; aria-label=&quot;until next time permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Until Next Time&lt;/h2&gt;
&lt;p&gt;We&amp;rsquo;re thrilled that we could restart these events, and it was lovely to see so many familiar faces alongside all the newcomers. The next hack day is scheduled for &lt;a href=&quot;https://forms.gle/c6A2TSbUBZeVJSG46&quot;&gt;March 31st&lt;/a&gt;, and we&amp;rsquo;re excited to see more people working on the compiler.&lt;/p&gt;
&lt;p&gt;We&amp;rsquo;d love to see you at a future event, but even if you can&amp;rsquo;t come in person, there are loads of ways you can contribute. You can suggest projects and &amp;quot;good first issues,&amp;quot; add and improve on documentation, and even set up your own local event! You can check out the &lt;a href=&quot;https://github.com/tarides/compiler-hacking/wiki&quot;&gt;wiki here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We look forward to hanging out with more people around Cambridge who are curious or passionate about OCaml. If you&amp;rsquo;re interested in joining future events in Cambridge, please &lt;a href=&quot;https://tarides.com/company&quot;&gt;email us&lt;/a&gt;, we look forward to hearing from you! See you next time!&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/c8ce8d1832f3c017b0e81ac33743c362/5c13f/hacking.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 155.88235294117646%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAfABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAwACBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAfPQgaW547UDWoVms//EABwQAAMBAAIDAAAAAAAAAAAAAAABAhEDEBIhMv/aAAgBAQABBQL5Lrio3jH778MaWDlE1I8w/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQERL/2gAIAQMBAT8BtmnP/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAEREP/aAAgBAgEBPwGLYf/EACIQAAECAwkAAAAAAAAAAAAAABEAARIhMQIQICIyYXGRof/aAAgBAQAGPwLWjmPCra6wCIOoWmdlXxTdyixu/8QAHRAAAgICAwEAAAAAAAAAAAAAAREAITFBUXGB8f/aAAgBAQABPyEBwUB6NQ1YNlHwUAmVw4nqVCLWw4qwMs5GAHT1B78yYj2qMu8z/9oADAMBAAIAAwAAABCIyQ3/xAAXEQADAQAAAAAAAAAAAAAAAAAAARBh/9oACAEDAQE/EGel/8QAGhEAAQUBAAAAAAAAAAAAAAAAAAEQESFBUf/aAAgBAgEBPxDgQhWN/8QAIBABAAICAQQDAAAAAAAAAAAAAQARITFBYXGBwVGx0f/aAAgBAQABPxAqesoM+jEga2xL80so5uwe5RDSX53jZSjpWYp5uCEGg2M+ZfJqF0POI3MnJohdzwoP3FWNmzAj0iyWqbVn/9k='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/c8ce8d1832f3c017b0e81ac33743c362/7bf67/hacking.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Hacking&quot; title=&quot;&quot; srcset=&quot;/static/c8ce8d1832f3c017b0e81ac33743c362/651be/hacking.jpg 170w,
/static/c8ce8d1832f3c017b0e81ac33743c362/d30a3/hacking.jpg 340w,
/static/c8ce8d1832f3c017b0e81ac33743c362/7bf67/hacking.jpg 680w,
/static/c8ce8d1832f3c017b0e81ac33743c362/990cb/hacking.jpg 1020w,
/static/c8ce8d1832f3c017b0e81ac33743c362/c44b8/hacking.jpg 1360w,
/static/c8ce8d1832f3c017b0e81ac33743c362/5c13f/hacking.jpg 3228w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/2a82aadb22ee69e06e9b8c805dd7ce96/b62ab/Patrick.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 131.1764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAUBAgQD/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgEA/9oADAMBAAIQAxAAAAFxwXU11kDKWmnGa4FIp//EAB0QAQACAgIDAAAAAAAAAAAAAAIBEQASAyExMjP/2gAIAQEAAQUC265ZuM5hvIVZeNOVLmytivi/Y+P/xAAVEQEBAAAAAAAAAAAAAAAAAAARIP/aAAgBAwEBPwEj/8QAFREBAQAAAAAAAAAAAAAAAAAAASD/2gAIAQIBAT8BGP/EAB4QAAIBBAMBAAAAAAAAAAAAAAABEBESQVEhMXGB/9oACAEBAAY/Alc0hZjvhYLdbht1R4VPqn//xAAdEAEBAQACAgMAAAAAAAAAAAABEQAxQSFRYdHw/9oACAEBAAE/IZtQ+ZgUeF60dZWvzcpGp0FjCjgxeMD3qmMB3korfpdyZpy3/9oADAMBAAIAAwAAABBMEEz/xAAXEQEBAQEAAAAAAAAAAAAAAAAAEQEh/9oACAEDAQE/EN5qtR//xAAXEQEBAQEAAAAAAAAAAAAAAAAAAREh/9oACAECAQE/EOjESv/EAB0QAQACAgMBAQAAAAAAAAAAAAEAESExQWGRcbH/2gAIAQEAAT8QHs4asDH2MKWAVZ7LeQ6C4yJxLnPA6lAfG8TYkwTAwOXk6PCF7dkeOvkyjg8jIib1dw/J+RiCM8M//9k='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/2a82aadb22ee69e06e9b8c805dd7ce96/7bf67/Patrick.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Patrick&quot; title=&quot;&quot; srcset=&quot;/static/2a82aadb22ee69e06e9b8c805dd7ce96/651be/Patrick.jpg 170w,
/static/2a82aadb22ee69e06e9b8c805dd7ce96/d30a3/Patrick.jpg 340w,
/static/2a82aadb22ee69e06e9b8c805dd7ce96/7bf67/Patrick.jpg 680w,
/static/2a82aadb22ee69e06e9b8c805dd7ce96/990cb/Patrick.jpg 1020w,
/static/2a82aadb22ee69e06e9b8c805dd7ce96/c44b8/Patrick.jpg 1360w,
/static/2a82aadb22ee69e06e9b8c805dd7ce96/b62ab/Patrick.jpg 3581w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;</content><id>https://tarides.com/blog/2023-03-22-compiler-hacking-in-cambridge-is-back</id><title type="text">Compiler Hacking in Cambridge is Back!</title><updated>2023-03-22T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2023-03-08-more-than-a-day-how-does-tarides-promote-women-in-tech" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;The aim of &lt;a href=&quot;https://www.internationalwomensday.com/About&quot;&gt;International Women&amp;rsquo;s Day&lt;/a&gt; is to raise awareness of gender inequalities and call for the empowerment of women worldwide. The goal is to forge a gender equal world and advance women&amp;rsquo;s equality in all forms.&lt;/p&gt;
&lt;p&gt;Within the &lt;a href=&quot;https://www.internationalwomensday.com/Mission/Tech&quot;&gt;field of technology&lt;/a&gt;, the focus is on elevating and advancing gender parity in technology and celebrating the women shaping innovation.&lt;/p&gt;
&lt;p&gt;While there have been advancements towards these goals, continuous attention and effort is required to create lasting change.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#how-is-tarides-promoting-gender-equality&quot; aria-label=&quot;how is tarides promoting gender equality permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;How is Tarides Promoting Gender Equality?&lt;/h2&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#externally&quot; aria-label=&quot;externally permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Externally&lt;/h3&gt;
&lt;p&gt;One of our goals is to &lt;a href=&quot;https://tarides.com/company/&quot;&gt;foster diversity and inclusion in tech&lt;/a&gt; and help provide more opportunities for underrepresented groups, including women. As a company, we partner with and support several organisations that promote diversity in the field of computer science. Some of them include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.50intech.com/about-us&quot;&gt;50 in Tech&lt;/a&gt; is working to achieve a gender balance of 50% women in tech by 2050. Their Gender Score Board helps companies across Europe measure their level of gender inclusion. They selected Tarides as an inclusive company and &lt;a href=&quot;https://app.50intech.com/company/tarides&quot;&gt;featured us on their website&lt;/a&gt;. For more information on our work with 50 in Tech, we have a &lt;a href=&quot;https://tarides.com/blog/2022-04-19-tarides-partners-with-50intech&quot;&gt;blog post from 2022&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;The &lt;a href=&quot;https://adatechschool.fr&quot;&gt;Ada Tech School&lt;/a&gt;, named after the first computer programmer Ada Lovelace, is a programming school designed for women but open to all. They are driven by three values: feminism, empathy, and singularity. We have a &lt;a href=&quot;https://tarides.com/blog/2021-02-15-partnering-for-more-diversity-in-tech&quot;&gt;blog post on our partnership with them from 2021&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://girlscancode.fr&quot;&gt;GirlsCanCode&lt;/a&gt; is an initiative launched by the organisation Prologin that hosts summer camps specially aimed at teaching young women about computer programming, free of charge. We have a &lt;a href=&quot;https://tarides.com/blog/2022-09-06-tarides-sponsors-girls-can-code&quot;&gt;blog post about why we sponsor GirlsCanCode from 2022&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.recurse.com/about&quot;&gt;The Recurse Center&lt;/a&gt; is an initiative that offers educational retreats for anyone who wants to get better at programming. They also provide needs-based grants to traditionally underrepresented groups to make programming more accessible for all. We're happy to have hired many talented engineers from the Recurse Center over the years!&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.outreachy.org/&quot;&gt;Outreachy&lt;/a&gt; is an internship program that provides paid remote internships in open source and open science. Outreachy&amp;rsquo;s goal is to increase diversity in open source and expressly invites anyone who faces underrepresentation or systemic bias in the technology industry of their country to apply. We sponsor and mentor interns in each biannual intake, and you can watch project presentations here (&lt;a href=&quot;https://watch.ocaml.org/w/eSSmoyEcPTEXPGAqDtKENX&quot;&gt;December 2021&lt;/a&gt;, &lt;a href=&quot;https://watch.ocaml.org/w/vXJtTj3cULRa1bZB5HrecX&quot;&gt;May 2022&lt;/a&gt;, &lt;a href=&quot;https://watch.ocaml.org/w/pQSAfZ9kDSsSnr8Bxzocn3&quot;&gt;December 2022&lt;/a&gt;); read a &lt;a href=&quot;https://discuss.ocaml.org/t/for-diversity-and-the-ocaml-community-outreachy-summer-2022/92340&quot;&gt;community post&lt;/a&gt; about how to get involved as a mentor; and read a &lt;a href=&quot;https://tarides.com/blog/2022-08-02-irmin-in-the-browser&quot;&gt;blog post&lt;/a&gt; from one of our Summer 2022 interns about her project.&lt;/li&gt;
&lt;li&gt;The &lt;a href=&quot;https://oxbridgewomenincs8.wixsite.com/2020&quot;&gt;Oxbridge Women in Computer Science Conference&lt;/a&gt; is an annual one-day event hosted by the Universities of Oxford and Cambridge (UK). The purpose of the conference is to spotlight the successes of women within computer science and strengthen the network of women in computer science within a supportive environment. The conference is free and open to all genders. We have a &lt;a href=&quot;https://tarides.com/blog/2020-12-14-tarides-sponsors-the-oxbridge-women-in-computer-science-conference-2020/&quot;&gt;blog post from 2020 on our sponsorship of the conference&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#internally&quot; aria-label=&quot;internally permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Internally&lt;/h3&gt;
&lt;p&gt;As a company we aim to provide a flexible and supportive working environment that encourages women to enter and remain in the workforce. Our aim is to make working at Tarides as inclusive as possible.&lt;/p&gt;
&lt;p&gt;Examples of our policies include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Childcare support as an employee perk&lt;/li&gt;
&lt;li&gt;Flexible hours and working&lt;/li&gt;
&lt;li&gt;Equal pay scales based on experience and skills&lt;/li&gt;
&lt;li&gt;Apprenticeships and internships to kickstart careers, or to enable later-stage career changes&lt;/li&gt;
&lt;li&gt;Career progression development in technical and managerial roles&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#still-some-way-to-go&quot; aria-label=&quot;still some way to go permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Still Some Way to Go&lt;/h2&gt;
&lt;p&gt;There is still much room for improvement, and we continue to be committed to removing barriers for women: at Tarides, in open source, and in computer science.&lt;/p&gt;
&lt;p&gt;Currently at Tarides, 24% of our workforce is female, with 15% in technical roles. Over the last 12 months, Tarides has grown from 55 to 83 people, with 27% of those hired being women. Despite this increase, we are still below our ambitious goal of reaching 30% of women in tech roles. This highlights the disappointing reality that for each position we want to hire for, there are still proportionally fewer women applying and reaching the later stages of recruitment in our field.&lt;/p&gt;
&lt;p&gt;In tech, we can address the issues from a number of angles, all of which will improve the overall picture. Collectively, we still need to encourage girls into STEM areas at an early age, in order to gradually increase the numbers of women in tech overall, but also to increase the size of the potential hiring pool of female applicants. Having female role models is essential, and we must continue to increase the representation of women in technology and STEM fields to encourage girls, and women, to see themselves in these kinds of roles. We must also continue to support lifelong learning by funding and creating training opportunities and resources for later-stage career changes.&lt;/p&gt;
&lt;p&gt;At Tarides, we have specifically noticed a skills and training gap between entry-level internships (e.g., Outreachy) and the next level of progression into junior software engineer. We are getting better at helping women make their first steps into the tech world, but where do they go next? This year, we are focussing on how we can specifically improve this by preparing more resources to help learn functional programming, OCaml, and open-source methods, and by understanding the different levels of training and education needed in order to progress beyond these initial stages.&lt;/p&gt;
&lt;p&gt;Finally, gender equality is not just a topic we should consider on March 8th every year. We must ensure that equality is in everyone&amp;rsquo;s consciousness and that it forms the basis of our conversations and decisions.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;ldquo;We will always have STEM with us. Some things will drop out of the public eye and will go away, but there will always be science, engineering and technology. And there will always, always be mathematics. Everything is physics and math.&amp;rdquo; - &lt;a href=&quot;https://www.nasa.gov/audience/foreducators/a-lifetime-of-stem.html&quot;&gt;Katherine Johnson, NASA mathematician&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</content><id>https://tarides.com/blog/2023-03-08-more-than-a-day-how-does-tarides-promote-women-in-tech</id><title type="text">More Than a Day: How Does Tarides Promote Women in Tech?</title><updated>2023-03-08T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2023-03-02-the-journey-to-ocaml-multicore-bringing-big-ideas-to-life" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Continuing our blog series on &lt;a href=&quot;https://tarides.com/blog/2022-12-19-ocaml-5-with-multicore-support-is-here&quot;&gt;Multicore OCaml&lt;/a&gt;, this blog provides an overview of the road to OCaml Multicore. If you want to know how you can use OCaml 5 in your own projects, please &lt;a href=&quot;https://tarides.com/company&quot;&gt;contact us&lt;/a&gt; for more information. We also recommend watching KC Sivaramakrishnan's ICFP 22' talk &lt;a href=&quot;https://www.youtube.com/watch?v=zJ4G0TKwzVc&quot;&gt;Retrofitting Concurrency - Lessons from the Engine Room&lt;/a&gt;&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;The journey to &lt;a href=&quot;https://github.com/ocaml-multicore/ocaml-multicore/wiki&quot;&gt;Multicore OCaml&lt;/a&gt; is a journey from cutting-edge theory to real-life code. It&amp;rsquo;s the story of an idea that grew from a small side-project into a multinational effort that brought a long-awaited update to OCaml. Along the road, the Multicore OCaml team faced many different challenges, leading them to re-evaluate their priorities and approach tasks differently.&lt;/p&gt;
&lt;p&gt;As part of the Multicore Project since December 2014, KC Sivaramakrishnan is in a good position to describe the process from the initial days of experimentation right up until launch. He has unique insight into the decisions, challenges, and successes that the team experienced as they worked to turn innovative ideas into tangible results.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-journey-begins&quot; aria-label=&quot;the journey begins permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Journey Begins&lt;/h2&gt;
&lt;p&gt;In 2013, the world had survived the 21st of December 2012, Flappy Bird was popular, and everyone was doing the Harlem shake. At the University of Cambridge, Professor Anil Madhavapeddy launched the Multicore OCaml project as part of the &lt;a href=&quot;https://ocamllabs.io/&quot;&gt;OCaml Labs&lt;/a&gt; initiative alongside Leo White, Jeremy Yallop, and Phillipe Wang. They were eventually joined by Stephen Dolan, the then PhD student working on combining &lt;a href=&quot;https://www.bcs.org/events/awards-and-competitions/distinguished-dissertations/previous-winners/2017-competition/&quot;&gt;ML-style parameteric polymorphism with subtyping&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In 2014 KC, who had just finished his PhD in the US, joined the team. His PhD had focused on making a multicore version of MLton Standard ML compiler, which made him an asset to the growing team that would see the Multicore OCaml Project through to completion. Together they collaborated on a project that would see many partial victories and setbacks, before ultimately releasing OCaml 5.0 to the public in December 2022.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#timeline&quot; aria-label=&quot;timeline permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Timeline&lt;/h2&gt;
&lt;p&gt;In the years since the project started, there have been several developments and incremental successes. Below is an overview of the milestones along the road to Multicore OCaml:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/7a1079030724de99ac8bce15ae51a0e3/9c618/Multicore_timeline_new-01.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 133.52941176470588%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAECAwX/xAAWAQEBAQAAAAAAAAAAAAAAAAABAgD/2gAMAwEAAhADEAAAAe3MhOgijJLVUSY//8QAGxAAAgMAAwAAAAAAAAAAAAAAAAECETEQIUH/2gAIAQEAAQUCZHFxdKOJmlnsV29//8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFxEBAAMAAAAAAAAAAAAAAAAAAQIRIP/aAAgBAgEBPwFiLeP/xAAYEAACAwAAAAAAAAAAAAAAAAABIBARQf/aAAgBAQAGPwJMk0v/xAAbEAACAwEBAQAAAAAAAAAAAAAAAREhMUFhUf/aAAgBAQABPyHEiRLDGmpul0fhEmrq/B/w0mhRRCsKhXBLH//aAAwDAQACAAMAAAAQ29AB/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARMf/aAAgBAwEBPxA5kisWt//EABgRAQEBAQEAAAAAAAAAAAAAAAEAIREx/9oACAECAQE/EAC9IzJuF//EABwQAQEBAQADAQEAAAAAAAAAAAERIQAxQVGBof/aAAgBAQABPxCRpSH3ikwrj74TyO/byjxDS+zhjGCzyn52UA0SM4i0A4jpwweWDj/OmG33vJKNkveKNrinMFDv/9k='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/7a1079030724de99ac8bce15ae51a0e3/7bf67/Multicore_timeline_new-01.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Isabella Leandersson's Graphic&quot; title=&quot;&quot; srcset=&quot;/static/7a1079030724de99ac8bce15ae51a0e3/651be/Multicore_timeline_new-01.jpg 170w,
/static/7a1079030724de99ac8bce15ae51a0e3/d30a3/Multicore_timeline_new-01.jpg 340w,
/static/7a1079030724de99ac8bce15ae51a0e3/7bf67/Multicore_timeline_new-01.jpg 680w,
/static/7a1079030724de99ac8bce15ae51a0e3/990cb/Multicore_timeline_new-01.jpg 1020w,
/static/7a1079030724de99ac8bce15ae51a0e3/c44b8/Multicore_timeline_new-01.jpg 1360w,
/static/7a1079030724de99ac8bce15ae51a0e3/9c618/Multicore_timeline_new-01.jpg 10800w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2013&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Multicore OCaml project was started by Prof Anil Madhavapeddy in the &lt;a href=&quot;https://ocamllabs.io/&quot;&gt;OCaml Labs&lt;/a&gt; initiative at the University of Cambridge Computer Lab with Leo White, Jeremy Yallop, and Phillipe Wang. The team was later joined by the then PhD student Stephen Dolan, who was working on combining &lt;a href=&quot;https://www.bcs.org/events/awards-and-competitions/distinguished-dissertations/previous-winners/2017-competition/&quot;&gt;ML-style parameteric polymorphism with subtyping&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2014&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;March: Stephen Dolan, Leo White, and Anil Madhavapeddy started hacking on Multicore OCaml&lt;/li&gt;
&lt;li&gt;March: Earliest &lt;a href=&quot;https://github.com/ocaml/ocaml/commit/a56e4530b5b173e8de28eead196d6878bc021c55&quot;&gt;commit&lt;/a&gt; that can be directly attributed to Multicore OCaml that is in the OCaml commit history. The commit removes most of the out-of-heap pointers the interpreter uses by replacing them with stack offsets.&lt;/li&gt;
&lt;li&gt;September: A status update on Multicore OCaml was presented in the OCaml workshop 2014, you can read the &lt;a href=&quot;https://web.archive.org/web/20160414164304/https://ocaml.org/meetings/ocaml/2014/ocaml2014_1.pdf&quot;&gt;associated paper&lt;/a&gt; by Stephen Dolan, Leo White, and Anil Madhavapeddy.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2015&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;First 6 months: An initial implementation of effect handlers was completed. The inspiration behind this idea came from the &lt;a href=&quot;https://www.eff-lang.org&quot;&gt;Eff language&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;September: Effect handlers in OCaml were presented at the OCaml workshop 2015. You can read more about it in this &lt;a href=&quot;https://kcsrk.info/ocaml/multicore/2015/05/20/effects-multicore&quot;&gt;blog post&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2016&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;May: &lt;a href=&quot;https://www.dagstuhl.de/en/seminars/seminar-calendar/seminar-details/16112&quot;&gt;Dagstuhl Seminar 16112&lt;/a&gt;: &amp;ldquo;From Theory to Practice of Algebraic Effects and Handlers.&amp;rdquo; Effect handlers in OCaml was presented and refined based on expert interactions.&lt;/li&gt;
&lt;li&gt;ML workshop: Daniel Hillestr&amp;ouml;m, Sam Lindley, KC Sivaramakrishnan &lt;a href=&quot;https://kcsrk.info/publications&quot;&gt;&amp;quot;Compiling Links Effect Handlers to the OCaml Backend&amp;quot;&lt;/a&gt;. Daniel Hillerstrom developed a Multicore OCaml backend for Links language compiling Links effect handlers to OCaml effect handlers.&lt;/li&gt;
&lt;li&gt;ML workshop: Oleg Kiselyov and KC Sivaramakrishnan &lt;a href=&quot;https://kcsrk.info/papers/eff_ocaml_ml16.pdf&quot;&gt;&amp;quot;Eff Directly in OCaml&amp;quot;&lt;/a&gt;. Showed how to get the expressive power of Eff language directly using features from the OCaml language + OCaml effect handlers.&lt;/li&gt;
&lt;li&gt;OCaml workshop: KC Sivaramakrishnan and Th&amp;eacute;o Laurent &lt;a href=&quot;https://kcsrk.info/papers/reagents_ocaml16.pdf&quot;&gt;&amp;quot;Lock-Free Programming for the Masses&amp;quot;&lt;/a&gt;. Presented the implementation of Reagents in OCaml, a composable lock-free programming library.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2017&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Papers published at the ML &amp;amp; OCaml Workshop: Stephen Dolan, Spiros Eliopoulos, Daniel Hillerstr&amp;ouml;m, Anil Madhavapeddy, KC Sivaramakrishnan, and Leo White &lt;a href=&quot;https://icfp17.sigplan.org/details/mlfamilyworkshop-2017-papers/2/Effectively-tackling-the-awkward-squad&quot;&gt;&amp;quot;Effectively Tackling the Awkward Squad&amp;quot;&lt;/a&gt;. The work outlined in this paper showed how effect handlers can simplify concurrent systems programming. These ideas were then incorporated in the development of &lt;a href=&quot;https://github.com/ocaml-multicore/eio&quot;&gt;Eio&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Stephen Dolan and KC Sivaramakrishnan - &lt;a href=&quot;https://icfp17.sigplan.org/details/ocaml-2017-talks/19/A-memory-model-for-multicore-OCaml&quot;&gt;&amp;quot;A Memory Model for Multicore OCaml&amp;quot;&lt;/a&gt;. The paper proposed a relaxed memory model for OCaml, broadly following the design of axiomatic memory models for languages such as C++ and Java, but with a number of differences to provide stronger guarantees and easier reasoning to the programmer, at the expense of not admitting every possible optimisation. This work eventually lead to the &lt;a href=&quot;https://v2.ocaml.org/releases/5.0/htmlman/memorymodel.html&quot;&gt;relaxed memory model used in OCaml 5&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2018&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Stephen Dolan, KC Sivaramakrishnan, Spiros Eliopoulos, Daniel Hillerstr&amp;ouml;m, Anil Madhavapeddy, and Leo White presented a forward looking paper on &amp;quot;&lt;a href=&quot;https://kcsrk.info/papers/system_effects_feb_18.pdf&quot;&gt;Concurrent Systems Programming with Effect Handlers&amp;quot;&lt;/a&gt; at the Trends in Functional Programming conference. This is the full version of the 2017 ML Workshop paper.&lt;/li&gt;
&lt;li&gt;Stephen Dolan, KC Sivaramakrishnan, and Anil Madhavapeddy, published a paper on the relaxed memory model for OCaml at PLDI, &lt;a href=&quot;https://kcsrk.info/papers/pldi18-memory.pdf&quot;&gt;&amp;quot;Bounding Data Races in Space and Time&amp;quot;&lt;/a&gt;. This is the full version of the memory model work presented at the 2017 OCaml Workshop.&lt;/li&gt;
&lt;li&gt;The team worked on simplifying and speeding up the implementation of effect handlers.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2019&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Sadiq Jaffer and Tom Kelly implemented a new garbage collector for the minor heap (parallel stop-the-world minor collector), which ensures that programs using C FFI in OCaml remain backwards compatible.&lt;/li&gt;
&lt;li&gt;The &lt;a href=&quot;https://github.com/ocaml-bench/sandmark/&quot;&gt;Sandmark&lt;/a&gt; benchmark suite for rigorously benchmarking OCaml programs was developed and deployed. These days the performance of OCaml compiler is tracked continuously using the &lt;a href=&quot;https://sandmark.tarides.com&quot;&gt;Sandmark nightly continuous benchmarking service&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2020&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The team decided to switch to the parallel stop-the-world minor collector (ParMinor) as default and drop the support for the concurrent minor collector (ConcMinor). ParMinor GC avoided a breaking change in the C FFI introduced by the ConcMinor GC. One concern is that the stop-the-world aspect in ParMinor would be a scalability bottleneck at large core counts. Our performance evaluation on the Sandmark suite showed that the impact of ParMinor is minimal even at large core counts (120+).&lt;/li&gt;
&lt;li&gt;KC Sivaramakrishnan, Stephen Dolan, Leo White, Sadiq Jaffer, Tom Kelly, Anmol Sahoo, Sudha Parimala, Atul Dhiman, and Anil Madhavapeddy presented &lt;a href=&quot;https://core.ac.uk/download/pdf/328720849.pdf&quot;&gt;&amp;quot;Retrofitting Parallelism onto OCaml&amp;quot;&lt;/a&gt; at ICFP 2020. The paper describes the design choices for multicore support in OCaml, the design of the ConcMinor and ParMinor GCs, detailed performance evaluation, and justifies our choice to switch to ParMinor as default. It won the distinguished paper award at ICFP.&lt;/li&gt;
&lt;li&gt;From 2020 through 2021, the team focused on achieving feature parity with sequential OCaml (systhreads, GC performance, DWARF support, &lt;a href=&quot;http://check.ocamllabs.io/&quot;&gt;opam health check&lt;/a&gt;, etc.)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2021&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;KC Sivaramakrishnan, Stephen Dolan, Leo White, Sadiq Jaffer, Tom Kelly, and Anil Madhavapeddy published &lt;a href=&quot;https://kcsrk.info/papers/drafts/retro-concurrency.pdf&quot;&gt;&amp;quot;Retrofitting Effect Handlers onto OCaml&amp;quot;&lt;/a&gt; at PLDI 2021. The paper describes the design choices for the concurrency substrate in OCaml 5 and how effect handlers are a good fit for our needs.&lt;/li&gt;
&lt;li&gt;Later half of 2021, OCaml core developers began reviewing code for Multicore OCaml, including the new concurrency and parallelism features, see &lt;a href=&quot;https://github.com/ocaml-multicore/docs/blob/main/ocaml_5_upstreaming_proposal.md&quot;&gt;this document&lt;/a&gt; for more information.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2022&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Early 2022, the &lt;a href=&quot;https://github.com/ocaml/ocaml/pull/10831&quot;&gt;Multicore PR&lt;/a&gt; was merged!&lt;/li&gt;
&lt;li&gt;Significant efforts were made by core OCaml developers to implement new features, review them, and ready the compiler for release. Without their hard work and dedication, the would be no OCaml Multicore nor OCaml 5.0.&lt;/li&gt;
&lt;li&gt;Memory model successfully implemented&lt;/li&gt;
&lt;li&gt;RISC-V backend and ARM64 backend achieved&lt;/li&gt;
&lt;li&gt;December 16th, 2022: OCaml 5.0 is released!&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#why-multicore-ocaml&quot; aria-label=&quot;why multicore ocaml permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Why Multicore OCaml?&lt;/h2&gt;
&lt;p&gt;The number of cores on the machines that we use have been &lt;a href=&quot;https://www.techspot.com/article/2363-multi-core-cpu/&quot;&gt;steadily increasing for years&lt;/a&gt;. Almost every computer now has several cores available to the user, and for a programming language to use them effectively it must support shared-memory parallel programming. If it does not, the user is forced to execute everything sequentially using only one core, or use multi-process programming, which is hard to use and in many cases less efficient than shared-memory parallel programming.&lt;/p&gt;
&lt;p&gt;There are two main features coming with OCaml 5: &lt;strong&gt;Parallelism&lt;/strong&gt; and &lt;strong&gt;Concurrency.&lt;/strong&gt; Parallelism is about performance; it&amp;rsquo;s the idea that if you have an &lt;em&gt;n&lt;/em&gt; amount of cores, you can make your program go faster by &lt;em&gt;n&lt;/em&gt; amounts of time. The effects of parallelism will be most keenly felt in how fast your programs run, giving you as a user a significant performance boost.&lt;/p&gt;
&lt;p&gt;On a bigger scale, parallel programming is significant for projects that need to complete resource intensive tasks quickly, like &lt;a href=&quot;https://tarides.com/blog/2022-12-20-how-nomadic-labs-used-multicore-processing-to-create-a-faster-blockchain&quot;&gt;theorem provers&lt;/a&gt; for example. With multicore support for OCaml, developers can take advantage of features like type and memory-safety with unprecedented levels of performance.&lt;/p&gt;
&lt;p&gt;Concurrency, on the other hand, is a programming abstraction. It is a way to tell your program that you want to execute several functions, each of which may potentially block for a short time while waiting for some external event. The programming language may choose either to execute such functions sequentially, one after the other, on a single core, interleaving their execution when a function gets blocked, or choose to execute them in parallel on several cores at once. Concurrency is useful, for example, when writing a web server that must handle several concurrent requests. The program may handle several such requests at the same time, but not necessarily need to use multiple cores to handle them. With OCaml 5, writing concurrent code is made a lot easier.&lt;/p&gt;
&lt;p&gt;Previously, concurrent OCaml code would have to be written in a specific tool, Async or Lwt, that the developer would have to learn separately. However, these tools don&amp;rsquo;t currently allow for asynchronous and synchronous code to interact with each other. In a &lt;a href=&quot;https://journal.stuffwithstuff.com/2015/02/01/what-color-is-your-function/&quot;&gt;blog post from 2015,&lt;/a&gt;, Bob Nystrom goes describes this process in what he calls the &amp;lsquo;Functional Colouring Problem&amp;rsquo;. OCaml 5 brings in support for concurrency through &lt;a href=&quot;https://kcsrk.info/webman/manual/effects.html&quot;&gt;effect handlers&lt;/a&gt; and the new Input/Output library &lt;a href=&quot;https://github.com/ocaml-multicore/eio&quot;&gt;Eio&lt;/a&gt;, which lets developers compose asynchronous and synchronous code together. It&amp;rsquo;s also easy to learn and use since it behaves like normal OCaml code, &lt;a href=&quot;https://tarides.com/blog/2022-10-19-porting-charrua-unix-and-rawlink-to-eio&quot;&gt;simplifying the developer workflow&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;For those who still prefer to use Lwt or Async, OCaml 5 doesn&amp;rsquo;t preclude them from doing so. Should they one day want to switch from using either tool to using Eio, changing their code to be compatible with Eio is simple and user-friendly. Whilst they will still need to rewrite their applications to use the primitives provided by Eio, to do so is straight-forward and can be made incremental thanks to the Lwt- and Async-Eio bridges.&lt;/p&gt;
&lt;p&gt;The team of people who worked on OCaml 5 knew from the start that bringing multicore support to OCaml would improve the lives of its users. It would make programs that run in OCaml &lt;a href=&quot;https://medium.com/geekculture/what-makes-a-cpu-fast-344517cf91f9&quot;&gt;faster and more efficient&lt;/a&gt;,  as well as help developers be more productive.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-academic-and-the-engineer&quot; aria-label=&quot;the academic and the engineer permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Academic and the Engineer&lt;/h2&gt;
&lt;p&gt;When academics are on the cutting edge of science, they're essentially creating a new area of research as they go. This leads to a natural lag time between innovation and the creation of academic papers revieweing the process. For example, KC explains that &amp;ldquo;The first &lt;a href=&quot;https://kcsrk.info/ocaml/multicore/2015/05/20/effects-multicore/&quot;&gt;talk on effect handlers was in 2015&lt;/a&gt;, but the first &lt;a href=&quot;https://anil.recoil.org/papers/2021-pldi-retroeff.pdf&quot;&gt;proper paper on effect handlers&lt;/a&gt; was just published in 2021.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Refererring to the time between experimentation and finished product, KC goes on to say: &amp;ldquo;Personally, it has been challenging to take part in building these systems, because 95% of the work is not very visible but you have to create that 95% in order to talk about the 5%.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Since the road to get here has been so long, it feels all the more exhilarating that release day has finally arrived.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;ldquo;It&amp;rsquo;s incredible that we are at the stage where we&amp;rsquo;re able to take cutting-edge research and put it into practice. In the last few years, we&amp;rsquo;ve expanded from academic research to producing robust code that can be upstreamed.&amp;rdquo;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This is great news for the whole community, as it demonstrates OCaml&amp;rsquo;s potential to turn research into real products. The team behind the multicore effort&amp;rsquo;s goals were to modernise OCaml and make it faster and more efficient for everyone. The realisation of that goal took years of experimentation, optimisation, and groundbreaking research.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#first-major-challenge-its-all-about-garbage&quot; aria-label=&quot;first major challenge its all about garbage permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;First Major Challenge: It&amp;rsquo;s All About Garbage&lt;/h2&gt;
&lt;p&gt;The first major challenge facing the Multicore team was OCaml&amp;rsquo;s garbage collector. In OCaml, there are two programs working together on the heap, the language and the garbage collector. If the language supports parallelism but the garbage collector does not, the language would run fast just to be slowed down by the garbage collector.&lt;/p&gt;
&lt;p&gt;To avoid this problem, the team made the garbage collector support parallelism to give users a uniformly smooth experience. &amp;ldquo;Garbage collectors balance memory usage at the cost of time, so you can either have it use a small amount of memory but take a long time, or be fast but use a lot of memory,&amp;rdquo; KC comments.&lt;/p&gt;
&lt;p&gt;With different variables to optimise for, the team had to make some crucial decisions. OCaml already had a user base with certain expectations. They had to ensure that their changes did not remove features that users had come to expect. For example, OCaml is a &lt;a href=&quot;https://ocaml.org/about&quot;&gt;robust and predictable language&lt;/a&gt;, and they needed to replace the garbage collector without sacrificing on that predictability. They also didn&amp;rsquo;t want to settle for worse results in terms of performance.&lt;/p&gt;
&lt;p&gt;Working on the new garbage collector, the team built an initial version that performed very well. However, they soon discovered that in order for the garbage collector to work, it would break the existing Application Programming Interface (API) interacting with C code.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;ldquo;That was our dilemma: we had a nice, fast, garbage collector, but it would break people&amp;rsquo;s code.&amp;rdquo;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;A broken API would have been bad news for anyone, but it would especially affect any existing projects that relied heavily on C code (like Coq), as well as many industrial users who would have had to change millions of lines of code. The team worried that this would create a fork in the community, between those who would find it worth the upgrade and those who would not.&lt;/p&gt;
&lt;p&gt;This was a big lesson for the team: user friendliness is incredibly important when introducing new technologies, and a big part of user friendliness is backwards compatibility. With this in mind, they set out to redesign the garbage collector. Although they were initially resigned to sacrifice some performance for the sake of compatibility, they ended up with a final product that not only did not break any code, but also didn&amp;rsquo;t see significant performance losses! They &lt;a href=&quot;https://icfp20.sigplan.org/details/icfp-2020-papers/21/Retrofitting-Parallelism-onto-OCaml&quot;&gt;presented their findings&lt;/a&gt;  at ICFP 2020 and won the distinguished paper award.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#second-major-challenge-memory-model-what-memory-model&quot; aria-label=&quot;second major challenge memory model what memory model permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Second Major Challenge: Memory Model, What Memory Model?&lt;/h2&gt;
&lt;p&gt;The second challenge came as a result of the very way computers are constructed. Unsurprisingly, the hardware that actually executes your code predates the multicore era. Consequently, the hardware and compilers running the code are designed to make optimisations based on the assumption that you&amp;rsquo;re running a single-threaded (so not multicore) program.&lt;/p&gt;
&lt;p&gt;As you might imagine, several of these optimisations conflict with more modern, multicore aspects of code. In order for multicore code to run successfully in the face of these optimisations, useful abstractions are needed to determine what is safe and how parallel code is expected to run. These abstractions are called &lt;a href=&quot;http://canonical.org/~kragen/memory-models/&quot;&gt;memory models&lt;/a&gt;, and they are necessary for hardware made for single-threaded programs to run multi-threaded code.&lt;/p&gt;
&lt;p&gt;Memory models are very complex and have to balance simplicity with performance. The more straight-forward the model, the greater the risk that it can&amp;rsquo;t account for all possibilities, and therefore cause bugs. Conversely, if the memory model is complex enough to maximise performance, it will be hard for people to understand and use.&lt;/p&gt;
&lt;p&gt;For the Multicore OCaml Project, the team decided to take inspiration from the memory models of &lt;a href=&quot;https://cplusplus.com&quot;&gt;C++&lt;/a&gt; and &lt;a href=&quot;https://www.java.com/en/&quot;&gt;Java&lt;/a&gt;, which choose to prioritise performance. However, they still wanted to make a memory model that was straightforward and intuitive. &amp;ldquo;OCaml is used to prove other languages, and if the memory model is too complicated, it becomes hard to verify other parallel programs,&amp;rdquo; KC explains.&lt;/p&gt;
&lt;p&gt;By sacrificing a small amount of performance (around 3%), the team managed to create an &lt;a href=&quot;https://kcsrk.info/webman/manual/memorymodel.html&quot;&gt;OCaml memory model&lt;/a&gt; that was both high-performing and easy-to-use. The paper detailing the process is called &lt;a href=&quot;https://kcsrk.info/papers/pldi18-memory.pdf&quot;&gt;&lt;em&gt;Bounding Data Races in Space and Time&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In two of the big technological challenges that faced the team, a clear focus on user experience emerged. As a language with deep roots in academia, at times rumoured to be &amp;lsquo;difficult,&amp;rsquo; focusing on improving user experience is an important part of making OCaml a language for everyone.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-people-behind-the-project&quot; aria-label=&quot;the people behind the project permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The People Behind the Project&lt;/h2&gt;
&lt;p&gt;Behind every project is a group of hardworking people. Stephen Dolan, Leo White, and Anil Madhavapeddy started the Multicore project back in 2014. Until 2018, KC, Stephen, and Leo were doing most of the hacking. After 2018, the team saw enormous growth with Sadiq Jaffer and Tom Kelly working together on the garbage collector. Today, there are around ten people hacking on Multicore OCaml at any given time, all working hard to ensure that OCaml 5 is a success.&lt;/p&gt;
&lt;p&gt;The open-source community has also provided continuous, valuable feedback as work on Multicore OCaml has progressed. Every person who participates by sharing their opinions and experience helps the project more forward. Many core OCaml developers worked tirelessly to get OCaml 5.0 release ready. In particular we should highlight the support of Xavier Leroy, who spent a considerable amount of time and effort implementing changes to important pieces in the runtime to make them multicore compatible (such as closure representation, bytecode interpreter, etc.), as well as Gabriel Scherer for his enthusiastic support of Multicore features and the willingness to do an enormous amount of crucial work like reviewing a large number of Multicore PRs and additional features. The academic community has also actively utilised Multicore OCaml to push the boundaries of what is possible with effect handlers, and provided useful feedback and bug reports.&lt;/p&gt;
&lt;p&gt;On the commercial side, Tezos has significantly helped the team test OCaml 5 by using multicore features for their tools &lt;a href=&quot;https://tarides.com/blog/2022-12-20-how-nomadic-labs-used-multicore-processing-to-create-a-faster-blockchain&quot;&gt;PLONK prover&lt;/a&gt;. They&amp;rsquo;ve made good progress using OCaml 5 and have been extremely helpful by reporting on bugs and their experience.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#sandmark&quot; aria-label=&quot;sandmark permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Sandmark&lt;/h2&gt;
&lt;p&gt;Over the course of OCaml Multicore&amp;rsquo;s implementation, new tools have been developed to facilitate its creation. These tools are useful in and of themselves, and can be used in other projects. One tool born out of the OCaml Multicore push is the benchmarking suite &lt;a href=&quot;https://github.com/ocaml-bench/sandmark&quot;&gt;Sandmark&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;When Sadiq and Tom were working on the garbage collector, they had to understand how the change to a parallel garbage collector would affect non-parallel, sequential programs. To this end, they created Sandmark to benchmark different iterations.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#where-do-we-go-from-here&quot; aria-label=&quot;where do we go from here permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Where Do We Go from Here?&lt;/h2&gt;
&lt;p&gt;OCaml 5 is just the beginning, and from its release springs countless more opportunities. Several teams across the community are innovating on new features for OCaml. These features are at various levels of maturity and development, with small groups of developers testing some of them, whilst others are more or less in the ideation phase. Some of these features in development are listed below, but this is by no means an exhaustive list:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Effects system: At the moment, there is no support from the OCaml type system to ensure that effect handlers are handled properly. An effect system is an extension of the type system that keeps track of which effects can be performed by an expression or a function, ensuring that effects are only performed in a context where a corresponding effect handler is set up to deal with them. In a language as well-established and large as OCaml, implementing new features comes with significant considerations. Backwards compatibility is a must, and the new system must work with the polymorphism, modularity, and generativity features already in place. For an early exploration of typed effect handlers in OCaml, check out &lt;a href=&quot;https://www.janestreet.com/tech-talks/effective-programming/&quot;&gt;Leo White's talk&lt;/a&gt; from 2018.&lt;/li&gt;
&lt;li&gt;JavaScript: OCaml has a very nice compiler to &lt;a href=&quot;https://www.javascript.com&quot;&gt;JavaScript&lt;/a&gt;, but it couldn't compile effect handlers to JavaScript. Indeed, JavaScript does not provide a corresponding feature. A standard way to translate effect handlers is to transform the code into the so-called continuation-passing style (CPS). Functions require an extra argument: a one-argument continuation function. Instead of returning a result value, they call the continuation with this value. By making continuations explicit, one can then explicitly manipulate the control flow of the program, which makes it possible to support effect handlers. Js_of_ocaml has been recently modified to support effect handlers using this approach. This &lt;a href=&quot;https://github.com/ocsigen/js_of_ocaml/pull/1340&quot;&gt;preliminary implementation&lt;/a&gt; has been released in &lt;a href=&quot;https://discuss.ocaml.org/t/ann-js-of-ocaml-5-0/11008&quot;&gt;Js_of_ocaml 5.0&lt;/a&gt;. It has provided their team with a good understanding of how effect handlers work and what technical difficulties exist when supporting them in a compiler targeting JavaScript. However, CPS transformation comes with an important negative impact on performance. The team then implemented a &lt;a href=&quot;https://github.com/ocsigen/js_of_ocaml/pull/1384&quot;&gt;partial CPS transform&lt;/a&gt; that removed some of the overheads with the CPS transformation. There are still some overheads due to CPS conversion that can be eliminated with smarter analysis and transformation. The team is considering trying alternative compilation techniques to support effect handlers. For example, there are implementation strategies that should have low overhead as long as no effect is performed at the cost of making effect handling slower. However, this might make the generated code much larger. The CPS-based implementation provides them with a point of comparison for undertaking this work.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml-flambda/ocaml-jst/tree/main/jane/doc&quot;&gt;Local Allocations&lt;/a&gt;: implemented by Stephen Dolan and Leo White: This feature adds support for stack-allocated blocks. It enforces memory safety by requiring that heap-allocated blocks never point to stack-allocated blocks, and stack-allocated blocks never point to shorter-lived stack-allocated blocks. This is a big addition to OCaml&amp;rsquo;s type system and is still under development.&lt;/li&gt;
&lt;li&gt;Unboxed Types: Currently in OCaml, all fields of a structure store values in a single-machine word. This word is further restricted by having to either point to a garbage-collected memory or be tagged to denote that the garbage collector should skip it.  Unboxed types relax this restriction, allowing a field to hold values smaller or larger than a word. This can be used to save memory and to improve performances by avoiding some pointer dereferencing. To find out more, read the &lt;a href=&quot;https://github.com/ocaml/RFCs/pull/34&quot;&gt;proposal on unboxed types&lt;/a&gt; on GitHub.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-legacy&quot; aria-label=&quot;the legacy permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Legacy&lt;/h2&gt;
&lt;p&gt;The Multicore OCaml project has been full of challenges, successes, and surprises. Along the way, the team has developed and grown, learning important lessons and adapted their approach to best suit the needs of all OCaml users.&lt;/p&gt;
&lt;p&gt;Making the leap from research to product is a complex process that takes time to execute properly. In computer science, it can take decades to get right. It&amp;rsquo;s a massive achievement to get a revolutionary update like OCaml Multicore from concept to finished product in less than 8 years.&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s also an update suitable for everyone. Users who don&amp;rsquo;t have a need for multicore features can carry on using OCaml like they always have, benefitting from other OCaml 5 features without having to change a line of code. On the other hand, the significant number of people who have long awaited the update can now benefit from having OCaml and all its strengths on multiple cores.&lt;/p&gt;
&lt;p&gt;The story of OCaml Multicore is one of hard work and a dedication to learning. It speaks to anyone with a passion project that seems too innovative or experimental to succeed. With a strong team and a flexible, problem-solving approach, theory can quickly become reality.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#acknowledgements&quot; aria-label=&quot;acknowledgements permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Acknowledgements&lt;/h2&gt;
&lt;p&gt;A big thank you to KC Sivaramakrishnan, without whom this article would not be possible. Further thanks goes to Jer&amp;ocirc;me Vouillon and Leo White for their expertise and contributions to the &amp;lsquo;where do we go from here&amp;rsquo; section of the article.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://tarides.com/company&quot;&gt;Contact Tarides&lt;/a&gt; to see how OCaml can benefit your business and/or for support while learning OCaml. Follow us on &lt;a href=&quot;https://twitter.com/tarides_&quot;&gt;Twitter&lt;/a&gt; and &lt;a href=&quot;https://www.linkedin.com/company/tarides/&quot;&gt;LinkedIn&lt;/a&gt; to ensure you never miss a post, and join the OCaml discussion on &lt;a href=&quot;https://discuss.ocaml.org/&quot;&gt;Discuss&lt;/a&gt;!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#sources-and-further-reading&quot; aria-label=&quot;sources and further reading permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Sources and Further Reading&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;A collection of libraries, experiments, and ideas relating to OCaml 5: &lt;a href=&quot;https://github.com/ocaml-multicore/awesome-multicore-ocaml&quot;&gt;https://github.com/ocaml-multicore/awesome-multicore-ocaml&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A wiki for Multicore OCaml. Note that it's not currently being maintained, so whilst it has much useful information, some migh be outdated: &lt;a href=&quot;https://github.com/ocaml-multicore/ocaml-multicore/wiki&quot;&gt;https://github.com/ocaml-multicore/ocaml-multicore/wiki&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Information on Effect Handlers: &lt;a href=&quot;https://kcsrk.info/webman/manual/effects.html&quot;&gt;https://kcsrk.info/webman/manual/effects.html&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Information on Parallelism: &lt;a href=&quot;https://kcsrk.info/webman/manual/parallelism.html&quot;&gt;https://kcsrk.info/webman/manual/parallelism.html&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Information on Memory Models: &lt;a href=&quot;https://kcsrk.info/webman/manual/memorymodel.html&quot;&gt;https://kcsrk.info/webman/manual/memorymodel.html&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Academic publications pertaining to OCaml Multicore: &lt;a href=&quot;https://github.com/ocaml-multicore/awesome-multicore-ocaml#papers&quot;&gt;https://github.com/ocaml-multicore/awesome-multicore-ocaml#papers&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;OCaml&amp;rsquo;s home on the web: &lt;a href=&quot;https://ocaml.org&quot;&gt;https://ocaml.org&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content><id>https://tarides.com/blog/2023-03-02-the-journey-to-ocaml-multicore-bringing-big-ideas-to-life</id><title type="text">The Journey to OCaml Multicore: Bringing Big Ideas to Life</title><updated>2023-03-02T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2023-01-12-lambda-retreat-report" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Today we're taking a little pause from our OCaml 5 series to talk about a programming retreat. I spent a week in the woods with fellow programmers at the &lt;a href=&quot;https://anandology.com/lambda-retreat/&quot;&gt;Lambda Retreat&lt;/a&gt;. It was a wonderful way to explore the nature of computations, abrstractions, and paradigms. Although I mostly work in OCaml, it was fun and challenging to code in Scheme, another functional programming language.&lt;/p&gt;
&lt;p&gt;For more OCaml 5 posts, visit our &lt;a href=&quot;https://tarides.com/blog&quot;&gt;Tarides blog&lt;/a&gt; for posts about some exciting new features and interviews with OCaml programmers, &lt;a href=&quot;https://tarides.com/blog/2023-01-10-engineer-spotlight-sudha-parimala&quot;&gt;including one with me&lt;/a&gt;! Next week, come back to read an article about how OCaml 5 performs during the &lt;a href=&quot;https://benchmarksgame-team.pages.debian.net/benchmarksgame/index.html&quot;&gt;Benchmarking Game&lt;/a&gt;, but for now, read on for a Lambda Retreat Retrospective.&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;&lt;em&gt;Structure and Interpretation of Computer Programs (SICP)&lt;/em&gt; is many programmers' favourite programming textbook. It teaches programming constructs like recursion, modularity, abstractions, etc. For a long time, it was used as the textbook for an introduction to programming course. Here's what &lt;a href=&quot;https://www.amazon.com/review/R403HR4VL71K8&quot;&gt;Peter Norvig&lt;/a&gt; and &lt;a href=&quot;https://eli.thegreenplace.net/2008/05/28/book-review-structure-and-interpretation-of-computer-programs-by-harold-abelson-gerald-jay-sussman/&quot;&gt;Eli Bendersky&lt;/a&gt; have to say about SICP.&lt;/p&gt;
&lt;p&gt;Having seen a lot of people highly recommend SICP, I grabbed a copy for myself a few years ago and started reading it, but, alas, I never completed the book.&lt;/p&gt;
&lt;p&gt;In the latter part of last year, &lt;a href=&quot;https://anandology.com/&quot;&gt;Anand&lt;/a&gt; decided to host a week-long retreat to gather a bunch of people and go through some interesting parts of SICP. Suffice it to say, I jumped at the opportunity to do nothing but read and write code for a week.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#getting-ready&quot; aria-label=&quot;getting ready permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Getting Ready&lt;/h3&gt;
&lt;p&gt;Two weeks before the retreat, we had some warm-up sessions to get ourselves ready. During this time, we attended some remote sessions and solved a few exercises from the Chapters 1 &amp;amp; 2 of SICP.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#arriving&quot; aria-label=&quot;arriving permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Arriving&lt;/h3&gt;
&lt;p&gt;On Day 0, we all arrived at Bangalore from various parts of India, and carpooled to the &lt;a href=&quot;https://tvc.farm/&quot;&gt;Tamarind Valley Collective&lt;/a&gt; (TVC), located ~80km from the city. Reaching TVC turned out to be an unexpected but enjoyable 1.5km trek, since the roads to the campsite were unusable due to rain.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#at-the-retreat&quot; aria-label=&quot;at the retreat permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;At the Retreat&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Functional Geometry&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The retreat began with Functional Geometry from the second chapter of SICP. We started with the basics, like rendering images, and slowly built the primitives needed for generating Escher's woodcut.&lt;/p&gt;
&lt;p&gt;It was amazing to see the power of composability! We thoroughly enjoyed building Escher's woodcut from an unassuming image of a fish.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 305px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/91ad732ce9c8ddafb7f72036ecd368e1/a3e09/fish.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 80.58823529411765%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACJElEQVR42pVUa2+iQBTl//+HfrFGYxMTP7S+qqbVtI2atmpNI77fLCBgEQF5nc2dLi5raro9yQ3DDHPmzL3nwqmaiQ/dBj0nMwWCbMC0DtB1HZqmQdqKGE2m6L510ON5iJKMPt8DP+jjlybCNE3s9/tjcIbpYm970A0HomJB0R1YtgPncMDeNKF8yFiuBQyHA0ymU+g7A6vlErP5HMpOhW3bsCzrGFzwocCXBfiqjGA9ARQJnm2h3mhAVRQQfN9HACAIgs9xEByD3qPB+YYOV5HhaSrcjQhXUwHXwc4w8Pz8DEmSEEWU7CtwpxPhh6vVCre3t8hmsxBFkV2H8vUdOBBBJHzPYwtEdHFxgYeHBxQKBTSbTdTrddzd3X1DeALKA6FSqaBcLsNxHLy+vqLVaqHf7yOZTMJ13f8njF57sVig2+1CEASm8P39HbFYjB3yI0LP81jOCPf396wwpVIJ8/mcpYKs8iNCUtBoNNh4MBiw65M6Cpr3/uT5R1W+vr7Gzc0NG1MxqtUqUzmbzbBer//688Q+3LmTqBBU5Uwmw1TmcrljEOk5T54l7PV6eHl5wdPTExKJBLNPPp9HOp3G5eUl8ygVKiQP3XH2yjzPMxJSSthut6xA1D2j0QiPj4/odDooFovMDeHeswppI+Uu7NFQBRmbyNrtNkvH1dUV4vE4arXaZy9/RUYL4/H4H79FfwbUluTNzWYDWZYxHA6RSqVYi/4GQnm2TCv35hsAAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/91ad732ce9c8ddafb7f72036ecd368e1/a3e09/fish.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;fish&quot; title=&quot;&quot; srcset=&quot;/static/91ad732ce9c8ddafb7f72036ecd368e1/04472/fish.png 170w,
/static/91ad732ce9c8ddafb7f72036ecd368e1/a3e09/fish.png 305w&quot; sizes=&quot;(max-width: 305px) 100vw, 305px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p align=&quot;center&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 514px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/ae748b6f80360897b268809e102ce128/dea13/woodcut.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 94.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAACM0lEQVR42q1UZ4siQRD1//8Ps5hzTqgYEXW5PczgqWM4nTF9UN/xamlZjtWF4waKrqnufvVeVdEmwzCw3+8fdjqdcD6fxejrui7r5XJ5xA+Hg8TpH49H8XV9D103YOJBAu12OxjGHr1eB/V6HYVCAe12G8fjAe/vP1Ct1tBqtdBsNjEcDjEYDFAqlfDWe8N8+QuT5U9sN9oH4EdGA2SraRpmsxmm0ykWi4Uw0LQl+v2+xObzObbbLdbrtfwvl0vs9jv81jcwDB2m+/2O2+2Gf/l497MRx6Q2mHk8Hj9sMpnIShZcR6PRw+cejTVU99UngEROJBIwm80IBoPw+XxwOp0Ih8Ow2+1wu90IBALih0IheL1e2Wd5ngLm83kBSKVSiMViiEajDz+bzSKZTApYOp2WGBOwjl8CXq9X5HI5RCIRMV5mAl7OZDLiE4xnqIAxJn8KSIY87HA4ZKVkq9WKcrksTDkefr9fYtynT9nfMmQdCUA5BInH48KEDaBPppRPn4xXq9VrQDKsVqsimUPNAadEJiFrloBgqoabzeZ1U9hN1kcxYz3JulgsCjjjjUZDwJjgW8kqOy+TJS8zTobdbldiTMKkLyX/3RTKtFgs6HQ6IpMsycpms0kNCcbGvJSsmKjZU0YASua+mlMqYYKXTVGzxsOq2wTjq0OZKk6foC/nkIA8RJlk5fF4pEFKupLocrkEkPv0nzJkgEWvVCry3rEptVpN1s/GJqk9Gh/WLwH/5/cHlBVML5O8NJcAAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/ae748b6f80360897b268809e102ce128/dea13/woodcut.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Escher's Woodcut&quot; title=&quot;&quot; srcset=&quot;/static/ae748b6f80360897b268809e102ce128/04472/woodcut.png 170w,
/static/ae748b6f80360897b268809e102ce128/9f933/woodcut.png 340w,
/static/ae748b6f80360897b268809e102ce128/dea13/woodcut.png 514w&quot; sizes=&quot;(max-width: 514px) 100vw, 514px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/35f581f60f5317fa1f360d000beff8b5/37523/group2.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqklEQVR42gGfAmD9ACMdIiMbITAlJzotLj8wMEAvMzoqL1BNU6W9wbPGsK63jKyveq+zgKu0h7nEosDPub/PucfNmbi8baqvVwAwIyQvIiMqHyIlHCEsIiUxJyoyJSsxIyk+NTNvb0SpqF+urWu3tW+wrmy9vHG8vnLGx3zV03S6u1utsloAQy8nTjYpTTYqQS8nSTUqSj4vQDwxRTw1PjMwLiUsdXNSusJuxsdyvsNxyM58x897v8VywMNixMdftLxcAGNNNVk9Jl9FLUY5KjQtJkE9MT09MTs5MjcyKHRoP3ZwQJ2iU6WrWKalZKywbLm6cKCrWLm9XMC/arCzagCOj1aNhU+Hfk1MTDAYGBwiHiQnKTg4PEk0NDyFgFqal1qkol2TkGd3bHCVmWytsWu3uHPRzHjQy4GnrG8AdnBTl4lfrZ9tYlpFMS4uNC8tTlp0aXycXWuLTVhpTmh/eoygd4yodI6/g5CPiZV2l5x+nqmCpbJ5iJ1kAIhqU11NQmVRQWRYSktMS0RERlRXZ3N8kFxecmJxj0Jbf2l5mV9rhltwmG9rcoGLe4udiIeTgYSUfXqFcQBeVVFUSD1RQjVLSUNPU1JVTUluYl16cm9CP0hlbYUzPFBXXGpPTlUZJDdaTFGOjoKQnI19g3R+gnmChYAAZGVlWFRPW2JwVGRuTlVaWlBNZ19eWFZXGyErHig+SEpYcW53YGBqKjNEXk1PiXlyjZGMhJF+e4p5foR9AFlcZTw9QEpVaGZrd2llZ3BpaG1pcWhhZTw2PEhKWot8fZGAfH1xdF9aYnhjYIJpYn93a4iRf5ajkJKgiQBiaHVWUUxdWVlkYGFXUVJZTVBnWFt+bnB5ZmidjY6ql5WbhoKSfnuRgX2PeXR/a2NyYVeBdW2enY+XnY9IURaQya6SDQAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/35f581f60f5317fa1f360d000beff8b5/c5bb3/group2.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Participants with Lambda Retreat t-shirt&quot; title=&quot;&quot; srcset=&quot;/static/35f581f60f5317fa1f360d000beff8b5/04472/group2.png 170w,
/static/35f581f60f5317fa1f360d000beff8b5/9f933/group2.png 340w,
/static/35f581f60f5317fa1f360d000beff8b5/c5bb3/group2.png 680w,
/static/35f581f60f5317fa1f360d000beff8b5/37523/group2.png 720w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/p&gt;
&lt;p&gt;Anand rewarded everyone with an Escher's woodcut T-Shirt for successfully generating the &lt;code&gt;square-limit&lt;/code&gt; \o/&lt;/p&gt;
&lt;p&gt;We then abstracted out the implementation details for the Functional Geometry primitives we had built. The abstraction gives us the freedom to change the implementation at a later point without affecting the higher-level details.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Mutability and State&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We spent some time understanding mutations, global state, and local state in Scheme, a functional language like OCaml. This led us to building some mutable data structures, like a mutable queue and a mutable hash table in Scheme, and generalising with a dispatcher to perform operations.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Metacircular Interpreter&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Another exercise before the retreat was to write a parser for Scheme in Python. At the retreat, we started with translating it to Scheme. Going further, we built a metacircular interpreter -- a Scheme interpreter written in Scheme. How cool is that?&lt;/p&gt;
&lt;p&gt;We then learnt about lazy evaluation in Scheme and went on to make our metacircular interpreter lazy by default. Another interesting part we looked forward to was targeting WebAssembly (Wasm) from Scheme. It was surprisingly simple to go from Scheme to Wasm, targeting Wasm's Lisp-like syntax.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#beyond-tech&quot; aria-label=&quot;beyond tech permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Beyond Tech&lt;/h3&gt;
&lt;p&gt;Living at TVC in the middle of a forest with barely any electricity or cellular network for a week was a humbling experience. Madhav, the resident manager at TVC, and his team made sure our stay was comfortable. The food, made from locally-sourced indgredients featuring local cuising was amazing!&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/23dba1a715848b57cf73cb75d4404490/eea4a/campsite.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAv/aAAwDAQACEAMQAAABqTnNDYlD/8QAGhAAAgMBAQAAAAAAAAAAAAAAAAECAxEEEv/aAAgBAQABBQJdMWWXRzSK0bSPZ//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/AYf/xAAWEQEBAQAAAAAAAAAAAAAAAAAAEgH/2gAIAQIBAT8BpWv/xAAYEAACAwAAAAAAAAAAAAAAAAAAEAIRIf/aAAgBAQAGPwJZIp//xAAcEAACAgMBAQAAAAAAAAAAAAAAAREhUWFxMZH/2gAIAQEAAT8h9JxjY7JS+F7g0KazXCqS+jtg/9oADAMBAAIAAwAAABCPD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QH//EABcRAAMBAAAAAAAAAAAAAAAAAAABUWH/2gAIAQIBAT8QbwwP/8QAHBABAQEAAQUAAAAAAAAAAAAAAREAMSFBUWHR/9oACAEBAAE/EG1YWJaYMgeAfc8JKWu2jgrUUwpwiL1XTVD0l3//2Q=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/23dba1a715848b57cf73cb75d4404490/7bf67/campsite.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;campsite&quot; title=&quot;&quot; srcset=&quot;/static/23dba1a715848b57cf73cb75d4404490/651be/campsite.jpg 170w,
/static/23dba1a715848b57cf73cb75d4404490/d30a3/campsite.jpg 340w,
/static/23dba1a715848b57cf73cb75d4404490/7bf67/campsite.jpg 680w,
/static/23dba1a715848b57cf73cb75d4404490/990cb/campsite.jpg 1020w,
/static/23dba1a715848b57cf73cb75d4404490/eea4a/campsite.jpg 1280w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The evening walks and hikes at TVC were memorable. We managed to sight some kingfishers and owls while snacking on some freshly plucked tamarinds. We had so much fun hiking along a stream that runs in the middle of TVC and capturing wisdom about sustainable living from Madhav and Vikrant, who put it into practice by living on farms.&lt;/p&gt;
&lt;p align=&quot;center&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 447px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/8091856d2296477e493c94038c366f82/a2d48/owl.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 76.47058823529412%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAADeElEQVR42n2Q3U9bZRzHz7+lZibIBAItlNKytYxSCqHlrYW+95y+cPpy2lJeF43e4MXMSBY1GuMECpRC5WWZbIuJV956Z2I0WWzPabuPOcVs7kIvPnmSX37fz/N9HsH7fR3vXh3fXoOlvTrL+zp/4T+o/yeBgzqhI5XEqUbiVCVeVZFOVWIVFeHNUgN/ufEm+D/S8JGGWNVIVFUSVQ3xRCNa0YgeawihI43goUqg3HjNW23+NQ+W9Wa6UCV2ohI81Hf1uUroUOvMBemsRazaIlLR0OX6U26kjbdkkWMN8bSFdNrqtIudaB1hoKwSPtaIHKsEy40boVRr/8OrzqkHI5UmkUqbSKVF6LBB6LhJZP8PQnt/dgS6cElvd6SyUtOIn+nfoCLo4Vi12blVOmu+Jl5rkay1kC9aJM7b5Govub9eIpgsIlXr5K+aFC40CpdNNq5b5C41Ck+aCLHKS8SzNmINxHOQdC4gfgHJi1fI502SP7QpVX9jdzvBhjRH4cE+2y9g+0eNtadNcpcttq9bfPS8hRDNrBJWtpG2HpD87DsSn5+Q+vpn0uVfkU9+J32uIV+BfAn7j7/k8ScREt4ZxIdXZK8hVauTvbgRb15rCBPOaUJ+H0kpTCLqJxkLdNgorlAsFShuf0xx5xHp3VN2v3rEt59GEJemGTRZCD98SuEnyD1rk3kGynMQphZDzHiDhMQ42bxCSl4hHhcprWZZVRIU01G2lBhbuQjFTJTVvERRSSKGfciKQmbnG6I7B6x88YTSwS8IdvskDocHt8uDd36BgN9PIBxGUdIUijmUQo619TzFUob1tTQbpQxKLsXaWpZSUSaTCOGbm0aOB5CTIsLtd7pwme7iMlow3urGdrufJZuT0KgNr/UOyzNuEvMLhJwTSH4fOUVmRY6zuZln634JOZsmGA1TKGQ7JYQFi4NFsx23wcJ0v5n5QSuB4TssDAwz3tXL0HsfMNU3hOndLsZ6B0h53CRnZhBnZ8lHg+TDfsLzs8jxGMVsCmHWYGb4/R4Mtz7EOzJG2DqGq3cIR+8griErc7ZJFu9O4LHY8IzYWByx47c5cPUbGe/uQ7SM4jMY8JotpJwuBI/RjGNgGFN3P+7BUZbNNtyGEe71GBjvNzFnsTPZP4S9x8j86D2W7RNMD1ux9RlwGkeYMY3i7DMyZTATtNr5G05JOprae2DPAAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/8091856d2296477e493c94038c366f82/a2d48/owl.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;An owl we spotted&quot; title=&quot;&quot; srcset=&quot;/static/8091856d2296477e493c94038c366f82/04472/owl.png 170w,
/static/8091856d2296477e493c94038c366f82/9f933/owl.png 340w,
/static/8091856d2296477e493c94038c366f82/a2d48/owl.png 447w&quot; sizes=&quot;(max-width: 447px) 100vw, 447px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/1a6b3dd1fda189aabdd21e1591229a8d/eea4a/group.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMBBP/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAAB1OGXqEf/xAAcEAEAAgEFAAAAAAAAAAAAAAABAAIRAxITISL/2gAIAQEAAQUCrqI8nTZz5Y2ZuMf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwFH/8QAGRAAAgMBAAAAAAAAAAAAAAAAACEBAhAR/9oACAEBAAY/Ah5NuPHB/8QAHBAAAwACAwEAAAAAAAAAAAAAAAERMUEhcYGR/9oACAEBAAE/IavEVNTNV/BDb0XHYIhFVNdCgpT/2gAMAwEAAgADAAAAEEc//8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/EK1//8QAFhEAAwAAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/EFGQf//EABwQAQACAgMBAAAAAAAAAAAAAAERIQAxQVFhcf/aAAgBAQABPxB5FFibvGlYZzt1jAJneziCjyOINP3GL4RY9cKrmSgleZ//2Q=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/1a6b3dd1fda189aabdd21e1591229a8d/7bf67/group.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;After a hike along the stream&quot; title=&quot;&quot; srcset=&quot;/static/1a6b3dd1fda189aabdd21e1591229a8d/651be/group.jpg 170w,
/static/1a6b3dd1fda189aabdd21e1591229a8d/d30a3/group.jpg 340w,
/static/1a6b3dd1fda189aabdd21e1591229a8d/7bf67/group.jpg 680w,
/static/1a6b3dd1fda189aabdd21e1591229a8d/990cb/group.jpg 1020w,
/static/1a6b3dd1fda189aabdd21e1591229a8d/eea4a/group.jpg 1280w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/p&gt;
&lt;p&gt;Our coworkers Pappu the hunting cat, her three kittens, and our boy Poco, the rugged looking sweet doggo, kept us company.&lt;/p&gt;
&lt;p align=&quot;center&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 537px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/ab433e19fe4942a338efd9f13e1adf60/b1cde/cat.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 77.64705882352942%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEXElEQVR42gXB+1MSBgDAcX7aD7m7nnO9tIdmj1s+Su1aZ6KogGAomi9UFBBEEXyhoIAgiKCi5rN0M8/Spqmz5WhZ0yxnu7I9ftndbrv9K999PoLFrUmevhpjdXOKpb0d7r94ibnbyaN34yztmFnZruX5h1qe7zfx+i8v3gEznhkPU6vz9LoceBw2vpmdZ2EtjFajRTCxXM30op75ZRtzGyHuPfZjdhqZ2/Lw5J2BlfcGFnerWPlNzQ+/V+ALVfD9npm5tUF8Djf9vR7mF57yaGmdTosOweiEjuComolHFsZWrdiCFRgsSibX2/GMqPFNltK/XIh/Po++WRl1Zgmzq0XMPHQQ6GpnuM+L2+Vm6N4w6vJ8BBvPXITfuAhvDbKxN8To43qqqu5QrM6jrFSO3VzG0JNaJjYV+CclmOy59M4W8CDYxpTbwr3BfkZGxpmaHsY/VYRgc9fLs58C2OyttFnNyPLFnDoZw6FDX5KeLqTNpKdAlk2NUUF5pRi9ScHMdCOrwzYeDniYmf6WF5s7PL0/gEaZgmBuyUagvxlRZgbXk1OIPHGGuLg4oqLOkJR0jSaThqICGRlCEeryIvwdehYG2plxGgk42+nz9uDs6qFdc5f02EgEObcSURXfQSbLITnhEqlJV7gUe55jRyOJOn2OfKmQfHkO3W4bw4EOHgQaWR1txlVfSZZQhPDqGaJPxxB55AuuHvsMgddQSENNJaYGPeK0RDJuJnAl9ixXL13gYmwsF6KPU1iQy8aPKygLJbToFDzuN9JiriM1VUj85SvEJ6RwNvoCxz+PQNBpbSM3r5xGcxOF0tsUK7IoU0pQKSVU3JWhKpTTVKvm/dtXhEI+5sc6+bC9QLvVjkJejChLTnZ6Jgnx14m//BUCfW0zlkYbHVYnDYYajDoVttY6THoVHRYtPc52jAo5m+vLfNjf4e32Gn98eoOny4tB14he14SuykhVaQ3S3CIEWo0JTYWBooJSskVCNDWVdHc2o69U0mqqxmqqxlRdwvhQL+HwMnu7YT7+uoW3q4cWi50B3xBB3wgeRxBbiwtBrc5MpUpLpkjKqZPRHDlyFGmOiPrqYsx6FX3uVkYG7IR8LWy/WuW/fz/yfjfMqH+QkLefHkcv/d1BvE4/o8ExBPX6BlR3VcjFecScvUjEgYMcPHSYQoUUQ5USR6uBhdkA698N8+d+mH/+/oWpiQmcbV2MuP247V5cNi+TwVH6egYQZArFpH2dya2bt0lNSiHq5HmOHjxMxIEI0m4kUq8twd9t5ueXi+x/es32yzXGfb04O1wEnT2EPAE6rU4G3EGmQmMISpVliCUKkpPTEAuzuBafRFzMJc5HnePUidMkxSciSReirVEjlcpRSKWYq7UYdEY0NUY8Ng8uu4cWiw1bhwuBWqUlX1GCOEdOVpaUG6lp5GZKyEgTkXz9Jpm3ReRlySjIllKSp+SORIZZXUudRo9Ra6CrqQOP1UWvow9zo53/ARCW19uiba/vAAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/ab433e19fe4942a338efd9f13e1adf60/b1cde/cat.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Pappu the cat&quot; title=&quot;&quot; srcset=&quot;/static/ab433e19fe4942a338efd9f13e1adf60/04472/cat.png 170w,
/static/ab433e19fe4942a338efd9f13e1adf60/9f933/cat.png 340w,
/static/ab433e19fe4942a338efd9f13e1adf60/b1cde/cat.png 537w&quot; sizes=&quot;(max-width: 537px) 100vw, 537px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/2c0f98a83217cb6e933920968f817edf/eea4a/poco-dog.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIFAwT/xAAWAQEBAQAAAAAAAAAAAAAAAAACAAH/2gAMAwEAAhADEAAAAV14ENWJJp//xAAbEAACAQUAAAAAAAAAAAAAAAAAARMQERQhMv/aAAgBAQABBQKZsn1mFjmn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFhEAAwAAAAAAAAAAAAAAAAAAAQIQ/9oACAECAQE/AQs//8QAGxAAAQQDAAAAAAAAAAAAAAAAEQABAhASITH/2gAIAQEABj8CyKLMZFcrVf/EABwQAAMAAgMBAAAAAAAAAAAAAAABESGhMUFR8P/aAAgBAQABPyGiqj4Zmmrki+5ZUeXH4OpsL7J//9oADAMBAAIAAwAAABCb/wD/xAAWEQEBAQAAAAAAAAAAAAAAAAAAIUH/2gAIAQMBAT8QxX//xAAWEQEBAQAAAAAAAAAAAAAAAAABERD/2gAIAQIBAT8QC1z/xAAeEAEAAwABBQEAAAAAAAAAAAABABExQVFhcaHB4f/aAAgBAQABPxA5dgy/IHIg2r0lZBjyQFkTJ5gURBgbb19lqxe8f//Z'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/2c0f98a83217cb6e933920968f817edf/7bf67/poco-dog.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Hiking crew with Poco the dog&quot; title=&quot;&quot; srcset=&quot;/static/2c0f98a83217cb6e933920968f817edf/651be/poco-dog.jpg 170w,
/static/2c0f98a83217cb6e933920968f817edf/d30a3/poco-dog.jpg 340w,
/static/2c0f98a83217cb6e933920968f817edf/7bf67/poco-dog.jpg 680w,
/static/2c0f98a83217cb6e933920968f817edf/990cb/poco-dog.jpg 1020w,
/static/2c0f98a83217cb6e933920968f817edf/eea4a/poco-dog.jpg 1280w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/p&gt;
&lt;p&gt;Our days of hacking were followed by board games in evenings and nights. We had so much fun and laughter riots playing games like Skull, Chameleon, and Ticket to Ride Europe. By the end of the retreat, we were surprised by how little internet and social media we had consumed that week!&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/f0ce14e49dabc260374548b09e1b66c9/dc896/game.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 119.41176470588235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAYABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQDAf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAABj5doUjrZvoZYgX//xAAcEAACAgIDAAAAAAAAAAAAAAABAgADBBMSISL/2gAIAQEAAQUC1cpo60oZR6BWMHQ45UVNbXDak//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABYRAAMAAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPwFw/8QAHBAAAgICAwAAAAAAAAAAAAAAAAECERAhMTJB/9oACAEBAAY/AtHhcYocqxUHoVyR2Ryf/8QAGxAAAwEBAQEBAAAAAAAAAAAAAAERITFRQWH/2gAIAQEAAT8ha5lZRp1x4JSghcp5Db8fRhi6ItLsovfoUH//2gAMAwEAAgADAAAAENzfPP/EABYRAAMAAAAAAAAAAAAAAAAAAAAQEf/aAAgBAwEBPxB0/8QAGhEAAAcAAAAAAAAAAAAAAAAAAAEQESFBUf/aAAgBAgEBPxDHElSv/8QAHBABAQADAQEBAQAAAAAAAAAAAREAIUFhMVHw/9oACAEBAAE/EKup221vV5MmUnii73rC6GesfzE14QN4GaJQKefTBAL8O9/xlsBKRO9MHNY+WzBqX7n/2Q=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/f0ce14e49dabc260374548b09e1b66c9/7bf67/game.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;game&quot; title=&quot;&quot; srcset=&quot;/static/f0ce14e49dabc260374548b09e1b66c9/651be/game.jpg 170w,
/static/f0ce14e49dabc260374548b09e1b66c9/d30a3/game.jpg 340w,
/static/f0ce14e49dabc260374548b09e1b66c9/7bf67/game.jpg 680w,
/static/f0ce14e49dabc260374548b09e1b66c9/990cb/game.jpg 1020w,
/static/f0ce14e49dabc260374548b09e1b66c9/dc896/game.jpg 1294w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;I'm grateful to have had the opportunity to attend the first ever Lambda Retreat and hope to carry the functional programming spirit forward. It was super nice meeting all the enthusiastic and kind people at the retreat, and I hope to see everyone again at future events.&lt;/p&gt;
&lt;p&gt;Thanks to Anand for organising it and to everyone who attended for making it an enjoyable experience. Thanks also to Madhav and his team at TVC for ensuring our stay was comfortable.&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;Check out our series on Multicore OCaml, a project I've worked on for the last several years, starting with the &lt;a href=&quot;https://tarides.com/blog/2022-12-19-ocaml-5-with-multicore-support-is-here&quot;&gt;announcement of the OCaml 5 release&lt;/a&gt;. If you'd like to know more about OCaml 5, you can start with &lt;a href=&quot;https://youtu.be/6BhmRz7eqiE&quot;&gt;KC's keynote address&lt;/a&gt; from the ICFP 2022 conference, &lt;a href=&quot;https://ocaml.org/docs&quot;&gt;OCaml tutorials&lt;/a&gt;, and the informative book &lt;a href=&quot;https://www.cambridge.org/core/books/real-world-ocaml-functional-programming-for-the-masses/052E4BCCB09D56A0FE875DD81B1ED571&quot;&gt;&lt;em&gt;Real World OCaml&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://tarides.com/company&quot;&gt;Contact Tarides&lt;/a&gt; to see how OCaml can benefit your business and/or for support while learning OCaml. Follow us on &lt;a href=&quot;https://twitter.com/tarides_&quot;&gt;Twitter&lt;/a&gt; and &lt;a href=&quot;https://www.linkedin.com/company/tarides/&quot;&gt;LinkedIn&lt;/a&gt; to ensure you never miss a post, and join the OCaml discussion on &lt;a href=&quot;https://discuss.ocaml.org/&quot;&gt;Discuss&lt;/a&gt;!&lt;/p&gt;
&lt;/blockquote&gt;</content><id>https://tarides.com/blog/2023-01-12-lambda-retreat-report</id><title type="text">Lambda Retreat Report</title><updated>2023-01-12T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2023-01-10-engineer-spotlight-sudha-parimala" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;For our third and final Engineer Spotlight, we interviewed Sudha Parimala, a Tarides engineer who works primarily on the Multicore Applications team. She talks about what lead her to become an OCaml programmer and why she's excited about OCaml 5, as our blog series on &lt;a href=&quot;https://tarides.com/blog/2022-12-19-ocaml-5-with-multicore-support-is-here&quot;&gt;Multicore OCaml&lt;/a&gt; continues.&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;&lt;strong&gt;Christine: Why did you decide to become an OCaml programmer rather than Python or C++?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Sudha: My programming journey started with Python in high school. At that point I didn't really know much about programming, and I picked it only as an alternative to studying biology. Python's human language-like syntax made it easy to grasp the concepts as a novice, while also getting a feel of programming constructs. The education board decided to switch to C++, and I ended up learning OOP as a result. I continued learning C, Java, and such during my undergrad.&lt;/p&gt;
&lt;p&gt;Then I discovered Haskell and was hooked. I found it wild that I could write a 200+ lines Java program with just 10 lines in Haskell. I got an opportunity to participate in a summer school organised by ACM India on Programming Language Design. This deepened my interest in Functional Programming (FP). After graduating, I got an opportunity to join KC's Multicore OCaml team at IIT Madras. I started learning OCaml then, and there's no looking back.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;C: What do you like best in OCaml?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;S: I like OCaml's features combined with its practicality. When I started learning OCaml, I could relate to a lot of general FP concepts I had learnt through other languages. At the same time one can easily do imperative programming (mutations) or I/O with ease.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;C: What&amp;rsquo;s the coolest thing you've made with OCaml?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;S: When I was working on the Multicore OCaml compiler, I found it really cool that we could easily connect OCaml directly with C, with the type safety of OCaml. If I may add a futuristic take on this is, I'd find it really cool to do hobby projects of mine with the entire stack - from web scraping, to talking to databases, to creating web apps - in OCaml.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;C: Why should engineers learn OCaml?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;S: I'd recommend learning OCaml to anyone curious to learn new and succint ways of expressing programs. OCaml definitely changes the way you think about programs, and I'm sure that reflects on how you write programs, in OCaml and elsewhere.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;C: What are you most excited about in OCaml 5?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;S: I'm really excited to see the OCaml world transition to Multicore. It will be a challenging, yet rewarding journey. Challenging because OCaml programs for more than two decades have been designed for single core. Rewarding, thanks to blazing fast performance time and direct style concurrency. The Multicore and OCaml development teams have invested time in ensuring backwards compatibility, which will hopefully ease the process a bit.&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;Thank you so much, Sudha, for taking the time to answer these questions about your experience with OCaml. Also read &lt;a href=&quot;https://tarides.com/blog/2023-01-05-engineer-spotlight-zach-shipko&quot;&gt;Zach Shipko's&lt;/a&gt; and &lt;a href=&quot;https://tarides.com/blog/2022-12-29-engineer-spotlight-jules-aguillon&quot;&gt;Jules Aguillon's&lt;/a&gt; interviews for their take! Thanks to their willingness to share, other developers can see why they should learn OCaml as their next language.&lt;/p&gt;
&lt;p&gt;Feel like learning OCaml? Get started with the &lt;a href=&quot;https://ocaml.org/docs&quot;&gt;tutorials&lt;/a&gt; and the &lt;a href=&quot;https://www.cambridge.org/core/books/real-world-ocaml-functional-programming-for-the-masses/052E4BCCB09D56A0FE875DD81B1ED571&quot;&gt;&lt;em&gt;Real World OCaml&lt;/em&gt;&lt;/a&gt; book. Get a nice overview of what OCaml 5 has to offer by watching &lt;a href=&quot;https://youtu.be/6BhmRz7eqiE&quot;&gt;KC Sivaramamakrishnan's keynote address&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://tarides.com/company&quot;&gt;Contact Tarides&lt;/a&gt; to see how OCaml can benefit your business and/or for support while learning OCaml. Follow us on &lt;a href=&quot;https://twitter.com/tarides_&quot;&gt;Twitter&lt;/a&gt; and &lt;a href=&quot;https://www.linkedin.com/company/tarides/&quot;&gt;LinkedIn&lt;/a&gt; to ensure you never miss a post, and join the OCaml discussion on &lt;a href=&quot;https://discuss.ocaml.org/&quot;&gt;Discuss&lt;/a&gt;!&lt;/p&gt;
&lt;/blockquote&gt;</content><id>https://tarides.com/blog/2023-01-10-engineer-spotlight-sudha-parimala</id><title type="text">Engineer Spotlight: Sudha Parimala</title><updated>2023-01-10T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2023-01-05-engineer-spotlight-zach-shipko" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Tarides engineer Zach Shipko answers a few questions about why he decided to learn OCaml and why he's particularly excited about the OCaml 5 release. In celebration of OCaml 5, we've interviewed several engineers about their personal experience with the language and what features they enjoy. It's a great way to get some unique insight into the language from someone who works with it on a daily basis.&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;&lt;strong&gt;Christine: Why did you decide to become an OCaml programmer rather than Python or C++?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Zach: I don't really see myself as an &amp;quot;OCaml programmer&amp;quot; because I use Python, C, Rust, Javascript, and other languages quite frequently. It's my interest in many different programming languages that led me to OCaml!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;C: What do you like best in OCaml?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Z: One of my favorite things about OCaml is the amount of thought put into new language features. Because of this I think the whole community values the importance of API design and correctness.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;C: What&amp;rsquo;s the coolest thing you've made with OCaml?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Z: I have been working on &lt;a href=&quot;https://github.com/mirage/irmin/blob/main/libirmin.opam&quot;&gt;&lt;code&gt;libirmin&lt;/code&gt;&lt;/a&gt;, which provides C bindings to the Irmin API, making it possible to use Irmin directly from C and other languages. This uses &lt;a href=&quot;https://github.com/yallop/ocaml-ctypes/tree/master/src/cstubs&quot;&gt;&lt;code&gt;Cstubs_inverted&lt;/code&gt;&lt;/a&gt; to wrap OCaml code in C functions. I don't know how &amp;quot;cool&amp;quot; that is, but everytime it works I am pleasantly surprised.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;C: Why should engineers learn OCaml?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Z: Learning a new programming language can help you see problems from a new perspective and it gives you another tool to reach for when needed. OCaml has lots of nice features (pattern matching, functors, ...) that make solving certain problems more fun.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;C: What are you most excited about in OCaml 5?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Z: Other than being able to use multiple cores, I am very excited about Effects (and eventually typed effects). It is an entirely new paradigm for writing applications with a lot of research behind it. To have a usable effects system in a general-purpose language like OCaml is a huge accomplishment!&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;Zach emphasises the importance of expanding your horizons as a programmer, learning new languages to give you fresh perspectives and insights. Perhaps especially when learning a language like OCaml. Like the esteemed &lt;a href=&quot;https://en.wikipedia.org/wiki/Alan_Perlis&quot;&gt;Alan Perlis&lt;/a&gt; said, &amp;quot;A language that doesn't affect the way you think about programming is not worth knowing.&amp;quot;&lt;/p&gt;
&lt;p&gt;Zach also studied photography and digital media in college. He took the pictures at the top of this post and said he &amp;quot;typically picks photos like this to have some nature to look at on programming websites.&amp;quot;&lt;/p&gt;
&lt;p&gt;Read &lt;a href=&quot;https://tarides.com/blog/2022-12-29-engineer-spotlight-jules-aguillon&quot;&gt;Jules Aguillon's&lt;/a&gt; interview from 27 December 2022 to learn about his journey to OCaml. Next week, look for our final Engineer Spotlight interview with Sudha Parimala, as well as a post from her on the Benchmarking Game.&lt;/p&gt;
&lt;p&gt;Feel like learning OCaml? Get started with &lt;a href=&quot;https://ocaml.org/docs&quot;&gt;the tutorials&lt;/a&gt; and the &lt;a href=&quot;https://www.cambridge.org/core/books/real-world-ocaml-functional-programming-for-the-masses/052E4BCCB09D56A0FE875DD81B1ED571&quot;&gt;&lt;em&gt;Real World OCaml&lt;/em&gt;&lt;/a&gt; book. Learn more about effects and other things OCaml 5 has to offer? Watch KC Sivaramamakrishnan &lt;a href=&quot;https://youtu.be/6BhmRz7eqiE&quot;&gt;keynote&lt;/a&gt; and check out the &lt;a href=&quot;https://speakerdeck.com/kayceesrk/ocaml-5-dot-0&quot;&gt;speaker deck&lt;/a&gt; for his talk as well.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://tarides.com/company&quot;&gt;Contact Tarides&lt;/a&gt; to see how OCaml can benefit your business and/or for support while learning OCaml. Follow us on &lt;a href=&quot;https://mobile.twitter.com/tarides_&quot;&gt;Twitter&lt;/a&gt; and &lt;a href=&quot;https://www.linkedin.com/company/tarides/&quot;&gt;LinkedIn&lt;/a&gt; to ensure you never miss a post, and join the OCaml discussion on &lt;a href=&quot;https://discuss.ocaml.org&quot;&gt;Discuss&lt;/a&gt;!&lt;/p&gt;
&lt;/blockquote&gt;</content><id>https://tarides.com/blog/2023-01-05-engineer-spotlight-zach-shipko</id><title type="text">Engineer Spotlight: Zach Shipko</title><updated>2023-01-05T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-12-29-engineer-spotlight-jules-aguillon" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;In celebration of the OCaml 5 release, we decided to interview a few of our talented engineers about OCaml. While it isn't a well-known language outside of the functional programming community, we're striving to get the word out about the great benefits of OCaml and why it's worth your time to try it out, especially with the introduction of &lt;a href=&quot;https://tarides.com/blog/2022-12-19-ocaml-5-with-multicore-support-is-here&quot;&gt;Multicore support in OCaml 5&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;KC Sivaramakrishnan's inspiring &lt;a href=&quot;https://www.youtube.com/watch?v=zJ4G0TKwzVc&quot;&gt;keynote address&lt;/a&gt; is a great introduction to OCaml 5 and all it offers. Check out the &lt;a href=&quot;https://speakerdeck.com/kayceesrk/retrofitting-concurrency-lessons-from-the-engine-room&quot;&gt;speaker deck&lt;/a&gt; as well.&lt;/p&gt;
&lt;p&gt;Today our engineer Jules Aguillon, who works primarily on our OCaml Platform tooling project, talks about his journey to OCaml, what he enjoys about the language, and why he thinks you should learn it! Take it away Jules!&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;&lt;strong&gt;Christine: How did you start programming?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Jules: My programming journey began with learning C in school, but I soon realised I wanted more abstraction. It felt like the C code was always talking about low-level stuff instead of what I wanted to express. In C, translations are a lot of work and get harder as the algorithm becomes more complex. Things like ASTs and polymorphic datastructures are also really hard to write in C.&lt;/p&gt;
&lt;p&gt;Some of the ways C works are not so innocent, it supports the kinds of dangerous memory operations that &lt;a href=&quot;https://www.zdnet.com/article/microsoft-70-percent-of-all-security-bugs-are-memory-safety-issues/&quot;&gt;famously cause 70% of all security bugs&lt;/a&gt; in some big corporations.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;C: What did you do to get that abstraction that you were looking for?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;J: I decided to learn C++, which is C but with classes (grouping code and data together), abstracted memory operations (making them safer by default), and more type checking.&lt;/p&gt;
&lt;p&gt;But I quickly found that C++ also wasn't a good fit, mainly due to its use of boilerplate. Boilerplate refers to pieces of code that must be repeated in various places without significant change, wrapping around every concept you try to express in C++. They are used to represent several complicated concepts, and any mistake in the boilerplate could bring things like memory unsafety back. I wanted to abstract this away, too.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;C: What did you do next?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;J: To finally write shorter and safe code, I tried Python. It was a joy to use compared to the previous unsafe and verbose C and C++. The garbage collector solved the memory-unsafety problems, and the built-in datastructures and idioms allowed me to write many complex algorithms using only a small amount of code.&lt;/p&gt;
&lt;p&gt;But Python has a dark side: it entirely lacks static type checking. This means that it requires considerable effort to find a type-related mistake. The only way is to run the program with different inputs and wait until it crashes. This gets really annoying as the program grows.&lt;/p&gt;
&lt;p&gt;Furthermore, this kind of mistake happens all the time (sometimes once in every line of code!) and could be entirely solved by a type checker.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;quot;For me, this is already the perfect language and it doesn't stop there!&amp;quot;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;C: Is this where OCaml comes in?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;J: Yes! Then I learned OCaml! It's unconditionally memory-safe, has a garbage collector, the code is concise, many kinds of abstractions are possible, and most importantly, it has well-defined and powerful type checking.&lt;/p&gt;
&lt;p&gt;For me, this is already the perfect language and it doesn't stop there! Modules, polymorphism, and higher-order functions all add deep abstraction possibilities, and there's even a more important feature. Variant types allow types to have different shapes and write tree-looking things like ASTs (abstract syntax trees) that are impossibly hard to express in all the languages above and many others that I have tried.&lt;/p&gt;
&lt;p&gt;Theoreticians talk about algebra of types, and this is the &amp;quot;plus&amp;quot; operation. Now that I've used it in OCaml, I could never go back to a language that doesn't have the &amp;quot;plus&amp;quot; operation!&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;A big thank you to Jules for taking the time to speak about his experience with OCaml. Getting a personal account of why he chose OCaml gives great insight into the strengths and features of the language from someone who uses it every day.&lt;/p&gt;
&lt;p&gt;If you're interested in learning more about OCaml you can learn from &lt;a href=&quot;https://ocaml.org/docs&quot;&gt;tutorials&lt;/a&gt;, the &lt;a href=&quot;https://www.cambridge.org/core/books/real-world-ocaml-functional-programming-for-the-masses/052E4BCCB09D56A0FE875DD81B1ED571&quot;&gt;Real World OCaml book&lt;/a&gt;, and contribute &lt;a href=&quot;https://github.com/ocaml/ocaml&quot;&gt;on Github&lt;/a&gt;. We look forward to seeing you in the community!&lt;/p&gt;</content><id>https://tarides.com/blog/2022-12-29-engineer-spotlight-jules-aguillon</id><title type="text">Engineer Spotlight: Jules Aguillon</title><updated>2022-12-29T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-12-27-love-rust-then-ocaml-s-new-eio-library-is-for-you" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;We&amp;rsquo;ve come to expect a lot from the programming languages we use. We want the memory safety of Java, the performance of C/C++, and the concurrency of Go. On top of this, we need robust cybersecurity tools to protect us from the many risks and vulnerabilities in the world, all in an intuitive and easy-to-use package for programmers.&lt;/p&gt;
&lt;p&gt;You can expect all of the above with OCaml 5. The new library &lt;a href=&quot;https://github.com/ocaml-multicore/eio&quot;&gt;Eio&lt;/a&gt; introduces some great new features that let the programmer write concurrent code in a way that best suits them. Eio is fast, solves the &lt;a href=&quot;https://journal.stuffwithstuff.com/2015/02/01/what-color-is-your-function/&quot;&gt;function colouring problem&lt;/a&gt;, and can use effect handlers to let the developer customise the scheduling algorithm rather than baking it in at runtime. If you&amp;rsquo;re a fan of how Rust delivers fast and high performing concurrent code, OCaml 5&amp;rsquo;s Eio is a close match, with some additional features.&lt;/p&gt;
&lt;p&gt;Eio gives OCaml a new edge on speed, ease-of-use, portability, and security. It matches Rust&amp;rsquo;s reputed performance on the same points, making the two languages more comparable when it comes to concurrent programming. Let me know what you think of my comparison on &lt;a href=&quot;https://discuss.ocaml.org&quot;&gt;Discuss&lt;/a&gt; or &lt;a href=&quot;https://twitter.com/tarides_&quot;&gt;Twitter&lt;/a&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#how-eio-makes-concurrent-code-quick-and-easy&quot; aria-label=&quot;how eio makes concurrent code quick and easy permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;How Eio Makes Concurrent Code Quick and Easy&lt;/h2&gt;
&lt;p&gt;Rust is a &lt;a href=&quot;https://codilime.com/blog/why-is-rust-programming-language-so-popular/&quot;&gt;popular programming language&lt;/a&gt; that solves a lot of problems for programmers. One of Rust&amp;rsquo;s strengths is the way it delivers concurrent code in a quick and safe manner.&lt;/p&gt;
&lt;p&gt;According to a &lt;a href=&quot;https://codilime.com/blog/why-is-rust-programming-language-so-popular/&quot;&gt;recent blog post&lt;/a&gt;, &amp;ldquo;Rust solves problems that C/C++ developers have been struggling with for a long time: memory errors and concurrent programming. This is seen as its main benefit.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Eio makes writing concurrent code in OCaml much easier, resolving earlier pain points and providing significant benefits. OCaml is also a type- and memory-safe language with a low-latency and high-throughput concurrent garbage collector that doesn't get in the way of application code execution.&lt;/p&gt;
&lt;p&gt;Below is an overview of the biggest changes Eio brings to concurrent programming in OCaml. With these improvements, OCaml provides a concurrent programming experience comparable to Rust.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#key-benefits-of-eio&quot; aria-label=&quot;key benefits of eio permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Key Benefits of Eio&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;Performance&lt;/em&gt;
Eio brings big performance improvements to concurrent code in OCaml, making use cases like web servers serving requests from users a lot faster. In a speed test comparing Eio&amp;rsquo;s performance to Go&amp;rsquo;s &lt;code&gt;net/http&lt;/code&gt; and Rust&amp;rsquo;s &lt;code&gt;hyper&lt;/code&gt;, the results show that Eio outperforms Go and closely matches Rust. Eio can reliably serve over one million requests per second on a few cores. Being such a close match in terms of performance, OCaml is a strong contender for users looking to expand beyond using Rust.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/9f0b97bdb5cfc231e1a387bb218f08c4/133ae/http_load1.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.47058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABp0lEQVR42pVT266bQAzM//9c1ZdIfYoSaNPCsjebvbKeIwgVJ03zcIxGvi2jWYxPrbVfACIABjB/Be2ISYBFRL6fRMS01qCNldExiAjGGDjnUEp5i5wzllowx4zBcsPDfpxSSialBDUOMv68out6nM9n3O93iMgLWhNgjyktmPwMpdRBSETGGAtjJ5nm31CTRtd1sNZuL/3PUhVoz5idBpJBpukgZGYzKQVPJGWpu4q24bAHcV0arPPwekALBmh5q+ecnxWO4whmlldFe75UkJ2g1R/k2QJSP3eRUzoIQwhGaw3v/T+Ee9wqmh9QvMY7e1GolFqnuxPK9jxOMiqP4EzQ2cFlB5vs5l3a82wxff6G3nszTdN25SaPeq4R7HpY18MXhsseqUas/UWWZ2ABRXoeyl+FqzAXNXpzAQWN9dS7Sb+9cqnFMM+w1oiNGioqLG3BV+yJcN2UNaKZpB96tNrARIgxblh/+hACYkzbhqy11TPz1tv9Qdha6/d99CFEyiVTCIHmeabL5ULX65X6vqfb7UZd1225UopijFRKIWYmAA5AEZFvH4+X8/tF5WSuAAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/9f0b97bdb5cfc231e1a387bb218f08c4/c5bb3/http_load1.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;EioImage&quot; title=&quot;&quot; srcset=&quot;/static/9f0b97bdb5cfc231e1a387bb218f08c4/04472/http_load1.png 170w,
/static/9f0b97bdb5cfc231e1a387bb218f08c4/9f933/http_load1.png 340w,
/static/9f0b97bdb5cfc231e1a387bb218f08c4/c5bb3/http_load1.png 680w,
/static/9f0b97bdb5cfc231e1a387bb218f08c4/b12f7/http_load1.png 1020w,
/static/9f0b97bdb5cfc231e1a387bb218f08c4/b5a09/http_load1.png 1360w,
/static/9f0b97bdb5cfc231e1a387bb218f08c4/133ae/http_load1.png 1424w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Ease-of-Use&lt;/em&gt;
One of Rust&amp;rsquo;s strengths is its user friendliness, meaning it&amp;rsquo;s easy to use and code in. With the OCaml 5 update, Eio makes OCaml a much easier language for writing concurrent code.&lt;/p&gt;
&lt;p&gt;Eio offers an alternative to monadic I/O, which used to be the only way to write concurrent code in OCaml. Now, with OCaml 5, the developer experience is greatly simplified and will feel familiar to anyone who knows OCaml.&lt;/p&gt;
&lt;p&gt;Patrick Ferris, a developer at Tarides, emphasises that with Eio:&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#normal-ocaml-features-just-work-out-of-the-box-like-exception-backtraces-which-are-crucial-for-writing-new-libraries-using-tools-and-debugging-programs&quot; aria-label=&quot;normal ocaml features just work out of the box like exception backtraces which are crucial for writing new libraries using tools and debugging programs permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&amp;ldquo;Normal OCaml features just work out of the box, like exception backtraces, which are crucial for writing new libraries, using tools, and debugging programs.&amp;rdquo;&lt;/h3&gt;
&lt;p&gt;Being able to use backtraces is a big improvement, as they can show the developer a form of &amp;lsquo;history&amp;rsquo; of what interventions have been made to a program. Using it in Eio lets developers debug and troubleshoot more quickly. Having access to standard OCaml features also means that the more difficult parts of concurrent programming, such as cancellations, cleaning up resources, reporting errors, and testing are a lot easier to perform with Eio.&lt;/p&gt;
&lt;p&gt;The biggest change users will notice is the resolution of the &amp;lsquo;code colouring problem.&amp;rsquo; In the past, synchronous code could not exist alongside asynchronous code without breaking, requiring the developer to use a special calling convention to invoke asynchronous code. With Eio, that is no longer a problem, as both just appear as normal OCaml functions. This significantly improves developer experience and productivity and is unique to Eio. Currently, in Rust&amp;rsquo;s I/O library the &amp;lsquo;code colouring problem&amp;rsquo; still exists, and developers have to spend time resolving conflicts between code types.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Portability&lt;/em&gt;
Both Rust and OCaml offer excellent portability, and with Eio OCaml gets several quality-of-life updates that lets developers create programs in different environments with several different features.&lt;/p&gt;
&lt;p&gt;Operating systems have changed a lot in the last decade, benefiting from continuous development and modernisation. Thanks to its flexibility, Eio is able to take advantage of modern OS features (such as Linux&amp;rsquo;s &lt;a href=&quot;https://github.com/axboe/liburing&quot;&gt;io_uring&lt;/a&gt; to boost its own performance.&lt;/p&gt;
&lt;p&gt;In turn, different backends for various platforms (such as Linux, MacOS, Windows, Mirage, etc.) can also implement the standard environment Eio expects to run programs. This adds an element of predictability to developer workflow, minimising the amount of task-switching and time spent outside of programming.&lt;/p&gt;
&lt;p&gt;On the topic of Eio&amp;rsquo;s flexibility, Thomas Leonard, the creator and lead maintainer of Eio, highlights that:&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#eio-can-also-run-existing-lwt-and-async-code-alongside-new-code-allowing-existing-projects-to-be-upgraded-piece-by-piece-keeping-the-tests-passing-throughout-the-migration-a-couple-of-lines-of-code-is-all-it-takes-to-make-an-existing-lwt-application-run-on-eio-and-from-there-any-new-code-can-use-eio-directly&quot; aria-label=&quot;eio can also run existing lwt and async code alongside new code allowing existing projects to be upgraded piece by piece keeping the tests passing throughout the migration a couple of lines of code is all it takes to make an existing lwt application run on eio and from there any new code can use eio directly permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&amp;ldquo;Eio can also run existing Lwt and Async code alongside new code, allowing existing projects to be upgraded piece by piece, keeping the tests passing throughout the migration. A couple of lines of code is all it takes to make an existing Lwt application run on Eio, and from there any new code can use Eio directly.&amp;rdquo;&lt;/h3&gt;
&lt;p&gt;Instead of having to pick one I/O tool to learn, Eio&amp;rsquo;s library can run all three in the same program which is completely new.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Security&lt;/em&gt;
Both Rust and OCaml offer strong safety features. According to the blog &lt;a href=&quot;https://codilime.com/blog/why-is-rust-programming-language-so-popular/&quot;&gt;Codilime&lt;/a&gt;, &amp;ldquo;High performance and safety are the features that made Rust so appealing.&amp;rdquo; Well, Eio adds even more security features to OCaml&amp;rsquo;s already long list.&lt;/p&gt;
&lt;p&gt;Eio allows developers to implement measures with great specificity, which has great significance when it comes to security. For example, Eio lets a developer program a web server to serve files only from within specified directory trees, removing the possibility that it could be tricked into serving other files. This ensures that the I/O only shares what it&amp;rsquo;s intended to do without being bypassed, which is a common security problem with web servers.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Many businesses and programmers love Rust, and for good reason! What OCaml 5 and Eio can offer is an alternative that matches Rust on performance and user friendliness, includes new cutting-edge features, and delivers on safety in a way that is uniquely OCaml. With its new Eio library, concurrent programming in OCaml becomes more similar to Rust, and out of the two only OCaml solves the function colouring problem. If you&amp;rsquo;re looking to complement your use of Rust with a robust functional programming language &amp;ndash; without sacrificing performance &amp;ndash; OCaml 5 is the language for you.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://tarides.com/company&quot;&gt;Contact us&lt;/a&gt; and learn more about how OCaml can transform your business. You can also find us on &lt;a href=&quot;https://github.com/tarides&quot;&gt;GitHub&lt;/a&gt;, the OCaml &lt;a href=&quot;https://discuss.ocaml.org&quot;&gt;Discuss&lt;/a&gt;  forum, and &lt;a href=&quot;https://twitter.com/tarides_&quot;&gt;Twitter&lt;/a&gt;&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#acknowledgements&quot; aria-label=&quot;acknowledgements permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Acknowledgements&lt;/h3&gt;
&lt;p&gt;With thanks to Thomas Leonard, creator and lead maintainer of Eio, and Patrick Ferris, a developer at Tarides, for their expertise and input that made this article possible.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#sources&quot; aria-label=&quot;sources permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Sources&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://codilime.com/blog/why-is-rust-programming-language-so-popular/&quot;&gt;Codilime&lt;/a&gt; blog&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://serokell.io/blog/rust-guide&quot;&gt;Serokell&lt;/a&gt; blog&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content><id>https://tarides.com/blog/2022-12-27-love-rust-then-ocaml-s-new-eio-library-is-for-you</id><title type="text">Love Rust? Then OCaml's New Eio Library is for You</title><updated>2022-12-27T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-12-22-ocaml-5-multicore-testing-tools" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;The new version of OCaml 5 is here! It brings the ability to program multicore applications and to maximise our usage of all the CPU cores without a global lock getting in the way of performance. What's most exciting to me though is that we have a whole new way of writing... bugs!&lt;/p&gt;
&lt;p&gt;And with so much potential for mistakes comes a new era of testing tools to help us write correct applications:&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#memory-model&quot; aria-label=&quot;memory model permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Memory Model&lt;/h2&gt;
&lt;p&gt;The first of those is the &lt;a href=&quot;https://kcsrk.info/webman/manual/memorymodel.html&quot;&gt;&lt;em&gt;memory model&lt;/em&gt; of OCaml 5&lt;/a&gt;. If you already know what those two words mean, please skip this part because I won't pretend that I do. (I'm still convinced that it's just some fancy legalese terms to confuse people.) But it may actually matter when you realise that you've been living in a fantasy your whole CPU life:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;left &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;42&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
right &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When I read these two lines, I have years of beliefs telling me that the reference &lt;code&gt;left&lt;/code&gt; will be updated before the &lt;code&gt;right&lt;/code&gt; one is. But modern compilers and hardware conspire to break any sanity that may exist in my brain. You see, the order of operations doesn't actually matter &lt;em&gt;if&lt;/em&gt; you can't see that the CPU is doing things in another order. It may just happen that the compiler or CPU will choose to do those two operations in reverse if they think it would be more convenient. And without this, our software would be so much slower that &lt;em&gt;&amp;quot;instructions are executed in order&amp;quot;&lt;/em&gt; is an essential lie. (Well, is it even a lie if it makes no difference?)&lt;/p&gt;
&lt;p&gt;To catch a liar, you need a second observer to correlate their claims. This is exactly what the other CPU cores will do. The bad news is that they are not actively looking for bad behavior from their colleagues, but they will end up reading values that aren't quite written in the order expected. This will wreak havoc into your invariants and trigger very, very weird bugs.&lt;/p&gt;
&lt;p&gt;I'm not kidding when I say &amp;quot;very, very weird.&amp;quot; Below is a real example of an out-of-order read/write that happened on my computer. This was a very simple program, with only two references, &lt;code&gt;left&lt;/code&gt; and &lt;code&gt;right&lt;/code&gt;, that got updated by two different domains (shown as two branches here):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;                          !left    = 42
                          !right   = 0
                                 |
              .------------------------------------.
              |                                    |
              |                               left  := 1
              |                               right := 2
         right := 3                                |
        !left        = 42                    !right       = 3
                      ^^^^
                      how?&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I tried to align the sequence of operations according to the observed memory values, but no ordering actually made sense. We can't have both &lt;code&gt;!left = 42&lt;/code&gt; and &lt;code&gt;!right = 3&lt;/code&gt; in the end.&lt;/p&gt;
&lt;p&gt;Here's another attempt to align the instructions in a coherent way:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;                          !left    = 42
                          !right   = 0
                                 |
              .------------------------------------.
              |                                    |
         right := 3                                |
        !left        = 42                          |
                                              left  := 1
                                              right := 2
                                             !right       = 3
                                                          ^^^^
                                                          how?&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It already requires some time to unpack this short example, but imagine how bad it would get to debug such a thing in production!&lt;/p&gt;
&lt;p&gt;I want to stress that this specific execution wasn't the result of a compiler optimisation that we could have discovered by reading the assembly code. The program was running just fine over many iterations before being disturbed by a sudden hardware optimisation. The probability of observing this behavior from your CPU is very low---not low enough that you can ignore it, but you won't be able to reproduce this exact bug in any reasonable time. (But we'll see how to catch our CPU cores red-handed in the following sections!)&lt;/p&gt;
&lt;p&gt;But ok, wait---come again. How is any of this nonsense a good memory model? For starters, the values you can read &amp;quot;out-of-order&amp;quot; are still real values that have been assigned to the references, not imaginary ones. Yes, it could be even weirder, but you don't want to know. It's all fun and games with integers, but this property really matters for pointers (where following the wrong one would lead you down a segmentation fault). You need to be wary of this in other languages, but not in OCaml. Memory safety is preserved. It's not an instant &lt;em&gt;Game Over&lt;/em&gt; to do an accidental out-of-order read.&lt;/p&gt;
&lt;p&gt;Secondly, when reading and writing to shared memory, you should use the new &lt;code&gt;Atomic&lt;/code&gt; module to ensure the proper memory ordering of operations. This will introduce the required memory barriers to bring back sanity---at a small performance cost---so it's opt-in and only required for shared memory! (Note: you can also use a &lt;code&gt;Mutex&lt;/code&gt; lock to protect your read/write into shared memory.)&lt;/p&gt;
&lt;p&gt;In technical words, OCaml 5 programs enjoy the &lt;em&gt;&amp;quot;Sequential Consistency for Data Race Freedom (DRF-SC)&amp;quot;&lt;/em&gt; property. If your program has no data races, then you can reason about your code under sequential consistency where the operations from different threads are interleaved with each other, but the instructions don't seem to be executed out of order.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://kcsrk.info/webman/manual/memorymodel.html&quot;&gt;Read more about the memory model in the OCaml 5 manual&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;By using &lt;code&gt;Atomic&lt;/code&gt;, we are back in the wonderful land where operations happen in the expected order! The memory model becomes a tool for your brain, enabling it to reason about your algorithms. This one is so intuitive that I can once again pretend that it doesn't exist (without getting hit by an unexpected bug later.)&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#threadsanitizer&quot; aria-label=&quot;threadsanitizer permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ThreadSanitizer&lt;/h2&gt;
&lt;p&gt;Alright, so how do we check that our programs aren't susceptible to an &amp;quot;out-of-order&amp;quot; bug caused by a missing &lt;code&gt;Atomic&lt;/code&gt; or &lt;code&gt;Mutex&lt;/code&gt;? ThreadSanitizer was created by Google as a lightweight instrumentation to discover these runtime data races.&lt;/p&gt;
&lt;p&gt;To enable it on your OCaml program, you&amp;rsquo;ll need a special compiler that adds the required instrumentation to your software. Don't worry, it&amp;rsquo;s super easy to setup thanks to opam switches!&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ocaml-multicore/ocaml-tsan&quot;&gt;Install and usage informations on the &lt;code&gt;ocaml-tsan&lt;/code&gt; repository&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;As a running example to demonstrate the usefulness of each tool, let's look at different implementations of simple banking accounts, where users can transfer money to each other &lt;em&gt;if&lt;/em&gt; they have enough money in their account:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Bank &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; int array

  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; transfer t from_account to_account money &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; money &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;                     &lt;span class=&quot;token comment&quot;&gt;(* no negative transfer! *)&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; from_account &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;gt;&lt;/span&gt; to_account    &lt;span class=&quot;token comment&quot;&gt;(* or transfer to self! *)&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;from_account&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;gt;=&lt;/span&gt; money     &lt;span class=&quot;token comment&quot;&gt;(* and you must have enough money! *)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;begin&lt;/span&gt;
      t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;from_account&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;from_account&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; money &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;to_account&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;to_account&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; money &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This module could be part of a much larger program that receives transaction requests from the network and handles them. For simplicity here, we'll only be running a small simulation, but ThreadSanitizer is intended to be used on large real programs with messy I/O and side effects, not just broken toys and unit tests.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; t &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Bank&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;make &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;(* 8 accounts with $100 each *)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; money_shuffle &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;(* simulate an economy *)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    Unix&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sleepf &lt;span class=&quot;token number&quot;&gt;0.1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;(* wait for a network request *)&lt;/span&gt;
    Bank&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;transfer t &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Random&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;int &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Random&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;int &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;(* transfer $1 *)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; account_balances &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;(* inspect the bank accounts *)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;iter &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Format&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printf &lt;span class=&quot;token string&quot;&gt;&amp;quot;%i &amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; t &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; Format&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printf &lt;span class=&quot;token string&quot;&gt;&amp;quot;@.&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    Unix&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sleepf &lt;span class=&quot;token number&quot;&gt;0.1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;(* run the simulation and the debug view in parallel *)&lt;/span&gt;
  &lt;span class=&quot;token operator-like-punctuation punctuation&quot;&gt;[|&lt;/span&gt; Domain&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;spawn money_shuffle &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; Domain&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;spawn account_balances &lt;span class=&quot;token operator-like-punctuation punctuation&quot;&gt;|]&lt;/span&gt; 
  &lt;span class=&quot;token operator&quot;&gt;|&amp;gt;&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;iter Domain&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;join&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It should be pretty clear that our code is not thread-safe and that transferring money while printing the account balances is asking for trouble! Running it with ThreadSanitizer enabled will print warnings into the terminal as soon as a potential data-race is observed (and it's even better in real life as the output is colorful!):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;WARNING: ThreadSanitizer: data race (pid=1178477)
  Write of size 8 at 0x7fc4936fd6b0 by thread T4 (mutexes: write M87):
    #0 camlDune__exe__V0.transfer_317 &amp;lt;null&amp;gt; (v0.exe+0x6ae1a)
    #1 camlDune__exe__V0.money_shuffle_325 &amp;lt;null&amp;gt; (v0.exe+0x6af8d)
    .. ...

  Previous read of size 8 at 0x7fc4936fd6b0 by thread T1 (mutexes: write M83):
    #0 camlStdlib__Array.iter_329 &amp;lt;null&amp;gt; (v0.exe+0x9c675)
    #1 camlDune__exe__V0.account_balances_563 &amp;lt;null&amp;gt; (v0.exe+0x6b054)
    .. ...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The issue is reported very clearly thanks to the two conflicting stacktraces. There's a read/write data-race happening between the &lt;code&gt;money_shuffle&lt;/code&gt; execution and the &lt;code&gt;account_balances&lt;/code&gt; one, which could result in unreasonable memory reordering artifacts. In fact, it would be even worse if we were to &lt;code&gt;transfer&lt;/code&gt; money from multiple domains in parallel (which we'll attempt to do in the next section as an interesting way of speeding up our bank transactions with Multicore).&lt;/p&gt;
&lt;p&gt;It looks like we can fix the read/write data-race by adding a &lt;code&gt;Mutex&lt;/code&gt; lock around the &lt;code&gt;transfer&lt;/code&gt; function &lt;em&gt;write&lt;/em&gt; operations:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; lock &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Mutex&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;create &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; transfer t from_account to_account money &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  Mutex&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lock lock &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;(* ... same as before ... *)&lt;/span&gt;
  Mutex&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;unlock lock&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;But ThreadSanitizer is not easily fooled and will still complain loudly. We also need to use the same &lt;code&gt;Mutex&lt;/code&gt; to protect the array reads in the &lt;code&gt;account_balances&lt;/code&gt; function, as it would otherwise be perfectly valid to optimise away the shared memory reads into oblivion:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; account_balances_optimized &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;(* faster... but wrong-er! *)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; str &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;concat &lt;span class=&quot;token string&quot;&gt;&amp;quot; &amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;@@&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;of_list &lt;span class=&quot;token operator&quot;&gt;@@&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;map string_of_int t &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    Format&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printf &lt;span class=&quot;token string&quot;&gt;&amp;quot;%s @.&amp;quot;&lt;/span&gt; str &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    Unix&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sleepf &lt;span class=&quot;token number&quot;&gt;0.1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The data races reported by ThreadSanitizer are not only the ones where an absurd &amp;ldquo;out-of-order&amp;rdquo; happened, but preemptively, all those that could potentially trigger such a problem. If you are porting an existing multi-threaded application to OCaml 5, this compiler variant should probably be your default debug build.&lt;/p&gt;
&lt;p&gt;Note that the ThreadSanitizer instrumentation does add a performance cost and doesn't increase memory safety by itself. Run it for a bit, track down your shared memory misuses, and add the required &lt;code&gt;Atomic&lt;/code&gt; and &lt;code&gt;Mutex&lt;/code&gt; operations.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#multicore-tests-lin-and-stm&quot; aria-label=&quot;multicore tests lin and stm permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Multicore Tests: &lt;code&gt;Lin&lt;/code&gt; (and &lt;code&gt;STM&lt;/code&gt;)&lt;/h2&gt;
&lt;p&gt;How do we unit test our Multicore libraries? It's business as usual, and the standard Alcotest will do well, for example. But there are some new properties that we should look for when writing and using libraries in a multicore setting. Let's revisit the bank accounts implementation by using &lt;code&gt;Atomic&lt;/code&gt; operations this time rather than a &lt;code&gt;Mutex&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Bank &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; int Atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t array

  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; get t client &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; transfer t from_account to_account money &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; money &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; from_account &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;gt;&lt;/span&gt; to_account
    &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; get t from_account &lt;span class=&quot;token operator&quot;&gt;&amp;gt;=&lt;/span&gt; money
    &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;begin&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;(* [fetch_and_add x v] is an atomic operation that does [x := !x + v] *)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fetch_and_add t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;from_account&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; money&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fetch_and_add t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;to_account&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; money &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;See how careful I was to use &lt;code&gt;Atomic&lt;/code&gt; to read and write from shared memory? (I even used a fancy &lt;code&gt;fetch_and_add&lt;/code&gt;!) Therefore, it must be correct if used by different domains, right? While this program doesn't have a data race, the definition of &amp;quot;correctness&amp;quot; is more subtle in a multicore setting.&lt;/p&gt;
&lt;p&gt;It's easier to explain if I show you the problem. To test this interface with the &lt;code&gt;Lin&lt;/code&gt; library, we only need to describe how to &lt;code&gt;init&lt;/code&gt;ialise a new bank and the API signature of available functions:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; Lin

&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Bank_test &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Bank&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t

  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; init &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;(* 8 accounts with $100 each *)&lt;/span&gt;
    Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;init &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; Atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;make &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; cleanup &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; account &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; int_bound &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;(* array index between 0..7 *)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; api &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    val_ &lt;span class=&quot;token string&quot;&gt;&amp;quot;get&amp;quot;&lt;/span&gt; Bank&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;@-&amp;gt;&lt;/span&gt; account &lt;span class=&quot;token operator&quot;&gt;@-&amp;gt;&lt;/span&gt; returning int&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    val_ &lt;span class=&quot;token string&quot;&gt;&amp;quot;transfer&amp;quot;&lt;/span&gt; Bank&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;transfer
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;@-&amp;gt;&lt;/span&gt; account &lt;span class=&quot;token operator&quot;&gt;@-&amp;gt;&lt;/span&gt; account &lt;span class=&quot;token operator&quot;&gt;@-&amp;gt;&lt;/span&gt; nat_small &lt;span class=&quot;token operator&quot;&gt;@-&amp;gt;&lt;/span&gt; returning unit&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Run &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Lin_domain&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Make &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Bank_test&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  QCheck_base_runner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run_tests_main &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Run&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lin_test &lt;span class=&quot;token label property&quot;&gt;~count&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt; &lt;span class=&quot;token label property&quot;&gt;~name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;Bank&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That's all! A small DSL to define the types of our functions and we are done. Run this test to admire the beautiful ASCII art... craAaAash:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;  Results incompatible with sequential execution

                                   |
                                   |
                .------------------------------------.
                |                                    |
     transfer t 4 0 8  : ()               transfer t 4 0 93  : ()
          get t 4  : -1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;Lin&lt;/code&gt; found a bug! The account number &lt;code&gt;4&lt;/code&gt; is trying to simultaneously transfer $8 and $93 to account number &lt;code&gt;0&lt;/code&gt;. It then naturally ends up with a negative $1 on its account, which is obviously bad for a banking system... but we never told &lt;code&gt;Lin&lt;/code&gt; that this was illegal, so why is it complaining?&lt;/p&gt;
&lt;p&gt;In the tradition of QuickCheck, &lt;code&gt;Lin&lt;/code&gt; not only generates random arguments to test our API, but it also creates full programs to execute on two domains. It then runs these generated programs and checks if the intermediate results are &amp;quot;sequentially consistent,&amp;quot; the property of a well-behaved API where we can always explain its multicore behavior as a linear execution of the calls on a single core.&lt;/p&gt;
&lt;p&gt;Without this &amp;quot;sequential consistency&amp;quot; property, the internals of our functions leak when multiple cores interleave their execution. In the example above, it wouldn't be possible to reach a negative $1 account on a single core, so &lt;code&gt;Lin&lt;/code&gt; reports that sequential consistency is broken. It doesn't know that negative accounts are illegal, but it knows that this state is unreachable without multicore shenanigans.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/1ef04969f6bdb69e1799b67f09b8acfe/c1b63/nonseq.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 32.35294117647059%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABsjAAAbIwGgXpL4AAABT0lEQVR42o2QTS8DURSG5z+Jn4BgY2vnl0jEwkJCsBCJTRcSNmJDfDVaVEIqSutzSqqdaqcf0xmmc6d1731ERyzFc/Ikb07e5CTHEEIggjYi8JFSgApAeqBaaNmkE5So27eUHZsQheh28H2fIAgIw5AeWoOOotGo3lPJTuIVVnGtHZR7AF4C7SRQtQQ0z7GeDrl1SrzQ4fTDYrqSYsN9oOV5vIeCLhDoT3zZwShnDsjMDpBfGuVxbhhzfpjy4hD22gTdxy3aNRPrrUiuVuRKVImVLujbmqJ/b4bB+Dwj8QXGzlYYT8fYd0wM4TkIy0TkM/jXR3ipTdy9VdztZT6S6/jZEwp3aVKvdxzXTfaLN+wWMiTf7jmrPHFpv3DTKPLsVtFaY/AHKmzTrhawzRzNRoP/YEQPVZFKglKRWv+WpJS969+jtEZq1VP1jHb6p/8FnZm35rtmSMYAAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/1ef04969f6bdb69e1799b67f09b8acfe/c5bb3/nonseq.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;nonseq&quot; title=&quot;&quot; srcset=&quot;/static/1ef04969f6bdb69e1799b67f09b8acfe/04472/nonseq.png 170w,
/static/1ef04969f6bdb69e1799b67f09b8acfe/9f933/nonseq.png 340w,
/static/1ef04969f6bdb69e1799b67f09b8acfe/c5bb3/nonseq.png 680w,
/static/1ef04969f6bdb69e1799b67f09b8acfe/b12f7/nonseq.png 1020w,
/static/1ef04969f6bdb69e1799b67f09b8acfe/c1b63/nonseq.png 1200w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Even though this is not a data race, a user of our library would have an equally hard time understanding the outcomes of our functions, when they depend so much on their accidental interleaving. &lt;em&gt;&amp;quot;It sometimes doesn't work&amp;quot;&lt;/em&gt; is not a bug report I wish to see!&lt;/p&gt;
&lt;p&gt;An intuitive way of thinking about &amp;quot;sequential consistency&amp;quot; is that our functions should behave as if they were a single atomic operation: Either we see none of their side effects, or we see all of them. It shouldn't be possible to see an in between, as this would result in a non-sequentialisable execution.&lt;/p&gt;
&lt;p&gt;Once again, the easiest solution here is to use a &lt;code&gt;Mutex&lt;/code&gt; to lock all the accounts during a transfer and when reading an account balance. Run the test suite again with &lt;code&gt;Lin&lt;/code&gt;, and yep, we are safe. The operations are now sequentially consistent! (But we don't need the Atomics anymore with the &lt;code&gt;Mutex&lt;/code&gt;.)&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/e315b196ba7386891ed868b245f87e1d/c1b63/seqmutex.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 21.176470588235293%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABrOAAAazgFG4XaGAAAA/UlEQVR42l3Lv07CQACA8VuIoy9kfCNnX0ETE3XQxMkHMCEYIBhXdMLJf6hAoeAfUnptr3DXo971M3HkW37TJ3wxxusnnH6hKvq4IiJ3loHPGbqcN5eR4KGMcatHnH7Fm2f8r2SxtgQ+Z+ByPpziszKIr+4O44YgbAqW3S2i0Tn7aQ8xOqY2O0NMDjjkG96P6F8JwlaN6Fbgh3tczh/Ynl0gJqeI8ITdVRuxTu8x8wYmalLKDtZkjJymuQ5p2yl1O2ZYWSgCzOIaG3coZYuqGLC0hhs7pWEC6ibgrvxBsJFSimWSYaRCy4wiycliiUwVqSqQif53EWdorTd3/gDF/RsU8/+kGgAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/e315b196ba7386891ed868b245f87e1d/c5bb3/seqmutex.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;seqmutex&quot; title=&quot;&quot; srcset=&quot;/static/e315b196ba7386891ed868b245f87e1d/04472/seqmutex.png 170w,
/static/e315b196ba7386891ed868b245f87e1d/9f933/seqmutex.png 340w,
/static/e315b196ba7386891ed868b245f87e1d/c5bb3/seqmutex.png 680w,
/static/e315b196ba7386891ed868b245f87e1d/b12f7/seqmutex.png 1020w,
/static/e315b196ba7386891ed868b245f87e1d/c1b63/seqmutex.png 1200w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;I really like how low effort / high reward &lt;code&gt;Lin&lt;/code&gt; is. In just a few lines of declarative code, we can check that our code is correct when running on multiple cores. It's very extensive in its testing, which is just what we need when bugs are this hard to reproduce. The Multicore testing suite also provides a state-machine interface &lt;code&gt;STM&lt;/code&gt;, which allows you to specify more properties that your system should respect (not only sequential consistency, but custom business logic!)&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ocaml-multicore/multicoretests&quot;&gt;More examples on the &lt;code&gt;multicoretests&lt;/code&gt; repository&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Fun fact: The earlier &amp;quot;out-of-order&amp;quot; memory read/write on mutable references was also generated by &lt;code&gt;Lin&lt;/code&gt;. While this tool is not specialised like ThreadSanitizer for discovering data-races, it can still trigger and identify the hardware memory reordering since they produce outcome that can't be explained on a single core. Here's the complete test if you want to see your computer memory &lt;del&gt;misbehaving&lt;/del&gt; optimising:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; Lin

&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Int_array &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; int array
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; init &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator-like-punctuation punctuation&quot;&gt;[|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token operator-like-punctuation punctuation&quot;&gt;|]&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; cleanup &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; index &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; int_bound &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; api &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    val_ &lt;span class=&quot;token string&quot;&gt;&amp;quot;get&amp;quot;&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;@-&amp;gt;&lt;/span&gt; index &lt;span class=&quot;token operator&quot;&gt;@-&amp;gt;&lt;/span&gt; returning int&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    val_ &lt;span class=&quot;token string&quot;&gt;&amp;quot;set&amp;quot;&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;set &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;@-&amp;gt;&lt;/span&gt; index &lt;span class=&quot;token operator&quot;&gt;@-&amp;gt;&lt;/span&gt; int &lt;span class=&quot;token operator&quot;&gt;@-&amp;gt;&lt;/span&gt; returning unit&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Run &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Lin_domain&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Make &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Int_array&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; QCheck_base_runner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run_tests_main &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Run&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lin_test &lt;span class=&quot;token label property&quot;&gt;~count&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10_000&lt;/span&gt; &lt;span class=&quot;token label property&quot;&gt;~name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;Array&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#dscheck&quot; aria-label=&quot;dscheck permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Dscheck&lt;/h2&gt;
&lt;p&gt;While adding a &lt;code&gt;Mutex&lt;/code&gt; restores the sequential consistency of the &lt;code&gt;transfer&lt;/code&gt; function, it's unsatisfying to slow down all transactions with a global lock. Most transfers are going to happen on different accounts, so could we be more precise in our safety measures? This is far from easy with locks, if we don't want to end up bankrupt with &lt;a href=&quot;https://en.wikipedia.org/wiki/Dining_philosophers_problem&quot;&gt;hungry philosophers&lt;/a&gt;!&lt;/p&gt;
&lt;p&gt;One alternative solution is called lock-free programming, and as the name implies, it gets rid of all the locks---but at the cost of more complex algorithms. By using only &lt;code&gt;Atomic&lt;/code&gt; operations, there are ways of encoding our &lt;code&gt;transfer&lt;/code&gt; operation without blocking the other cores (such that they don't get stuck waiting on the unrelated threads to finish their transaction).&lt;/p&gt;
&lt;p&gt;Lock-free algorithms have a bad reputation of being crazy hard to implement correctly. It's very easy to convince yourself that you found the right solution, only to discover that your algorithm only works when the OS scheduler is on your side (which it generally is...until it isn't). This is another type of hard-to-reproduce bug. We can't coerce the OS scheduler to be evil when testing our software.&lt;/p&gt;
&lt;p&gt;Our last testing tool is the library &lt;code&gt;dscheck&lt;/code&gt;. It provides a way to &lt;em&gt;exhaustively&lt;/em&gt; test all the possible schedulings of a Multicore execution in order to discover the worst-case scenario that would lead to a crash. It does so by simulating parallelism on a single core using concurrency, thanks to algebraic effects and a custom scheduler. Dscheck is very fast because it doesn't test &lt;em&gt;all&lt;/em&gt; possible interleaving but only the ones that matters.&lt;/p&gt;
&lt;p&gt;In order to use it, you only need to replace the &lt;code&gt;Atomic&lt;/code&gt; module by a custom one, and then write your unit test. Here I simply copy-pasted the bug generated by &lt;code&gt;Lin&lt;/code&gt; earlier:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Atomic &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Dscheck&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;TracedAtomic
&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Test   &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Dscheck&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;TracedAtomic

&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Bank &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;(* same as before, but now using the traced Atomic *)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; test &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;init &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; Atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;make &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  Test&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;spawn &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; Bank&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;transfer t &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;(* fake a Domain.spawn *)&lt;/span&gt;
  Bank&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;transfer t &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;93&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Bank&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get t &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Test&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;trace test &lt;span class=&quot;token comment&quot;&gt;(* exhaustively test all interleaving *)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Dscheck will then run our &lt;code&gt;test&lt;/code&gt; function multiple times, discovering all the interesting paths that the scheduler could lead us down, and finally outputs a visualisation describing the worst-case scheduling that lead to crashes:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/72fbe0068c73cadf22e018262c394504/ad997/dscheck.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 107.6470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC2klEQVR42p1UPU9iQRTlj5hYqIVaiCSaAIaNbKGFdib2FhqjHYlxE2trjYXRwsIYNCbaWNioyaLgghb6QkAggohm+R59+ID3dTZz3beRFVbcIZOZ3DmcN+eeO9eEfwxd12ktFot4eHioiTUapkYHqqrSenBwAKfTCZvNRvu3Z/9FuLOzg7a2NrS2tsLtdlNMVmTov39NE74lTiQSuL6+/lBuU4R8xONxXF1dQapIyJfyEGURJa2EF/UFmq41R6hpr8BkMoleSy+Gvg7B7XFjMbCIZWEZK5EVrEZXwSqsxqx3hEZuDACXfHl5CZ/XB7EiIifnEPwZRIIlkJWyUHX185Kfnp7w+PhIe0VTsBnbhC/r+3OBhoT8a/lqHrlqDplyBimWQkEswP/DD4/HA0VVCPcsP0NSpcamGF/hwI34BtZia1gPr2MptIRD4RAOqwOOLw7c3NzU5PdDl7ljZa2MRDGBUCaEklpCVakiFotBEAQi4lPV1Hfu1iU0bhpgAeyn96HorxIzmQzu7+8///QMsBAUcPL9BGdnZ9je3sbp6SnOz8+xtbUFn88Hr9eLcDj8MaHx3Oa/zcNqtWJ0dBR2mx0ulwtzc3Mwm80YGRnB8PAwFhYWmn8pPE+yLNONRVGE3+9HIBCgPY8pitKwQdSVnEqlEAqFyAwu7+joiMqGS49Go+S20c6akjwzM4P29nYMDAygo6MDExMTmJqaQktLC7Uxi8WC2dnZ5iVzuZIkoVqtIpvNUskEg0Fyu1KpoFwu01ldQi7TqC+qMVV9VxoXFxck9+/0cOzb//KYicqvztQ0jdZkMqn39/frTqdTD4fDNWf1polfvVAokBzeAO7u7nB7e0vJj0QiNI+Pj6n9G4ZwsziGY7k56XSaODiXaW9vj7lcLjY9Pc3Gx8eZw+Fgdrud9fX1se7ubtbZ2cm6urpoNZvNFOvp6SHM4OAgGxsbY5OTk8Sxu7vLfgFaXzglmIj1rAAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/72fbe0068c73cadf22e018262c394504/c5bb3/dscheck.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;dscheck&quot; title=&quot;&quot; srcset=&quot;/static/72fbe0068c73cadf22e018262c394504/04472/dscheck.png 170w,
/static/72fbe0068c73cadf22e018262c394504/9f933/dscheck.png 340w,
/static/72fbe0068c73cadf22e018262c394504/c5bb3/dscheck.png 680w,
/static/72fbe0068c73cadf22e018262c394504/ad997/dscheck.png 1012w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This is a low-level view of the bug. By inspecting the sequence of &lt;code&gt;Atomic&lt;/code&gt; operations along the bad paths, we can discover the origin of the problem: the code is not careful when removing money from an account.&lt;/p&gt;
&lt;p&gt;Perhaps this would work better:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;rec&lt;/span&gt; transfer t from_account to_account money &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; money_from &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; get t from_account &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; money &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; from_account &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;gt;&lt;/span&gt; to_account
  &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; money_from &lt;span class=&quot;token operator&quot;&gt;&amp;gt;=&lt;/span&gt; money
  &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;begin&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; Atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;compare_and_set t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;from_account&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; money_from &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;money_from &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; money&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fetch_and_add t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;to_account&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; money &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; transfer t from_account to_account money &lt;span class=&quot;token comment&quot;&gt;(* retry *)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And yes, Dscheck now happily validates all possible interleaving of this unit test!&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ocaml-multicore/dscheck&quot;&gt;More examples on the &lt;code&gt;dscheck&lt;/code&gt; repository&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;So, does it mean our banking system works now? Nope! &lt;code&gt;Lin&lt;/code&gt; reports new counter examples that break sequential consistency. I told you that lock-free was hard! Still, we can keep iterating, and we will eventually get it right because our tools remove the doubt and the impossibility of reproducibility that would otherwise make the task insurmountable. It's like having tiny assistants to double-check our assumptions. I love it. I've never been so excited to test my software!&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;                           get t 3  : 100
                           get t 4  : 100
                                   |
                .------------------------------------.
                |                                    |
                |                             transfer t 4 3 10  : ()
           get t 4  : 90
           get t 3  : 100
                     ^^^^^
                how? account 4 sent the money, but account 3 didn't receive it!&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Would you have caught this bug? Can you fix it? ;)&lt;/p&gt;
&lt;p&gt;This was a tiny example, and it already brought some surprises. The multicore testing &lt;code&gt;Lin&lt;/code&gt;, &lt;code&gt;STM&lt;/code&gt;, and &lt;code&gt;dscheck&lt;/code&gt; have been applied to real datastructures with great success. In fact, I wouldn't trust lock-free algorithms that were not validated by them.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;It's 2022 and OCaml is finally Multicore. Even if this article is only scratching the surface of a specific itch, I hope it has convinced you that the Multicore metamorphose wasn't only about lifting a global lock somewhere in the runtime. A lot of care and attention also went into creating a great environment to tackle really hard problems. Here we've only looked at:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The memory model to be able to reason about our programs&lt;/li&gt;
&lt;li&gt;ThreadSanitizer to detect dangerous use of shared memory&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Lin&lt;/code&gt; and &lt;code&gt;STM&lt;/code&gt; to discover logical bugs in a multicore setting&lt;/li&gt;
&lt;li&gt;Dscheck to validate unit tests of lock-free algorithms by exhaustively checking all possible interleavings of their Atomic operations&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There's still a lot more to discover in the latest release of OCaml. In the meantime, not only can we do Multicore, we can do it with confidence that our code works!&lt;/p&gt;</content><id>https://tarides.com/blog/2022-12-22-ocaml-5-multicore-testing-tools</id><title type="text">OCaml 5 Multicore Testing Tools</title><updated>2022-12-22T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-12-21-advanced-merlin-features-destruct-and-construct" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Merlin is one of the most important tools for OCaml users, but a lot of its
advanced feature often remain unknown. For OCaml newcomers who might not know, Merlin is the server software that provides intelligence to code editors when working on OCaml documents. It allows one to easily navigate the code, get meaningful information (like type information), and perform code generation and refactoring tasks. Merlin installation and usage is documented on its &lt;a href=&quot;https://ocaml.github.io/merlin/&quot;&gt;official webpage&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Merlin is distributed with both an Emacs and a Vim plugin. It can also be used in Vscode via the OCaml LSP Server and the corresponding plugin.&lt;/p&gt;
&lt;p&gt;In this post, we will focus on two complementary features of Merlin: the venerable &lt;code&gt;destruct&lt;/code&gt; and the younger &lt;code&gt;construct&lt;/code&gt;. Both of these leverage OCaml's precise type information to destruct or create expressions.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#destruct&quot; aria-label=&quot;destruct permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Destruct&lt;/h2&gt;
&lt;p&gt;Destruct (sometimes called case-analysis) uses the type of an identifier to
perform multiple tasks related to pattern-matching. It can be called with the
following key bindings:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Emacs: &lt;kbd&gt;C-d&lt;/kbd&gt; or &lt;kbd&gt;M-x merlin-destruct&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Vim: &lt;kbd&gt;:MerlinDestruct&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;VSCode: &lt;kbd&gt;Alt-d&lt;/kbd&gt; or &lt;kbd&gt;&amp;#128161; Destruct&lt;/kbd&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Destruct's behavior changes slightly depending on the context around the cursor. We are going to describe how it behaves in the next three sections.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#automatic-case-analysis&quot; aria-label=&quot;automatic case analysis permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Automatic Case Analysis&lt;/h3&gt;
&lt;p&gt;The primary use case for Destruct is to generate a pattern-matching for a
given value. Let's consider the following snippet:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let f (x : int option) = x &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Calling &lt;code&gt;destruct&lt;/code&gt; on the right-most occurrence of &lt;code&gt;x&lt;/code&gt; will automatically generate the following pattern-matching with the two constructors of &lt;code&gt;x&lt;/code&gt;'s' option type:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let f (x : int option) = match x with
  | None -&amp;gt; _
  | Some _ -&amp;gt; _&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;What happened is that Merlin looked at the type of &lt;code&gt;x&lt;/code&gt; and generated a complete pattern-matching by enumerating its constructors.&lt;/p&gt;
&lt;p&gt;Notice that Merlin used underscores on the right-handsides of the matching. We call these underscores &lt;em&gt;typed holes&lt;/em&gt;. These holes are rejected by the compiler, but Merlin will provide type information for them. These holes should not be confused with the wildcard pattern appearing on the left handside &lt;code&gt;Some _&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;After calling &lt;code&gt;destruct&lt;/code&gt;, the cursor should have jumped to the first hole. In
Emacs (resp. Vim), you can navigate between holes by using the commands &lt;kbd&gt;M-x merlin-next-hole&lt;/kbd&gt; (resp. &lt;kbd&gt;:MerlinNextHole&lt;/kbd&gt;) and &lt;kbd&gt;M-x merlin-previous-hole&lt;/kbd&gt; (resp. &lt;kbd&gt;:MerlinPreviousHole&lt;/kbd&gt;). In VSCode, you can use &lt;kbd&gt;Alt-y&lt;/kbd&gt; to jump to the next typed hole.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#complete-a-matching&quot; aria-label=&quot;complete a matching permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Complete a Matching&lt;/h3&gt;
&lt;p&gt;Merlin can also add missing branches to an incomplete matching. Given
the following snippet:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let f (x : int option) = match x with
  | None -&amp;gt; _&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Calling &lt;code&gt;destruct&lt;/code&gt; with the cursor on &lt;code&gt;None&lt;/code&gt; will make the pattern-matching
exhaustive:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let f (x : int option) = match x with
  | None -&amp;gt; _
  | Some _ -&amp;gt; _&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#refine-the-cases&quot; aria-label=&quot;refine the cases permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Refine the Cases&lt;/h3&gt;
&lt;p&gt;Finally, Merlin can be used to make a pattern-matching more precise when called on a &lt;em&gt;wildcard&lt;/em&gt; pattern &lt;code&gt;_&lt;/code&gt;. Given the following snippet:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let f (x : int option opton) = match x with
  | None -&amp;gt; _
  | Some _ -&amp;gt; _&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Calling &lt;code&gt;destruct&lt;/code&gt; with the cursor on the &lt;code&gt;_&lt;/code&gt; pattern in &lt;code&gt;Some _&lt;/code&gt; will refine the matching:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let f (x : int option option) = match x with
  | None -&amp;gt; _
  | Some (None) | Some (Some _) -&amp;gt; _&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that Destruct also works with other types, like records. Let's consider the following snippet:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;type t = { a : string option }
let f (x : t) = x&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Calling &lt;code&gt;destruct&lt;/code&gt; on the last occurrence of &lt;code&gt;x&lt;/code&gt; will yield:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let f (x : t) = match x with 
  | { a } -&amp;gt; _&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And we can refine it by calling &lt;code&gt;destruct&lt;/code&gt; again on &lt;code&gt;a&lt;/code&gt;, etc.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let f (x : t) = match x with 
  | { a = None } | { a = Some _ } -&amp;gt; _&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That wraps our presentation for &lt;code&gt;destruct&lt;/code&gt;. Generating and completing pattern-
matching cases can be very useful when working with large sum types !&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#construct&quot; aria-label=&quot;construct permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Construct&lt;/h2&gt;
&lt;p&gt;Construct can be considered as the dual of Destruct, as they work
complementarily. When called over a typed-hole &lt;code&gt;_&lt;/code&gt;, Construct will suggest
values that can fill that hole. It can be called with the following key
bindings:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Emacs: &lt;kbd&gt;M-x merlin-construct&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Vim: &lt;kbd&gt;:MerlinConstruct&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;VSCode: &lt;kbd&gt;Alt-c&lt;/kbd&gt; of &lt;kbd&gt;&amp;#128161; Construct an expression&lt;/kbd&gt; (the cursor must be right after the &lt;code&gt;_&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For example, given the following snippet:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let x : int option = _&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Calling &lt;code&gt;construct&lt;/code&gt; with the cursor on the &lt;code&gt;_&lt;/code&gt; typed hole will suggest the following constructions:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Some _
None&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Choosing the first one will replace the hole and place the cursor on the next hole:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let x : int option = (Some _)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Calling &lt;code&gt;construct&lt;/code&gt; again will suggest &lt;code&gt;0&lt;/code&gt; and result in:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let x : int option = (Some 0)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In the future, Construct might also suggest fitting values from the local
environment instead of solely rely on a type's constructors.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#destruct-and-construct&quot; aria-label=&quot;destruct and construct permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Destruct and Construct&lt;/h2&gt;
&lt;p&gt;As stated previously calls to &lt;code&gt;destruct&lt;/code&gt; and &lt;code&gt;construct&lt;/code&gt; can be used in
collaboration. For example, after calling &lt;code&gt;destruct&lt;/code&gt; on &lt;code&gt;x&lt;/code&gt; in the following code snippet:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;type t = { a : unit; b : string option }
let f (x : int option) : t option = x&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;x&lt;/code&gt; is replaced by a matching on &lt;code&gt;x&lt;/code&gt; with the cursor on the first hole:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let f (x : int option) : t option = 
    match w with
    | None -&amp;gt; _
    | Some _ -&amp;gt; _&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;One can immediately call &lt;code&gt;construct&lt;/code&gt; and choose a construction for the first branch:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let f (x : int option) : t option = 
    match w with
    | None -&amp;gt; None
    | Some _ -&amp;gt; _&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And again for the second branch:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let f (x : int option) : t option = 
    match w with
    | None -&amp;gt; None
    | Some _ -&amp;gt; Some _&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Finally, like Destruct, Construct also works with records and most OCaml types:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Some _ &amp;rarr; Some { a = _; b = _ } &amp;rarr; Some { a = (); b = None }&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;When put to good use, these complementary features can remove some of the burden of working with big variant types. We encourage you to try them and see if they help your everyday workflow! If you encounter any issues or have ideas for improvement, please communicate them to us &lt;a href=&quot;https://github.com/ocaml/merlin/issues&quot;&gt;via the issue tracker&lt;/a&gt;.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-12-21-advanced-merlin-features-destruct-and-construct</id><title type="text">Advanced Merlin Features: Destruct and Construct</title><updated>2022-12-21T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-12-20-how-nomadic-labs-used-multicore-processing-to-create-a-faster-blockchain" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;The technology that makes blockchain possible is complex, cutting-edge, and fascinating. Balancing efficiency and security on a knife's edge, it finds perfect harmony between high transaction speeds and safe, predictable results. Blockchain technology is constantly evolving, pushing the boundaries of what&amp;rsquo;s possible, and driving innovation and research. Discover how Tarides helped Nomadic Labs use &lt;a href=&quot;https://speakerdeck.com/kayceesrk/retrofitting-concurrency-lessons-from-the-engine-room&quot;&gt;OCaml 5&lt;/a&gt; to boost blockchain performance with rollup technology.&lt;/p&gt;
&lt;p&gt;In order to remain competitive with other major players in the blockchain market (including Bitcoin and Ethereum), the open-source blockchain Tezos invests in cutting-edge research and engineering. Another way Tezos has chosen to differentiate itself in a crowded market is by focusing on sustainability and scalable efficiency. Tezos is proof-of-stake (rather than proof-of-work) and is therefore more &lt;a href=&quot;https://tezos.com/carbon/&quot;&gt;energy efficient&lt;/a&gt; than other blockchain technologies, with the annual energy consumption estimated at 0.001TWh, or &amp;ldquo;17 global citizens.&amp;rdquo; Furthermore, the &lt;a href=&quot;https://4c.cst.cam.ac.uk&quot;&gt;Cambridge Centre for Carbon Credits (4C)&lt;/a&gt; is using the Tezos blockchain to create a trusted decentralised marketplace for carbon credits. The sheer amount of data needed to support verifiable carbon credits requires planetary-scale computations, coupled with the digital permanence needed to track projects over decades and even generations.&lt;/p&gt;
&lt;p&gt;A growing number of users and companies are bringing their projects to the Tezos blockchain. To respond to increasing demand, the network is preparing for more activity and high-throughput applications. To that end, Nomadic Labs is working on implementing leading-edge rollup technology for the Tezos blockchain. Rollups are a way of increasing throughput and blockchain speeds without compromising on decentralisation, latency,  stability, security, or its resistance to censorship.&lt;/p&gt;
&lt;p&gt;To achieve their goal of offering a major scaling solution for Tezos, Nomadic Labs called in Tarides. By leveraging the multicore capabilities of OCaml 5, the team was able to achieve significant performance boosts, making it a viable solution for increasing both blockchain speeds and transactions per second (TPS).&lt;/p&gt;
&lt;p&gt;Marco Stronati co-leads the &lt;a href=&quot;https://research-development.nomadic-labs.com/files/cryptography.html&quot;&gt;cryptography team&lt;/a&gt; at Nomadic Labs with cryptographer Marc Beunardeau. Looking back on the decision to use an early version of OCaml 5, Marco said, &amp;ldquo;We knew OCaml 5 was not ready yet, but that backward compatibility was an explicit goal of the project, so we thought we would put that to the test.&amp;rdquo;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#who-are-nomadic-labs&quot; aria-label=&quot;who are nomadic labs permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Who Are Nomadic Labs?&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.nomadic-labs.com&quot;&gt;Nomadic Labs&lt;/a&gt; is one of the largest research and development centres within the open-source &lt;a href=&quot;https://tezos.com&quot;&gt;Tezos ecosystem.&lt;/a&gt; They work on the Tezos core technologies that run its distributive network as one of the largest research and development centres within the Tezos ecosystem.&lt;/p&gt;
&lt;p&gt;Nomadic Labs handles software releases and amendments to the Tezos blockchain, focusing on the innovation, development, and implementation of new features. They help companies and institutions use Tezos to their advantage. At its core, the company values dependability, balancing cutting-edge innovation with reliable and consistent results.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#what-is-a-rollup-and-how-does-it-boost-the-speed-of-the-blockchain&quot; aria-label=&quot;what is a rollup and how does it boost the speed of the blockchain permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What Is a Rollup and How Does it Boost the Speed of the Blockchain?&lt;/h2&gt;
&lt;p&gt;Rollups settle transactions outside the network and then post data back into it. This is what&amp;rsquo;s called a &lt;a href=&quot;https://research-development.nomadic-labs.com/tezos-is-scaling.html&quot;&gt;Layer 2 solution&lt;/a&gt;, which avoids the main chain. By handling the process externally, they reduce the strain on the network. Rollups help blockchains like Tezos keep transaction speeds and throughput high without compromising the integrity of the blockchain. It is one of the many different scalability solutions a blockchain may employ to offer top-level performance. There are two main types of rollups: optimistic and zero-knowledge (zk).&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://research-development.nomadic-labs.com/next-generation-rollups.html&quot;&gt;Optimistic rollups&lt;/a&gt; assume that the transaction data they&amp;rsquo;re processing is correct, and any fraud or other problem with the transaction is handled separately. Zk-rollups on the other hand use zero-knowledge proofs to validate a transaction. Zk-rollups provide better security and confidentiality than optimistic rollups, but they come with their own sets of limitations.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#pushing-the-limits-of-zero-knowledge-proving-systems&quot; aria-label=&quot;pushing the limits of zero knowledge proving systems permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Pushing the Limits of Zero-Knowledge Proving Systems&lt;/h2&gt;
&lt;p&gt;The challenge Nomadic Labs faced was related to their proving system. In general, proving systems have to be very asymmetrical, with a prover doing most of the work off-chain and a lean verifier working on-chain. Whilst these rollup systems are great for blockchains, because of how quickly they can verify something, the proving stage is very CPU- and memory-intensive. This prevents the scalability of Epoxy, their zk-rollup solution, since its throughput and latency are directly limited by the speed of the prover.
Most of the innovation in the field of zero-knowledge proving systems today is driven by lowering the complexity of the provers, thanks to novel cryptography but also to highly optimised implementations.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#ocaml-5-multicore-saves-the-day&quot; aria-label=&quot;ocaml 5 multicore saves the day permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;OCaml 5 Multicore Saves the Day&lt;/h1&gt;
&lt;p&gt;The team&amp;rsquo;s solution to the prover&amp;rsquo;s inefficiencies was to use the &lt;a href=&quot;https://gitlab.com/nomadic-labs/cryptography/privacy-team/&quot;&gt;aPlonK&lt;/a&gt; proving system to power Epoxy. It enables the efficient aggregation of multiple proofs that can be executed in parallel. This is where OCaml 5 comes in! With its Multicore capabilities and strong safety features, it is the perfect candidate for speeding up the proving process.&lt;/p&gt;
&lt;p&gt;With OCaml 5, the team could parallelise the proving process by utilising multiple cores on one machine. According to Marco, &amp;ldquo;OCaml 5 drastically improved performance with minimal effort.&amp;rdquo;  Increased performance of the zk-rollup translates to high TPS and throughput for customers using digital currencies. Striving to be the fastest blockchain means constantly looking at opportunities to improve performance, from changing algorithms to workflows.&lt;/p&gt;
&lt;p&gt;Furthermore, speaking as a seasoned developer, Marco emphasises the importance of OCaml 5 being easy to install and set up.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-most-important-thing-was-not-having-to-revolutionise-what-i-do-people-dont-want-to-waste-a-week-on-upgrading-and-this-was-a-seamless-experience&quot; aria-label=&quot;the most important thing was not having to revolutionise what i do people dont want to waste a week on upgrading and this was a seamless experience permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&amp;ldquo;The most important thing was not having to revolutionise what I do. People don&amp;rsquo;t want to waste a week on upgrading, and this was a seamless experience.&amp;rdquo;&lt;/h3&gt;
&lt;p&gt;Installing OCaml 5 proved to be easy for the team, and in the matter of a few hours, they were running Multicore on their machines. For people who don&amp;rsquo;t need Multicore, the upgrade is completely backwards compatible, and their sequential code will still work normally. It&amp;rsquo;s due to the precise balance OCaml 5 strikes between backwards compatibility and cutting-edge upgrades that Marco thinks there is literally &amp;ldquo;No reason not to upgrade.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;When using OCaml 5 before its official launch, the team faced some small compatibility issues they needed help with. They checked the state of compatibility on the helpful &lt;a href=&quot;http://check.ocamllabs.io/&quot;&gt;health check&lt;/a&gt; website, where more and more packages were &amp;lsquo;going green&amp;rsquo; daily. Even before they could file a bug report, they would find that their problem had been resolved. Since set up was so smooth, the team needed very little help. Still, Marco commented that: &amp;ldquo;The moment we had a problem, we would get help immediately.&amp;rdquo;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#what-does-the-future-hold&quot; aria-label=&quot;what does the future hold permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What Does the Future Hold?&lt;/h2&gt;
&lt;p&gt;The team is excited to continue using OCaml 5 in the future, as soon as Tezos begins using it in production after the full release. At the moment, the team has to parallelise using several machines to speed up the prover&amp;rsquo;s performance. With OCaml 5, they will be able to exploit multiple cores on several computers at the same time.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#we-can-easily-double-the-speed-of-what-were-doing-with-ocaml-5&quot; aria-label=&quot;we can easily double the speed of what were doing with ocaml 5 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&amp;ldquo;We can easily double the speed of what we&amp;rsquo;re doing with OCaml 5.&amp;rdquo;&lt;/h3&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;After successful experimentation with a prerelease of OCaml 5, the team at Nomadic Labs discovered that it gives their zk-rollup a significant performance boost. For the Tezos blockchain, this boost can result in higher TPS and throughput for customers who use their digital currency. Combined with Tezos&amp;rsquo;s other benefits, such as its energy efficiency (thanks to its proof-of-stake consensus mechanism), OCaml 5 definitively gives it a leg up with fast zk-rollups.&lt;/p&gt;
&lt;p&gt;The technologies that make blockchains a reality are undeniably a driving force behind great innovation. Zk-rollups are just one example of technologies that aim to make complex processes like verifiers and provers lightning fast. Performance is vital in almost every field, and the use cases for this type of technology are endless.&lt;/p&gt;
&lt;p&gt;Tarides offers its extensive expertise in OCaml to help businesses achieve their targets. Find out more about how OCaml 5 can help you transform &lt;a href=&quot;https://tarides.com/company&quot;&gt;your business&lt;/a&gt;!&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#sources&quot; aria-label=&quot;sources permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Sources&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://research-development.nomadic-labs.com/kathmandu-is-live.html&quot;&gt;Kathmandu Blog on Nomadic Labs&lt;/a&gt;
&lt;a href=&quot;https://research-development.nomadic-labs.com/next-generation-rollups.html&quot;&gt;Next Generation Rollups&lt;/a&gt;
&lt;a href=&quot;https://www.quicknode.com/guides/infrastructure/introduction-to-ethereum-rollups&quot;&gt;Ethereum Rollups&lt;/a&gt;
&lt;a href=&quot;https://research-development.nomadic-labs.com/smart-rollups-are-coming.html&quot;&gt;Smart Rollups&lt;/a&gt;&lt;/p&gt;</content><id>https://tarides.com/blog/2022-12-20-how-nomadic-labs-used-multicore-processing-to-create-a-faster-blockchain</id><title type="text">How Nomadic Labs Used Multicore Processing to Create a Faster Blockchain</title><updated>2022-12-20T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-12-19-ocaml-5-with-multicore-support-is-here" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;It's here! It's finally here! On Friday, 16 December 2022, the OCaml community &lt;a href=&quot;https://discuss.ocaml.org/t/ocaml-5-0-0-is-out/10974/7&quot;&gt;announced the official release of Multicore OCaml&lt;/a&gt;! From the beginning, Tarides has been deeply involved in OCaml's evolution, so we're very proud to present OCaml 5!&lt;/p&gt;
&lt;p&gt;Our work with the myriad of academics, industrial developers, and the entire OCaml community has been both inspiring and fulfilling. We look forward to continuing our collaboration for future iterations of OCaml. Watch &lt;a href=&quot;https://www.youtube.com/watch?v=zJ4G0TKwzVc&quot;&gt;KC's keynote&lt;/a&gt; to get a visual overview of all OCaml 5 has to offer!&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#about-ocaml-5&quot; aria-label=&quot;about ocaml 5 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;About OCaml 5&lt;/h2&gt;
&lt;p&gt;OCaml is a pragmatic functional programming language. Its strength lies in the capacity to balance security, performance, and reliability. OCaml is used in both industry and academia to address problems in which a single mistake could be catastrophic, &lt;a href=&quot;https://ocaml.org/success-stories/large-scale-trading-system&quot;&gt;such as in finance&lt;/a&gt; and &lt;a href=&quot;https://ocaml.org/success-stories/sensor-analytics-and-automation-platform-for-sustainable-agriculture&quot;&gt;sensor analytics&lt;/a&gt; for sustainable agriculture. It's also used by millions of developers daily with &lt;a href=&quot;https://www.docker.com/blog/how-docker-desktop-networking-works-under-the-hood/&quot;&gt;Docker for Desktop&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;OCaml 5 brings the long-awaited runtime support for shared memory &lt;a href=&quot;https://v2.ocaml.org/releases/5.0/manual/parallelism.html&quot;&gt;parallelism&lt;/a&gt; and &lt;a href=&quot;https://v2.ocaml.org/releases/5.0/manual/effects.html&quot;&gt;effect handlers&lt;/a&gt;. It is a major change (including the full rewrite of a new, concurrent garbage collector), but we worked hard to ensure there would be no breakage for existing OCaml users. This release combines the security and safety of OCaml with new features that bring huge performance benefits and an improved methodology for writing concurrent code.&lt;/p&gt;
&lt;p&gt;OCaml 5 supports both the the x86-64 and ARM64 architectures, so Linux, the BSDs, macOS, and Mingw-w64 on Windows are all supported. Over the next year, the OCaml community and Tarides will restore support for most previously-supported architectures that fall outside of this range, but this doesn't mean you can't use OCaml now! OCaml 5 seeks to be completely backwards-compatible, and programs written for any version of OCaml 4 will continue to work in OCaml 5.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#multicore&quot; aria-label=&quot;multicore permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Multicore&lt;/h2&gt;
&lt;p&gt;With technological advances and the explosive growth of machines with more and more available cores, it's necessary for programming languages to support multicore technology. Until this new release, OCaml was single-threaded, meaning it could only utilise one core to run code. With OCaml 5, programs can now exploit multiple cores and execute processes in parallel, providing users with enhanced performance and efficiency.&lt;/p&gt;
&lt;p&gt;Performance is key with OCaml 5 to ensure your programs run smoother, faster, and more efficient, a significant achievement in turning cutting-edge science into real-life applications and industrial-strength tools.&lt;/p&gt;
&lt;p&gt;Multicore OCaml has been in the making for 8 years and required a full rewrite of it runtime environment, so you can believe that the OCaml community is absolutely thrilled to see this come to fruition from their years of hard work. Multicore support ensures beginners can achieve the same productivity as OCaml experts!&lt;/p&gt;
&lt;p&gt;If you come across any unexpected behaviours that aren't covered by the few exceptions listed on the &lt;a href=&quot;https://discuss.ocaml.org/t/ocaml-5-0-0-is-out/10974&quot;&gt;Discuss post&lt;/a&gt;, please report them on the &lt;a href=&quot;https://github.com/ocaml/ocaml/issues&quot;&gt;OCaml issue tracker&lt;/a&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#eio--concurrency&quot; aria-label=&quot;eio  concurrency permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Eio &amp;amp; Concurrency&lt;/h2&gt;
&lt;p&gt;Concurrency in OCaml 5 is supported through the use of effect handlers, a new feature that enables the development of concurrent applications in a seamless fashion. The developer experience is improved, now that programmers can simply write concurrent code in the same style as non-concurrent code.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ocaml-multicore/eio&quot;&gt;Eio&lt;/a&gt;, our experimental, high-performant I/O library, is an excellent example of use for effect handlers. Since we've already demonstrated that we can reach millions of requests per second while keeping simple, direct-style code, OCaml 5 is meant to be on par with Rust (and outperforms Go) for I/O heavy workloads.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 578px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/ce6f7c661802b2b8eda379f465a7cb87/508ef/eio1.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 67.64705882352942%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABuklEQVR42n2Ui5KbMAxF8/+fuM02TZoHBPAbv7B9O3KAZJshmtFghDmSrxC7lBKstTDOw1V3cN7XWF1vuJ2vwTsIZTBNE8h2FOz7HudLi6ZtcTwecTqdEEJAznnTUQpSzuB2wp+7QAj+AZRSQggOPnzjdrvg6+tXBcYY8clszBi0hTcCEz/XAipQCAFtNHrLYUYDxhgothyhWikPBxBTxiA1FOuQxwFIDjGGJ3AYBmitUeYX3u0RT7lASAneNZg0A1LA8gYlX4Fd10Frg1zyXEyZ4WWFOdGgby+wigF5WtOU+TnJ8+PI4zj+qLBCaZETYDmy5ig5b+r5VqExZgWu4Mkj6RbeK1ztHdxxcCcgvYB4cRkkbur2oiFjFZjnCmKKUOIMzg4VoqNBSB6ppKfn2UuqUllvn0A2A6tW0eIvO2CQF2SUD436cGTqsFISygm0poGN44uO5V2K/9ZLU7yfgUTnkuH39RvBBdjRQipZM1KzaDMlpSuNI8VpupRS9Z6e0Qm9nydlyUYbKLhspmbt93vcuw6HwwFN09SxvF6voG+XktF/gCaN9F84uy1d1p+AtTURAWi9VLll/wDCwETBRKk40wAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/ce6f7c661802b2b8eda379f465a7cb87/508ef/eio1.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Eio Performance&quot; title=&quot;&quot; srcset=&quot;/static/ce6f7c661802b2b8eda379f465a7cb87/04472/eio1.png 170w,
/static/ce6f7c661802b2b8eda379f465a7cb87/9f933/eio1.png 340w,
/static/ce6f7c661802b2b8eda379f465a7cb87/508ef/eio1.png 578w&quot; sizes=&quot;(max-width: 578px) 100vw, 578px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 572px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/cd13a47efa1219429ec495747f257b73/a805e/eio2.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 67.64705882352942%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB5ElEQVR42nWT227jIBRF+//fNy/VzKitYseO4xvG3DGrgriJ085s64iLxWKfA7wYY/geWuvSWmtw1iCVYZaKWa7My1pacYhBSLz3ZL0sy4KUkpQS27aVyH0fItI4Jh14b3uuQjFrz6Q8U2kds7LMq6XqF5TWN2DXdcVNVgZlnSdNJwyrT3hrSNMJ9AB2hqAgGkgbX4ox3hlPwKwQN67SUdBWgB7zTmWzlCLJKZKVJD2R1h6MIKzTA9i27RMwp2SsBdWXhbt1fmqfC4a4Dg9gXdf3gY8b/ephriA7OZThwdnd7t+PlK/XK3ofVLNDjB34lSPGb56wBbZD3Y56AjZtW65JVtvUpHUkpA0bDMIKhF2olope9/v4FvNX3wlGNR6ATVPum3aBpW/wm6OWZ0YzFmc5jspOXfS4LdydSyvRZr82l8sF6z3zOFL3fxnsRPqWWuK5ZotUXLqJ7nKhqira5pHlyzAMTPPMn/dfSC/5n8rh7AekZI+YPnh7e+f19ZWqrh5AuUiatuKj+Y13EbnK8nKMNiilSt85V2KREq00vRj4uNac63NxeDqdEIu4AfMbzPS4xTJhrS2QrPwMc42ncUIIwTD0hBDKv3Vd767KZstyAz6l9A9ZYxCzKAtiDM81TY/40ifCNEKKStf+WgAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/cd13a47efa1219429ec495747f257b73/a805e/eio2.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Eio Performance&quot; title=&quot;&quot; srcset=&quot;/static/cd13a47efa1219429ec495747f257b73/04472/eio2.png 170w,
/static/cd13a47efa1219429ec495747f257b73/9f933/eio2.png 340w,
/static/cd13a47efa1219429ec495747f257b73/a805e/eio2.png 572w&quot; sizes=&quot;(max-width: 572px) 100vw, 572px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;With Eio, asynchronous and synchronous code can be composed together naturally, solving the &lt;a href=&quot;https://www.tedinski.com/2018/11/13/function-coloring.html&quot;&gt;function colouring problem&lt;/a&gt; that affects many languages, including programs written in earlier versions of OCaml. This makes OCaml easier to use, even if you're new to the language.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#runtime-events&quot; aria-label=&quot;runtime events permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Runtime Events&lt;/h2&gt;
&lt;p&gt;Another huge improvement with OCaml 5 is Runtime Events, a library included with OCaml 5's runtime, which efficiently processes performance data from the garbage collector (GC) and runtime. Runtime Events provides continuous monitoring of OCaml applications. Multicore programs are notoriously hard to debug and profile, so we ensured that OCaml 5 has a built-in mechanism to build great, relevant tooling. The basis of this is Runtime Events.&lt;/p&gt;
&lt;p&gt;Read more about Runtime Events in the &lt;a href=&quot;https://v2.ocaml.org/releases/5.0/htmlman/runtime-tracing.html&quot;&gt;OCaml Manual&lt;/a&gt;, and watch the &lt;a href=&quot;https://watch.ocaml.org/videos/watch/299cab02-db94-44ac-b926-ea90ddda1b09&quot;&gt;OCaml Workshop&lt;/a&gt; for a visual introduction to Runtime Events. Also check out these WIP tools: &lt;a href=&quot;https://github.com/sadiqj/runtime_events_tools&quot;&gt;olly&lt;/a&gt; and &lt;a href=&quot;https://github.com/patricoferris/meio&quot;&gt;meio&lt;/a&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#open-source-and-open-arms&quot; aria-label=&quot;open source and open arms permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Open Source and Open Arms&lt;/h2&gt;
&lt;p&gt;OCaml 5 is freely available to everyone worldwide. For installation instructions, compiler configurations, and a detailed list of changes and new features, please visit &lt;a href=&quot;https://discuss.ocaml.org/t/ocaml-5-0-0-is-out/10974&quot;&gt;this OCaml Discuss post&lt;/a&gt;. While you're there, join in the conversation! We welcome you to the OCaml community with open arms! There has never been a better time to learn and use OCaml. Give it a try, and please report any problems to the &lt;a href=&quot;https://github.com/ocaml/ocaml/issues&quot;&gt;OCaml issue tracker&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Read more about the journey to Multicore, Runtime Events, Eio, and more over the next six weeks in our OCaml 5 blog series. It will include several articles highlighting OCaml 5's new features, interviews with OCaml engineers, and reasons why OCaml should be the next language you learn. Follow us on &lt;a href=&quot;https://twitter.com/tarides_&quot;&gt;Twitter&lt;/a&gt; and &lt;a href=&quot;https://www.linkedin.com/company/tarides&quot;&gt;LinkedIn&lt;/a&gt; so you don't miss a thing!&lt;/p&gt;
&lt;p&gt;This OCaml 5 release is the best holiday gift for developers, both experienced and those new to programming. &lt;a href=&quot;https://tarides.com/blog/2022-11-24-solve-the-2022-advent-of-code-puzzles-with-ocaml&quot;&gt;Enjoy!&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Tarides is always happy to discuss commercial opportunities around OCaml. Especially with the OCaml 5 release, there are many areas where we can help industrial users to adopt OCaml 5 more quickly, including training, support, custom developments, etc. Please &lt;a href=&quot;https://tarides.com/company/&quot;&gt;contact us&lt;/a&gt; if you are interested in discussing your needs.&lt;/p&gt;
&lt;/blockquote&gt;</content><id>https://tarides.com/blog/2022-12-19-ocaml-5-with-multicore-support-is-here</id><title type="text">OCaml 5 With Multicore Support Is Here!</title><updated>2022-12-19T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-12-14-hillingar-mirageos-unikernels-on-nixos" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">

&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 512px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/ba47ed1e2b7a5e9dc869229c7e9e073f/01e7c/hillingar.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE7UlEQVR42h3QS1MaCxqH8f4Ws5maxWxmMbOZmqlKlcGcibecqIkJaozXCAioiApCAigoAkFQg8qloRtomqa5ysWTc6lZzKXmiz1TsPjVf/fUW6/wcCdxfVPgIponHBOJxkTi8Tz3KZlUqshdqjja7INMOSdTFmWyGZlYUub6Wwkpr3BzX+FbukKxoCBEr2SGviZkYoki8USR5HWJbFpBzFQQMypyvoJSKKGIJVRJ4SGtEE6UuUqplIo69WqdlqbTquoIyZsSqVQJMV1GzCijUD5bQcpWkMUKkqiSz6k8pPKkv+WQRYVMVuUurSFJOg2tSa/RpF1roikNBDGrIuVUynmVcqFKuaBRyqvkMwq5dIVsZkjl3HNKwLpPKnpLoaAjFzSU0XVNWlqTmtpELTcQFKmGWqxRlTUqRR1F1pHzKreJLA8PCqJY4+4mQ/DwgNODfa7Oo0hSnXJRp6q00KttdK1DVe2gKG2EslynUqxTLdWpluuoJZ2SpBG7vOEyGCWf1/gWiRDafsOlfYWEZ2/0t2FArT6iVnuoWo+q1qOidhEKYo1CroaUryGJGgVRI5ep4LId8NliInEZJ+o95uJol5DrkHjASyYtU9UGo5hW61PTB9T0PrVaH0GSGshSg2KxSanYGBEzJXxON+duL1fnEU53bZyb3hKzGwmb35IKX6A3nmjUe7Sb/ZFmvU+r0UdQlA4VpUO1MtSmpj4SDydwftrGYzETOnYTdbuIOrYJOcxkQy4KsRANrcNja8Bje0C7ORhFO40eglbtMlQbUjs09R7xYAzX5ha+HQtRzwnp6Pnoj/aNbe6uEqRicaScwlPvO4NOn8Hj00i/PUBo13t06j0eG126jS66UuM28pXIFx8uq41Lrxf/vp3wgZkvW0YurEtE3C7qaoN+u8/3wS90Wz2atdYoKvzU7vK902W07Q6DRouox01g8y2u9UV8O2YOV1cIWLfw79q4D3q5D0f456DPb70ehdtbMokkT60Ov3a7CP8a9Bj699NwH/le1xGTN0SOHPj2HUROvMR9AW7DEU6PTkgnkkQ/+4l4fXjMVjJX1/zn5z7/+7XPf3/uIkgFjbKsU8jXkCUdMacSDl2x/maJDzPzLE/N82Z8CuMPk0z+5a+8+NOfefaHPzL2u9/j2XVR1vqUyi3KShu12kHYPY7gcEWxOkJYds/YOwpz6Dxj+uUCk4ZZpl7MMWX4kZnn08yOzzBrmGF55h3WdRtHnijbe6esWr6waguwsRtE2PUmsZ1cYT2O4NrZ5NBuZ3sYPzjDdhxmzxvH+SWJ6/QWz9ktbv81gYt7Pgdv+Oz/ylkoictzwYEriNMdQlgx+Vm3BdlyXLKxaWV9y8r6fohVq4+lTTdvPziZMzpY2vTyzhRg0XKK0eRn0exnw37Glj2A0x3G54ty6gsj/G3sPX8fM/JsfAnD1AaGmU3GXq7w7MUyY/9YYXxijecT67yctzH98YSpjye8XvPw6qObicUDPmx7sNj9mHc8rK45EQxzJsZnP2GY3cLwehPD7Ceev97ih7ltphaszC7vs7zlZm3Hh9HkY2LZhWHhgAnjIYubbnb2AixtnDC/csgrowNhftnO60UrU+/MTL4zM23cYdpoYfK9hckFM1MLJn58b8W45mTDdMKLOTuvFg+w7PlZ3Xbz6v0uK59cOI6COI+D/B+si/MrWRg7jwAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/ba47ed1e2b7a5e9dc869229c7e9e073f/01e7c/hillingar.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;hillingar&quot; title=&quot;&quot; srcset=&quot;/static/ba47ed1e2b7a5e9dc869229c7e9e073f/04472/hillingar.png 170w,
/static/ba47ed1e2b7a5e9dc869229c7e9e073f/9f933/hillingar.png 340w,
/static/ba47ed1e2b7a5e9dc869229c7e9e073f/01e7c/hillingar.png 512w&quot; sizes=&quot;(max-width: 512px) 100vw, 512px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;NixOS allows reproducible deployments of systems by managing configuration declaratively.
MirageOS is a unikernel creation framework that creates targeted operating systems for high-level applications that can run on a hypervisor.
By building MirageOS unikernels with Nix, we can enable reproducible builds of these unikernels and enable easy deployment on NixOS systems.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#introduction&quot; aria-label=&quot;introduction permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Introduction&lt;/h2&gt;
&lt;p&gt;The Domain Name System (DNS) is a critical component of the modern Internet, allowing domain names to be mapped to IP addresses, mailservers, and more.
This allows users to access services independent of their location in the Internet using human-readable names.
We can host a DNS server ourselves to have authoritative control over our domain, protect the privacy of those using our server, increase reliability by not relying on a third party DNS provider, and allow greater customisation of the records served.
However, it can be quite challenging to deploy one's own server reliably and reproducibly.
The Nix deployment system aims to address this.
With a NixOS machine, deploying a DNS server is as simple as:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nix&quot;&gt;&lt;pre class=&quot;language-nix&quot;&gt;&lt;code class=&quot;language-nix&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bind &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    enable &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    zones&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;freumh.org&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      master &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      file &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;freumh.org.zone&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Which we can then query with:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;dig&lt;/span&gt; freumh.org @ns1.freumh.org +short
&lt;span class=&quot;token number&quot;&gt;135.181&lt;/span&gt;.100.27&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To enable the user to query our domain without specifying the nameserver, we have to create a glue record with our registrar pointing &lt;code&gt;ns1.freumh.org&lt;/code&gt; to the IP address of our DNS-hosting machine.&lt;/p&gt;
&lt;p&gt;You might notice this configuration is running the venerable bind&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;, which is written in C.
As an alternative, using functional, high-level, type-safe programming languages to create network applications can greatly benefit safety and usability whilst maintaining performant execution.
One such language is OCaml.&lt;/p&gt;
&lt;p&gt;MirageOS&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-2&quot; class=&quot;footnote-ref&quot;&gt;2&lt;/a&gt;&lt;/sup&gt; is a deployment method for these OCaml programs.
Instead of running them as a traditional Unix process, we instead create a specialised 'unikernel' operating system to run the application.
They offer reduced image sizes through dead code elimination, as well as improved security and efficiency.&lt;/p&gt;
&lt;p&gt;However, to deploy a Mirage unikernel with NixOS, one must use the imperative deployment methodologies native to the OCaml ecosystem, thus eliminating the benefit of reproducible systems that Nix offers.
This blog post will explore how we enabled reproducible deployments of Mirage unikernels by building them with Nix.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#mirageos&quot; aria-label=&quot;mirageos permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;MirageOS&lt;/h2&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
  &lt;img src=&quot;https://tarides.com/mirage-logo.svg&quot; style=&quot;height: 300px; max-width: 100%&quot;/&gt;
&lt;/div&gt;
&lt;p&gt;&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-3&quot; class=&quot;footnote-ref&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;MirageOS is a library operating system that allows users to create unikernels, which are specialised operating systems that include both low-level operating system code and high-level application code in a single kernel and a single address space.
It was the first such 'unikernel creation framework', but comes from a long lineage of OS research, such as the exokernel library OS architecture.
Embedding application code in the kernel allows for dead-code elimination, removing OS interfaces that are unused, which reduces the unikernel's attack surface and offers improved efficiency.&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
  &lt;img src=&quot;https://tarides.com/mirage-diagram.svg&quot; style=&quot;height: 300px; max-width: 100%&quot;/&gt;
&lt;/div&gt;
&lt;p&gt;Contrasting software layers in existing VM appliances vs. unikernel's standalone kernel compilation approach &lt;a href=&quot;https://tarides.com/feed.xml#madhavapeddyUnikernelsLibraryOperating2013&quot;&gt;[3]&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Mirage unikernels are written OCaml&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-4&quot; class=&quot;footnote-ref&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;.
OCaml is more practical for systems programming than other functional programming languages, such as Haskell.
It supports falling back on impure imperative code or mutable variables when warranted.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#nix&quot; aria-label=&quot;nix permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Nix&lt;/h2&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
  &lt;img src=&quot;https://tarides.com/nix-snowflake.svg&quot; style=&quot;height: 300px; max-width: 100%&quot;/&gt;
&lt;/div&gt;
&lt;p&gt;Nix snowflake&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-5&quot; class=&quot;footnote-ref&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;Nix is a deployment system that uses cryptographic hashes to compute unique paths for components&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-6&quot; class=&quot;footnote-ref&quot;&gt;6&lt;/a&gt;&lt;/sup&gt; that are stored in a read-only directory: the Nix store, at &lt;code&gt;/nix/store/&amp;lt;hash&amp;gt;-&amp;lt;name&amp;gt;&lt;/code&gt;.
This provides several benefits, including concurrent installation of multiple versions of a package, atomic upgrades, and multiple user environments.&lt;/p&gt;
&lt;p&gt;Nix uses a declarative domain-specific language (DSL), also called Nix, to build and configure software.
The snippet used to deploy the DNS server is in fact a Nix expression.
This example doesn't demonstrate it, but Nix is Turing complete.
Nix does not, however, have a type system.&lt;/p&gt;
&lt;p&gt;We used the DSL to write derivations for software that describe how to build said software with input components and a build script.
This Nix expression is then 'instantiated' to create 'store derivations' (&lt;code&gt;.drv&lt;/code&gt; files), which is the low-level representation of how to build a single component.
This store derivation is 'realised' into a built artefact, hereafter referred to as 'building.'&lt;/p&gt;
&lt;p&gt;Possibly the simplest Nix derivation uses &lt;code&gt;bash&lt;/code&gt; to create a single file containing &lt;code&gt;Hello, World!&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nix&quot;&gt;&lt;pre class=&quot;language-nix&quot;&gt;&lt;code class=&quot;language-nix&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; pkgs &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;nixpkgs&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;builtins&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;derivation&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;hello&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  system &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;builtins&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentSystem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  builder &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token antiquotation important&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;nixpkgs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bash&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;/bin/bash&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  args &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;-c&amp;quot;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;''echo &amp;quot;Hello, World!&amp;quot; &amp;gt; $out''&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that &lt;code&gt;derivation&lt;/code&gt; is a function that we're calling with one argument, which is a set of attributes.&lt;/p&gt;
&lt;p&gt;We can instantiate this Nix derivation to create a store derivation:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ nix-instantiate default.nix
/nix/store/5d4il3h1q4cw08l6fnk4j04a19dsv71k-hello.drv
$ nix show-derivation /nix/store/5d4il3h1q4cw08l6fnk4j04a19dsv71k-hello.drv
{
  &amp;quot;/nix/store/5d4il3h1q4cw08l6fnk4j04a19dsv71k-hello.drv&amp;quot;: {
    &amp;quot;outputs&amp;quot;: {
      &amp;quot;out&amp;quot;: {
        &amp;quot;path&amp;quot;: &amp;quot;/nix/store/4v1dx6qaamakjy5jzii6lcmfiks57mhl-hello&amp;quot;
      }
    },
    &amp;quot;inputSrcs&amp;quot;: [],
    &amp;quot;inputDrvs&amp;quot;: {
      &amp;quot;/nix/store/mnyhjzyk43raa3f44pn77aif738prd2m-bash-5.1-p16.drv&amp;quot;: [
        &amp;quot;out&amp;quot;
      ]
    },
    &amp;quot;system&amp;quot;: &amp;quot;x86_64-linux&amp;quot;,
    &amp;quot;builder&amp;quot;: &amp;quot;/nix/store/2r9n7fz1rxq088j6mi5s7izxdria6d5f-bash-5.1-p16/bin/bash&amp;quot;,
    &amp;quot;args&amp;quot;: [ &amp;quot;-c&amp;quot;, &amp;quot;echo \&amp;quot;Hello, World!\&amp;quot; &amp;gt; $out&amp;quot; ],
    &amp;quot;env&amp;quot;: {
      &amp;quot;builder&amp;quot;: &amp;quot;/nix/store/2r9n7fz1rxq088j6mi5s7izxdria6d5f-bash-5.1-p16/bin/bash&amp;quot;,
      &amp;quot;name&amp;quot;: &amp;quot;hello&amp;quot;,
      &amp;quot;out&amp;quot;: &amp;quot;/nix/store/4v1dx6qaamakjy5jzii6lcmfiks57mhl-hello&amp;quot;,
      &amp;quot;system&amp;quot;: &amp;quot;x86_64-linux&amp;quot;
    }
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And build the store derivation:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ nix-store &lt;span class=&quot;token parameter variable&quot;&gt;--realise&lt;/span&gt; /nix/store/5d4il3h1q4cw08l6fnk4j04a19dsv71k-hello.drv
/nix/store/4v1dx6qaamakjy5jzii6lcmfiks57mhl-hello
$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /nix/store/4v1dx6qaamakjy5jzii6lcmfiks57mhl-hello
Hello, World&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Most Nix tooling does these two steps together:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;nix-build default.nix
this derivation will be built:
  /nix/store/q5hg3vqby8a9c8pchhjal3la9n7g1m0z-hello.drv
building '/nix/store/q5hg3vqby8a9c8pchhjal3la9n7g1m0z-hello.drv'...
/nix/store/zyrki2hd49am36jwcyjh3xvxvn5j5wml-hello&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Nix realisations (hereafter referred to as 'builds') are done in isolation to ensure reproducibility.
Projects often rely on interacting with package managers to make sure all dependencies are available and may implicitly rely on system configuration at build time.
To prevent this, every Nix derivation is built in isolation (without network access or access to the global file system) with only other Nix derivations as inputs.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The name Nix is derived from the Dutch word &lt;em&gt;niks&lt;/em&gt;, meaning nothing; build actions do not see anything that has not been explicitly declared as an input.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#nixpkgs&quot; aria-label=&quot;nixpkgs permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Nixpkgs&lt;/h4&gt;
&lt;p&gt;You may have noticed a reference to &lt;code&gt;nixpkgs&lt;/code&gt; in the above derivation.
As every input to a Nix derivation also has to be a Nix derivation, one can imagine the tedium involved in creating a Nix derivation for every dependency of your project.
However, Nixpkgs&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-7&quot; class=&quot;footnote-ref&quot;&gt;7&lt;/a&gt;&lt;/sup&gt; is a large repository of software packaged in Nix, where a package is a Nix derivation.
We can use packages from Nixpkgs as inputs to a Nix derivation, as we've done with &lt;code&gt;bash&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;There is also a command line package manager installing packages from Nixpkgs, which is why people often refer to Nix as a package manager.
While Nix, and therefore Nix package management, is primarily source-based (since derivations describe how to build software from source), binary deployment is an optimisation of this.
Since packages are built in isolation and entirely determined by their inputs, binaries can be transparently deployed by downloading them from a remote server instead of building the derivation locally.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/d593fbd512695940ef53b14d87fcc371/ce6cc/nixpkgs.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 64.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACoUlEQVR42mOorKxkZmYWFxcXExVVU1FR11Az1NMxtDQXUVYUEREVEBAQExNjZ2evq637////nz9//iMBhry8PAYGBkYmJiEBATNjAwszQz9nRxF7I9ZgB1VdbQlRUSZmZgYGhuLiYiya8/PzGRgYFOTltNTVjIx1ff0dkiJ9nHRNxZSltbWUDXW1BPj4GBgYSnIK//////HTxx/ff/z58+c7GDDk5OQwMDA4O1tYWuuZmxt7BZvZW2oEGIoWurNZa7LGRfg7O1gzMDD4xkdeuHPjwrnzDx8+/Pr16+3bt+7cucOQk5vDxMhooK+jo6/kGqgRlKrl76LQlSC5skapNlVn59Z1C2dPYmBgCA30uHn1/OkzZ8+fP//u3bs7d24/fvIY5GcBUVanYOWAXPmETsn4FrnEVK2OMsMlLRYVMQp+zubG+hoSosIx4YE3rlw4evzY+fPnP3/+fPPWrQcPHzIU5Bdqmgind2sndsondEokNss6+4tbmQp7mPFoynHyq8pI5TUzqhikpSb/+P37xYvnb9++/fXr18ePHz9/+cJQkFcop8+Y2qeS2C0b1ybmlShtbWAZZJYUbpmhKKUpmVuls++VSExsZVE+ltDOyc4TkmAJK1aNapRyS+e31rOs95s8L2Xj0uzdBU7lnCbu3BktDOxcxQUgzb9///737x9Cc3Z2NhMDg5W9tkOwgoG+eqFr88rs/ZsKTm4uPL0gZauroY+OkR7OeC4oKGBgYNDSVnZyMXXQce8Mn7258PS+iut7Kq5OiF7iZOSioiTLwMBQWlqKM4UxMTLpamroq+lFGKf1hy/pDp2fbl+qLKLJwMDAjCeFtbW1SUlJ6enpqaura2trmxmZe9h5u1h7GOgZamiCRPT09OTk5Lq6ujA1AwA/420mGxKgWgAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/d593fbd512695940ef53b14d87fcc371/c5bb3/nixpkgs.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;nixpkgs&quot; title=&quot;&quot; srcset=&quot;/static/d593fbd512695940ef53b14d87fcc371/04472/nixpkgs.png 170w,
/static/d593fbd512695940ef53b14d87fcc371/9f933/nixpkgs.png 340w,
/static/d593fbd512695940ef53b14d87fcc371/c5bb3/nixpkgs.png 680w,
/static/d593fbd512695940ef53b14d87fcc371/b12f7/nixpkgs.png 1020w,
/static/d593fbd512695940ef53b14d87fcc371/b5a09/nixpkgs.png 1360w,
/static/d593fbd512695940ef53b14d87fcc371/ce6cc/nixpkgs.png 1551w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Visualisation of Nixpkgs&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-8&quot; class=&quot;footnote-ref&quot;&gt;8&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#nixos&quot; aria-label=&quot;nixos permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;NixOS&lt;/h4&gt;
&lt;p&gt;NixOS&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-9&quot; class=&quot;footnote-ref&quot;&gt;9&lt;/a&gt;&lt;/sup&gt; is a Linux distribution built with Nix from a modular, purely functional specification.
It has no traditional filesystem hierarchy (FSH), like &lt;code&gt;/bin&lt;/code&gt;, &lt;code&gt;/lib&lt;/code&gt;, &lt;code&gt;/usr&lt;/code&gt;, but instead stores all components in &lt;code&gt;/nix/store&lt;/code&gt;.
The system configuration is managed by Nix and configured with Nix expressions.
NixOS modules are Nix files containing chunks of system configuration that can be composed to build a full NixOS system&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-10&quot; class=&quot;footnote-ref&quot;&gt;10&lt;/a&gt;&lt;/sup&gt;.
While many NixOS modules are provided in the Nixpkgs repository, they can also be written by an individual user.
For example, the expression used to deploy a DNS server is a NixOS module.
Together these modules form the configuration which builds the Linux system as a Nix derivation.&lt;/p&gt;
&lt;p&gt;NixOS minimises global mutable state that -- without knowing it -- you might rely on being set up in a certain way.
For example, you might follow instructions to run a series of shell commands and edit some files to get a piece of software working.
You may subsequently be unable to reproduce the result because you've forgotten some intricacy or are now using a different version of the software.
Nix forces you to encode this in a reproducible way, which is extremely useful for replicating software configurations and deployments, aiming to solve the 'It works on my machine' problem.
Docker is often used to fix this configuration problem, but Nix aims to be more reproducible.
This can be frustrating at times because it can make it harder to get a project off the ground, but the benefits often outweigh the downsides.&lt;/p&gt;
&lt;p&gt;Nix uses pointers (implemented as symlinks) to system dependencies, which are Nix derivations for programs or pieces of configuration files.
This means NixOS supports atomic upgrades, as the pointers to the new packages are only updated when the install succeeds; the old versions can be kept until garbage collection.
This also allows NixOS to trivially supports rollbacks to previous system configurations, as the pointers can be restored to their previous state.
Every new system configuration creates a GRUB entry, so you can boot previous systems even from your UEFI/BIOS.
Finally, NixOS also supports partial upgrades: while Nixpkgs also has one global coherent package set, one can use multiple instances of Nixpkgs (i.e., channels) at once, as this Nix store allows multiple versions of a dependency to be stored.&lt;/p&gt;
&lt;p&gt;To summarise the parts of the Nix ecosystem that we've discussed:&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
  &lt;img src=&quot;https://tarides.com/nix-stack.svg&quot; style=&quot;height: 300px; max-width: 100%&quot;/&gt;
&lt;/div&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#flakes&quot; aria-label=&quot;flakes permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Flakes&lt;/h4&gt;
&lt;p&gt;We also use Nix flakes for this project.
Without going into too much depth, they enable hermetic evaluation of Nix expressions and provide a standard way to compose Nix projects.
With flakes, instead of using a Nixpkgs repository version from a 'channel'&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-11&quot; class=&quot;footnote-ref&quot;&gt;11&lt;/a&gt;&lt;/sup&gt;, we pin Nixpkgs as an input to every Nix flake, be it a project build with Nix or a NixOS system.
Integrated with flakes, there is also a new &lt;code&gt;nix&lt;/code&gt; command aimed at improving the Nix UI.
You can read more detail about flakes in a series of blog posts by Eelco Dolstra on the topic&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-12&quot; class=&quot;footnote-ref&quot;&gt;12&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#deploying-unikernels&quot; aria-label=&quot;deploying unikernels permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Deploying Unikernels&lt;/h2&gt;
&lt;p&gt;Now that we understand what Nix and Mirage are, and we've motivated the desire to deploy Mirage unikernels on a NixOS machine, what's stopping us from doing just that?
To support deploying a Mirage unikernel, like for a DNS server, we need to write a NixOS module for it.&lt;/p&gt;
&lt;p&gt;A paired-down&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-13&quot; class=&quot;footnote-ref&quot;&gt;13&lt;/a&gt;&lt;/sup&gt; version of the bind NixOS module, the module used in our Nix expression for deploying a DNS server on NixOS (&lt;a href=&quot;https://tarides.com/feed.xml#cb1&quot;&gt;&amp;sect;&lt;/a&gt;), is:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nix&quot;&gt;&lt;pre class=&quot;language-nix&quot;&gt;&lt;code class=&quot;language-nix&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; lib&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; pkgs&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; lib&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  options &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bind &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      enable &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mkEnableOption &lt;span class=&quot;token string&quot;&gt;&amp;quot;BIND domain name server&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      
      zones &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mkOption &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  config &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mkIf cfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;enable &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    systemd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bind &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      description &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;BIND Domain Name Server&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      after &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;network.target&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      wantedBy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;multi-user.target&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

      serviceConfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        ExecStart &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token antiquotation important&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;pkgs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bind&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;/sbin/named&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Notice the reference to &lt;code&gt;pkgs.bind&lt;/code&gt;.
This is the Nixpkgs repository Nix derivation for the &lt;code&gt;bind&lt;/code&gt; package.
Recall that every input to a Nix derivation is itself a Nix derivation (&lt;a href=&quot;https://tarides.com/feed.xml#nixpkgs&quot;&gt;&amp;sect;&lt;/a&gt;); in order to use a package in a Nix expression -- i.e., a NixOS module -- we need to build said package with Nix.
Once we build a Mirage unikernel with Nix, we can write a NixOS module to deploy it.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#building-unikernels&quot; aria-label=&quot;building unikernels permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Building Unikernels&lt;/h2&gt;
&lt;p&gt;Mirage uses the package manager for OCaml called opam&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-14&quot; class=&quot;footnote-ref&quot;&gt;14&lt;/a&gt;&lt;/sup&gt;.
Dependencies in opam, as is common in programming language package managers, have a file which -- among other metadata, build/install scripts -- specifies dependencies and their version constraints.
For example&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-15&quot; class=&quot;footnote-ref&quot;&gt;15&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;...
depends: [
  &amp;quot;arp&amp;quot; { ?monorepo &amp;amp; &amp;gt;= &amp;quot;3.0.0&amp;quot; &amp;amp; &amp;lt; &amp;quot;4.0.0&amp;quot; }
  &amp;quot;ethernet&amp;quot; { ?monorepo &amp;amp; &amp;gt;= &amp;quot;3.0.0&amp;quot; &amp;amp; &amp;lt; &amp;quot;4.0.0&amp;quot; }
  &amp;quot;lwt&amp;quot; { ?monorepo }
  &amp;quot;mirage&amp;quot; { build &amp;amp; &amp;gt;= &amp;quot;4.2.0&amp;quot; &amp;amp; &amp;lt; &amp;quot;4.3.0&amp;quot; }
  &amp;quot;mirage-bootvar-solo5&amp;quot; { ?monorepo &amp;amp; &amp;gt;= &amp;quot;0.6.0&amp;quot; &amp;amp; &amp;lt; &amp;quot;0.7.0&amp;quot; }
  &amp;quot;mirage-clock-solo5&amp;quot; { ?monorepo &amp;amp; &amp;gt;= &amp;quot;4.2.0&amp;quot; &amp;amp; &amp;lt; &amp;quot;5.0.0&amp;quot; }
  &amp;quot;mirage-crypto-rng-mirage&amp;quot; { ?monorepo &amp;amp; &amp;gt;= &amp;quot;0.8.0&amp;quot; &amp;amp; &amp;lt; &amp;quot;0.11.0&amp;quot; }
  &amp;quot;mirage-logs&amp;quot; { ?monorepo &amp;amp; &amp;gt;= &amp;quot;1.2.0&amp;quot; &amp;amp; &amp;lt; &amp;quot;2.0.0&amp;quot; }
  &amp;quot;mirage-net-solo5&amp;quot; { ?monorepo &amp;amp; &amp;gt;= &amp;quot;0.8.0&amp;quot; &amp;amp; &amp;lt; &amp;quot;0.9.0&amp;quot; }
  &amp;quot;mirage-random&amp;quot; { ?monorepo &amp;amp; &amp;gt;= &amp;quot;3.0.0&amp;quot; &amp;amp; &amp;lt; &amp;quot;4.0.0&amp;quot; }
  &amp;quot;mirage-runtime&amp;quot; { ?monorepo &amp;amp; &amp;gt;= &amp;quot;4.2.0&amp;quot; &amp;amp; &amp;lt; &amp;quot;4.3.0&amp;quot; }
  &amp;quot;mirage-solo5&amp;quot; { ?monorepo &amp;amp; &amp;gt;= &amp;quot;0.9.0&amp;quot; &amp;amp; &amp;lt; &amp;quot;0.10.0&amp;quot; }
  &amp;quot;mirage-time&amp;quot; { ?monorepo }
  &amp;quot;mirageio&amp;quot; { ?monorepo }
  &amp;quot;ocaml&amp;quot; { build &amp;amp; &amp;gt;= &amp;quot;4.08.0&amp;quot; }
  &amp;quot;ocaml-solo5&amp;quot; { build &amp;amp; &amp;gt;= &amp;quot;0.8.1&amp;quot; &amp;amp; &amp;lt; &amp;quot;0.9.0&amp;quot; }
  &amp;quot;opam-monorepo&amp;quot; { build &amp;amp; &amp;gt;= &amp;quot;0.3.2&amp;quot; }
  &amp;quot;tcpip&amp;quot; { ?monorepo &amp;amp; &amp;gt;= &amp;quot;7.0.0&amp;quot; &amp;amp; &amp;lt; &amp;quot;8.0.0&amp;quot; }
  &amp;quot;yaml&amp;quot; { ?monorepo &amp;amp; build }
]
...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Each of these dependencies will have its own dependencies with their own version constraints.
As we can only link one dependency into the resulting program, we need to solve a set of dependency versions that satisfies these constraints.
This is not an easy problem.
In fact, it's NP-complete &lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-16&quot; class=&quot;footnote-ref&quot;&gt;16&lt;/a&gt;&lt;/sup&gt;.
Opam uses the Zero Install&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-17&quot; class=&quot;footnote-ref&quot;&gt;17&lt;/a&gt;&lt;/sup&gt; SAT solver for dependency resolution.&lt;/p&gt;
&lt;p&gt;Nixpkgs has a large number of OCaml packages&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-18&quot; class=&quot;footnote-ref&quot;&gt;18&lt;/a&gt;&lt;/sup&gt;, which we could provide as build inputs to a Nix derivation.
However, Nixpkgs has one global coherent set of package versions&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-19&quot; class=&quot;footnote-ref&quot;&gt;19&lt;/a&gt;&lt;/sup&gt;.
The support for installing multiple versions of a package concurrently comes from the fact that they are stored at a unique path and can be referenced separately, or symlinked, where required.
So different projects or users that use a different version of Nixpkgs won't conflict, but Nix does not do any dependency version resolution -- everything is pinned.
This is a problem for opam projects with version constraints that can't be satisfied with a static instance of Nixpkgs.&lt;/p&gt;
&lt;p&gt;Luckily, a project from Tweag already exists (&lt;code&gt;opam-nix&lt;/code&gt;) to deal with this&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-20&quot; class=&quot;footnote-ref&quot;&gt;20&lt;/a&gt;&lt;/sup&gt;.
This project uses the opam dependency versions solver inside a Nix derivation, and then creates derivations from the resulting dependency versions.&lt;/p&gt;
&lt;p&gt;This still doesn't support building our Mirage unikernels, though.
Unikernels quite often need to be cross-compiled: compiled to run on a platform other than the one they're being built on.
A common target, Solo5&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-21&quot; class=&quot;footnote-ref&quot;&gt;21&lt;/a&gt;&lt;/sup&gt;, is a sandboxed execution environment for unikernels.
It acts as a minimal shim layer to interface between unikernels and different hypervisor backends.
Solo5 uses a different &lt;code&gt;glibc&lt;/code&gt; which requires cross-compilation.
Mirage 4&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-22&quot; class=&quot;footnote-ref&quot;&gt;22&lt;/a&gt;&lt;/sup&gt; supports cross compilation with toolchains in the Dune build system&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-23&quot; class=&quot;footnote-ref&quot;&gt;23&lt;/a&gt;&lt;/sup&gt;.
This uses a host compiler installed in an opam switch (a virtual environment) as normal, as well as a target compiler&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-24&quot; class=&quot;footnote-ref&quot;&gt;24&lt;/a&gt;&lt;/sup&gt;.
But the cross-compilation context of packages is only known at build time, as some metaprogramming modules may require preprocessing with the host compiler.
To ensure that the right compilation context is used, we have to provide Dune with all our sources' dependencies.
A tool called &lt;code&gt;opam-monorepo&lt;/code&gt; was created to do just that&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-25&quot; class=&quot;footnote-ref&quot;&gt;25&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;We extended the &lt;code&gt;opam-nix&lt;/code&gt; project to support the &lt;code&gt;opam-monorepo&lt;/code&gt; workflow with this pull request: &lt;a href=&quot;https://github.com/tweag/opam-nix/pull/18&quot;&gt;github.com/tweag/opam-nix/pull/18&lt;/a&gt;.
This is very low-level support for building Mirage unikernels with Nix, however.
In order to provide a better user experience, we also created the Hillinar Nix flake: &lt;a href=&quot;https://github.com/ryanGibb/hillingar&quot;&gt;github.com/RyanGibb/hillingar&lt;/a&gt;.
This wraps the Mirage tooling and &lt;code&gt;opam-nix&lt;/code&gt; function calls so that a simple high-level flake can be dropped into a Mirage project to support building it with Nix.
To add Nix build support to a unikernel, simply:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# create a flake from hillingar's default template&lt;/span&gt;
$ nix flake new &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-t&lt;/span&gt; github:/RyanGibb/hillingar
&lt;span class=&quot;token comment&quot;&gt;# substitute the name of the unikernel you're building&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;'s/throw &amp;quot;Put the unikernel name here&amp;quot;/&amp;quot;&amp;lt;unikernel-name&amp;gt;&amp;quot;/g'&lt;/span&gt; flake.nix
&lt;span class=&quot;token comment&quot;&gt;# build the unikernel with Nix for a particular target&lt;/span&gt;
$ nix build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;#&amp;lt;target&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For example, see the flake for building the Mirage website as a unikernel with Nix: &lt;a href=&quot;https://github.com/RyanGibb/mirage-www/blob/master/flake.nix&quot;&gt;github.com/RyanGibb/mirage-www/blob/master/flake.nix&lt;/a&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#evaluation&quot; aria-label=&quot;evaluation permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Evaluation&lt;/h2&gt;
&lt;p&gt;Hillingar's primary limitations are (1) complex integration is required with the OCaml ecosystem to solve dependency version constraints using &lt;code&gt;opam-nix&lt;/code&gt;, and (2) that cross-compilation requires cloning all sources locally with &lt;code&gt;opam-monorepo&lt;/code&gt; (&lt;a href=&quot;https://tarides.com/feed.xml#dependency-management&quot;&gt;&amp;sect;&lt;/a&gt;).
Another issue that proved an annoyance during this project is the Nix DSL's dynamic typing.
When writing simple derivations this often isn't a problem, but when writing complicated logic, it quickly gets in the way of productivity.
The runtime errors produced can be very hard to parse.
Thankfully there is work towards creating a typed language for the Nix deployment system, such as Nickel&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-26&quot; class=&quot;footnote-ref&quot;&gt;26&lt;/a&gt;&lt;/sup&gt;.
However gradual typing is hard, and Nickel still isn't ready for real-world use despite being open-sourced (in a week as of writing this) for two years.&lt;/p&gt;
&lt;p&gt;A glaring omission is that despite it being the primary motivation, we haven't actually written a NixOS module for deploying a DNS server as a unikernel.
There are still questions about how to provide zone file data declaratively to the unikernel and manage the runtime of deployed unikernels.
One option to do the latter is Albatross&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-27&quot; class=&quot;footnote-ref&quot;&gt;27&lt;/a&gt;&lt;/sup&gt;, which has recently had support for building with Nix added&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-28&quot; class=&quot;footnote-ref&quot;&gt;28&lt;/a&gt;&lt;/sup&gt;.
Albatross aims to provision resources for unikernels such as network access, share resources for unikernels between users, and monitor unikernels with a Unix daemon.
Using Albatross to manage some of the inherent imperative processes behind unikernels, as well as share access to resources for unikernels for other users on a NixOS system, could simplify the creation and improve the functionality of a NixOS module for a unikernel.&lt;/p&gt;
&lt;p&gt;There also exists related work in the reproducible building of Mirage unikernels.
Specifically, improving the reproducibility of opam packages (as Mirage unikernels are opam packages themselves)&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-29&quot; class=&quot;footnote-ref&quot;&gt;29&lt;/a&gt;&lt;/sup&gt;.
Hillingar differs in that it only uses opam for version resolution, instead using Nix to provide dependencies, which provides reproducibility with pinned Nix derivation inputs and builds in isolation by default.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;To summarise, this project was motivated (&lt;a href=&quot;https://tarides.com/feed.xml#introduction&quot;&gt;&amp;sect;&lt;/a&gt;) by deploying unikernels on NixOS (&lt;a href=&quot;https://tarides.com/feed.xml#deploying-unikernels&quot;&gt;&amp;sect;&lt;/a&gt;).
Towards this end, we added support for building MirageOS unikernels with Nix:
we extended &lt;code&gt;opam-nix&lt;/code&gt; to support the &lt;code&gt;opam-monorepo&lt;/code&gt; workflow and created the Hillingar project to provide a usable Nix interface (&lt;a href=&quot;https://tarides.com/feed.xml#building-unikernels&quot;&gt;&amp;sect;&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;While only the first was the primary motivation, the benefits of building unikernels with Nix are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Reproducible and low-config unikernel deployment using NixOS modules is enabled.&lt;/li&gt;
&lt;li&gt;Nix allows reproducible builds pinning system dependencies and composing multiple language environments. For example, the OCaml package &lt;code&gt;conf-gmp&lt;/code&gt; is a 'virtual package' that relies on a system installation of the C/Assembly library &lt;code&gt;gmp&lt;/code&gt; (The GNU Multiple Precision Arithmetic Library). Nix easily allows us to depend on this package in a reproducible way.&lt;/li&gt;
&lt;li&gt;We can use Nix to support building on different systems (&lt;a href=&quot;https://tarides.com/feed.xml#cross-compilation&quot;&gt;&amp;sect;&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To conclude, while NixOS and MirageOS take fundamentally very different approaches, they're both trying to bring some kind of functional programming paradigm to operating systems.
NixOS does this in a top-down manner, trying to tame Unix with functional principles like laziness and immutability&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-30&quot; class=&quot;footnote-ref&quot;&gt;30&lt;/a&gt;&lt;/sup&gt;; whereas, MirageOS does this by throwing Unix out the window and rebuilding the world from scratch in a very much bottom-up approach.
Despite these two projects having different motivations and goals, Hillingar aims to get the best from both worlds by marrying the two.&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;To dive deeper, please see a more detailed article on my &lt;a href=&quot;https://ryan.freumh.org/blog/hillingar&quot;&gt;personal blog&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If you have a unikernel, consider trying to build it with Hillingar, and please report any problems at &lt;a href=&quot;https://github.com/RyanGibb/hillingar/issues&quot;&gt;github.com/RyanGibb/hillingar/issues&lt;/a&gt;!&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr/&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://www.isc.org/bind/&quot;&gt;ISC bind&lt;/a&gt; has many &lt;a href=&quot;https://www.cvedetails.com/product/144/ISC-Bind.html?vendor_id=64&quot;&gt;CVE's&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt; &lt;a href=&quot;https://mirage.io&quot;&gt;mirage.io&lt;/a&gt; &lt;a href=&quot;https://tarides.com/feed.xml#fnref-2&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Credits to Takayuki Imada&lt;a href=&quot;https://tarides.com/feed.xml#fnref-3&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Barring the use of &lt;a href=&quot;https://mirage.io/blog/modular-foreign-function-bindings&quot;&gt;foreign function interfaces&lt;/a&gt; (FFIs).&lt;a href=&quot;https://tarides.com/feed.xml#fnref-4&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;As 'nix' means snow in Latin. Credits to Tim Cuthbertson.&lt;a href=&quot;https://tarides.com/feed.xml#fnref-5&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;NB: we will use component, dependency, and package somewhat interchangeably in this blog post, as they all fundamentally mean the same thing -- a piece of software.&lt;a href=&quot;https://tarides.com/feed.xml#fnref-6&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt; &lt;a href=&quot;https://github.com/nixos/nixpkgs&quot;&gt;github.com/nixos/nixpkgs&lt;/a&gt; &lt;a href=&quot;https://tarides.com/feed.xml#fnref-7&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.tweag.io/blog/2022-09-13-nixpkgs-graph/&quot;&gt;www.tweag.io/blog/2022-09-13-nixpkgs-graph/&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-8&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://nixos.org&quot;&gt;nixos.org&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-9&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://nixos.org/manual/nixos/stable/index.html#sec-writing-modules&quot;&gt;NixOS manual Chapter 66. Writing NixOS Modules&lt;/a&gt;.&lt;a href=&quot;https://tarides.com/feed.xml#fnref-10&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://nixos.org/manual/nix/stable/package-management/channels.html&quot;&gt;nixos.org/manual/nix/stable/package-management/channels.html&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-11&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.tweag.io/blog/2020-05-25-flakes/&quot;&gt;tweag.io/blog/2020-05-25-flakes&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-12&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;The full module can be found &lt;a href=&quot;https://github.com/NixOS/nixpkgs/blob/fe76645aaf2fac3baaa2813fd0089930689c53b5/nixos/modules/services/networking/bind.nix&quot;&gt;here&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-13&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://opam.ocaml.org/&quot;&gt;opam.ocaml.org&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-14&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;For &lt;a href=&quot;https://github.com/mirage/mirage-www&quot;&gt;mirage-www&lt;/a&gt; targetting &lt;code&gt;hvt&lt;/code&gt;.&lt;a href=&quot;https://tarides.com/feed.xml#fnref-15&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://research.swtch.com/version-sat&quot;&gt;research.swtch.com/version-sat&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-16&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://0install.net&quot;&gt;0install.net&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-17&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/NixOS/nixpkgs/blob/9234f5a17e1a7820b5e91ecd4ff0de449e293383/pkgs/development/ocaml-modules/&quot;&gt;github.com/NixOS/nixpkgs pkgs/development/ocaml-modules&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-18&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Bar some exceptional packages that have multiple major versions packaged, like Postgres.&lt;a href=&quot;https://tarides.com/feed.xml#fnref-19&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/tweag/opam-nix&quot;&gt;github.com/tweag/opam-nix&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-20&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/Solo5/solo5&quot;&gt;github.com/Solo5/solo5&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-21&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://mirage.io/blog/announcing-mirage-40&quot;&gt;mirage.io/blog/announcing-mirage-40&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-22&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://dune.build&quot;&gt;dune.build&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-23&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/mirage/ocaml-solo5&quot;&gt;github.com/mirage/ocaml-solo5&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-24&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/tarides/opam-monorepo&quot;&gt;github.com/tarides/opam-monorepo&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-25&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.tweag.io/blog/2020-10-22-nickel-open-sourcing/&quot;&gt;www.tweag.io/blog/2020-10-22-nickel-open-sourcing&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-26&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://hannes.robur.coop/Posts/VMM&quot;&gt;hannes.robur.coop/Posts/VMM&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-27&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/roburio/albatross/pull/120&quot;&gt;https://github.com/roburio/albatross/pull/120&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-28&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://hannes.nqsb.io/Posts/ReproducibleOPAM&quot;&gt;hannes.nqsb.io/Posts/ReproducibleOPAM&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-29&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.tweag.io/blog/2022-07-14-taming-unix-with-nix/&quot;&gt;tweag.io/blog/2022-07-14-taming-unix-with-nix&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-30&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><id>https://tarides.com/blog/2022-12-14-hillingar-mirageos-unikernels-on-nixos</id><title type="text">Hillingar: MirageOS Unikernels on NixOS</title><updated>2022-12-14T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-12-07-ocaml-5-release-candidate-now-available" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;We're in the home stretch for the full OCaml 5 release. Multicore is almost here! Yesterday its Release Candidate (RC) was announced on the &lt;a href=&quot;https://discuss.ocaml.org/t/first-release-candidate-for-ocaml-5-0-0/10922&quot;&gt;OCaml Discuss&lt;/a&gt;, which is the final step before the major release, expected before Christmas.&lt;/p&gt;
&lt;p&gt;To learn more about the exciting features coming with OCaml 5, you can watch &lt;a href=&quot;https://www.youtube.com/watch?v=zJ4G0TKwzVc&quot;&gt;KC&amp;rsquo;s keynote address&lt;/a&gt; and check out his &lt;a href=&quot;https://speakerdeck.com/kayceesrk/retrofitting-concurrency-lessons-from-the-engine-room&quot;&gt;speaker slide deck&lt;/a&gt; as well. As always, feel free to &lt;a href=&quot;https://tarides.com/company&quot;&gt;contact us&lt;/a&gt; for more information about using OCaml and for support on your OCaml projects.&lt;/p&gt;
&lt;p&gt;The OCaml community has worked tirelessly to release 5.0 before the end of the year, with a lot of time spent on creating a smooth transition for OCaml users. There should be just enough time for you to try out OCaml 5 for a fun holiday project or the &lt;a href=&quot;https://tarides.com/blog/2022-11-24-solve-the-2022-advent-of-code-puzzles-with-ocaml&quot;&gt;Advent of Code&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Your reports resulted in these bug fixes since the Beta 2 release last week:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/issues/11776&quot;&gt;11776&lt;/a&gt;: Extend environment with functor parameters in &lt;code&gt;strengthen_lazy&lt;/code&gt;. (Chris Casinghino and Luke Maurer, review by Gabriel Scherer)&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/issues/11533&quot;&gt;11533&lt;/a&gt; and &lt;a href=&quot;https://github.com/ocaml/ocaml/issues/11534&quot;&gt;11534&lt;/a&gt;: follow synonyms again in &lt;code&gt;#show_module_type&lt;/code&gt; (this had stopped working in 4.14.0) (Gabriel Scherer, review by Jacques Garrigue, report by Yaron Minsky)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For the full change log, &lt;a href=&quot;https://github.com/ocaml/ocaml/blob/5.0/Changes&quot;&gt;visit the GitHub repo&lt;/a&gt;. The source code for the release candidate is available at these addresses:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/archive/5.0.0-rc1.tar.gz&quot;&gt;https://github.com/ocaml/ocaml/archive/5.0.0-rc1.tar.gz&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://caml.inria.fr/pub/distrib/ocaml-5.0/ocaml-5.0.0~rc1.tar.gz&quot;&gt;https://caml.inria.fr/pub/distrib/ocaml-5.0/ocaml-5.0.0~rc1.tar.gz&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Please keep those testing reports coming in. We believe this release candidate is ready to go, but we really value testing right up to the last minute to be even more sure. Send us your valuable input! If you find something, please &lt;a href=&quot;https://github.com/ocaml/ocaml/issues&quot;&gt;open an issue on GitHub&lt;/a&gt; or join the discussion on the &lt;a href=&quot;https://discuss.ocaml.org/t/first-release-candidate-for-ocaml-5-0-0/10922&quot;&gt;Discuss post&lt;/a&gt;, where you can also find installation instructions.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-12-07-ocaml-5-release-candidate-now-available</id><title type="text">OCaml 5 Release Candidate Now Available!</title><updated>2022-12-07T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-11-29-ocaml-5-beta2-release" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Just about a month after the &lt;a href=&quot;https://tarides.com/blog/2022-10-17-ocaml-5-beta-release&quot;&gt;OCaml 5 Beta release&lt;/a&gt;, the OCaml 5 Beta2 version has been released, taking us one step closer to the full OCaml 5 with Multicore release later this year. The OCaml community's collaboration is coming to fruition! Although we're not quite ready for the RC1 (Release Candidate) version, several things have been added and improved with Beta2.&lt;/p&gt;
&lt;p&gt;To learn more about the exciting things coming with OCaml 5, please watch KC Sivaramakrishnan&amp;rsquo;s &lt;a href=&quot;https://www.youtube.com/watch?v=zJ4G0TKwzVc&quot;&gt;keynote address&lt;/a&gt; and check out &lt;a href=&quot;https://speakerdeck.com/kayceesrk/retrofitting-concurrency-lessons-from-the-engine-room&quot;&gt;his speaker slide deck&lt;/a&gt; as well. As always, feel free to &lt;a href=&quot;https://tarides.com/company&quot;&gt;contact us&lt;/a&gt; for more information about using OCaml and for support on your OCaml projects.&lt;/p&gt;
&lt;p&gt;Here's a partial list of improvements/fixes with &lt;a href=&quot;https://github.com/ocaml/ocaml/issues&quot;&gt;issue numbers&lt;/a&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11631&quot;&gt;#11631&lt;/a&gt; - fix an assertion dealing with a segfault found by the Multicore test suite&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/issues/11662&quot;&gt;#11662&lt;/a&gt;, &lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11673&quot;&gt;#11673&lt;/a&gt; - memory leak affecting &lt;code&gt;dynlink&lt;/code&gt; with frame descriptor tables (reported by Frama-C devs)&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11704&quot;&gt;#11704&lt;/a&gt;, &lt;a href=&quot;https://github.com/ocaml/ocaml/issues/11669&quot;&gt;#11669&lt;/a&gt; - segfault with effects fixed, having been tracked down to the refactoring of &lt;code&gt;Effect.Unhandled&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11701&quot;&gt;#11701&lt;/a&gt; - fix spurious &lt;code&gt;.dSYM&lt;/code&gt; files and directories being created on macOS&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11671&quot;&gt;#11671&lt;/a&gt; - bug in &lt;code&gt;top_heap_words&lt;/code&gt; statistics accounting fix&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11670&quot;&gt;#11670&lt;/a&gt; - macOS fix when creating empty archives&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11097&quot;&gt;#11097&lt;/a&gt; - NetBSD fixes, including ARM64 support&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11194&quot;&gt;#11194&lt;/a&gt;, &lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11609&quot;&gt;#11609&lt;/a&gt; - fixes a regression from 4.14&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11622&quot;&gt;#11622&lt;/a&gt; - fixes a regression in error messages since 4.10&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11725&quot;&gt;#11725&lt;/a&gt; - remove &lt;code&gt;caml_alloc_N&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11661&quot;&gt;#11661&lt;/a&gt; - erroneous &lt;code&gt;-force-tmc&lt;/code&gt; option removed&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11367&quot;&gt;#11367&lt;/a&gt;, &lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11652&quot;&gt;#11652&lt;/a&gt; - Windows clean-ups&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11611&quot;&gt;#11611&lt;/a&gt; - fix --disable-instrumented-runtime&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11639&quot;&gt;#11639&lt;/a&gt; - configuration bookkeeping (ensure system, etc., always set)&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11632&quot;&gt;#11632&lt;/a&gt; - minor bookkeeping bug fix&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11559&quot;&gt;#11559&lt;/a&gt;, &lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11649&quot;&gt;#11649&lt;/a&gt;, &lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11640&quot;&gt;#11640&lt;/a&gt;, &lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11301&quot;&gt;#11301&lt;/a&gt;, &lt;a href=&quot;https://github.com/ocaml/ocaml/pull/11705&quot;&gt;#11705&lt;/a&gt; - docs updates&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In short, we're continuing to stabilise the release. We're also dealing with reports coming from the wonderful testing that's been going on, especially Multicore tests and the Frama-C report. Keep those testing reports and feedback coming by &lt;a href=&quot;https://github.com/ocaml/ocaml/issues&quot;&gt;opening an issue on the GitHub repo&lt;/a&gt; or chiming in through the &lt;a href=&quot;https://discuss.ocaml.org/t/ocaml-5-0-0-second-beta-release/10871&quot;&gt;OCaml Discuss forum post&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Thanks to the hard work by all engineers working to make OCaml even better than before. It's a beautiful sight to watch brilliant developers come together on an open-source project like OCaml, and Tarides is proud to be part of this ever-growing community.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-11-29-ocaml-5-beta2-release</id><title type="text">OCaml 5 Beta2 Release</title><updated>2022-11-29T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-11-24-solve-the-2022-advent-of-code-puzzles-with-ocaml" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Too many programmers only know OCaml through a functional programming language overview course at university. They erroneously believe OCaml is used primarily in academia rather than in the real world. Not only is OCaml already used in &lt;a href=&quot;https://tarides.com/blog/2022-11-22-six-surprising-reasons-the-ocaml-programming-language-is-good-for-business&quot;&gt;several prominent businesses&lt;/a&gt;, it can also be used for fun projects, like the upcoming Advent of Code.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#what-is-advent-of-code&quot; aria-label=&quot;what is advent of code permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What is Advent of Code?&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://adventofcode.com/&quot;&gt;Advent of Code&lt;/a&gt; is an annual online Advent calendar produced specifically for programmers. It publishes a series of daily puzzles, revealing a new puzzle every day from 1 December to 25 December. That's 25 days of coding challenges! These puzzles can be solved in the language of your choice.&lt;/p&gt;
&lt;p&gt;Every year they have new puzzles and anyone can participate, whether you're new to programming or a veteran. Advent of Code has been running since 2015 and has attracted a large community of developers around the world!&lt;/p&gt;
&lt;p&gt;It's not only a fun way to learn new languages, but it also provides a great way to meet new people with the same interests and exchange ideas.&lt;/p&gt;
&lt;p&gt;OCaml 5 is set for release later this year, so it's a perfect time to learn and practice OCaml with Advent of Code!&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#5-reasons-to-learn-ocaml&quot; aria-label=&quot;5 reasons to learn ocaml permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5 Reasons to Learn OCaml&lt;/h2&gt;
&lt;p&gt;There are so many misconceptions around OCaml that it's hard to know where to start. Basically, OCaml can do what Python, C++, Java, or any other major programming language can do. Here are a few specific reasons why OCaml should be the next language you learn:&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#1-secure-by-design&quot; aria-label=&quot;1 secure by design permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. &lt;strong&gt;Secure-By-Design&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Cyber attacks have become more commonplace and sophisticated, so security has become a top priority in software development. With the proliferation of cloud services and Internet-connected devices, software must be secure-by-design to prevent malicious actors from taking advantage of any bugs or loopholes. Creating software with a secure-by-design language like OCaml helps meet this goal.&lt;/p&gt;
&lt;p&gt;OCaml has built-in features and design patterns, like &lt;strong&gt;type and memory safety&lt;/strong&gt;, that make it secure-by-design.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#2-performant-garbage-collector&quot; aria-label=&quot;2 performant garbage collector permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2. &lt;strong&gt;Performant Garbage Collector&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Contrary to popular belief, OCaml's garbage collector (GC) doesn't slow things down because it's incremental, which can help avoid the problems of manual memory management in large or long-running programs.&lt;/p&gt;
&lt;p&gt;OCaml's GC has to run periodically, but it can do so in &lt;strong&gt;small incremental steps&lt;/strong&gt;. Although allocations that trigger a GC are longer than a malloc call (used in C), most of them are almost immediate because allocating from the minor heap is as cheap as allocating on the stack.&lt;/p&gt;
&lt;p&gt;This incremental GC avoids the problems normally associated with garbage collection, like tying up memory and slowing down the process.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#3-confidence-in-the-code-through-type-checking&quot; aria-label=&quot;3 confidence in the code through type checking permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3. &lt;strong&gt;Confidence in the Code Through Type Checking&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;OCaml's compile-time type checking eliminates many potential runtime errors, and its strong type inference eliminates several redundant type annotations. Often, a programming language has either type safety or type inference, but with OCaml you get both!&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#4-multicore&quot; aria-label=&quot;4 multicore permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;4. &lt;strong&gt;Multicore!&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;With the release of OCaml 5 later this year comes Multicore support! &lt;a href=&quot;https://github.com/ocaml-multicore/ocaml-multicore&quot;&gt;Multicore&lt;/a&gt; is an extension of OCaml with native support for &lt;strong&gt;Shared-Memory Parallelism&lt;/strong&gt; through domains and &lt;strong&gt;Concurrency&lt;/strong&gt; through algebraic effects. The ability to run OCaml on multiple cores will make it even faster than before.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#5-extensive-tools--libraries&quot; aria-label=&quot;5 extensive tools  libraries permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5. &lt;strong&gt;Extensive Tools &amp;amp; Libraries&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;OCaml has some great tools and &lt;a href=&quot;https://tarides.com/blog/2022-10-12-8-ocaml-libraries-to-make-your-life-easier&quot;&gt;helpful libraries&lt;/a&gt;, like &lt;a href=&quot;https://mirage.io/&quot;&gt;MirageOS&lt;/a&gt;, &lt;a href=&quot;https://irmin.org/&quot;&gt;Irmin&lt;/a&gt;, and so many others as reported by seasoned OCaml programmers in &lt;a href=&quot;https://discuss.ocaml.org/t/top-5-favorite-ocaml-libraries/10626&quot;&gt;this &lt;em&gt;Discuss&lt;/em&gt; thread&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;OCaml platform tools include the &lt;a href=&quot;https://dune.readthedocs.io/en/stable/&quot;&gt;Dune build system&lt;/a&gt;, &lt;a href=&quot;https://opam.ocaml.org/&quot;&gt;opam package manager&lt;/a&gt;, &lt;a href=&quot;https://tarides.com/blog/2022-07-05-the-magic-of-merlin&quot;&gt;Merlin IDE&lt;/a&gt;, and the &lt;a href=&quot;https://ocaml.github.io/odoc/&quot;&gt;&lt;code&gt;odoc&lt;/code&gt; documentation generator&lt;/a&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#pro-tip-learn-ocaml-basics-first&quot; aria-label=&quot;pro tip learn ocaml basics first permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Pro Tip: Learn OCaml Basics First&lt;/h2&gt;
&lt;p&gt;Before you start solving puzzles, learn the basics to ensure you understand the most common data structures and algorithms. It's important to know how to print to the console, read and write files, and parse text.&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s also a good idea to read about common problem-solving approaches. For example, checking whether a solution is correct is a crucial part of the solving process. This will help you understand the challenges better, and you can save yourself a lot of time and frustration.&lt;/p&gt;
&lt;p&gt;Get &lt;a href=&quot;https://ocaml.org/docs/up-and-running&quot;&gt;Up &amp;amp; Running&lt;/a&gt; with OCaml today through the &lt;a href=&quot;https://ocaml.org/docs&quot;&gt;tutorials on OCaml.org&lt;/a&gt;. Also consider joining the &lt;a href=&quot;https://discuss.ocaml.org/&quot;&gt;OCaml Community Forum &lt;em&gt;Discuss&lt;/em&gt;&lt;/a&gt;. They're very welcoming of those new to OCaml as well as experienced OCaml programmers, and members will quickly answer any questions you have while you learn.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;The Advent of Code is a great way to practise your problem-solving skills in a new programming language during the holidays.&lt;/p&gt;
&lt;p&gt;Give OCaml a try this holiday season. You won't regret it!&lt;/p&gt;
&lt;p&gt;Learn more about the forthcoming OCaml 5 through &lt;a href=&quot;https://www.youtube.com/watch?v=zJ4G0TKwzVc&quot;&gt;KC Shivaramakrishnan's Keynote Address&lt;/a&gt; and &lt;a href=&quot;https://speakerdeck.com/kayceesrk/retrofitting-concurrency-lessons-from-the-engine-room&quot;&gt;speaker deck&lt;/a&gt;. Stay tuned to this blog for release updates and a series of posts about why you should consider OCaml as your next language.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-11-24-solve-the-2022-advent-of-code-puzzles-with-ocaml</id><title type="text">Solve the 2022 Advent of Code Puzzles with OCaml</title><updated>2022-11-24T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-11-22-six-surprising-reasons-the-ocaml-programming-language-is-good-for-business" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Functional programming languages have been around since the 1950's, when the first high-level languages were used to program early computers. Examples of functional programming languages include OCaml, Erlang, Clojure, Haskell, Scala, and Common Lisp. Choosing the right programming language is critical to the long-term success and stability of your products, services, and operations. With strong academic roots and years of iteration and innovation, functional programming languages can offer a real competitive edge to businesses. This article explains some of the lesser-known benefits of OCaml from a business perspective.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#why-functional-programming&quot; aria-label=&quot;why functional programming permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Why Functional Programming?&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&quot;https://medium.com/javascript-scene/master-the-javascript-interview-what-is-functional-programming-7f218c68b3a0&quot;&gt;strengths of functional programming&lt;/a&gt; are becoming increasingly well-known. Functional programming lets programmers write programs in a declarative, logical, and mathematical style. This makes it easier for the developer to express their intent in a declarative style, where the code closely matches the specification. A specification is a mathematical description of what a program does, and programs that match their specification are proven to follow that description, which makes them predictable and safe. Furthermore, with features that limit the mutation of data and side effects, functional programs tend to have fewer bugs and vulnerabilities, remain easy to develop and maintain, and last longer overall.&lt;/p&gt;
&lt;p&gt;Nowadays, widely-used imperative programming languages such as Python, Rust, and Java support programming in a functional style and use functional programming features to take &lt;a href=&quot;https://spectrum.ieee.org/functional-programming&quot;&gt;advantage of its strengths&lt;/a&gt;. Features &lt;a href=&quot;https://www.typescriptlang.org/&quot;&gt;like rich type systems&lt;/a&gt;, &lt;a href=&quot;https://medium.com/digitalfrontiers/a-case-for-pattern-matching-b43a5c9796b8&quot;&gt;pattern matching&lt;/a&gt;, and &lt;a href=&quot;https://en.wikipedia.org/wiki/Anonymous_function&quot;&gt;lambda expressions&lt;/a&gt; are becoming more mainstream, illustrating their usefulness.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#what-makes-ocaml-unique&quot; aria-label=&quot;what makes ocaml unique permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What Makes OCaml Unique?&lt;/h2&gt;
&lt;p&gt;OCaml combines a strong foundation in functional programming with some select imperative and object-oriented programming features, allowing the user to choose the best approach for the task at hand. This is part of what makes OCaml such a great general-purpose programming language; it combines the strengths of several programming styles and offers the developer a full software development toolkit.&lt;/p&gt;
&lt;p&gt;OCaml provides a unique balance of performance, security, and reliability. It combines features like a garbage collector, static type-checking, type-driven development, first-class functions, and pattern matching (features that work well together). Together they result in a language known for minimising errors, debugging easily, automatically managing memory, preventing structural errors in data, and providing a user-friendly developer environment.&lt;/p&gt;
&lt;p&gt;When OCaml 5 is released later this year, the language will get a significant upgrade, introducing support for shared-memory parallelism and native support for simple concurrent programming. Running programs on multiple cores will allow developers to considerably reduce the runtime of their projects by executing code in parallel. The quality-of-life updates to concurrent programming will make it easier for developers to write high-performance concurrent code.&lt;/p&gt;
&lt;p&gt;So what are some of OCaml&amp;rsquo;s greatest strengths? Here are the key reasons why businesses use OCaml to solve complex, critical, and time-sensitive problems.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#1-ocaml-is-trusted-by-several-prominent-companies&quot; aria-label=&quot;1 ocaml is trusted by several prominent companies permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. OCaml Is Trusted By Several Prominent Companies&lt;/h3&gt;
&lt;p&gt;Think of OCaml as an academic language? Think again! Owing to its reputation for reliability, safety, and performance, many businesses use it to solve real-world problems. Talented software engineers all over the world create robust, maintainable, energy-efficient, and fast solutions in OCaml for high-pressure environments where a single mistake can cost millions.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.docker.com&quot;&gt;Docker&lt;/a&gt; is making life easier for developers by providing them with a state-of-the-art integrated development pipeline that consolidates application components, all available conveniently on your desktop. Docker has over &lt;a href=&quot;https://containerjournal.com/features/docker-inc-dev-tools-boast-15-million-users/&quot;&gt;fifteen million&lt;/a&gt; registered users worldwide and uses &lt;a href=&quot;https://github.com/moby/vpnkit&quot;&gt;VPNKit&lt;/a&gt;, which is written in OCaml, in its Docker Desktop app to &lt;a href=&quot;https://www.docker.com/blog/how-docker-desktop-networking-works-under-the-hood/&quot;&gt;keep user networks secure.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://about.meta.com/company-info/&quot;&gt;Meta&lt;/a&gt; is a multiplatform company that uses tech to bring people together and build unique communities online. The social media giant uses OCaml in major parts of its infrastructure, such as the compiler and typechecker for its programming language Hack. Other Meta tooling that uses OCaml includes Infer, Flow, and the now retired Pfff.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.janestreet.com&quot;&gt;Jane Street&lt;/a&gt; is a quantitative trading firm that uses OCaml as their core solution for their research tools, trading systems, and accounting systems. Processing billions of dollars each day, Jane Street relies on OCaml to ensure it is done securely and quickly. Notably, nearly a million lines of their code is open source, and they work closely with the OCaml community to develop the language and its tools.&lt;/p&gt;
&lt;p&gt;Other companies that use OCaml include &lt;a href=&quot;https://ahrefs.com&quot;&gt;Ahrefs&lt;/a&gt;, an all-in-one SEO tool; &lt;a href=&quot;https://www.nitrokey.com&quot;&gt;Nitrokey&lt;/a&gt;, a world-leading provider of open-source security hardware; and &lt;a href=&quot;https://hyper.systems&quot;&gt;Hyper&lt;/a&gt;, who use OCaml to provide their customers with a unified data platform to manage large infrastructure. There are also two blockchains written in OCaml: &lt;a href=&quot;https://tezos.foundation/&quot;&gt;Tezos&lt;/a&gt; and &lt;a href=&quot;https://minaprotocol.com/&quot;&gt;Mina&lt;/a&gt;. When it comes to the modern landscape of software development, it is safe to say OCaml has an ever-growing part to play.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The Takeaway&lt;/em&gt; : Several top companies are already using OCaml, so there is a strong tradition of successfully using OCaml on an industrial level.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#2-ocaml-has-a-growing-and-thriving-community&quot; aria-label=&quot;2 ocaml has a growing and thriving community permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2. OCaml Has a Growing and Thriving Community&lt;/h3&gt;
&lt;p&gt;The open-source community surrounding OCaml is diverse and flourishing. It congregates in several places online, like the &lt;a href=&quot;https://discuss.ocaml.org&quot;&gt;Discuss forum&lt;/a&gt;, &lt;a href=&quot;https://github.com/ocaml&quot;&gt;GitHub repo&lt;/a&gt;, and &lt;a href=&quot;https://www.reddit.com/r/ocaml/&quot;&gt;Reddit community&lt;/a&gt;. Thanks to its increasing popularity, more and more &lt;a href=&quot;https://ocaml.org/docs&quot;&gt;tutorials and documentation&lt;/a&gt; are becoming available online. Learning new languages with the help of online material is the trend nowadays, and OCaml welcomes all developers with open arms. In fact, there is a great book for learning OCaml &lt;a href=&quot;https://www.cambridge.org/core/books/real-world-ocaml-functional-programming-for-the-masses/052E4BCCB09D56A0FE875DD81B1ED571&quot;&gt;entirely available online&lt;/a&gt; called &lt;em&gt;Real World OCaml&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Over thirty universities currently teach OCaml, including the University of Cambridge, Paris-Diderot University, the Indian Institute of Technology Madras, Harvard, and Cornell University. Cornell University has a &lt;a href=&quot;https://www.cs.cornell.edu/courses/cs3110/2022fa/&quot;&gt;great textbook&lt;/a&gt; on OCaml. Students who learn OCaml often end up becoming part of its open-source community, contributing to projects and launching initiatives of their own. Companies that use OCaml to provide their customers with great products also contribute to the OCaml community, as do academics, researchers, and hobbyists. All entry-points contribute to the development of the language, and users end up interacting with each other across these categories, each bringing their own unique perspective.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The Takeaway&lt;/em&gt; : The community surrounding OCaml is vibrant and thriving, allowing you to invest your time and energy in OCaml knowing it&amp;rsquo;s here to stay.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#3-ocaml-offers-powerful-tools-and-plenty-of-support&quot; aria-label=&quot;3 ocaml offers powerful tools and plenty of support permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3. OCaml Offers Powerful Tools and Plenty of Support&lt;/h3&gt;
&lt;p&gt;OCaml is not only an industrial-strength programming language, but it also provides industry-ready tooling and ecosystem support. The OCaml Platform is a curated set of tools that have broad community support. It includes all the tools you'd expect from an industrial-strength programming language, including a build system, package manager, editor support, and documentation generator. The OCaml Platform tells you whether one of these tools is active, under incubation, or deprecated. The OCaml Platform ensures that developers not only have an excellent language at hand but also have the tools to productively develop software with that language. Furthermore, the OCaml website has thorough resources on everything OCaml, including a comprehensive &lt;a href=&quot;https://ocaml.org/docs/up-and-running#setting-up-development-tools&quot;&gt;guide to setting up OCaml on your computer&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The OCaml compiler is regularly updated and has a dedicated team focused on innovation, improving new features, and keeping everything bug-free. If you have a problem or need help, the response time across the various OCaml forums is very quick and supportive of new learners. Recently, the aforementioned great and comprehensive book &lt;a href=&quot;https://www.cambridge.org/core/books/real-world-ocaml-functional-programming-for-the-masses/052E4BCCB09D56A0FE875DD81B1ED571&quot;&gt;Real World OCaml&lt;/a&gt; has been updated for its 2nd edition. This edition is available to download online as a free PDF to make learning OCaml even &lt;a href=&quot;https://tarides.com/blog/2022-10-14-real-world-ocaml-book-giveaway&quot;&gt;more accessible.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;If you want to create something new in OCaml, or need help building something, there are several companies as well as hobbyist groups to consult. You can find like-minded people to discuss your ideas with on the &lt;a href=&quot;https://discuss.ocaml.org&quot;&gt;OCaml forum &lt;em&gt;Discuss&lt;/em&gt;&lt;/a&gt;. Tarides is one of the companies that regularly work on OCaml, so you can &lt;a href=&quot;https://tarides.com/company&quot;&gt;send us a message&lt;/a&gt; if you&amp;rsquo;d like help with a project.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The Takeaway&lt;/em&gt; : OCaml offers several up-to-date tools supported by an active group of contributors and maintainers. Using OCaml means getting help fast and having a complete developer environment with everything you need.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#4-ocaml-is-secure-by-design&quot; aria-label=&quot;4 ocaml is secure by design permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;4. OCaml is Secure-By-Design&lt;/h3&gt;
&lt;p&gt;In today&amp;rsquo;s connected world, keeping yourself and your data safe online is not just a matter of convenience, but it's also a crucial task that can have serious personal and professional repercussions. Luckily, the OCaml programming language is built in a way that promotes safety, including features and design patterns that make it secure-by-design. It's easy to integrate formally verified code with OCaml programs, which makes OCaml more secure. Some formally verified libraries available in OCaml include &lt;a href=&quot;https://hacl-star.github.io/&quot;&gt;Microsoft's HACL*&lt;/a&gt; and &lt;a href=&quot;https://news.mit.edu/2019/fiat-cryptography-chrome-android-0617&quot;&gt;MIT's Fiat&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Secure-by-design is a known programming term which means that a language is constructed in a way that fundamentally promotes security and minimises vulnerabilities. A language that is secure-by-design makes it impossible to introduce a large class of security vulnerabilities into programs written using that language. A great example of how secure-by-design principles are implemented in OCaml is its type and memory safety, which prevents the most frequent kinds of attacks and crashes from ever happening.&lt;/p&gt;
&lt;p&gt;Memory-safety attacks are extremely common, with approximately 70% of zero-day attacks being &lt;a href=&quot;https://www.itpro.co.uk/security/zero-day-exploit/360447/why-zero-day-exploits-are-surging-on-an-unprecedented-scale&quot;&gt;memory-safety attacks&lt;/a&gt;. OCaml is memory safe because it doesn&amp;rsquo;t allow a pointer (the designator of the information being written into memory) to enter information into an unauthorised memory block. As a result, you can&amp;rsquo;t make a program crash with OCaml by manipulating where it writes code into memory, as OCaml simply does&amp;rsquo;t allow this to happen. This prevents programs crashing due to memory exploits, including buffer overflows, where memory is &amp;lsquo;tricked&amp;rsquo; into writing more than the block &amp;lsquo;allows.&amp;rsquo;&lt;/p&gt;
&lt;p&gt;OCaml is also statically-typed and type-safe, meaning that it detects errors at compile time and completely stops programs with defects from running, as well as limits what type of operations can be performed on which kinds of data. Both work to remove bugs and errors from the code, making programs written in OCaml more reliable and consistent.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The Takeaway&lt;/em&gt; : Cybersecurity is an increasing area of concern, and OCaml has several built-in features that help make it secure-by-design. It&amp;rsquo;s an excellent choice for projects where security is paramount.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#5-ocaml-is-big-on-performance-and-developer-productivity&quot; aria-label=&quot;5 ocaml is big on performance and developer productivity permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5. OCaml is Big on Performance and Developer Productivity&lt;/h3&gt;
&lt;p&gt;OCaml is hailed for striking a balance between a large number of advanced features and performance. For example, it has a very efficient compiler that&amp;rsquo;s divided into two parts: a bytecode compiler and a native compiler. The bytecode compiler is very quick and generates small, portable executables. The native code compiler produces highly-efficient machine code.&lt;/p&gt;
&lt;p&gt;Since OCaml also allows for some uses of imperative and object-oriented programming features, it&amp;rsquo;s possible to use them in places where they can help with performance. This flexibility of programming paradigms is another way that OCaml helps programmers increase the speed and efficiency of the code they write.&lt;/p&gt;
&lt;p&gt;Type inference allows the language to infer what type is being used, removing the need for the developer to annotate every single variable in their code. This makes developing in OCaml faster than many other languages that lack type inference. OCaml also allows the developer to write complex algorithms without introducing bugs. The developer can easily optimise algorithms for greater speed without compromising performance and security. Furthermore, the presence and use of algebraic data types, higher order functions, and immutable data all make manipulating large and complex data structures much easier and faster.&lt;/p&gt;
&lt;p&gt;It is also worth noting that OCaml offers several strong methods for debugging its programs. From the fast, interactive, REPL to the powerful symbolic replay debugger, OCaml lets you eliminate bugs at compile time and avoid them at runtime. This, in combination with how effective the debugging programs are, makes OCaml an easy language to debug. This saves developer time and increases the productivity and speed of programming.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The Takeaway&lt;/em&gt; : The OCaml language is strong on performance and has a lot of features that make the code run fast, while also making the development process more efficient.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#6-ocaml-is-multicore&quot; aria-label=&quot;6 ocaml is multicore permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;6. OCaml is Multicore!&lt;/h3&gt;
&lt;p&gt;With the imminent release of OCaml 5, the language will support the use of multiple cores and have enhanced infrastructure in place for concurrent programming. Both bring significant performance boosts, allowing users to increase the speed of their programs.&lt;/p&gt;
&lt;p&gt;The new I/O library Eio can serve more than one million requests per second, outperforming Go&amp;rsquo;s &lt;code&gt;net/http&lt;/code&gt; and closely matching Rust&amp;rsquo;s &lt;code&gt;hyper&lt;/code&gt;. Writing concurrent code will also be much easier in OCaml 5, just like writing regular OCaml. The &amp;lsquo;function colouring problem,&amp;rsquo; whereby concurrent and non-concurrent code are incompatible, will also be a thing of the past after the new release. With OCaml 5, both kinds of code can coexist with minimal intervention on the part of the programmer.&lt;/p&gt;
&lt;p&gt;Multicore or parallel programming increases the efficiency of a program by several orders of magnitude. By letting the computer use more than one core to execute the code, the program can do several things simultaneously rather than consecutively. For complex tasks that take a long time, Multicore revolutionises their applicability, making them more realistic and time-efficient alternatives.&lt;/p&gt;
&lt;p&gt;You can look forward to more posts on the &lt;a href=&quot;https://tarides.com/blog&quot;&gt;Tarides blog&lt;/a&gt; about OCaml 5, the technology behind it, and its use cases.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The Takeaway&lt;/em&gt; : OCaml 5 is coming, and with it, Multicore. OCaml will become even more powerful, both for parallel programming and concurrent programming, allowing users to significantly boost the speed of their projects.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Choosing the perfect programming language for you is an important but difficult task. It needs to be powerful and guarantee performance while simultaneously offering strong security features. Developers are also going to need state-of-the-art tools alongside responsive help and support. OCaml is a good candidate that offers all of the above, making it great for businesses looking for a versatile and robust programming language.&lt;/p&gt;
&lt;p&gt;Combining the power of functional programming, Multicore, and open source, OCaml offers a potent mix of strong features and an engaged community. For more information about OCaml, you can visit the &lt;a href=&quot;https://ocaml.org/about&quot;&gt;OCaml Website&lt;/a&gt; or &lt;a href=&quot;https://tarides.com/company&quot;&gt;contact Tarides&lt;/a&gt; to see how we can make OCaml work for you.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-11-22-six-surprising-reasons-the-ocaml-programming-language-is-good-for-business</id><title type="text">Six Surprising Reasons the OCaml Programming Language is Good for Business</title><updated>2022-11-22T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-11-16-ocaml-5-at-open-source-india-2022" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#open-source-india-2022&quot; aria-label=&quot;open source india 2022 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Open Source India 2022&lt;/h1&gt;
&lt;p&gt;With OCaml 5 just around the corner, it's been a really exciting year to attend conferences all over the world. Just recently, I presented some highlights of the OCaml 5 update, building on &lt;a href=&quot;https://www.youtube.com/watch?v=zJ4G0TKwzVc&quot;&gt;KC Sivaramakrishnan's great keynote address&lt;/a&gt; at the 19th annual &lt;a href=&quot;http://opensourceindia.in&quot;&gt;Open Source India 2022&lt;/a&gt; conference. Since Tarides was invited to participate, I gave a talk on &lt;em&gt;OCaml 5: Language, Platform, and Ecosystem&lt;/em&gt; by starting with OCaml's history and ending with a Multicore OCaml matrix implementation running on 120 cores!&lt;/p&gt;
&lt;p&gt;Open Source India was held on the 29-30th September 2022 as a physical event at the NIMHANS Convention Centre, Bengaluru, India. It was organised by the &lt;a href=&quot;https://www.opensourceforu.com/&quot;&gt;Open Source For You&lt;/a&gt; magazine team in India, with the help of community and industry participation. The conference ran along multiple parallel &amp;quot;tracks&amp;quot; - FOSS for Everyone, Developers, CXO Summit, DevOps, AI &amp;amp; ML, Data Management, and IT Infrastructure. My talk was part of the Developers track on the second day.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#day-i&quot; aria-label=&quot;day i permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Day I&lt;/h2&gt;
&lt;p&gt;The conference had many exhibits, and I interacted with a number of participants at the booths. &lt;a href=&quot;https://www.mosip.io/&quot;&gt;MOSIP&lt;/a&gt; is an open source platform for national foundational identities. Some Governments implement a digital identity system for its citizens, and MOSIP provides a robust, scalable, open source platform for governance. While they currently use &lt;a href=&quot;https://github.com/mosip/registration/blob/master/db_scripts/README.md&quot;&gt;PostgreSQL&lt;/a&gt; as their database backend, it would be useful to re-model their backend to use &lt;a href=&quot;https://irmin.io/&quot;&gt;Irmin&lt;/a&gt; as the data store for security reasons.&lt;/p&gt;
&lt;p&gt;Another Business-to-Consumer (B2C), open-source software application was &lt;a href=&quot;https://www.chatwoot.com/&quot;&gt;Chatwoot&lt;/a&gt;, a customer engagement and support platform that also uses PostgreSQL. It would be an interesting data modeling or solution architect project to implement Irmin support for their chat application. The &lt;a href=&quot;https://www.umwelten.xyz/dwelling/&quot;&gt;Compossible Umwelten&lt;/a&gt; company are working on wearable computing using ARM processors, and they were interested in exploring using OCaml, instead of C, for their customer products.&lt;/p&gt;
&lt;p&gt;Post-lunch, I attended a talk on &lt;em&gt;Open Source at AWS&lt;/em&gt; by Suman Debnath, Principal Developer Advocate, Data Engineering and Analytics at Amazon Web Services. We had the opportunity to discuss the possibility of providing the OCaml Platform and Products available through Amazon directly to end users.&lt;/p&gt;
&lt;p&gt;In the afternoon, I took the time to attend the AI &amp;amp; ML track. The &lt;em&gt;Adopting MLSecOps&lt;/em&gt; talk was presented by Dibya Prakash, CTO and Principal Consultant at Neural Hub, and he introduced me to MLSecOps and best practices in the industry. This was followed by a talk on &lt;em&gt;Time Series Analysis: Anticipating Future with Darts&lt;/em&gt; by Binitha MT and Subhankar Adak from Dell. It was an interesting first day at the conference with useful discussions on technology and real world experiences.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#day-ii&quot; aria-label=&quot;day ii permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Day II&lt;/h2&gt;
&lt;p&gt;In the morning, I spent some time at the speaker's lounge reviewing the slides for OCaml 5, as well as setting up the demo for the Multicore OCaml code examples. I also had the chance to meet my colleague, Puneeth Chaganti, who works remotely from Bengaluru.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/b6202cc9d8a0ef2a09c993ece992a258/80e3c/Vf8n4at.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQGAf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAFnFFYoiZD/xAAaEAEBAAIDAAAAAAAAAAAAAAACAQASBBMh/9oACAEBAAEFAt7ld6zZryFTlThK8//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABoQAAICAwAAAAAAAAAAAAAAAAABAiEREjH/2gAIAQEABj8CNi7EiSTwjp//xAAbEAEAAgIDAAAAAAAAAAAAAAABABEhUTFBcf/aAAgBAQABPyF2r5MG5vceKW2SprBG4pCgxE7p/9oADAMBAAIAAwAAABBMD//EABURAQEAAAAAAAAAAAAAAAAAAAEA/9oACAEDAQE/EBJv/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEB/9oACAECAQE/EImv/8QAGxABAQADAAMAAAAAAAAAAAAAAREAITFBYdH/2gAIAQEAAT8QHzTWQYZyJb2h5THM1OFuKLQIe3RllJlNYp9mSiE9u8//2Q=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/b6202cc9d8a0ef2a09c993ece992a258/7bf67/Vf8n4at.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Puneeth and Shakthi&quot; title=&quot;&quot; srcset=&quot;/static/b6202cc9d8a0ef2a09c993ece992a258/651be/Vf8n4at.jpg 170w,
/static/b6202cc9d8a0ef2a09c993ece992a258/d30a3/Vf8n4at.jpg 340w,
/static/b6202cc9d8a0ef2a09c993ece992a258/7bf67/Vf8n4at.jpg 680w,
/static/b6202cc9d8a0ef2a09c993ece992a258/80e3c/Vf8n4at.jpg 720w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;That afternoon, I gave my talk on &lt;em&gt;OCaml 5: Language, Platform, and Ecosystem&lt;/em&gt;. After reviewing OCaml's history, I discussed the recent &lt;a href=&quot;https://github.com/ocaml/ocaml/pull/10831&quot;&gt;Multicore OCaml merge&lt;/a&gt;, then delved into the syntax of the OCaml 5 language: basic types, operations, control structures, data structures, user types, functions, recursion, and I/O. Following this, I showed examples of &lt;a href=&quot;https://github.com/ocaml-multicore/domainslib&quot;&gt;domainslib&lt;/a&gt; and &lt;a href=&quot;https://github.com/ocaml-multicore/eio&quot;&gt;Eio&lt;/a&gt; before demonstrating the impressive Multicore OCaml matrix implementation running on 120 cores!&lt;/p&gt;
&lt;p&gt;Additionally, I presented the various platform tools available in the OCaml community, including the &lt;a href=&quot;http://opam.ocaml.org/&quot;&gt;OCaml package manager (opam)&lt;/a&gt;, the &lt;a href=&quot;https://dune.build/&quot;&gt;Dune&lt;/a&gt; build system, &lt;a href=&quot;https://ocaml.github.io/odoc/&quot;&gt;odoc&lt;/a&gt;, &lt;a href=&quot;https://github.com/ocaml/ocaml-lsp&quot;&gt;OCaml-LSP&lt;/a&gt;, &lt;a href=&quot;https://ocaml.github.io/merlin/&quot;&gt;Merlin&lt;/a&gt;, and &lt;a href=&quot;https://github.com/realworldocaml/mdx&quot;&gt;MDX&lt;/a&gt;. I also introduced the following ecosystem projects:  &lt;a href=&quot;https://github.com/ocaml-bench/sandmark&quot;&gt;Sandmark&lt;/a&gt; benchmarking suite, &lt;a href=&quot;https://tezos.com/&quot;&gt;Tezos&lt;/a&gt; blockchain, &lt;a href=&quot;https://irmin.io/&quot;&gt;Irmin&lt;/a&gt; database, &lt;a href=&quot;https://mirageos.org/&quot;&gt;MirageOS&lt;/a&gt; library operating system, &lt;a href=&quot;https://aantron.github.io/dream/&quot;&gt;Dream&lt;/a&gt; web framework, and &lt;a href=&quot;https://ocaml.xyz/&quot;&gt;OCaml Scientific Computing&lt;/a&gt; project. I finished my talk with some useful references for OCaml. To my delight, the participants were curious to learn more!&lt;/p&gt;
&lt;p&gt;The conference gave me a great opportunity to reach out to developers and make them aware of the current state of OCaml. It was good to share the platform and ecosystem projects with them so that they can get started with their contributions. I look forward to participating in more conferences and promoting the use of OCaml!&lt;/p&gt;</content><id>https://tarides.com/blog/2022-11-16-ocaml-5-at-open-source-india-2022</id><title type="text">OCaml 5 at Open Source India 2022</title><updated>2022-11-16T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-11-15-presenting-on-algebraic-effects-at-fp-syd" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;At ICFP this year, &lt;a href=&quot;https://kcsrk.info/&quot;&gt;KC Sivaramakrishnan&lt;/a&gt; gave two talks that put OCaml 5 in the spotlight: his &lt;a href=&quot;https://youtu.be/6BhmRz7eqiE&quot;&gt;keynote&lt;/a&gt;, &amp;ldquo;Retrofitting Concurrency - Lessons from the Engine Room,&amp;rdquo; and the &lt;a href=&quot;https://speakerdeck.com/kayceesrk/ocaml-5-dot-0&quot;&gt;opening presentation&lt;/a&gt; of the OCaml workshop, &amp;ldquo;OCaml 5.0 - Concurrent and Parallel Programming.&amp;rdquo; &lt;em&gt;Effect Handlers&lt;/em&gt; feature heavily, as they are the foundations on which concurrency primitives were added to OCaml. Since I knew very little about &lt;em&gt;effects&lt;/em&gt; in this context, I asked KC for some pointers on where to start with learning about them. He pointed me to the &lt;a href=&quot;https://koka-lang.github.io&quot;&gt;Koka programming language&lt;/a&gt;, encouraging me to set it up, play with it, and see how its type systems work with effects and effect handlers.&lt;/p&gt;
&lt;p&gt;Following the usual tradition of learning something by committing to give a talk on it, I signed up to speak about &lt;em&gt;algebraic effects&lt;/em&gt; at my local functional programming meetup, &lt;a href=&quot;https://www.meetup.com/FP-Syd/&quot;&gt;FP-SYD&lt;/a&gt;. I figured that I would have a friendly audience that would be forgiving of excessive hand waving! :)&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#brain-food&quot; aria-label=&quot;brain food permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Brain Food&lt;/h3&gt;
&lt;p&gt;I had an absolute blast learning about &lt;em&gt;algebraic effects&lt;/em&gt;! Koka was really easy to install and use. Its rich set of examples and excellent documentation make it work really well as a place to explore the concepts of effect systems.&lt;/p&gt;
&lt;p&gt;That got me started, but what really hooked me was discovering Andrej Bauer&amp;rsquo;s paper, &lt;em&gt;What is Algebraic about Algebraic Effects and Handlers.&lt;/em&gt; As a mathematician, I found it to be an accessible way of getting to the topic's theoretical underpinnings (see &lt;a href=&quot;https://github.com/yallop/effects-bibliography#2018&quot;&gt;here&lt;/a&gt; for the paper and videos). Next, Matija Pretnar&amp;rsquo;s &lt;a href=&quot;http://www.eff-lang.org/handlers-tutorial.pdf&quot;&gt;tutorial&lt;/a&gt;, &lt;em&gt;An Introduction to Algebraic Effects and Handlers,&lt;/em&gt; complimented Bauer's work really well.&lt;/p&gt;
&lt;p&gt;As I learned more about the topic, I realised just how deep an area this is, and I realised how little I would know about it in four weeks of enthusiastic (but decidedly surface-level) reading. So, I decided to pitch the talk as an overview or a survey of the field. To make things concrete, I would also focus on examples from the effect handling systems of Koka and OCaml 5.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-talk&quot; aria-label=&quot;the talk permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Talk&lt;/h3&gt;
&lt;p&gt;October&amp;rsquo;s FP-SYD was on the 19th. Around 6pm in Sydney&amp;rsquo;s Central Business District, about twenty people showed up, ate pizza, and settled into general functional programming-related geekery. Haskell is very strongly represented in this community, and it turned out that most of the audience had not spent much time with effect systems, as their tools for working with effects have been Monads, Monad Transformers, and accompanying abstractions.&lt;/p&gt;
&lt;p&gt;I enjoyed talking through what I had learned about Algebraic Effects. Since I've worked on Haskell teams, I connected with the community on the various ways  computational effects are handled between pure and impure functional languages. It was great to reference Alexis King's recent work that resulted in delimited continuations &lt;a href=&quot;https://github.com/ghc-proposals/ghc-proposals/blob/master/proposals/0313-delimited-continuation-primops.rst&quot;&gt;being added to GHC.&lt;/a&gt; The examples from Koka helped give folks a taste for the type systems that include effects and values. I also leaned on the excellent work of KC and the Tarides team, borrowing heavily from the material they have written on effect handlers for the OCaml manual.&lt;/p&gt;
&lt;p&gt;The talk certainly delivered, as it got me started on the vast topic of &lt;em&gt;algebraic effects&lt;/em&gt;. It also piqued the curiosity of at least a few people in my community, so that&amp;rsquo;s not nothing! :)&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#acknowledgements&quot; aria-label=&quot;acknowledgements permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Acknowledgements&lt;/h3&gt;
&lt;p&gt;I am particularly grateful to KC for getting me curious and giving me material and inspiration to get started. Thanks also to Sudha Parimala for putting together a comprehensive tutorial on parallelism and effects in OCaml and for answering questions and making helpful suggestions.  My colleague and friend Tim McGilchrist runs the FP-SYD meetup, so he helped by asking a lot of really good questions, listening to a draft version of the talk, and generally providing support and encouragement. Thanks, Tim! :)&lt;/p&gt;
&lt;p&gt;The slides of my talk are available on the FP-SYD &lt;a href=&quot;https://github.com/fp-syd/meetings/blob/master/2022/2022-10-Keswani-Algebraic-Effects-Survey.pdf&quot;&gt;repository&lt;/a&gt;.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-11-15-presenting-on-algebraic-effects-at-fp-syd</id><title type="text">Presenting on Algebraic Effects at FP-SYD</title><updated>2022-11-15T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-11-10-towards-minimal-disk-usage-for-tezos-bakers" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Over the last few months, Tarides has focused on designing,
prototyping, and integrating a new feature for Tezos bakers: automatic
context pruning for rolling and full nodes. This feature will allow
bakers to run Tezos with minimal disk usage while continuing to enjoy
&lt;a href=&quot;https://tarides.com/blog/2022-04-26-lightning-fast-with-irmin-tezos-storage-is-6x-faster-with-1000-tps-surpassed&quot;&gt;12x more responsive operations&lt;/a&gt;. The first version has been
released with &lt;a href=&quot;https://forum.tezosagora.org/t/octez-v15-0-has-been-released&quot;&gt;Octez v15&lt;/a&gt;. The complete, more optimised context pruning
feature will come with Octez v16. We encourage every Tezos baker to
upgrade and give feedback.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;We have implemented context pruning for rolling and full nodes, which
requires ~35GB of disk for storing 6 cycles in the upper layer. In
Octez v15, each subsequent pruning run needs an additional 40GB, but
that space is recovered when the operation finishes. We plan to remove
that extra requirement in Octez v16.&lt;/em&gt;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#improve-space-usage-with-context-pruning&quot; aria-label=&quot;improve space usage with context pruning permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Improve Space Usage with Context Pruning&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&quot;https://tarides.com/feed.xml&quot;&gt;Tezos context&lt;/a&gt; is a versioned key/value store that associates for
each block a view of its ledger state. The versioning uses concepts
similar to Git. The current implementation is using &lt;a href=&quot;https://tarides.com/feed.xml&quot;&gt;irmin&lt;/a&gt; as
backend and abstracted by the &lt;a href=&quot;https://tarides.com/feed.xml&quot;&gt;lib_context&lt;/a&gt; library.&lt;/p&gt;
&lt;p&gt;We have been designing, prototyping, and integrating a new structure
for Irmin storage. It is now reorganised into two
layers: one upper layer that contains the latest cycles of the
blockchain, which are still in use, and a lower layer containing
older, frozen data. A new garbage collection feature (GC) periodically
restructures the Tezos context by removing unused data in the oldest
cycles from the upper layer, where only the data still accessible from
the currently live cycles are preserved. The first version of the GC,
available in Octez-v15, is optimised for rolling and full nodes and
thus does not contain a lower layer. We plan to extend this feature in
Octez-v17 to dramatically improve the archive nodes' performance by
moving the unused data to the lower layer (more on this below).&lt;/p&gt;
&lt;p&gt;Garbage collection and subsequent compression of live data improves
disk and kernel cache performance, which enhances overall node
performance. Currently, rolling nodes operators must apply a
manual cleanup process to release space on the disk by discarding
unused data. The manual cleanup is tedious and error-prone. Operators
could discard valuable data, have to stop their baker, or try to devise
semi-automatic procedures and run multiple bakers to avoid
downtime. The GC feature provides rolling nodes operators
a fully automated method to clean up the unused data and guarantees
that only the unused data is discarded, i.e., &lt;em&gt;all&lt;/em&gt; currently used data
is preserved.&lt;/p&gt;
&lt;p&gt;The GC operation is performed asynchronously with minimal impact on
the Tezos node. In the rolling node's case, a GC'd context uses less
disk space and has a more stable performance throughout,
as the protocol operations (such as executing smart contracts or
computing baking rewards) only need data from the upper layer. As
such, the nodes that benefit from the store's layered structure don't
need to use the manual snapshot export/import&amp;mdash;previously necessary when
the disk&amp;rsquo;s context got too big. In the future, archive nodes&amp;rsquo;
performance will improve because only the upper layer is needed to
validate recent blocks. &lt;em&gt;This means archive nodes can bake as reliably
as rolling nodes.&lt;/em&gt;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#tezos-storage-in-a-nutshell&quot; aria-label=&quot;tezos storage in a nutshell permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Tezos Storage, in a Nutshell&lt;/h2&gt;
&lt;p&gt;The Tezos blockchain uses &lt;a href=&quot;https://tarides.com/feed.xml&quot;&gt;Irmin&lt;/a&gt; as the main storage component. Irmin
is a library to design Git-like storage systems. It has many backends,
and one of them is &lt;a href=&quot;https://tarides.com/feed.xml&quot;&gt;&lt;code&gt;irmin-pack&lt;/code&gt;&lt;/a&gt;, which is optimised for the Tezos use
case. In the followings, we focus on the main file used to store
object data: the store &lt;code&gt;pack&lt;/code&gt; file.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Pack file:&lt;/strong&gt; Tezos state is serialised as immutable functional objects.
These objects are marshalled in a append-only &lt;code&gt;pack&lt;/code&gt; file, one after the
other. An object can contain pointers to the file's earlier (but not
later!) objects. Pointers to an earlier object are typically
represented by the offset (position) of the earlier object in the
&lt;code&gt;pack&lt;/code&gt; file. The &lt;code&gt;pack&lt;/code&gt; file is append-only: existing objects are
never updated.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/3f9db58c8c913ffba792f0457ff4845e/d3deb/J7N0pil.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 15.294117647058824%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAWElEQVR42p2KQQrAIAwE/f8LvakJmmM9CRV1SwJC21PpwpBhs26thS/svLs5B/pBOCubu/v4b3qrGL2ZOxFBjBFEhJSSsT2E8OgV3TKzXf0r3nsUEeSccQHjT+dIi6J8tQAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/3f9db58c8c913ffba792f0457ff4845e/c5bb3/J7N0pil.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;J7N0pil&quot; title=&quot;&quot; srcset=&quot;/static/3f9db58c8c913ffba792f0457ff4845e/04472/J7N0pil.png 170w,
/static/3f9db58c8c913ffba792f0457ff4845e/9f933/J7N0pil.png 340w,
/static/3f9db58c8c913ffba792f0457ff4845e/c5bb3/J7N0pil.png 680w,
/static/3f9db58c8c913ffba792f0457ff4845e/b12f7/J7N0pil.png 1020w,
/static/3f9db58c8c913ffba792f0457ff4845e/b5a09/J7N0pil.png 1360w,
/static/3f9db58c8c913ffba792f0457ff4845e/d3deb/J7N0pil.png 1758w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;An Irmin &lt;code&gt;pack&lt;/code&gt; file as a sequence of objects: | obj | obj | obj | ...&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Commit objects:&lt;/strong&gt; Some of the objects in the &lt;code&gt;pack&lt;/code&gt; file are commit
objects. A commit, together with the objects reachable from that
commit, represents the state associated to a Tezos' block.  The
Tezos node only needs the last commit to process new blocks, but
bakers will need a lot more commits to compute baking rewards.
Objects not reachable from these commits can are unreachable or dead
objects.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/ecda34b084e8e0384500bf41aaf273f3/bdcd6/DQJJLll.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 95.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAATABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB91IdAYhWxH//xAAXEAADAQAAAAAAAAAAAAAAAAAAECFB/9oACAEBAAEFAnCPD//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABQQAQAAAAAAAAAAAAAAAAAAADD/2gAIAQEABj8CH//EABwQAAIBBQEAAAAAAAAAAAAAAAABMRARIUFRgf/aAAgBAQABPyFyWfRQS2ehRgUM63T/2gAMAwEAAgADAAAAENAHvv/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EAB0QAQACAQUBAAAAAAAAAAAAAAEAESExQVFxkWH/2gAIAQEAAT8QAgGumZsL1hoDr3caZF+LZfH2ytaIfZrrbF3jg3cDNw7Z/9k='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/ecda34b084e8e0384500bf41aaf273f3/7bf67/DQJJLll.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;DQJJLll&quot; title=&quot;&quot; srcset=&quot;/static/ecda34b084e8e0384500bf41aaf273f3/651be/DQJJLll.jpg 170w,
/static/ecda34b084e8e0384500bf41aaf273f3/d30a3/DQJJLll.jpg 340w,
/static/ecda34b084e8e0384500bf41aaf273f3/7bf67/DQJJLll.jpg 680w,
/static/ecda34b084e8e0384500bf41aaf273f3/990cb/DQJJLll.jpg 1020w,
/static/ecda34b084e8e0384500bf41aaf273f3/c44b8/DQJJLll.jpg 1360w,
/static/ecda34b084e8e0384500bf41aaf273f3/bdcd6/DQJJLll.jpg 1662w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The data-structure (mental model) representation of the &lt;code&gt;pack&lt;/code&gt; file vs. its physical representation.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Archive nodes and rolling nodes:&lt;/strong&gt; There are different types of
Tezos nodes. An archive node stores the complete blockchain
history from the genesis block. Currently, this is over &lt;em&gt;2 million&lt;/em&gt;
blocks. Roughly speaking, a block corresponds to a commit. A
rolling node stores only the last &lt;em&gt;n&lt;/em&gt; blocks, where &lt;em&gt;n&lt;/em&gt; is chosen
to keep the total disk usage within some bounds. This may be as small
as 5 (or even less) or as large as 40,000 or more. Another type of
node is the &amp;quot;full node,&amp;quot; which is between an archive node and a
rolling node.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Rolling nodes, disk space usage:&lt;/strong&gt; The purpose of the rolling node
is to keep resource usage, particularly disk space, bounded by only
storing the last blocks. However, the current implementation does
not achieve this aim. As rolling nodes execute, the &lt;code&gt;pack&lt;/code&gt; file
grows larger and larger, and no old data is discarded. To get around
this problem, node operators periodically export snapshots of the
current blockchain state from the node, delete the old data,
and then import the snapshot state back.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Problem summary:&lt;/strong&gt; The main problem we want to avoid is Tezos users
having to periodically export and import the blockchain state to
keep the disk usage of the Tezos node bounded. Instead, we want to
perform context pruning via automatic garbage collection of unreachable
objects. Periodically, a commit should be chosen as the GC
root, and objects constructed before the commit that are not
reachable from the commit should be considered dead branches, removed from
the &lt;code&gt;pack&lt;/code&gt; store, and the disk space reclaimed. The problem is that
with the current implementation of the &lt;code&gt;pack&lt;/code&gt; file, which is just an
ordinary file, it is impossible to &amp;quot;delete&amp;quot; regions corresponding to
dead objects and reclaim the space.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#automatised-garbage-collection-solution&quot; aria-label=&quot;automatised garbage collection solution permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Automatised Garbage Collection Solution&lt;/h2&gt;
&lt;p&gt;Consider the following &lt;code&gt;pack&lt;/code&gt; file, where the &lt;code&gt;GC-commit&lt;/code&gt; object has
been selected as the commit root for garbage collection:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/6ec700aa3bc32bb9faa417d7c414e6e4/668c6/ySiXa1r.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 28.235294117647058%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAqElEQVR42p1Q0QqDMAzs/3+iMOrQ2VYdzHZNo8XeaHHDbS9zgeOSS3KBCPwYaeNrmHC2GiHOr14ME3g8YbEGAgeDFsbobx/XVvBksEY6bhhjRAjhS5+ZkVL6z5ACbW9IO0NCSisEM5eLexARvPclz2ytLZz1YRigjUHe80Sl55yDVhfcnYNQSsEY84astW1b8q7rIKWE1rroVVVB1jX6vi/1E3m+aRo8ACET06M7C48pAAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/6ec700aa3bc32bb9faa417d7c414e6e4/c5bb3/ySiXa1r.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;ySiXa1r&quot; title=&quot;&quot; srcset=&quot;/static/6ec700aa3bc32bb9faa417d7c414e6e4/04472/ySiXa1r.png 170w,
/static/6ec700aa3bc32bb9faa417d7c414e6e4/9f933/ySiXa1r.png 340w,
/static/6ec700aa3bc32bb9faa417d7c414e6e4/c5bb3/ySiXa1r.png 680w,
/static/6ec700aa3bc32bb9faa417d7c414e6e4/b12f7/ySiXa1r.png 1020w,
/static/6ec700aa3bc32bb9faa417d7c414e6e4/b5a09/ySiXa1r.png 1360w,
/static/6ec700aa3bc32bb9faa417d7c414e6e4/668c6/ySiXa1r.png 1692w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Objects that precede the commit root are either reachable from the
commit (by following object references from it) or not. For the
unreachable objects, we want to reclaim the disk space. For reachable
objects, we need to be able to continue to access them via their
offset in the &lt;code&gt;pack&lt;/code&gt; file.&lt;/p&gt;
&lt;p&gt;The straightforward solution is to implement the &lt;code&gt;pack&lt;/code&gt; file using two
other data structures: the &lt;code&gt;suffix&lt;/code&gt; and the &lt;code&gt;prefix&lt;/code&gt;. The &lt;code&gt;suffix&lt;/code&gt;
file contains the root commit object (&lt;code&gt;GC-commit&lt;/code&gt;) and the live
objects represented by &lt;em&gt;all&lt;/em&gt; bytes following the offset of &lt;code&gt;GC-commit&lt;/code&gt;
in the &lt;code&gt;pack&lt;/code&gt; file. The &lt;code&gt;prefix&lt;/code&gt; file contains all the objects
reachable from the root commit, indexed by their offset. Note that the
reachable objects appear earlier in the &lt;code&gt;pack&lt;/code&gt; file than the root
commit.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/5ae9c879daf866bfd4791176a2e9e4d5/09262/QVeXtOB.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 37.05882352941176%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABFklEQVR42p2PzUvDQBBH8xcLHrx6VfDiUcSTBxERBPEoiOhBe7DQmrQx/di0Jtuk2iRtMds02SdJwHPrwGNYfsObHYMtSqOrPssi7NhmpFzcXCDjAeonrTLjP0I/87GUSVd1MZXFUDmgi1qo0X+Dm2rNxOZl9kY7btFK2lhRkzRyKNJ4ux+WtcoVrbCJGfQwp33epw7twGEWTyDPMZarJV7soTK10blf6YK7cYNz/4gbecCtPOZivM/j5Kw+OZpHtXBVC7XWFUVRVGRZVrFer1nME2SU8DDucRUecj3c4/R1h0uxy/P0pNyKIaWkY3UIw7AiCAI8z6sos/JdUmZCCEauy6Br8/kR0Dd9nu4biM4EKb7xpc8vcBETtk7nX+MAAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/5ae9c879daf866bfd4791176a2e9e4d5/c5bb3/QVeXtOB.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;QVeXtOB&quot; title=&quot;&quot; srcset=&quot;/static/5ae9c879daf866bfd4791176a2e9e4d5/04472/QVeXtOB.png 170w,
/static/5ae9c879daf866bfd4791176a2e9e4d5/9f933/QVeXtOB.png 340w,
/static/5ae9c879daf866bfd4791176a2e9e4d5/c5bb3/QVeXtOB.png 680w,
/static/5ae9c879daf866bfd4791176a2e9e4d5/b12f7/QVeXtOB.png 1020w,
/static/5ae9c879daf866bfd4791176a2e9e4d5/b5a09/QVeXtOB.png 1360w,
/static/5ae9c879daf866bfd4791176a2e9e4d5/09262/QVeXtOB.png 1896w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The layered structure of the &lt;code&gt;pack&lt;/code&gt; file with &lt;code&gt;prefix&lt;/code&gt;+&lt;code&gt;suffix&lt;/code&gt; as the upper layer.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Reading from the &lt;code&gt;pack&lt;/code&gt; file is then simulated in an obvious way: if
the offset is for the &lt;code&gt;GC-commit&lt;/code&gt;, or later, we read from the &lt;code&gt;suffix&lt;/code&gt;
file, and otherwise, we lookup the offset in the &lt;code&gt;prefix&lt;/code&gt; and return
the appropriate object. We only access the reachable objects in the
&lt;code&gt;prefix&lt;/code&gt; via their offset.  We replace the Irmin &lt;code&gt;pack&lt;/code&gt; file with
these two data structures. Every time we perform garbage collection
from a given &lt;code&gt;GC-commit&lt;/code&gt;, we create the next versions of the &lt;code&gt;prefix&lt;/code&gt;
and &lt;code&gt;suffix&lt;/code&gt; data-structures and &lt;em&gt;switch&lt;/em&gt; from the current version to the next
version by deleting the old &lt;code&gt;prefix&lt;/code&gt; and &lt;code&gt;suffix&lt;/code&gt; to reclaim
disk space. Creating the next versions of the &lt;code&gt;prefix&lt;/code&gt; and &lt;code&gt;suffix&lt;/code&gt;
data-structures is potentially expensive. Hence, we implement these steps in a
separate process, the &lt;em&gt;GC worker&lt;/em&gt;, with minimal impact on the running
Tezos node.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Caveat:&lt;/strong&gt; Following Git, a commit will typically reference its
parent commit, which will then reference its parent, and so
on. Clearly, if we used these references to calculate object
reachability, all objects would remain reachable forever. However,
this is not what we want, so when calculating the set of reachable
objects for a given commit, we ignore the references from a commit
to its parent commit.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-prefix-data-structure&quot; aria-label=&quot;the prefix data structure permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The &lt;code&gt;prefix&lt;/code&gt; Data-Structure&lt;/h2&gt;
&lt;p&gt;The &lt;code&gt;prefix&lt;/code&gt; is a persistent data-structure that implements a map from
the offsets in &lt;code&gt;pack&lt;/code&gt; file to objects (the marshalled bytes
representing an object). In our scenario, the GC worker creates the
&lt;code&gt;prefix&lt;/code&gt;, which is then read-only for the main process. Objects are
never mutated or deleted from the &lt;code&gt;prefix&lt;/code&gt; file. In this setting, a
straightforward implementation of an object store suffices: we store
reachable objects in a data file and maintain a persistent &lt;code&gt;(int &amp;rarr; int)&lt;/code&gt; map from &amp;quot;offset in the original &lt;code&gt;pack&lt;/code&gt; file&amp;quot; to &amp;quot;offset in the
&lt;code&gt;prefix&lt;/code&gt; file.&amp;quot;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Terminology:&lt;/strong&gt; We introduce the term &amp;quot;virtual offset&amp;quot; for &amp;quot;offset in
the original &lt;code&gt;pack&lt;/code&gt; file&amp;quot; and the term &amp;quot;real offset&amp;quot; for &amp;quot;offset in
the &lt;code&gt;prefix&lt;/code&gt; file.&amp;quot; Thus, the map outlining virtual offset to real
offset is made persistent as the &lt;code&gt;mapping&lt;/code&gt; file.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Example:&lt;/strong&gt; Consider the following, where the &lt;code&gt;pack&lt;/code&gt; file contains
reachable objects &lt;code&gt;o1&lt;/code&gt; .. &lt;code&gt;o10&lt;/code&gt;, (with virtual offsets &lt;em&gt;v1 .. v10&lt;/em&gt;, respectively):&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/b1a2c914473284ac9bb2b688a1852562/cb88c/JKWA4ff.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 54.70588235294118%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABbUlEQVR42qWPa0/iQBSG+f9/wq+bbKIkcmkkFpemUKTl0sSoi9poBRVhe8FeoLSPmWFN1A8m4puczMy5PPOeEj9QtErw0pBg/cIiCVitV5R2ARX/z6flgrPwjvOly8B3CF7C3YBvyosCNgXOfEKY+DL3cyBw+e+ay7i9OzAHvDznOcuIgIfgltvk9HvAoihkCMVJwiwM8aIIL0q4f3a4TrWvgW/Dn7XJMgzTpKaqtAd9jv7oKD0FY7nHXXq6Bb7//cNqeU4cxwRBwGw2434y4Wo8pm1ZaLbN0LnhzH1Ad3TM4BeD8PdHhwKaZZmE+L6P53kS5Lou0+kUx3FkLOZzlr5PsdmQxjGPk0fWabZd2bZtRqMRuq6jKAqaptHtdjEMg36/j2VZlMtlqtUqqqrSbDZpnpzQarXk/bBS4eBgn2O1wd/xBSUBEsVarSaBAiLenU6HXq9Ho9GgXq/LvAgBETXTNBkOh9KAmBUmRP8rxR8+zVOJxCgAAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/b1a2c914473284ac9bb2b688a1852562/c5bb3/JKWA4ff.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;JKWA4ff&quot; title=&quot;&quot; srcset=&quot;/static/b1a2c914473284ac9bb2b688a1852562/04472/JKWA4ff.png 170w,
/static/b1a2c914473284ac9bb2b688a1852562/9f933/JKWA4ff.png 340w,
/static/b1a2c914473284ac9bb2b688a1852562/c5bb3/JKWA4ff.png 680w,
/static/b1a2c914473284ac9bb2b688a1852562/b12f7/JKWA4ff.png 1020w,
/static/b1a2c914473284ac9bb2b688a1852562/b5a09/JKWA4ff.png 1360w,
/static/b1a2c914473284ac9bb2b688a1852562/cb88c/JKWA4ff.png 2728w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Note that the objects &lt;code&gt;o1&lt;/code&gt; .. &lt;code&gt;o10&lt;/code&gt; are scattered throughout the
&lt;code&gt;pack&lt;/code&gt; file where they appear in ascending order (i.e., &lt;em&gt;v1 &amp;lt; .. &amp;lt;
v10&lt;/em&gt;). The &lt;code&gt;prefix&lt;/code&gt; file contains the same objects but with different
&amp;quot;real&amp;quot; offsets &lt;em&gt;r1..r10&lt;/em&gt;, as now the objects &lt;code&gt;o1 .. o10&lt;/code&gt; appear one
after the other. The &lt;code&gt;mapping&lt;/code&gt; needs to contain an entry &lt;em&gt;(v1 &amp;rarr; r1)&lt;/em&gt;
for object &lt;code&gt;o1&lt;/code&gt; (and similarly for the other objects) to relate the
virtual offset in the &lt;code&gt;pack&lt;/code&gt; file with the real offset in the &lt;code&gt;prefix&lt;/code&gt;
file.&lt;/p&gt;
&lt;p&gt;To read from &amp;quot;virtual offset &lt;em&gt;v3&lt;/em&gt;&amp;quot; (say), we use the map to retrieve
the real offset in the &lt;code&gt;prefix&lt;/code&gt; file (i.e., &lt;em&gt;r3&lt;/em&gt;) and then read the object
data from that position.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#asynchronous-implementation&quot; aria-label=&quot;asynchronous implementation permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Asynchronous Implementation&lt;/h2&gt;
&lt;p&gt;Tezos Context pruning is performed periodically. We want each round of
context pruning to take place asynchronously with minimal impact
on the main Tezos node. For this reason, when a commit is chosen as
the GC root, we fork a worker process to construct the next &lt;code&gt;prefix&lt;/code&gt;
and &lt;code&gt;suffix&lt;/code&gt; data structures. When the GC worker terminates, the &lt;code&gt;main&lt;/code&gt; process
handles worker termination. It switches from the current
&lt;code&gt;prefix&lt;/code&gt;+&lt;code&gt;suffix&lt;/code&gt; to the next and continues operation. This
switch takes place almost instantaneously. The hard work is done in
the worker process as depicted next:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/34188b669c6289bf79a8b2582e07c9b9/e4900/lob23OH.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 106.47058823529412%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAABYlAAAWJQFJUiTwAAADHUlEQVR42p2U/09aZxTG73+7X5ZsWWpi3BbWTqOzxXZtl7mYqGubucZlzdaYOHRYwzcHVFFAL/JFeuFigNGLwgUucPks7wWUa1m67iQnb/K+533e85z3OUdi1Ho9kk+XcU9+xtbnE7yc+JTnH39EMZ3uH5vmSGjvHRcmjeKZpkn5KIK65yXq2iTt3eVk20Vd065Ahg//m0k3N0Rou9MhFgrS0utjL1kxgAG0ev21CXQEYKvVolarWXS0y0v8Gy8p/7SKf/Y2+aXvqAS86IZBs9FAr9ept1qcx2PIi48IPrhL+Nt7BO7P45m5jezeRlIUhVKpRKfdRm+2ONrdIbe6xOuFOeTHCyjuLS50naqm8bZSoaJVUY7jxNfXOHi+hv/JCr4nK3iWvicdCiIVCgVElqN0LjSN03CIUj5Hu9sdS9ns9RAnJ4kEdV2/2pdUVaXZbF4Vu2uaXBaLRFx/0CyeW/Uf/Ulz8NMXBZXEz0/xOec4WV1Ck48RJ1I+n7dlqB4eEJq7w86dL/B8NUVq4zfr5eHPDqWTex3CPXUL79dfsjnxCcFnq/0Mc7mcHfA0gef+XQ4fOdmadnDk2hwrFaPdJhePkfjTRTLgt2psySabzdooCxO0U/IJDV23Xr0p3lFNxqJR6vVreUlnZ2fXgAKs26WQkNn8cYX8YURsMJqbUEO7a1J5kyW2/AP++WnSy4u8jUb6NbRlCOT3w6QezOOfdpBYmEVeXyOZzfJ3uUyxWKRcLlkyygT3CMw48M042HVMEvt1fTxg6U0W/+Jj9h8usOv8hvirHZqGgTHwIdWOaaImTykE91AiB9QGtC3KjUbDpjHhZ5kMLcMY33o36jlaUymTyVwDikCgWlAJ//6CajppmzBjgU2z72MBRbO32xw+W8HnmMQ3P412fm6fNO8xG+Dwkn55gRz8i6Ki/GegK8B0Om2jLAg26jWifi/Nqvbe+fcOYCqVQh80t7BiQmb/oZNXMw7Czjlynp2BDnv/I0PRevEYgXuz1vjamLrF/otfPihLSZZlhIueFppUVJXjyAER9zZVNY/R6XxQDf8B3JwdY4AqE7UAAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/34188b669c6289bf79a8b2582e07c9b9/c5bb3/lob23OH.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;lob23OH&quot; title=&quot;&quot; srcset=&quot;/static/34188b669c6289bf79a8b2582e07c9b9/04472/lob23OH.png 170w,
/static/34188b669c6289bf79a8b2582e07c9b9/9f933/lob23OH.png 340w,
/static/34188b669c6289bf79a8b2582e07c9b9/c5bb3/lob23OH.png 680w,
/static/34188b669c6289bf79a8b2582e07c9b9/e4900/lob23OH.png 988w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Read-only Tezos nodes:&lt;/strong&gt; In addition to the main Tezos read/write
node that accesses the &lt;code&gt;pack&lt;/code&gt; store, several read-only nodes also
access the &lt;code&gt;pack&lt;/code&gt; store (and other Irmin data files) in read-only
mode. These must be synchronised when the switch is made from the
current &lt;code&gt;prefix&lt;/code&gt;+&lt;code&gt;suffix&lt;/code&gt; to the next &lt;code&gt;prefix&lt;/code&gt;+&lt;code&gt;suffix&lt;/code&gt;. This
synchronisation makes use of a (new) single control file.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#further-optimisations-in-the-octez-storage-layer&quot; aria-label=&quot;further optimisations in the octez storage layer permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Further Optimisations in the Octez Storage Layer&lt;/h2&gt;
&lt;p&gt;The context pruning via automatic garbage collection performs well and
within the required constraints. However, it is possible to make
further efficiency improvements. We next describe some potential
optimisations we plan to work on over the next months.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Resource-aware garbage collection:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The GC worker intensively uses disk, memory, and OS resources. For
example, the disk and memory are doubled in size during the
asynchronous execution of the GC worker. We plan to improve on this by
more intelligent use of resources. For example, computing the
reachable objects during the GC involves accessing earlier objects,
using a lot of random-access reads, with unpredictable latency. A more
resource-aware usage of the file system ensures that the objects are
visited (as much as possible) in the order of increased offset on
disk. This takes advantage of the fact that sequential file access is
much quicker and predictable than accessing the file randomly. The work on
context pruning via a resource-aware garbage collection is planned to
be included in Octez v16.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Retaining older objects for archive nodes:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Archive nodes contain the complete blockchain history, starting from
the genesis block. This results in a huge store &lt;code&gt;pack&lt;/code&gt; file, many
times larger than the kernel&amp;rsquo;s page cache. Furthermore, live objects
are distributed throughout this huge file, which makes it difficult
for OS caching to work effectively. As a result, as the store becomes
larger, the archive node becomes slower.&lt;/p&gt;
&lt;p&gt;In previous prototypes of the layered store, the design also included a
&amp;quot;lower&amp;quot; layer. For archive nodes, the lower layer contained all the
objects before the most recent &lt;code&gt;GC-commit&lt;/code&gt;, whether they were reachable
or not. The lower layer was effectively the full segment of the
&lt;code&gt;pack&lt;/code&gt; file before the GC commit root.&lt;/p&gt;
&lt;p&gt;One possibility with the new layout introduced by the GC is to retain the
lower layer whilst still sticking with the &lt;code&gt;prefix&lt;/code&gt; and &lt;code&gt;mapping&lt;/code&gt; files
approach and preferentially reading from the &lt;code&gt;prefix&lt;/code&gt; where
possible. The advantage (compared with just keeping the full &lt;code&gt;pack&lt;/code&gt;
file) is that the &lt;code&gt;prefix&lt;/code&gt; is a dense store of reachable objects,
improving OS disk caching and the snapshot export performance for
recent commits. In addition, the OS can preferentially cache the
&lt;code&gt;prefix&lt;/code&gt;&amp;amp;&lt;code&gt;mapping&lt;/code&gt;, which enhances general archive node performance
compared with trying to cache the huge &lt;code&gt;pack&lt;/code&gt; file. As baking
operations only need to access these cached objects, their performance
will be more reliable and thus will reduce endorsement misses
drastically. However, some uses of the archive node, such as
responding to RPC requests concerning arbitrary blocks, would still
access the lower layer, so they will not benefit from this
optimisation. The work on improving performance for archive nodes is
planned for Octez v17.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;With the context pruning feature integrated, Tezos rolling and full nodes
accurately maintain all and only used storage data in a performant,
compact, and efficient manner. Bakers will benefit from these changes in
Octez v15, while the feature will be included in archive nodes in
Octez v17.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-11-10-towards-minimal-disk-usage-for-tezos-bakers</id><title type="text">Towards Minimal Disk-Usage for Tezos Bakers</title><updated>2022-11-10T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-10-28-the-mirageos-retreat-a-journey-of-food-cats-and-unikernels" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;&lt;a href=&quot;https://mirage.io/&quot;&gt;MirageOS&lt;/a&gt; is an OCaml ecosystem to construct &lt;a href=&quot;https://en.wikipedia.org/wiki/Unikernel&quot;&gt;unikernels&lt;/a&gt;, i.e., minimal operating systems. Here, we write about our social and technical experience at the MirageOS retreat in Morocco, as well as the vibe and wonderful organisational details. To sum up the technical part, we worked on different facets of the MirageOS world: different kinds of unikernels, some groundwork for Raspberry Pi 4 bare-metal unikernels, and a workflow to leverage an existing deployment/orchestrating infrastructure. The MirageOS retreat was amazing!&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#about-our-journey&quot; aria-label=&quot;about our journey permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;About Our Journey&lt;/h2&gt;
&lt;p&gt;Our journey started in Agadir, a Moroccan city right on the coast of the Atlantic sea, just south of the Atlas mountains. In Agadir, we had the best fish in the world (according to some) and amazing &amp;quot;cornes de gazelle,&amp;quot; a delicious sample of Moroccan culture.&lt;/p&gt;
&lt;p&gt;From Agadir, we went to Mirleft, a small town further south, full of square roads and beautiful reefs. That's where the MirageOS retreat took place. The venue had a kitchen and an amazing cook, a place for computers and presentations, a garden with a small pool, and a rooftop with dusty but nice views of the coast.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/5e247e5529e5f5a231665a5c9da5512d/d2602/mirleft_view.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUBAgT/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAv/aAAwDAQACEAMQAAAB1wgpFOxCH//EABoQAAMBAAMAAAAAAAAAAAAAAAABAwIREhP/2gAIAQEAAQUC4KTTPGY6D0zto//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/Aar/xAAWEQEBAQAAAAAAAAAAAAAAAAAAEQH/2gAIAQIBAT8Bmo//xAAbEAACAQUAAAAAAAAAAAAAAAAAATECEiFRgf/aAAgBAQAGPwItZvph1Esk/8QAGxABAAEFAQAAAAAAAAAAAAAAAQARITFhkdH/2gAIAQEAAT8hCtIJV5Byy7Qy4W2L9oAWfZ//2gAMAwEAAgADAAAAELTv/8QAFhEAAwAAAAAAAAAAAAAAAAAAEBFR/9oACAEDAQE/EEgf/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAx/9oACAECAQE/EFHZ/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARIVEx0f/aAAgBAQABPxApY3sakpRt7kvAXHxKYTreIWo9VK0E9j//2Q=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/5e247e5529e5f5a231665a5c9da5512d/7bf67/mirleft_view.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Beautiful Mirleft Sunset&quot; title=&quot;&quot; srcset=&quot;/static/5e247e5529e5f5a231665a5c9da5512d/651be/mirleft_view.jpg 170w,
/static/5e247e5529e5f5a231665a5c9da5512d/d30a3/mirleft_view.jpg 340w,
/static/5e247e5529e5f5a231665a5c9da5512d/7bf67/mirleft_view.jpg 680w,
/static/5e247e5529e5f5a231665a5c9da5512d/990cb/mirleft_view.jpg 1020w,
/static/5e247e5529e5f5a231665a5c9da5512d/c44b8/mirleft_view.jpg 1360w,
/static/5e247e5529e5f5a231665a5c9da5512d/d2602/mirleft_view.jpg 4032w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#about-the-retreat&quot; aria-label=&quot;about the retreat permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;About the Retreat&lt;/h2&gt;
&lt;p&gt;Both the venue and Mirleft as a whole were extremely inspiring in many ways. One of which included hacking on MirageOS, which was the main reason we came--of course, but we also enjoyed amazing food, saw old and new friends, and had a great time collaborating and creating with MirageOS.&lt;/p&gt;
&lt;p&gt;At least once a year since the &lt;a href=&quot;https://mirage.io/blog/2016-spring-hackathon&quot;&gt;first MirageOS retreat in 2016&lt;/a&gt; (with a Covid break in 2021), people get together and work on anything related to MirageOS. These retreats provide a great atmosphere, working environment, and everything else that's needed to be productive and to have a wonderful time.&lt;/p&gt;
&lt;p&gt;Besides, the retreat is always a nice opportunity to &lt;a href=&quot;https://en.wikipedia.org/wiki/Eating_your_own_dog_food&quot;&gt;eat our own dog food&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The organiser, &lt;a href=&quot;https://twitter.com/h4nnes&quot;&gt;Hannes&lt;/a&gt; (among others), always makes sure that most of the infrastructure we rely on is running on MirageOS as much as possible. A welcome addition this year was a local &lt;a href=&quot;https://hannes.robur.coop/Posts/OpamMirror&quot;&gt;opam cache&lt;/a&gt;, which allowed us to download and install packages without crushing the data allowance on the SIM card installed on our main access point.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/70b43054abaf1459bd1fdf211865935c/3acf0/Mirleft_venue.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAQX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABmX0MSAcH/8QAGRABAQADAQAAAAAAAAAAAAAAAgMAARES/9oACAEBAAEFAq1fotndKqj7POzzZHf/xAAXEQEBAQEAAAAAAAAAAAAAAAABAFER/9oACAEDAQE/AVcuuX//xAAYEQACAwAAAAAAAAAAAAAAAAAAARFRYf/aAAgBAgEBPwFLSFZ//8QAGxAAAQUBAQAAAAAAAAAAAAAAAAECESExEkH/2gAIAQEABj8CjpYPYFdZhqlOP//EABsQAQACAwEBAAAAAAAAAAAAAAEAESExcUFR/9oACAEBAAE/IbU8M91tYSqgHR8ireLyK7hdYTjP/9oADAMBAAIAAwAAABBk7//EABcRAQEBAQAAAAAAAAAAAAAAAAEAEWH/2gAIAQMBAT8QA4K6L//EABYRAQEBAAAAAAAAAAAAAAAAAAEQIf/aAAgBAgEBPxAHWB//xAAdEAEAAgICAwAAAAAAAAAAAAABABEhQVHhMWGB/9oACAEBAAE/EFIDoRVvxiGhS2F64jfeUC4H2KLGKU7wAKXCMY3quif/2Q=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/70b43054abaf1459bd1fdf211865935c/7bf67/Mirleft_venue.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Lunch at the MirageOS Retreat&quot; title=&quot;&quot; srcset=&quot;/static/70b43054abaf1459bd1fdf211865935c/651be/Mirleft_venue.jpg 170w,
/static/70b43054abaf1459bd1fdf211865935c/d30a3/Mirleft_venue.jpg 340w,
/static/70b43054abaf1459bd1fdf211865935c/7bf67/Mirleft_venue.jpg 680w,
/static/70b43054abaf1459bd1fdf211865935c/990cb/Mirleft_venue.jpg 1020w,
/static/70b43054abaf1459bd1fdf211865935c/c44b8/Mirleft_venue.jpg 1360w,
/static/70b43054abaf1459bd1fdf211865935c/3acf0/Mirleft_venue.jpg 2000w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#about-mirageos&quot; aria-label=&quot;about mirageos permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;About MirageOS&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://mirage.io/&quot;&gt;MirageOS&lt;/a&gt; is an ecosystem that constructs unikernels. In a superficial nutshell, a &lt;a href=&quot;https://en.wikipedia.org/wiki/Unikernel&quot;&gt;unikernel&lt;/a&gt; is a machine image that contains one process and a minimal set of operating system features the process requires. Unikernels are designed to be secure, efficient, and small. MirageOS unikernels are written in OCaml, a functional, semantically rich and type-safe programming language.&lt;/p&gt;
&lt;p&gt;MirageOS can be used in a wide range of settings, like robust reimplementations of core system services and protocols like (&lt;a href=&quot;https://github.com/mirage/ocaml-dns&quot;&gt;DNS&lt;/a&gt;, &lt;a href=&quot;https://github.com/mirage/awa-ssh&quot;&gt;SSH&lt;/a&gt;, &lt;a href=&quot;https://github.com/mirleft/ocaml-tls&quot;&gt;TLS&lt;/a&gt;, and &lt;a href=&quot;https://github.com/mirage/&quot;&gt;many more&lt;/a&gt;), as well as higher level applications like &lt;a href=&quot;https://hannes.robur.coop/Posts/OpamMirror&quot;&gt;web services&lt;/a&gt;. It's also on its way to become a good candidate for bare-metal applications on various chipsets (e.g., a &lt;a href=&quot;https://github.com/dinosaure/gilbraltar&quot;&gt;good choice for the Raspberry Pi 4&lt;/a&gt;. See also the section below on &lt;em&gt;Implementing a Jack Port Driver&lt;/em&gt;)&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#our-projects--what-we-learned&quot; aria-label=&quot;our projects  what we learned permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Our Projects &amp;amp; What We Learned&lt;/h2&gt;
&lt;p&gt;We worked on lots of interesting things, but let's start with the ones that directly relate to MirageOS.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#deploying-albatross-on-nixos-no-more-iptables-debugging&quot; aria-label=&quot;deploying albatross on nixos no more iptables debugging permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Deploying Albatross on Nixos: No More iptables Debugging&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/roburio/albatross&quot;&gt;Albatross&lt;/a&gt; is an orchestrator for MirageOS unikernels. It runs on a Linux system and manages unikernels using Solo5. It's made of several services, one of which is the remote TLS endpoint, which accepts requests from the network to manage the orchestrator.&lt;/p&gt;
&lt;p&gt;Some of us wanted to run Albatross on our favourite Linux distribution, &lt;a href=&quot;https://github.com/NixOS/nixpkgs&quot;&gt;NixOS&lt;/a&gt;, and we hoped to be able to hack around this quickly; however, it turned out to be harder than expected. We learned so much about systemd and networking while doing this project.&lt;/p&gt;
&lt;p&gt;A Nix flake (a new way of defining packages, which comes with many rough edges) and a NixOS module are added to the main repository in &lt;a href=&quot;https://github.com/roburio/albatross/pull/120&quot;&gt;this PR&lt;/a&gt;.
To test that it works and to play with it, we've written a &lt;a href=&quot;https://github.com/Julow/albatross-nixos-example&quot;&gt;small tutorial&lt;/a&gt; that explains how to build a Qemu VM with Albatross and how to deploy a unikernel using the remote TLS endpoint.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#coffee-chat-bot-a-friendly-unikernel-for-a-friendly-work-environment&quot; aria-label=&quot;coffee chat bot a friendly unikernel for a friendly work environment permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Coffee Chat Bot: a Friendly Unikernel for a Friendly Work Environment&lt;/h3&gt;
&lt;p&gt;Some of us worked on deploying a coffee chat bot as a MirageOS unikernel. Contrary to how it sounds, it isn't a robot that serves coffee (which would be extremely awesome)! Instead, it's a Slack bot that lets people on our company's Slack channel to opt-in for a coffee chat with a colleague. The coffee chat bot then matches each opt-in randomly with another opt-in.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 635px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/22a41f031c11471c02727254a9ce489f/1ddef/mirleft_coffeebot.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 19.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA20lEQVR42m2PS07DMABEc/8TsEccBLGCRUBR+bRNkya2aZK2tlOnUkltP5SCKiGxGM1oZjYvWS1niLqiKAqqqqIsS7quwznHMBw5nb4IIeC9v/iPIjFEvD//2cZxJLm9u+HxKeUlm5GmKVmWkec5QgiWiwVVXaOUREiJVBIlBau3e4qPB5SsUXLaFKLMaddzkkb3rMWM1/dn5rKh/GyRosa5AWMM1lq00ZdsjEXrPdtNzr4tsFOnNWb6bDvsriWJEUy/oWkFO3fEuIHDocf/ovynCTnEyPnahSv6N3KOLMktbR3sAAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/22a41f031c11471c02727254a9ce489f/1ddef/mirleft_coffeebot.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Coffee Chat Bot&quot; title=&quot;&quot; srcset=&quot;/static/22a41f031c11471c02727254a9ce489f/04472/mirleft_coffeebot.png 170w,
/static/22a41f031c11471c02727254a9ce489f/9f933/mirleft_coffeebot.png 340w,
/static/22a41f031c11471c02727254a9ce489f/1ddef/mirleft_coffeebot.png 635w&quot; sizes=&quot;(max-width: 635px) 100vw, 635px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This bot was already written in OCaml, and it's merely a single process. Due to its nature, it doesn't need to do any super complicated operating system stuff, so a natural question came to us: why not make a unikernel out of it?&lt;/p&gt;
&lt;p&gt;So &lt;a href=&quot;https://github.com/pitag-ha/slack_bot&quot;&gt;we did&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Making a unikernel out of a relatively simple application sounds rather straightforward. The first step was to get rid of all Unix operations. It's incredible how many small Unix calls we were doing without even noticing. For example, we were using &lt;code&gt;Unix.time&lt;/code&gt; all over the place, such as scheduling, providing a seed for the random library, and giving timestamps to our database entries.&lt;/p&gt;
&lt;p&gt;The database posed another problem. We had been using &lt;code&gt;irmin-unix&lt;/code&gt;, which writes to disk using Unix. To fix that, now we use &lt;code&gt;irmin-mem&lt;/code&gt;, which writes to memory. We persist (and inspect) the data by syncing our in-memory database with a GitHub repository. If you're not familiar with Irmin (a MirageOS library), its design follows the principles of the Git design and provides a library called &lt;code&gt;irmin-git&lt;/code&gt; to bridge the two.&lt;/p&gt;
&lt;p&gt;Providing the network stack needed for the Git (and also for the Slack API) communication is one of the typical tasks the operating system needs do. In our case, that's MirageOS. It has a concept called &amp;quot;devices,&amp;quot; which are the operating system features your unikernel might need. Examples of &amp;quot;devices&amp;quot; are network interfaces, network stacks, filesystems (which we didn't need), and monotonic time sources. MirageOS will provide a concrete implementation of such a device at your unikernel's compile time, as long as you declare the device in the MirageOS configuration file &lt;code&gt;config.ml&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The things described were just a small part of our nice, educational journey making a coffee chat unikernel. One more detail that's worth mentioning:  the bot now uses &lt;a href=&quot;https://github.com/dinosaure/paf-le-chien&quot;&gt;&lt;code&gt;httpaf&lt;/code&gt;&lt;/a&gt; for the Slack API interactions. Before, it was using &lt;code&gt;cohttp&lt;/code&gt;, which is already independent from Unix (unlike, for example, the OCaml &lt;code&gt;curl&lt;/code&gt; wrapper &lt;code&gt;curly&lt;/code&gt;). Porting it to &lt;code&gt;httpaf&lt;/code&gt; wasn't technically necessary, but it was a great way to get to know and test the latest &amp;quot;cutting-edge&amp;quot; unikernel features.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#implementing-a-jack-port-driver-or-how-to-make-a-unikernel-sing-bare-metal&quot; aria-label=&quot;implementing a jack port driver or how to make a unikernel sing bare metal permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Implementing a Jack Port Driver, or How to Make a Unikernel Sing Bare-Metal&lt;/h3&gt;
&lt;p&gt;We also went bare-metal during the retreat. &amp;quot;Bare-metal&amp;quot; sounds cool, doesn't it? Let us explain what we really mean by it. Often, the way to run a MirageOS unikernel is as follows:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You have a Linux kernel on your machine and virtualize it via a hypervisor such as KVM.&lt;/li&gt;
&lt;li&gt;That hypervisor is then abstracted further by a tool called Solo5 which integrates well with MirageOS unikernels.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;With this workflow, the communication between the unikernel and the hardware goes over several layers of abstraction. A &amp;quot;bare-metal&amp;quot; unikernel, on the contrary, communicates with the hardware directly, without any interfacing kernel such as Linux. The device we chose to do bare-metal work on is the Rasperry Pi 4 (RPi4).&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/3bde74c117dc40ffd803f1a8e763ada3/3acf0/Mirleft_rpi4.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.47058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIFAf/EABUBAQEAAAAAAAAAAAAAAAAAAAID/9oADAMBAAIQAxAAAAGclVSphgKf/8QAGhAAAgIDAAAAAAAAAAAAAAAAAAECAxESM//aAAgBAQABBQKKI7RZVgs5s//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABkQAAIDAQAAAAAAAAAAAAAAAAABEBFBgf/aAAgBAQAGPwItZDO1H//EABoQAQACAwEAAAAAAAAAAAAAAAEAESExUWH/2gAIAQEAAT8hHlkLLOmsQ93BRV18gpDTuxuZM//aAAwDAQACAAMAAAAQdB//xAAYEQACAwAAAAAAAAAAAAAAAAAAAREhMf/aAAgBAwEBPxDHRCP/xAAXEQADAQAAAAAAAAAAAAAAAAAAASEx/9oACAECAQE/ENVKf//EABsQAQEAAwADAAAAAAAAAAAAAAERACExQVFh/9oACAEBAAE/EOAYC+jmFX3powWt07gdyQEVAAjk18uaXgXISbt8OMVCF0XP/9k='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/3bde74c117dc40ffd803f1a8e763ada3/7bf67/Mirleft_rpi4.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Work set-up for RPi4 hacking&quot; title=&quot;&quot; srcset=&quot;/static/3bde74c117dc40ffd803f1a8e763ada3/651be/Mirleft_rpi4.jpg 170w,
/static/3bde74c117dc40ffd803f1a8e763ada3/d30a3/Mirleft_rpi4.jpg 340w,
/static/3bde74c117dc40ffd803f1a8e763ada3/7bf67/Mirleft_rpi4.jpg 680w,
/static/3bde74c117dc40ffd803f1a8e763ada3/990cb/Mirleft_rpi4.jpg 1020w,
/static/3bde74c117dc40ffd803f1a8e763ada3/c44b8/Mirleft_rpi4.jpg 1360w,
/static/3bde74c117dc40ffd803f1a8e763ada3/3acf0/Mirleft_rpi4.jpg 2000w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;So we needed an RPi4 bare-metal OCaml runtime. Luckily, Dinosaure wrote one last year: &lt;a href=&quot;https://github.com/dinosaure/gilbraltar&quot;&gt;Gilbraltar&lt;/a&gt;. It also dumps the text of OCaml print statements into the UART, which is a technical way of saying that we can send such text over USB (concretely over a USB to serial TTL cable) and see it. Quite useful for debugging!&lt;/p&gt;
&lt;p&gt;As you can see, doing bare-metal work is quite restrictive and everything that tends to be taken for granted needs to be implemented, like drivers, for example.&lt;/p&gt;
&lt;p&gt;So that's what we decided to do.&lt;/p&gt;
&lt;p&gt;Last year, some colleagues already implemented a driver for LED strips and powered our office's &lt;a href=&quot;https://twitter.com/Dinoosaure/status/1471128595154231300&quot;&gt;Christmas tree&lt;/a&gt; with a bare-metal OCaml RPi4! What is cooler than &lt;a href=&quot;https://tarides.com/blog/2021-11-11-mirageos-workshop-working-with-the-raspberry-pi-4&quot;&gt;making our bare-metal RPi4 Christmas tree sing&lt;/a&gt;? Well, a lot of things are. Anyways, we love music, so we decided to implement a jack port driver.&lt;/p&gt;
&lt;p&gt;Jack port drivers on a digital device are an interesting concept. Digital devices are digital, but jack ports expect analog data. One way the RPi4 can handle that is via a concept called PWM: Pulse Width Modulation. The PWM modulates analog signals (i.e., values between 0 and 1) by sending digital signals (i.e., either 0 or 1) really fast.&lt;/p&gt;
&lt;p&gt;That modulation is done on the hardware side of the RPi4, concretely on a RPi4 &lt;em&gt;peripheral&lt;/em&gt; also called PWM. &lt;a href=&quot;https://datasheets.raspberrypi.com/bcm2711/bcm2711-peripherals.pdf&quot;&gt;Peripherals&lt;/a&gt; are RPi4 hardware devices that are mapped to specific address ranges in the RPi4's memory. You communicate with them by writing to or reading from those locations in memory. The address range of each peripheral is structured into registers. One example of a register of the PWM is the PWM FIFO, i.e., the hardware queue that stores the data flowing from the program to the jack port.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/pitag-ha/rpi/blob/jack-port-driver-on-interrupts/src/peripherals/pwm.ml&quot;&gt;Our jack port driver&lt;/a&gt; does two things--both by writing to and reading from the right places in the PWM memory range.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;It can initiate the RPi4 for jack port communication (e.g., it sets the RPi4's clock to the correct frequency at which the port reads data from the FIFO, and it configures the correct modes to ensure the right data flow).&lt;/li&gt;
&lt;li&gt;It can send music to the jack port (by writing data to the FIFO--without overflowing it).&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;To use the new driver, we convert music into the right binary format by simply using &lt;code&gt;ffmpeg&lt;/code&gt;. Then we &lt;a href=&quot;https://github.com/pitag-ha/rpi/blob/jack-port-driver-on-interrupts/test/bare-metal/jack_port/main.ml&quot;&gt;write a program&lt;/a&gt; with that music in-memory using the MirageOS tool &lt;a href=&quot;https://github.com/mirage/ocaml-crunch&quot;&gt;&lt;code&gt;ocaml-crunch&lt;/code&gt;&lt;/a&gt;. That program just calls the driver to do the rest and is compiled for the RPi4 target with &lt;code&gt;gilbraltar&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This work is strongly related to MirageOS in three ways. First, the program playing music bare-metal on the RPi4 is a unikernel written in OCaml. Second, the program is compiled with &lt;code&gt;gilbraltar&lt;/code&gt;, which forms part of the MirageOS ecosystem and whose design and implementation is based on core tools in the MirageOS ecosystem, such as Solo5 and &lt;code&gt;ocaml-solo5&lt;/code&gt;. Third, by adding one layer of abstraction to the jack port driver, we can make it a MirageOS &amp;quot;device,&amp;quot; so one could use the driver while also leveraging other MirageOS features that work bare-metal on a RPi4.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#monitoring-mirageio-and-chasing-memory-leaks&quot; aria-label=&quot;monitoring mirageio and chasing memory leaks permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Monitoring mirage.io and Chasing Memory Leaks&lt;/h3&gt;
&lt;p&gt;One of the MirageOS goals is to be able self host our infrastructure. At the retreat, many tools we used were based on the MirageOS ecosytem: a DNS resolver (&lt;a href=&quot;https://github.com/mirage/ocaml-dns&quot;&gt;mirage/ocaml-dns&lt;/a&gt;), an opam repository cache (&lt;a href=&quot;https://git.robur.io/robur/opam-mirror&quot;&gt;robur/opam-mirror&lt;/a&gt;), and a portable file transfer application (&lt;a href=&quot;https://github.com/dinosaure/bob&quot;&gt;dinosaure/bob&lt;/a&gt;). It's not a surprise that the official website, &lt;a href=&quot;https://mirage.io&quot;&gt;mirage.io&lt;/a&gt;, is a unikernel itself. However, in the past six months, we experienced two website crashes due to &lt;code&gt;Out_of_memory&lt;/code&gt; exceptions. The unikernel is configured to run with 1GB of RAM, so that's a slow running memory leak that requires investigation.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/29c60ca463f3e469222eba820432f3a8/70ad2/mirleft_monitoring.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 69.41176470588235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB9klEQVR42nVUgW4TMQy9//8pBENICE2wsgkNaWyAoGunde31LrZjJw/Zubt1mujpKY6dPDvxSztVRSklUGsFEUFEwp79vkZyXuaOnHOgmDW4TzO6vj/GZocVW4gbYRudkCMJXvh9Xhy+p2SoshP2S9aUU7PrXIkthCK5EQITmcc1iErxZAY1Q/e036HnHqSEx/EBSUaICdQyKCeIMXbDI3IQVtSiKMYoJiglo0biVm0QbnYbvL97i6vtV7y7fYPV+gs2x3vcH9f4/nCNy80Kl+sVLDuhV6JBjKlSTNfghkWFhx0+3Zzh888POP9xhqvf57jdXuNm8w3Xfy9w8esj/uzu8NQ/Ybt/QD8M6IcxxpEIQ0pIxGETMTrvHhNDhcFE0KyRqTXI4q6888dhQKKEMY0YE4OFYa4Aa3fneyQrOm99je/5wufjzN/c+f//WiyOTMyLTGb4gmfiEo14veYkeXQ7QTOh8+Ocaq9praDYiKI9iqbo6sv4tCbWJRQdgjS6zCwhzhCp35vLwclcEtUmqbg8bKrWUF13hadRXx5ZhFGtBYvRM8kJQrhT3Ku1orBqrUKP19ZEfwCdv1vJBM4MygzOAhICZYqRwzf5M0E0xzxJAisvcX9looLOpbA/7NH3exwOh5DIKZg5MNvx5xE+mdDiXpgr5h8SIEdy0XCwYgAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/29c60ca463f3e469222eba820432f3a8/c5bb3/mirleft_monitoring.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Monitoring mirage.io&quot; title=&quot;&quot; srcset=&quot;/static/29c60ca463f3e469222eba820432f3a8/04472/mirleft_monitoring.png 170w,
/static/29c60ca463f3e469222eba820432f3a8/9f933/mirleft_monitoring.png 340w,
/static/29c60ca463f3e469222eba820432f3a8/c5bb3/mirleft_monitoring.png 680w,
/static/29c60ca463f3e469222eba820432f3a8/b12f7/mirleft_monitoring.png 1020w,
/static/29c60ca463f3e469222eba820432f3a8/b5a09/mirleft_monitoring.png 1360w,
/static/29c60ca463f3e469222eba820432f3a8/70ad2/mirleft_monitoring.png 1665w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The question is how to investigate such a leak.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#locally&quot; aria-label=&quot;locally permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Locally?&lt;/h4&gt;
&lt;p&gt;The initial attempt consisted in &lt;em&gt;tracing&lt;/em&gt; memory allocations using &lt;code&gt;statmemprof&lt;/code&gt; while bombarding the server with requests by using benchmarking tools such as ApacheBench (&lt;code&gt;ab&lt;/code&gt;) or &lt;code&gt;wrk&lt;/code&gt;. &lt;code&gt;statmemprof&lt;/code&gt; is an implementation of &lt;em&gt;Statistical Memory Profiling&lt;/em&gt; in the OCaml runtime. It enables sampling allocations at a fixed rate and tracing values until they are garbage collected. Using &lt;a href=&quot;https://github.com/janestreet/memtrace_viewer&quot;&gt;memtrace-viewer&lt;/a&gt;, one can analyse the memory usage and see which values are still live when the program goes out of memory, for example. For a unikernel with network access, it's possible to add an endpoint to enable tracing on demand: &lt;a href=&quot;https://github.com/roburio/memtrace-mirage&quot;&gt;roburio/memtrace-mirage&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Unfortunately, this setup didn't help us identify the leak. Indeed, we can still expect the server to work fine under normal conditions. Somehow we need to understand which rare event, leaking a small bit of memory at a time, is happening enough times to consume all available memory.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#monitoring-the-live-unikernel&quot; aria-label=&quot;monitoring the live unikernel permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Monitoring the Live Unikernel&lt;/h4&gt;
&lt;p&gt;Only the &lt;em&gt;Real&amp;trade;&lt;/em&gt; Internet would tell us the answer, so we monitored the live unikernel application. &lt;a href=&quot;https://github.com/roburio/mirage-monitoring&quot;&gt;roburio/mirage-monitoring&lt;/a&gt; was of great help, as it enables two things:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Reporting application-wide metrics to an InfluxDB endpoint, which can be displayed using Grafana&lt;/li&gt;
&lt;li&gt;Changing logs level/metrics sources at runtime&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Adding &lt;code&gt;mirage-monitoring&lt;/code&gt; to a unikernel was surprisingly easy. It was only a matter of updating the configuration file with some functoria voodoo: &lt;a href=&quot;https://github.com/mirage/mirage-www/pull/767&quot;&gt;https://github.com/mirage/mirage-www/pull/767&lt;/a&gt;. At some point, it will upstreamed in the &lt;code&gt;mirage&lt;/code&gt; tool so that adding monitoring is a single-line job. The hard part was providing the unikernel two network stacks to expose one to the internet while keeping the other for internal use only.&lt;/p&gt;
&lt;p&gt;Next, we set up a typical Grafana deployment using InfluxDB/Telegraf for the metrics input and data storage. Logs were displayed using &lt;code&gt;albatross-client-local&lt;/code&gt;.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#chasing-the-leak&quot; aria-label=&quot;chasing the leak permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Chasing the Leak&lt;/h4&gt;
&lt;p&gt;Now we can see the numbers for the live website. Memory usage, indeed, but also other metrics were included by default, such as the number of established connections in the TCP stack. There we found the source of the leak. Throughout the day, the number of established TCP connections kept increasing.&lt;/p&gt;
&lt;p&gt;Finally at runtime, we temporarily changed the TCP stack's log level to &lt;em&gt;debug&lt;/em&gt;, monitor the logs, and wait for the moment where the number of established TCP connections would increase without decreasing afterwards. These logs described what was going on in the TCP stack at the exact moment the connection leak happened. At this point, we figured out that it occurred when a client connected to the server but fail to perform the TLS handshake, so the server dropped the connection without &lt;em&gt;closing&lt;/em&gt; it--hence leaking it &lt;em&gt;forever&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Here we go: &lt;a href=&quot;https://github.com/dinosaure/paf-le-chien/pull/72&quot;&gt;&lt;em&gt;one less leak&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#next-steps&quot; aria-label=&quot;next steps permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Next Steps&lt;/h4&gt;
&lt;p&gt;Matching &lt;em&gt;logs&lt;/em&gt; and &lt;em&gt;metrics&lt;/em&gt; to inspect them together has proven to be very useful. We used Grafana for metrics, so the next step would be to also provide logs because Grafana supports structured logging through the &lt;a href=&quot;https://grafana.com/oss/loki/&quot;&gt;Loki&lt;/a&gt; logs aggregation system.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#miragehole---a-unikernel-dns-resolver-with-holes&quot; aria-label=&quot;miragehole   a unikernel dns resolver with holes permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;MirageHole - A Unikernel DNS Resolver with Holes&lt;/h3&gt;
&lt;p&gt;One way to stop web trackers, advertisements, and malware is to block access to sites known to contain such things. A popular approach is through browser extensions like &lt;a href=&quot;https://en.wikipedia.org/wiki/AdBlock&quot;&gt;AdBlock&lt;/a&gt; and &lt;a href=&quot;https://en.wikipedia.org/wiki/Privacy_Badger&quot;&gt;Privacy Badger&lt;/a&gt;. Another approach known as &lt;a href=&quot;https://en.wikipedia.org/wiki/DNS_sinkhole&quot;&gt;a DNS sinkhole&lt;/a&gt; involves installing a local DNS server that resolves bad domains to an invalid IP address. This approach has the advantage of working across different operating systems, browsers, and devices (laptops, smartphones, smart-TVs, etc.). For an added bonus, it can also save network bandwidth.&lt;/p&gt;
&lt;p&gt;Another project initiated during this year's retreat was to implement &lt;a href=&quot;https://github.com/jmid/mirage-hole&quot;&gt;Mirage-hole&lt;/a&gt;: a DNS sinkhole running as a Mirage Unikernel. It was inspired by &lt;a href=&quot;https://en.wikipedia.org/wiki/Pi-hole&quot;&gt;Pi-hole&lt;/a&gt; for the Raspberry Pi. Starting from a DNS-stub example from &lt;a href=&quot;https://github.com/roburio/dnsvizor&quot;&gt;dnsvizor&lt;/a&gt; (and after a bit of network debugging), we got a unikernel running that would block a single selected domain. We then extended this to fetch and parse &lt;a href=&quot;https://github.com/blocklistproject/Lists&quot;&gt;a blocklist&lt;/a&gt; at start-up. Next, we worked on integrating a little webserver to serve statistics about the requested and blocked domains. Overall, the project was a nice opportunity to talk to and learn from several MirageOS contributors, and it served as a nice tour-de-force of several MirageOS networking libraries.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#tarides-map---serving-the-tarides-geographical-distribution-in-a-unikernel&quot; aria-label=&quot;tarides map   serving the tarides geographical distribution in a unikernel permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Tarides Map - Serving the Tarides Geographical Distribution in a Unikernel&lt;/h3&gt;
&lt;p&gt;Tarides Map is a project intended to show the geographic distribution of all Tarides collaborators as a website. At the retreat, we explored deploying the site in a unikernel. To do this, we had to decide how to serve the files on the server and integrate it into a unikernel. We had two options use &lt;code&gt;ocaml-crunch&lt;/code&gt; or Docteur.&lt;/p&gt;
&lt;p&gt;We initially used &lt;a href=&quot;https://github.com/dinosaure/docteur&quot;&gt;Docteur&lt;/a&gt; due to an inspiration from a different project called &lt;a href=&quot;https://github.com/dinosaure/pasteur&quot;&gt;Pasteur&lt;/a&gt;, which uses Docteur and is deployed in a unikernel as a static site, which was exactly what we were aiming to do with Tarides Map. However, integrating Docteur into the project proved to be more difficult than we had expected. One reason was that Solo5 isn't currently supported on MacOS, the operating system used to write the project at the retreat. After compiling to Unix instead and numerous hours debugging, we were eventually able to generate the disk image; however, we still had issues deploying it in a unikernel, so we decided to try using &lt;a href=&quot;https://github.com/mirage/ocaml-crunch&quot;&gt;ocaml-crunch&lt;/a&gt; instead.&lt;/p&gt;
&lt;p&gt;Using &lt;code&gt;ocaml-crunch&lt;/code&gt; proved to be a more straightforward option. We merely had to move some files around so that the directory structure could be turned into a standalone OCaml module to serve the file contents without requiring an external filesystem to be present. After doing this, we were successfully able to deploy the site &lt;a href=&quot;https://github.com/SaySayo/tarides_map_static_website&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#what-we-dreamed-about&quot; aria-label=&quot;what we dreamed about permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What We Dreamed About&lt;/h2&gt;
&lt;p&gt;Another very interesting part of the retreat were the &lt;em&gt;dreaming sessions&lt;/em&gt; organized by Hannes. The central idea behind this exercice was to allow ourselves to dream about how we envision the MirageOS project in the future, no matter how untangible and seemingly unrealistic. We talked about those dreams in two sessions.&lt;/p&gt;
&lt;p&gt;The initial session revolved around gathering these dreams and ideas, without discussing how to achieve them, and let our mind go free with what we wanted to accomplish with MirageOS. Often times, those dreams would be shared with other participants. Some dreamed about replacing their whole software infrastructure by MirageOS, if not their main operating system! Others dreamed of artistic applications for Mirage, like using it as a backbone for musical endeavors.&lt;/p&gt;
&lt;p&gt;The subsequent session revolved around &lt;em&gt;how&lt;/em&gt; we could reach those dreams. This facilitated a more practical discussion around the challenges we may face along the way. Interestingly enough, in some instances, it turned out some dreams were either already achieved (like reverse-debugging Solo5!) or were close to being achievable.&lt;/p&gt;
&lt;p&gt;A beautiful example of the attendees' dedication is that it did not take long for some to start working on projects like MirageOS-OS, a hypervisor for MirageOS unikernels and written with MirageOS, or to successfully implement a jack port driver for the Raspberry Pi 4, bringing us closer to MirageOS powered synthesisers and to MirageOS midi interfaces!&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/45ef29c8b49ef9d490e6ccdeec689ed5/3acf0/Mirleft_reefs.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABAAD/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQAC/9oADAMBAAIQAxAAAAFGZZkxLL//xAAcEAADAAEFAAAAAAAAAAAAAAAAAQIDBBITFCH/2gAIAQEAAQUC5x6lI7MkxLKxeTtU/wD/xAAXEQEAAwAAAAAAAAAAAAAAAAAAAQIS/9oACAEDAQE/AYoy/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAEDEv/aAAgBAgEBPwF0Ns//xAAZEAEAAgMAAAAAAAAAAAAAAAABABARMUH/2gAIAQEABj8CrZOsclf/xAAbEAADAQADAQAAAAAAAAAAAAAAAREhQWFxsf/aAAgBAQABPyGOhS7MME/sKHw4Kcip4KhavD//2gAMAwEAAgADAAAAEHc//8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERMf/aAAgBAwEBPxBmsg//xAAXEQADAQAAAAAAAAAAAAAAAAABEBEh/9oACAECAQE/EK4Ef//EABwQAQEAAgIDAAAAAAAAAAAAAAERACExkUFR0f/aAAgBAQABPxBHx2xoG6c4LA0sSjoxsCilYLeAz1044N/MCDXYAdZ//9k='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/45ef29c8b49ef9d490e6ccdeec689ed5/7bf67/Mirleft_reefs.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Mirleft's Beautiful Reefs&quot; title=&quot;&quot; srcset=&quot;/static/45ef29c8b49ef9d490e6ccdeec689ed5/651be/Mirleft_reefs.jpg 170w,
/static/45ef29c8b49ef9d490e6ccdeec689ed5/d30a3/Mirleft_reefs.jpg 340w,
/static/45ef29c8b49ef9d490e6ccdeec689ed5/7bf67/Mirleft_reefs.jpg 680w,
/static/45ef29c8b49ef9d490e6ccdeec689ed5/990cb/Mirleft_reefs.jpg 1020w,
/static/45ef29c8b49ef9d490e6ccdeec689ed5/c44b8/Mirleft_reefs.jpg 1360w,
/static/45ef29c8b49ef9d490e6ccdeec689ed5/3acf0/Mirleft_reefs.jpg 2000w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#inventing-ocamlwave-serenading-cats-and-christening-dogs&quot; aria-label=&quot;inventing ocamlwave serenading cats and christening dogs permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Inventing OCamlwave, Serenading Cats, and Christening Dogs&lt;/h2&gt;
&lt;p&gt;As mentioned above, the retreat was extremely inspiring, even with respect to topics less related to MirageOS than the ones mentioned here. The one we're most proud of is &lt;a href=&quot;https://www.youtube.com/playlist?list=PLmaiK3-DyqMy3kNjdHIPUEo-Gkltha3mT&quot;&gt;our Mirleft MirageOS EP&lt;/a&gt; that contains five tracks (&lt;em&gt;five&lt;/em&gt; in the spirit of Solo&lt;em&gt;5&lt;/em&gt; and OCaml &lt;em&gt;5.0&lt;/em&gt;, of course). Its genre might be better described as &lt;em&gt;OCamlwave&lt;/em&gt;! On our EP, you will find many musical oddities ranging from an on-premise recorded drum solo (with glasses, cloth-racks, and flip-flops) to a cat-powered cover of &lt;em&gt;Mr Sandman&lt;/em&gt; (as an hommage to our time singing to Morroco's many, &lt;em&gt;many&lt;/em&gt; cute cats.) to the occasional dramatic rendition of controversial pull requests on the OCaml compiler.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/c9cafec3abe45e91bbbaec46eb95c169/f8beb/mirleft_cats.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFAv/EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAABVenYKrk0y//EABwQAAMAAQUAAAAAAAAAAAAAAAECAwASEyEiMf/aAAgBAQABBQK57TudrXQ5Xln9Wrgf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFREBAQAAAAAAAAAAAAAAAAAAACH/2gAIAQIBAT8BV//EABsQAQABBQEAAAAAAAAAAAAAAAABAhEhMnGB/9oACAEBAAY/AlPGbwh42f/EABkQAQADAQEAAAAAAAAAAAAAAAEAESExUf/aAAgBAQABPyGsdMhRHnjWGu14EJa8mSHAVK6Kp//aAAwDAQACAAMAAAAQTB//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREx/9oACAEDAQE/EK3pUf/EABkRAAEFAAAAAAAAAAAAAAAAAAABESExUf/aAAgBAgEBPxCoQbR//8QAHRABAQACAgMBAAAAAAAAAAAAAREAITFBgaGxwf/aAAgBAQABPxAw2nMwY5pBDDv1gs7JoE8ZMNn7xceGB1rC89wMfuf/2Q=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/c9cafec3abe45e91bbbaec46eb95c169/7bf67/mirleft_cats.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Cute street kittens in Mirleft&quot; title=&quot;&quot; srcset=&quot;/static/c9cafec3abe45e91bbbaec46eb95c169/651be/mirleft_cats.jpg 170w,
/static/c9cafec3abe45e91bbbaec46eb95c169/d30a3/mirleft_cats.jpg 340w,
/static/c9cafec3abe45e91bbbaec46eb95c169/7bf67/mirleft_cats.jpg 680w,
/static/c9cafec3abe45e91bbbaec46eb95c169/990cb/mirleft_cats.jpg 1020w,
/static/c9cafec3abe45e91bbbaec46eb95c169/c44b8/mirleft_cats.jpg 1360w,
/static/c9cafec3abe45e91bbbaec46eb95c169/f8beb/mirleft_cats.jpg 3421w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;However, not everything in Mirleft was about music and animals. Some things were also about the beauitful waves.&lt;/p&gt;
&lt;p&gt;Mirleft is a paradise for surfing, both for beginners and advanced surfers! We went to a nice sandy beach with perfect conditions to get started with surfing. Advanced surfers would probably go to one of the reefs for surfing, which we, in turn, found amazing for a peaceful walk, sometimes with and sometimes without company from a street dog we christened &lt;code&gt;null&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 401px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/49d62c1c5afdf2143a1efb9b0cb7bc1b/9144d/mirleft_dog.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 128.23529411764707%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAG/UlEQVR42h3S/VPThwGA8e+5ul13t2vvtt7snbtz+6W76bpab5sr64qorYpW8Q1E3oLhHUkCBkIwAZIQEvICgSQEEhIghPAeIEB4FQEFfMFTofUdcb6MbfVu1/0Bz677D567zyM8nvbxfNpN2K0lEhnj9pUR/NpcIh4tw041424tfdZiXj9dpaOpHunxfXiUYvq0mQxZixh1ljHqUDJYp2Q22IBwv7+WlS4zU+1Wrs4vMOhvpL7gLAHDRfrNUnp1mUy2Wfhu8xX9zRbajRJmAhbGHUomm9TMeDTMtVYTaargSpsZwaEU01yayVyog0ulamQZ8fjKRYy7VESalLSo03l6b4nhwQHqSsXM9dm4PtzMjN/IjFfLYpeZxaCJsK2EvppiBENePJbUA8iyMrDZXdi0cjzlYroNEjqNF7EqMgh2BenzuzFJz7DQW8figJ0Rh5J+UzHTLXquddYw49EzZC1D8NdpcClS6Orwk5YuRleYwYi9mB7TRaySMwTdtYRHR3HpSjDlnWawoYxRl4peUyH9NWX0GIqZ99tY8DvprZEjiJPjWQ638PrBXTIupFOUepxQrRS79BxOZQ6bG494+XgNfU4CruJM/JUlhGxqrnfbGW3UEraVM++pYcSmZtRWhvCzX3xI1BfR2GuquDszgttQTEPhWarSj7A8M8jmxhNmwz3UyJJoqcinRVXAgLWSXmMZEaeaEbuaSWcl8+0mBn4ofO+D7bz/y+1s276DQL0Zb7UCVUYcMwPtvF5/yItHdwk26LHKkuitVzLsUDPhUjFoktOhyqFbk4uvRMxgbSlDtcUIwpat/GjruxyI3kddpQqXRY9OU8H3/37Nk7U7rMyN4NUVUV+UQrehkFGHmqA2nystlcx6NQSUF3BLUxipvcRcqwYhJiYGmSQXQ1U53iYb4eEB+nu7uXdrkZfrD7kaakeb/jX1hYn0mGQEtRdpLohntEHB6kQjV/1V9FfnM+1UsOBVIQwEmpgf8jDR2cCQ10Qk5Meg15AtSiI7U4xTV0r5iSgaJWfoqc7CJkmguSSNq+0GZlr1XPHpCDcoiTQUM+dRIiyOB5npduKoKiEl8Qw5onOUynKJO3qY3R/v4uKpaHTn99NVIWLaUURrmYj6omQ69QUMWy8xVl9CV2U2nSoRHdpchOUrw8yH2/lmcYxqrYqi7FQK0hM4fGA/Rl0l6tJCjLJkOivSCJvzaC8TYck8SbMknqAmC09JKn5VFreG29i4v4wQCXXSWG/BZTNRXami4lIe0pwL1JmNuO11mJVKrAUypowq+vRZ+JRpWDNOYM+IxSw+gSVfxNrCNLeXrrN6+wbCzl1/YOeu37Nn925qDRUMBH10BwM0Ol0kpYpQnkvAI5Vyo9bOpFFNsyINhyQBo+gIifv20u9r4fs3LxkLD3JzLoKwZcs7CILAwZhofE02bJYanj24z+q9exw5fproP+7lmqWWb1taWHE5cMvTsOacpDorDmVBFl67jY2Hq6w/uMPqrTmEd7a++8OMvPf+z/l0z59ITkphc/0Jr9bXOZecTqm0kGmjmQfeFm7Z6wjVlFNblIo8OY6M8wnEfX2Mx2t3GQqF0OiqEX78k5+y7cNfERsbi75KR7AjwL82nrP54gWzVxeYGA5jLyyiX6lkVK3AoZRjrVKjURSy87cfEekL8PbVc97+8w3//c93CK2+FiLhQUL9Pfx5bxTFcgVv//GGOyt3WLq2yMajh2iL5WQeOkizNB9jRgoJcXGki9LJTklkaTLM4uwUm39/xtvNVwhrq/fRaKtIShZhMFpwNjbz/MlTxiNTrNy8zetn67S5nCTHfsXl5ATaFTIskmzE5xNxGbS0uxuZGgnx/NEaG4/XEEKDQzS6mlleXMLXFiAhMY2XGy+oszkwGE1YzLVY9VU0aNUUxp8koCqhSyVHlniKid4AGlUZO379GxZmJnj57AHC8WNH6ekfIjQY5rPP99Po8vDgm2+ZHJ9gbHQMt6uJUEcbTouR9KOHcMmldKjkWHJFdDst5OdkExX1V6bHwv/XFsRHP6co9wJOl4cPtu2gvFLHzOQ01+bmubG0yMLUJNenIsgkEhJjD2GT5tMol9BTdZk2dREScQo+TxOrt5fw+zwIWcf+RvLBT5BnxFOpVuNuacff0UldXT3pFzII9/UwPzVGXn4eMZ/9BXNBDna5lE6tmjFrNQGtgk5vEys3l9m162OEvFMxyFO+Iv/MF+Sc3odEdBbNZSVmk5lShQK/101kuB+ttpJL+fnUFkpoKiuh11jFsNXAUI2GVm0pwTYvn3y6B0GacIji5C9RiI4gPraXk1G/48s9HxF/OBpZXjY1VTq6O1pZmp9lfjyCSSbDWSKn12hgwKRn2KJnqKYCoyybZpeD/wFzWFn8IOBiigAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/49d62c1c5afdf2143a1efb9b0cb7bc1b/9144d/mirleft_dog.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Sweet null, our new friend!&quot; title=&quot;&quot; srcset=&quot;/static/49d62c1c5afdf2143a1efb9b0cb7bc1b/04472/mirleft_dog.png 170w,
/static/49d62c1c5afdf2143a1efb9b0cb7bc1b/9f933/mirleft_dog.png 340w,
/static/49d62c1c5afdf2143a1efb9b0cb7bc1b/9144d/mirleft_dog.png 401w&quot; sizes=&quot;(max-width: 401px) 100vw, 401px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;And, well, talking about &lt;code&gt;null&lt;/code&gt; (apart from naming street animals), we also had plenty of other computer science related conversations at the retreat. All of them were extremely enriching! A couple of examples include exception backtracing in LWT programs and BGP intrinsics.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#thanks-for-all-the-fish&quot; aria-label=&quot;thanks for all the fish permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Thanks for All the Fish!&lt;/h2&gt;
&lt;p&gt;As this lengthy report can attest, our experience was an amazing one for all. The MirageOS Hack Retreats are always an otherworldly space, where amazing individuals gather to exchange thoughts and create new (and better) software. Friends are made along the way, some bugs are fixed, new ones are found, and great new ideas emerges.&lt;/p&gt;
&lt;p&gt;This very special sense of community is rare, so we would like to thank everyone who organized, attended, and tended to the event. Thank you to our delightful hosts, who've been with us since the first retreat in 2016! Thank you as well to &lt;a href=&quot;https://robur.io&quot;&gt;Hannes and Robur&lt;/a&gt; for organizing those retreats and spending time instilling the same inspiration in the great project that is MirageOS! Finally, thank you to old and new friends, as well as old and new MirageOS hackers, for this amazing week of happy banter and hacking!&lt;/p&gt;
&lt;p&gt;PD: Some of the pics in this post were shared among us via &lt;a href=&quot;https://github.com/dinosaure/bob&quot;&gt;bob&lt;/a&gt;, a MirageOS unikernel to share files.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-10-28-the-mirageos-retreat-a-journey-of-food-cats-and-unikernels</id><title type="text">The MirageOS Retreat: A Journey of Food, Cats, and Unikernels</title><updated>2022-10-28T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-10-20-up-to-date-online-documentation" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#into-the-fire&quot; aria-label=&quot;into the fire permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Into the Fire&lt;/h2&gt;
&lt;p&gt;The OCaml ecosystem relies on various resources and infrastructure such as &lt;a href=&quot;https://ocaml.org&quot;&gt;ocaml.org&lt;/a&gt;, &lt;a href=&quot;https://hub.docker.com/r/ocaml/opam&quot;&gt;OCaml Docker images&lt;/a&gt;, &lt;a href=&quot;http://check.ocamllabs.io/&quot;&gt;opam-repo-ci&lt;/a&gt;, that are built and deployed using &lt;a href=&quot;https://www.ocurrent.org&quot;&gt;OCurrent&lt;/a&gt;. OCurrent is a library to express workflows and keep things up to date. As many of these projects are created using the same technology, it was interesting to centralise the documentation as it was spread throughout the various repositories. This post is about how we used OCurrent itself to automate this problem. We think it might also demonstrate how you can use OCurrent to automate some of yours!&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#cant-keep-my-eyes-off-you&quot; aria-label=&quot;cant keep my eyes off you permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Can't Keep My Eyes Off You&lt;/h2&gt;
&lt;p&gt;Before digging into the logic, it's essential to thoroughly define the problems in the documentation. The first problem was that the documentation lives in many GitHub repositories. Indeed, to make sure we update it whenever we modify the associated code, we keep the documentation closest to the code. The result is a repository organisation like this:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 401px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/13de7358e2149b6d1a660a4452c279bc/9144d/tracker.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 140.58823529411765%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD2ElEQVR42o1Va08bRxT1X2+lKCQQSNsoKiHQkn4ILUmrtmqVVkDNw2CwDcb4/cDGwsbr9dqu7d3Zx8yc6o7HyG0Bs9LRvTu7OrqPM/eG8MAjte1zjp1OB391OtgxzbFvWQphy8Jut4tty0JqOEToMYSmEHiVTuPp/j6ehMN4eXaGZ5EInkejWEwk1Pnnu7v4vdV6HGF7NMKvxSKSjoPz0QgX2qZsGxe2jbPhELHBAGXXfZhwQuoyBnswUO+ulHAAMACOlLClBJfy9v+ZhEEQQEp5G+1et4s3hQJWLi6wVijg28tLND1PfeOzCDnnYzIdQbPZxM+VCt4WCvg6mcRaPj8m9P3bbEIPkREmvhACnm1j5PsY6XRHQmAoBILHpEypThMLKVH0faQ9D1nXRZoxZFwXWc/DqW3D1P/fSUjREKajpOf7Wg2fhcOYi0TwIpHAk709LJycYD6ZRJGx+wknKRJupdNu46DdxpZpItzpjMXcbit/u9tFS9cxdFd0lO6/6iclbkwT3lTx5ZSspO4wyef/hERG9ZByLBkhlPZ+M01s1uv4UK9js1bD5tUVNioVbFxe4odqFe/rdSXy0IBz9KREX8P0ffQ4RycIwChlztHs9ZT2qF5LiQQWjo/xxfk5nh8eKsxHIngWjyNGd5ku/HIupzS1ksngrfaX83lUqNCco95o4Mb3YQiBFudjGwTKGpyjzTluOFdDJERFXc3n8a5YxFo2i29IrESez+OSMUjPQ90w0KRIOUcjCHDt+8onS5ictYMAoYEQ6AmBvrZtz0OXc5W6I4SKMGcYKuKFw0N8lUziy9NTLMViWIhE8DqdxhJJ5/gYfxjGjKZQp4WAxTl+abWwUSrhY72OH6+vsVmt4kOthp+ur/Hx6kpp9KjXQ0hOtV5q2fhBMCajdxI31cqy4FLXtUTEf6DO7pLN9HWbDAd6aq0WPjWb2LEsbJHANbZNE58MAznHeeTVozoCGAJYKZXw4uQEi7EY5o+O8JIkFI3iaTSKPct6eDhMolPknMMVAlnHUcgxppAl6zhIOw4aeibeS6ginETnOEiUyyrKv4VQIHUMpLxFV5+FZk1r6jZJar1SwXI6rYRPeJPJ4PXZmdLwai6HlXIZEeryzCWlb8Bmo4HVTAbrxSLelcvqAhDWSyWs68kd7fdn7xSKkORi0KKiBaUXE9O+o/2BnuCzt95ENtUqTns9pFwX53p1Jm0bKcdBfDS6fx7et5tJuN/Vapg7OsLcwQEW43HM7e/jVSqlJjaNrgkhewx8Idhhv8+2Oh223emwcLc7tpbF/rQsdsXUDmD/AGO5Q30gUeyvAAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/13de7358e2149b6d1a660a4452c279bc/9144d/tracker.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Tracking&quot; title=&quot;&quot; srcset=&quot;/static/13de7358e2149b6d1a660a4452c279bc/04472/tracker.png 170w,
/static/13de7358e2149b6d1a660a4452c279bc/9f933/tracker.png 340w,
/static/13de7358e2149b6d1a660a4452c279bc/9144d/tracker.png 401w&quot; sizes=&quot;(max-width: 401px) 100vw, 401px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;It's not a good judgement to count on humans' actions to monitor changes in all these repositories. As they fluctuate on their own time, we can't expect maintainers to backport documentation changes to the &lt;code&gt;ocurrent.org&lt;/code&gt; website for each modification. To say it more technically, we need to track many files and keep them up to date. These actions should also update incrementally which matches with OCurrent nicely.&lt;/p&gt;
&lt;p&gt;In addition, this documentation needs to stay up to date. Even if we centralise the documentation automatically, we must rebuild it regularly and fetch the changes from the repositories we track. Otherwise, the documentation will start to be outdated quickly. This is the opposite of what we want.&lt;/p&gt;
&lt;p&gt;Furthermore, the system has to scale and be updated easily. Indeed, we would like to have the possibility to introduce new documents and repositories without having to install more applications. For instance, it would be beneficial to simply make a pull request somewhere.&lt;/p&gt;
&lt;p&gt;In the next section, we will focus on the OCurrent pipeline design, which will automate our tasks and solve these problems.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#here-i-dreamt-i-was-an-architect&quot; aria-label=&quot;here i dreamt i was an architect permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Here I Dreamt I Was an Architect&lt;/h2&gt;
&lt;p&gt;The project is composed of several blocks we want to write to achieve our work:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fetch files from GitHub&lt;/li&gt;
&lt;li&gt;Rebuild a subset of the code&lt;/li&gt;
&lt;li&gt;Make the system modular&lt;/li&gt;
&lt;li&gt;Store and deploy the data easily&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;One aspect that will make our work a bit easier is to have it all concentrated in the same place, GitHub. As OCurrent provides a plugin to fetch information from GitHub, &lt;code&gt;current_github&lt;/code&gt;, we don't have to worry about it. Furthermore, everything is cached thanks to OCurrent itself. We don't have to care about the incremental build. The only requirement is wisely choosing the data we want to cache.&lt;/p&gt;
&lt;p&gt;Our architecture uses a &lt;code&gt;trackers.yml&lt;/code&gt; file describing how the pipeline should interact with our heterogeneous repositories. It describes the files we want to track and where we would like them in the final website structure. The configuration gives a way to achieve modularity at a low cost, as we only have to open a PR on the repository that contains the tracker file to update them. Additionally, it allows us to track the repositories we want quickly. Once it's followed, we don't have to worry about the monitoring, as OCurrent can be set to rebuild stuff at the regular cycle. In our case, we want to control every week that the code hasn't mutated. In the present version of &lt;code&gt;trackers.yml&lt;/code&gt;, we can specify the files we want to copy and the indexes we want to create to build our structure. This file is stored in the repository on which the &lt;code&gt;GitHub App&lt;/code&gt; is installed.&lt;/p&gt;
&lt;p&gt;Another critical component in the architecture is handling new files from the remote repository and integrating them into the website structure. This element is in charge of moving the piece from one part of the system to another. Moreover, it will have to ensure the paths are consistent and fail if not.&lt;/p&gt;
&lt;p&gt;The last item must push the code to a specific Git repository because we decided to use &lt;code&gt;GitHub Pages&lt;/code&gt; to store the website. To avoid issues with account management, it needs &lt;code&gt;ssh&lt;/code&gt; to get access to a specific repository.&lt;/p&gt;
&lt;p&gt;In the end, the pipeline design would look like this:
&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 379px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/6f25d575c0b498df6b0b07fe910849cc/811d1/pipeline.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 128.82352941176472%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEEElEQVR42pVWC1MaSRDm71+i0UtilGi0orkz6kUvdZW68nyEEFC0xAfCIiAEFNhdNjz2weKys/vddcMSzZkrb6u6+uueb3qZ7flmCPkYPGXHQdQwkLBt7He7SPR6I7zX7WLftjnes6xBzrI4jpomKjc3XMPzPBEKCmZubjAtSXh6cICFQgHPk0mMf/6MmVQKY9EowufnjMMUf/qEib095i7V68j0elxD3C54bttYqFaxUCxi8eoKrwoFzF5cYK5QwDzlKpVvY/k84/lCAa9lGWnb/nfBjhC47vdRFwI110Xd8xgrnoeSZaFoGFB8n8fk4Zg8nENzR0vGfzy+P3hdS9PwVVXv5H7AFyHh+zCEgOn70D2PrRN4IUCLOSsW2ezhSgJOwDM8D6bnwaVfSMl1TcNatYp1VcVGo4H3zSYb4fVGA79rGtv7VotzG6p6h7Ohafij00Gr3x8U/KVaxaPdXTyJxTCVTOLp4SEe7ezgSTzOnab8z4kEXpye4nEkghfHx5igsWiUY5rzrtlEkwrqQmBT17FjWdg2TWwbBv7SdTaOTRObnQ7blmGMcoS3dB1bt3DHdQdd7vv+veZ4Hqh/bV1Hs91mTLn7uO7/6fJ1pYKrcvlhXTaFQLrXw4XrIus4yN7cIBdgx0FeCMTqdbaC543y2X7/mzkOpF4PBi1ZFQKLtRqmTk8RliSEs1lMHh6yOl5ms+xJFS8lCVOpFKbOzjj/7OQEM+k0WziTwbKmQXYcEVJcF78qCqaJfHyM+ctLPCdfKGAul2M/m81yjl5IhV/lcsynQjQWTqexrKpQqMu0ZNIx/XTJcfiQyLouY4lwv48Tw8CpaY4+ixQsebh8nhcs+SFN0XUd7VbrblPuaQ43xfN9kPzcWz6wvucxMZvPI5vLMaac+x2P5wID6SUtCx+aTWzTZu50Bhu73Wa/RbGu44Om4U/i0MamzUzcdnvE27UsbBoGkqYpQnHbxlg8jrGPH1lOs5KEiVgMk/v7mD454RxJjzwdsiRBOmBnzs44xxKMRDBfKiFuWSIUN028VVWs1mpYlWWsEVYUrNRqjNcUBav1OlbqdbxrNAaxLOO3RoM98ZYrFaw0GogZhgh1g+PH99mCo4hjz4MFoGGaUHSdccC9PScwa9TlH8gp6Kgqy5BrtYdJT6MjXQiQYuQhJlOG8VcAR+UyG2ESAnHJK0OeMrwSGrSx6RokRSwWi3jz5QvelMtYKpfx+vKSbZm+0fU13tZqPDaXyWD+4gKLpRIW8nkslUqcJ6VE6RtGDANT6TRfiyyvTIYl+FMkgvF4HNPn53hGh+7REUtunA7bgwNMJhI8RvHjaBRzpRIiVDBl24h1uzgYXuR0iX9/0SdujQX5xPDyD/4AxLtdpP7ZNn8D7kZuwOCbyBYAAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/6f25d575c0b498df6b0b07fe910849cc/811d1/pipeline.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Pipeline&quot; title=&quot;&quot; srcset=&quot;/static/6f25d575c0b498df6b0b07fe910849cc/04472/pipeline.png 170w,
/static/6f25d575c0b498df6b0b07fe910849cc/9f933/pipeline.png 340w,
/static/6f25d575c0b498df6b0b07fe910849cc/811d1/pipeline.png 379w&quot; sizes=&quot;(max-width: 379px) 100vw, 379px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Now that we have our workflow let's see how it is implemented in practice!&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#this-is-how-we-do-it&quot; aria-label=&quot;this is how we do it permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;This is How We Do It&lt;/h2&gt;
&lt;p&gt;In this section, we will focus on the way to implement this infrastructure. We won't view all the elements in detail, but we will try to concentrate on the most important ones, like how to create a custom &lt;code&gt;ocurrent&lt;/code&gt; component and chain them together to build a pipeline.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#current_github&quot; aria-label=&quot;current_github permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code&gt;current_github&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;Let's focus on a standard structure in an OCurrent project: the way to get the HEAD of a branch on GitHub and fetch the commit with Git. In the related code, we find the HEAD, then ask GitHub to give us information about the HEAD commit on the default branch and finally get the content with Git (it returns the related commit):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; fetch_commit &lt;span class=&quot;token label property&quot;&gt;~github&lt;/span&gt; &lt;span class=&quot;token label property&quot;&gt;~repo&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; head &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Current_github&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;API&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;head_commit GitHub repo &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; commit_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    Current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;map Current_github&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Api&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Commit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id head
  &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; commit &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    Current_git&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fetch commit_id
  &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  commit

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; main &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; github &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;(* GitHub App code *)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; commit &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fetch_commit &lt;span class=&quot;token label property&quot;&gt;~github&lt;/span&gt; &lt;span class=&quot;token label property&quot;&gt;~repo&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;(* Use the commit code *)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The documentation of &lt;code&gt;current_github&lt;/code&gt; and &lt;code&gt;current_git&lt;/code&gt; is available &lt;a href=&quot;https://www.ocurrent.org/ocurrent/&quot;&gt;online&lt;/a&gt;.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fetching-the-files&quot; aria-label=&quot;fetching the files permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Fetching the Files&lt;/h3&gt;
&lt;p&gt;As we know how to extract data from GitHub, applying the process to various repositories will be easy. It can be noticed that the &lt;code&gt;commit&lt;/code&gt; element is of type &lt;code&gt;Commit.t Current.t&lt;/code&gt;. To work with &lt;code&gt;Current.t&lt;/code&gt;, we need to &amp;quot;unwrap&amp;quot; the object with specific functions like &lt;code&gt;map&lt;/code&gt; and &lt;code&gt;bind&lt;/code&gt;. This post does not present how to load the content from a &lt;code&gt;Yaml&lt;/code&gt; file. We assume that we get a &lt;code&gt;selection list Current.t&lt;/code&gt;, where &lt;code&gt;selection&lt;/code&gt; is defined as:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; selection &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  repo &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  commit &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Current_git&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Commit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t Current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  files &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt; list&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It contains the source repository, the commit associated with the specified branch, and the list of files to monitor from this repository.&lt;/p&gt;
&lt;p&gt;To &lt;code&gt;git clone&lt;/code&gt; the content, we must apply the &lt;code&gt;fetch_commit&lt;/code&gt; function.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#copy-the-content&quot; aria-label=&quot;copy the content permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Copy the Content&lt;/h3&gt;
&lt;p&gt;In this subsection, we will see how we can define a custom component and how to make it interact with the rest of our code.&lt;/p&gt;
&lt;p&gt;The component is in charge of fetching the content of the files from the source directory and storing it in memory. To trigger the action only when the content changes, we will define a &lt;code&gt;Current_cache&lt;/code&gt; element. Thanks to OCurrent, the content is cached and only rebuilt on change or request.&lt;/p&gt;
&lt;p&gt;It manipulates some &lt;code&gt;File.info&lt;/code&gt; (source, destination, &amp;hellip;) and produces a &lt;code&gt;File.t&lt;/code&gt; when the content is read. &lt;code&gt;File.t&lt;/code&gt; is simply a:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; File&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  metadata&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; File&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;info&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  content&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string list&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Our file is represented as a &lt;code&gt;string list&lt;/code&gt;, as we need to be able to add more information. We know the size of the files is limited, so it is not an issue for us.
The component is defined as a &lt;code&gt;Current_cache.BUILDER&lt;/code&gt; with whom the signature looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; BUILDER &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;sig&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; context

&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Key &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;sig&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; digest&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Value &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;sig&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; marshall &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; string
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; unmarshall &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; t
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; build &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  context &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
  Current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
  Key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
  Value&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t Current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;or_error Lwt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As the &lt;code&gt;Value&lt;/code&gt; and the &lt;code&gt;Key&lt;/code&gt; modules only use functions to manipulate &lt;code&gt;JSON&lt;/code&gt;, we can focus on the &lt;code&gt;build&lt;/code&gt; function definition:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; build files job &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;commit&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; Key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;repo&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  Current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;start job &lt;span class=&quot;token label property&quot;&gt;~level&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;Current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Level&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Average &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
  Current_git&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;with_checkout &lt;span class=&quot;token label property&quot;&gt;~job&lt;/span&gt; commit &lt;span class=&quot;token operator&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; dir &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
  extract &lt;span class=&quot;token label property&quot;&gt;~job&lt;/span&gt; &lt;span class=&quot;token label property&quot;&gt;~dir&lt;/span&gt; repo files
  &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; Lwt_result&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;return&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It creates a temporary directory with the content fetched from Git. Then, it extracts the data as a &lt;code&gt;File.t&lt;/code&gt; and returns the result. The interesting detail here is &lt;code&gt;Current_git.with_checkout fn&lt;/code&gt;. It is used to copy our code somewhere in the system temporarily. &lt;code&gt;Current.Job.start&lt;/code&gt; is just some boilerplate code to start a job asynchronously.&lt;/p&gt;
&lt;p&gt;Consequently, we can give the builder a functor to construct our cache system. Moreover, we create a function associated with it thanks to the &lt;code&gt;Content&lt;/code&gt; module newly created:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Content &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Current_cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Make &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Content&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; weekly &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Current_cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Schedule&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;v &lt;span class=&quot;token label property&quot;&gt;~valid_for&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Duration&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;of_day &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; fetch &lt;span class=&quot;token label property&quot;&gt;~repo&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt; commit files &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  Current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;component &lt;span class=&quot;token string&quot;&gt;&amp;quot;fetch-doc&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; commit &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; commit &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  Content&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get &lt;span class=&quot;token label property&quot;&gt;~schedule&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;weekly files
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;content&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;repo&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; Content&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;commit &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We specify the date when the cache is invalidated to trigger the rebuild at least every week.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#build--deploy&quot; aria-label=&quot;build  deploy permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Build &amp;amp; Deploy&lt;/h3&gt;
&lt;p&gt;In this last subsection, we discuss how to write all the files stored in the cache to the right place in the filesystem. We use &lt;code&gt;hugo&lt;/code&gt; to build the website and &lt;code&gt;git&lt;/code&gt; with &lt;code&gt;ssh&lt;/code&gt; to deploy it. As we expect the information to be cached, we build a &lt;code&gt;Current_cache&lt;/code&gt; module again, where the &lt;code&gt;build&lt;/code&gt; function is:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; build &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; files&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; indexes&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; conf &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; job &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;commit&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  Current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;start job &lt;span class=&quot;token label property&quot;&gt;~level&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;Current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Level&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Average &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
  Current_git&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;with_checkout &lt;span class=&quot;token label property&quot;&gt;~job&lt;/span&gt; commit &lt;span class=&quot;token operator&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; dir &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
  write_all job dir files indexes &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
  Lwt_result&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bind &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hugo &lt;span class=&quot;token label property&quot;&gt;~cwd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;dir job&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; f cwd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; commit &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Current_git&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Commit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hash commit &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
        deploy_over_git &lt;span class=&quot;token label property&quot;&gt;~cwd&lt;/span&gt; &lt;span class=&quot;token label property&quot;&gt;~job&lt;/span&gt; &lt;span class=&quot;token label property&quot;&gt;~conf&lt;/span&gt; dir commit
      &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
      Current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;with_tmpdir f&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In this context, the pipeline creates an &lt;code&gt;indexes&lt;/code&gt; file as &lt;code&gt;_index.md&lt;/code&gt;. It's used by Hugo to build the directory structure. This function uses the same &lt;code&gt;Current_git.checkout&lt;/code&gt; process to create a temporary directory containing the website's skeleton. All the work is done in the &lt;code&gt;deploy_over_git&lt;/code&gt; function, but this is not relevant to go further in detail. The component writes all the &lt;code&gt;File.t.content&lt;/code&gt; to the destination specified in their metadata. Once we have successfully written them, we generate the website with &lt;code&gt;hugo --minify --output-dir=public/&lt;/code&gt;. Last but not least, we copy the content of the &lt;code&gt;public&lt;/code&gt; repository to a fresh temporary one, so we can add the files with a &lt;code&gt;git init&lt;/code&gt; and push our work to GitHub. Finally, on the target repository, GitHub Pages will deploy the website.&lt;/p&gt;
&lt;p&gt;And voila, our website is up-to-date and online!&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#happy-together&quot; aria-label=&quot;happy together permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Happy Together&lt;/h2&gt;
&lt;p&gt;This blog post has described how we handle our distributed documentation and centralise it on our website. We have seen how to use some &lt;code&gt;Current_*&lt;/code&gt; plugins and how to write our own. It was also the occasion to speak about various OCurrent structures.&lt;/p&gt;
&lt;p&gt;If you are curious, you can check the code in the &lt;a href=&quot;https://github.com/ocurrent/ocurrent.org&quot;&gt;ocurrent/ocurrent.org&lt;/a&gt; repository. Feel free to look at the &lt;a href=&quot;https://ocurrent.org&quot;&gt;ocurrent.org&lt;/a&gt; built with this pipeline. The description of the pipeline is also available in the &lt;a href=&quot;https://github.com/ocurrent/ocurrent.org/tree/master/bin&quot;&gt;bin&lt;/a&gt; repository.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-10-20-up-to-date-online-documentation</id><title type="text">Up-to-Date Online Documentation</title><updated>2022-10-20T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-10-19-porting-charrua-unix-and-rawlink-to-eio" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;This article describes the porting of the DHCP daemon &lt;code&gt;charrua-unix&lt;/code&gt; and its companion library &lt;code&gt;rawlink&lt;/code&gt; to &lt;a href=&quot;https://github.com/ocaml-multicore/eio&quot;&gt;Eio&lt;/a&gt; for the upcoming OCaml 5 release. Before we get started, it makes sense to briefly describe what DHCP is and how we use it in production.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#what-is-dhcp&quot; aria-label=&quot;what is dhcp permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What is DHCP?&lt;/h1&gt;
&lt;p&gt;DHCP stands for Dynamic Host Configuration Protocol, and it's described in &lt;a href=&quot;https://www.rfc-editor.org/rfc/rfc2131.txt&quot;&gt;RFC2131&lt;/a&gt;, &lt;a href=&quot;https://www.rfc-editor.org/rfc/rfc2132.txt&quot;&gt;RFC2132&lt;/a&gt;, and others. It was first published in 1993, so it's considerably old, yet very much alive in virtually every network these days&amp;mdash;from your home, to your office, to your ISP Wide Area Network.&lt;/p&gt;
&lt;p&gt;When your computer, laptop, phone, or any IP-connected device boots up or changes network, it requests network parameters via broadcast. These parameters are requested and answered via the DHCP protocol. The common/minimum parameters a client requests are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;An IPv4 address&lt;/li&gt;
&lt;li&gt;An IPv4 gateway&lt;/li&gt;
&lt;li&gt;The address of a DNS resolver&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This is enough to get connectivity in most networks. DHCP can also provide many extra parameters, but they are outside of the scope of this document.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#what-is-charrua-dhcp&quot; aria-label=&quot;what is charrua dhcp permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What is &lt;code&gt;charrua-dhcp&lt;/code&gt;?&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;charrua-dhcp&lt;/code&gt; is a DHCP library suite written in pure OCaml. You might not know it, but if you have ever used Docker Desktop, be it on Windows or macOS, you're a user of &lt;code&gt;charrua-dhcp&lt;/code&gt; already !&lt;/p&gt;
&lt;p&gt;In Docker Desktop, a complete Linux VM is run in the background in order to be able to run Docker containers. This VM needs to acquire network parameters from the host operating system, and this is done via &lt;code&gt;charrua-dhcp&lt;/code&gt;. You can check more details on how OCaml and &lt;code&gt;charrua&lt;/code&gt; are used to power Docker Desktop in &lt;a href=&quot;https://www.docker.com/blog/how-docker-desktop-networking-works-under-the-hood/&quot;&gt;this article&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;charrua-dhcp&lt;/code&gt; is also the standard DHCP implementation used in &lt;a href=&quot;https://mirageos.org/&quot;&gt;Mirage OS&lt;/a&gt;, both when used as a server or a client, and perhaps more importantly, it is used on high profile, critical cases, like the home network of yours truly. It is a stable and tested library that has been in use for years, and it has also been put to the challenge against &lt;a href=&quot;https://github.com/stedolan/crowbar&quot;&gt;Crowbar&lt;/a&gt;. See more details in &lt;a href=&quot;https://somerandomidiot.com/blog/2017/04/26/crowbar-dhcp/&quot;&gt;this article&lt;/a&gt; by Mindy Preston.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;charrua-dhcp&lt;/code&gt; is split into &lt;code&gt;charrua-core&lt;/code&gt; and &lt;code&gt;charrua-unix&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;charrua-core&lt;/code&gt; implements the DHCP server and client logic in pure OCaml, as well as providing serialisers and deserialisers for the protocol wire format. It also provides a textual configuration interface, like &lt;a href=&quot;https://www.isc.org/dhcp/&quot;&gt;ISC-DHCP&lt;/a&gt; does.&lt;/p&gt;
&lt;p&gt;When we say pure OCaml, we mean it! &lt;code&gt;charrua-core&lt;/code&gt; is purely functional and doesn't produce anything via side-effects; therefore, it also does not perform any kind of I/O.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;charrua-unix&lt;/code&gt; implements the effect-full bits, and it does I/O, feeding incoming packets to &lt;code&gt;charrua-core&lt;/code&gt; and sending out replies given by &lt;code&gt;charrua-core&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The idea is that &lt;code&gt;charrua-core&lt;/code&gt; has the complex DHCP logic, while &lt;code&gt;charrua-unix&lt;/code&gt; does the basic things: logging, sending/receiving packets, making sure the environment is secure, and so on.&lt;/p&gt;
&lt;p&gt;The name &lt;code&gt;charrua&lt;/code&gt; is a reference to the seminomadic tribe Charr&amp;uacute;a from what is today Uruguay, Argentina, and southern Brazil. The rationale is that DHCP serves parameters to roaming (nomadic) clients.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#what-is-rawlink&quot; aria-label=&quot;what is rawlink permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What is &lt;code&gt;rawlink&lt;/code&gt;?&lt;/h1&gt;
&lt;p&gt;DHCP is not an IP protocol. It sits above the Ethernet layer, which means a DHCP application must be able to craft and receive the full Ethernet packet, not just the layers above IP.&lt;/p&gt;
&lt;p&gt;Each operating system provides a slightly different mechanism on how to accomplish this. Linux provides a special socket family called AF_SOCKET, whereas BSDs (OpenBSD, FreeBSD, macOS...) and most other Unix systems provide the same via BPF.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;rawlink&lt;/code&gt; is an OCaml library with C stubs that abstracts these differences away. You get a link on a network interface, which you use to craft and receive full Ethernet packets, bypassing most of the operating system network stack. In other words, &lt;code&gt;rawlink&lt;/code&gt; allows you to work with &lt;code&gt;raw&lt;/code&gt; packets on an Ethernet &lt;code&gt;link&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/caca7d8be3e9041f4b48945ca49762f5/ab98c/charrua.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 128.23529411764707%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAADRklEQVR42qWUaW/jNhCG/f//TfupRZEP22w2PpI4cWzH9xnbkmUd1k1K1LOgfGTdTbZIO8ALasjhg5FmNJXw9oa4USOuV/+fqt/YNx+oJHd1xOMDonn/k2TznuS+wfLqL3Y318gP4krdN/BbLSph9ZaoUSe+q5drdKefG2fpvX31G36tejj/QRdxtSpus0kl3FpEls12tsRbGwTmFne9xltvcFdrAlOf70qF2zfpOzpexxmTGYGxJbJdKhxNyoxcKebLV7q9PqPJlMF4QipkeV4UnK04OpPZnHa3R3KM0VYJw5A4ToiThDiK8VwPx3GJ45goisv1UhFJHBEEPp7nEYZBuXeIj6gkSUqhJNJ/QQUdpPdM4jxRhC9k+za59FEKlCrIZYw0n8jMFmrbLpVv2wdfhriuT0XodIuUYl8Hv4E9v8JeXKG8OuyrFNJ+e1URULzeol4b2J2rUtmiBqsapB6eH52AAuVVwa8hdl8Ru2sKr4rybn4CqsV1CU0mX0gnX1DLW4rlVxBHYCqEDqUQJqEzpEjXIDblWkqJN6DKKPzlQcErhCsCo4/aL6DI8PY+lTRNzxfSVJKrguJYVaWl1Lmq75lO6HTueftLYBSF9Ho9RqMR4/GI0WhIv9/Hdd3yXMOlFCS6omGIlLJUUaj3gXmekyQJek8riuPSV8UhayEltu0wGAzodDpl2+jsPszwn6bynCzLeGt+WX7vj+yXQJnDxklY7SLcGOxQYbgCN8w/RL4LPAXbQUZ3ldF5FTxOAlqzqPQHhkTm6j8A/YzeRvE8j7jtGDT6O/qbnKGRITP1+VcOEsXYlMysjKWjWNg5w03CysnL3/DTwFOb5Mei6AK5jkOSxGU3fAqoQXpy+P6+nCbadLWHw0O7+L5/Mcb+Faj3dEPPZzNm0xlCiMusP5uhNp2FyAWZHm15SpodJZPPAYtjne3QorV+pLV6pLl44GnZLP2e2SVT2a+A4jziDwPhALRCi7bxTG1Y5fe/f+PP+h88r1u8mF1EJsr+Ot15A/ofZ+glDl2zTW/b5cVo0zXavGy7jHZ98h8y1IU5DQnLsqnsdk5Jdt39hRzHY2OZZxmWydoyMHfWRZxtu0ync8bjKaPxlO9L0cNJXs7d6AAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/caca7d8be3e9041f4b48945ca49762f5/c5bb3/charrua.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;charrua&quot; title=&quot;&quot; srcset=&quot;/static/caca7d8be3e9041f4b48945ca49762f5/04472/charrua.png 170w,
/static/caca7d8be3e9041f4b48945ca49762f5/9f933/charrua.png 340w,
/static/caca7d8be3e9041f4b48945ca49762f5/c5bb3/charrua.png 680w,
/static/caca7d8be3e9041f4b48945ca49762f5/b12f7/charrua.png 1020w,
/static/caca7d8be3e9041f4b48945ca49762f5/b5a09/charrua.png 1360w,
/static/caca7d8be3e9041f4b48945ca49762f5/ab98c/charrua.png 2356w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#what-changes-in-ocaml-5&quot; aria-label=&quot;what changes in ocaml 5 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What Changes in OCaml 5?&lt;/h1&gt;
&lt;p&gt;OCaml 5 provides two main new features:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Parallelism&lt;/li&gt;
&lt;li&gt;Effect handlers&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Parallelism makes little sense on a slow, control protocol like DHCP, so we don't use it and it's not the focus of this article.&lt;/p&gt;
&lt;p&gt;Effect handlers allow OCaml programs to write non-blocking code as &lt;em&gt;if&lt;/em&gt; they were blocking.&lt;/p&gt;
&lt;p&gt;Until OCaml 5 and effect handlers, the common way to write non-blocking code was through &lt;a href=&quot;https://github.com/ocsigen/lwt&quot;&gt;Lwt&lt;/a&gt;, a concurrent programming library for OCaml. Lwt provides a concurrent scheduler and a monadic style of writing programs through promises. With it, the program becomes a long string of binding promises.&lt;/p&gt;
&lt;p&gt;One issue with Lwt is that it's very &amp;quot;infectious,&amp;quot; and as soon as you add the first Lwt promise (called &amp;quot;thread&amp;quot; in Lwt lingo), the whole code must now behave as a promise as well. Another issue is that the monadic programming is somewhat syntax heavy, so it can clutter the code. Since the promises are allocations themselves, it can also negatively affect performance. Lwt is a great library, but with OCaml 5 and effects we can do better.&lt;/p&gt;
&lt;p&gt;With OCaml 5 and effect handlers we can have the best of both worlds. We can write non-blocking code in a blocking style without the monadic clutter imposed by Lwt. The library we are proposing to replace Lwt in OCaml 5 is &lt;a href=&quot;https://github.com/ocaml-multicore/eio&quot;&gt;Eio&lt;/a&gt;, which takes full advantage of the effect system, as well as providing a framework to express parallelism.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#lwt-vs-eio&quot; aria-label=&quot;lwt vs eio permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Lwt vs. Eio&lt;/h2&gt;
&lt;p&gt;This code snippet is the main function of &lt;code&gt;charrua-unix&lt;/code&gt;, using Eio (left) and Lwt (right). We can summarize what is happening as follows:&lt;/p&gt;
&lt;p&gt;1 - We read a packet from the network.
2 - We feed the packet to &lt;code&gt;charrua-core&lt;/code&gt;, which then gives us a possible &lt;code&gt;Reply (reply, db)&lt;/code&gt;, the packet to be sent out and the new DHCP database state, respectively.
3 - We send the reply out and loop for more packets.&lt;/p&gt;
&lt;p&gt;It's a fairly simple code, but it shows how much less cluttered the Eio version can be by removing all Lwt decorators. Another nice advantage is that if we were to write a blocking version of the same code, we would only need to change &lt;code&gt;Eio_rawlink.{read,write}_packet&lt;/code&gt; to &lt;code&gt;Rawlink.{read,write}_packet&lt;/code&gt; as their signatures remain the same, something impossible with Lwt.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/2a50353585ea9fc610d27062d645f482/9b29b/code_Eio.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 28.235294117647058%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvklEQVR42m1Q0W6DMAwkCSRlpZSvKHFIKMR2gGj//10T0lhZN+nsB59Pd3bRxrWZculY9FH0WPTxBwaom7b6uUng8/yFjnIz549puwTWA0kgcXCV4xvm63NRQMpGBSTsmxizHlcdkhmT8VQ6lvDtLy3ecbuMaxWS9qgHUkC/xHVIxnPpUzmwsFFYFPYVvo1Li59VWIxH7Vk5PrPFXo9YPOa9/7mqmdc6sHQkARWgtCjOC/9/4ohtxmXP9WZ44AvH5y0zJGHlegAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/2a50353585ea9fc610d27062d645f482/c5bb3/code_Eio.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;code Eio&quot; title=&quot;&quot; srcset=&quot;/static/2a50353585ea9fc610d27062d645f482/04472/code_Eio.png 170w,
/static/2a50353585ea9fc610d27062d645f482/9f933/code_Eio.png 340w,
/static/2a50353585ea9fc610d27062d645f482/c5bb3/code_Eio.png 680w,
/static/2a50353585ea9fc610d27062d645f482/b12f7/code_Eio.png 1020w,
/static/2a50353585ea9fc610d27062d645f482/b5a09/code_Eio.png 1360w,
/static/2a50353585ea9fc610d27062d645f482/9b29b/code_Eio.png 3840w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#rawlink-and-eio-switches&quot; aria-label=&quot;rawlink and eio switches permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code&gt;rawlink&lt;/code&gt; and Eio Switches&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;rawlink&lt;/code&gt; uses a file descriptor that Eio knows nothing about, so in order for us to use Eio with it, we want to attach an &lt;code&gt;Eio.Flow.t&lt;/code&gt; to the file descriptor. An &lt;code&gt;Eio.Flow.t&lt;/code&gt; is an Eio abstraction of a bidirectional &lt;code&gt;socket&lt;/code&gt;, even though it was designed mostly for a &lt;code&gt;STREAM&lt;/code&gt;-like &lt;code&gt;socket&lt;/code&gt; in mind, the semantics fit &lt;code&gt;rawlink&lt;/code&gt; case. We do this in &lt;code&gt;Rawlink_eio.opensock&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; open_link &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;filter &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;promisc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ifname &lt;span class=&quot;token label property&quot;&gt;~sw&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; fd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Rawlink_lowlevel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;opensock &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;filter&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;filter &lt;span class=&quot;token label property&quot;&gt;~promisc&lt;/span&gt; ifname &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; flow &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Eio_unix&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;FD&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;as_socket &lt;span class=&quot;token label property&quot;&gt;~sw&lt;/span&gt; &lt;span class=&quot;token label property&quot;&gt;~close_unix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; fd &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; flow&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; fd&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; packets &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ref &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; buffer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Cstruct&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;create &lt;span class=&quot;token number&quot;&gt;65536&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;Rawlink_lowlevel.opensock&lt;/code&gt; is a call into the actual C stub that returns a BPF or AF_PACKET descriptor, we then create the &lt;code&gt;Eio.Flow.t&lt;/code&gt; with &lt;code&gt;Eio_unix.FD.as_socket&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Two things appear out of the ordinary in the flow creation call: The &lt;code&gt;sw (Eio.Switch.t)&lt;/code&gt; and &lt;code&gt;close_unix&lt;/code&gt; arguments, in order to make sense of them we have to understand what an &lt;code&gt;Eio.Switch.t&lt;/code&gt; is.&lt;/p&gt;
&lt;p&gt;A long standing issue with Lwt was &amp;quot;how to make sure my file descriptors are not leaked if something goes wrong.&amp;quot; Eio attempts to solve this by forcing each &lt;code&gt;Eio.Flow.t&lt;/code&gt; to belong to a &lt;code&gt;Eio.Switch.t&lt;/code&gt;. You can't create a &lt;code&gt;Eio.Flow.t&lt;/code&gt; without giving it a &lt;code&gt;Eio.Switch.t&lt;/code&gt;, so this is what the &lt;code&gt;Eio_unix.FD.as_socket&lt;/code&gt; does. Since &lt;code&gt;Flows&lt;/code&gt; are also attached to normal file descriptors, &lt;code&gt;Eio.Switch.t&lt;/code&gt; also takes care of them.&lt;/p&gt;
&lt;p&gt;An Eio program creates one or more &lt;code&gt;Eio.Switch.t&lt;/code&gt; in order to attach a &lt;code&gt;Eio.Flow.t&lt;/code&gt; to it. An &lt;code&gt;Eio.Switch.t&lt;/code&gt; can also be nested, creating a tree-like structure, as every new &lt;code&gt;Eio.Switch.t&lt;/code&gt; becomes a child of its parent &lt;code&gt;Eio.Switch.t&lt;/code&gt;. When an &lt;code&gt;Eio.Switch.t&lt;/code&gt; terminates, either succesfully or by some exception, all of its children &lt;code&gt;Eio.Flow.t&lt;/code&gt; are also terminated, automatically closing the file descriptor and guaranteeing we don't have a descriptor leak.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;close_unix&lt;/code&gt; tells Eio to call &lt;code&gt;close(2)&lt;/code&gt; when the &lt;code&gt;Eio.Switch.t&lt;/code&gt; terminates.&lt;/p&gt;
&lt;p&gt;Imagine a TCP server where each client has at least one dedicated &lt;code&gt;Eio.Switch.t&lt;/code&gt;, and some of these clients create additional &lt;code&gt;Eio.Switch.t&lt;/code&gt; to handle a specific unit of work:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/3d6e942b36d24d68b9c132d5d9720910/70d4c/switch.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 102.94117647058825%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAClklEQVR42p1UiW7aQBDl/3+nbZBapVGSpgEalBRKuS9DbMDG13rvXb8Kc6QoQaEdabXSzOzTzJs3W8I7liMv7iBbob/sob/oYeQPkAlyFN9b6VzAaTTB1a8rlKtl1MY1rGJ/G8//EXBvRGRwQw/PgYtl7INL8Wbe2YAbU0ohy+iblf0XoLsW+DVNQLg5mXMScFOBMaY41hhIZfA4iFDphOjNElijX+LWvg+YUQpKKRhju0Phrhm6c4qFn4BzdogRQg4UnASklJ3gKd+d49x9lScB0zSFteYVFN7wbCrctH4EuNdbyhMMgwF+jp4w8PsISHCiSoArjkk4LnJ7iy68xPsLcNeen61QHVVwcf8JleE9xqvJSbGnIkXdqaNcucBt+wYdt4vSBsdYC6V1cVPB4CxnePZdTD0HEYkLvzYGWhts8vfUGmsQkhBu4BWbk9B0W2GSxMW0OBeQQkErDUYZpJCQUhV+ISQozcA5fyXsjGSwZjcUKnIMXQIutw5lJIhMMffniFkEqeXh4dynmHjJUfva5hh5BGuitoBtJ8Vda4XmMDhw+K1ziy/1z7htX2Oy4zBlFl8fJrisjRARfQCcrRi+t3w8dAMwoVByQ4nmhGLspkVCwhM0pk1Uf9fwNHqCFy4Kv9A5GsMI9Y4PQtUBMM40Wg5Dx0mhlN4MJQdlshCmFKLgLk0JGONI4rTYFrHjTRkLKV/vMeO6WM0jHRpj4a/j4i5aD2JovW1tFURQ2pz1gZT2Mh15Ger9CH4isQgFfvQizHyGkCg8DhL0njNoY098wi9bVNrqKcd9w8GH6xaa/SUafQ8fb9qoNh30nQDluy4uqwNkTO4kg/e/r0xYzHwOyiWUzjH3BeKUw9ocm8GtInZWy38AQodde6NKPlEAAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/3d6e942b36d24d68b9c132d5d9720910/c5bb3/switch.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;switch&quot; title=&quot;&quot; srcset=&quot;/static/3d6e942b36d24d68b9c132d5d9720910/04472/switch.png 170w,
/static/3d6e942b36d24d68b9c132d5d9720910/9f933/switch.png 340w,
/static/3d6e942b36d24d68b9c132d5d9720910/c5bb3/switch.png 680w,
/static/3d6e942b36d24d68b9c132d5d9720910/b12f7/switch.png 1020w,
/static/3d6e942b36d24d68b9c132d5d9720910/b5a09/switch.png 1360w,
/static/3d6e942b36d24d68b9c132d5d9720910/70d4c/switch.png 2548w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Both Lwt and Eio provide means to achieve concurrency, but they only provide parallelism with &lt;code&gt;Domains&lt;/code&gt;. Lwt uses monadic-style promises to achieve concurrency, which pollutes the code and makes it harder to reason about it. Eio makes full use of the new effect handlers and Domains of OCaml 5, providing concurrency and parallelism while maintaining the same programming style of synchronous blocking programs.&lt;/p&gt;
&lt;p&gt;Eio is a library that aims to replace Lwt, but with a more modern style and feature set. It provides abstractions for sockets, fibers, streams, flows, and more.&lt;/p&gt;
&lt;p&gt;To review,&lt;code&gt;charrua-unix&lt;/code&gt; is a feature-packed, yet simple DHCP server implementation for Unix systems based on the OCaml library &lt;code&gt;charrua-core&lt;/code&gt;.&lt;code&gt;rawlink&lt;/code&gt; makes it possible to read and craft Ethernet packets on most Unix-like systems through an easy-to-use library.&lt;/p&gt;
&lt;p&gt;It's relatively easy to port &lt;code&gt;rawlink&lt;/code&gt; to Eio by attaching an Eio abstraction of a bidirectional socket, namely &lt;code&gt;Eio.Flow.t&lt;/code&gt;, to the file descriptor.&lt;/p&gt;
&lt;p&gt;We hope you enjoyed this article and found it helpful. As always, if there are any questions or concerns, feel free to &lt;a href=&quot;https://tarides.com/company&quot;&gt;reach out&lt;/a&gt;.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-10-19-porting-charrua-unix-and-rawlink-to-eio</id><title type="text">Porting Charrua-Unix and Rawlink to Eio</title><updated>2022-10-19T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-10-18-ocaml-s-platform-installer-alpha-release" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Yesterday we announced the &lt;a href=&quot;https://tarides.com/blog/2022-10-17-ocaml-5-beta-release&quot;&gt;OCaml 5 beta release&lt;/a&gt;, and today we're excited to introduce the OCaml Platform Installer! The &lt;a href=&quot;https://ocaml.org/docs/platform&quot;&gt;OCaml Platform&lt;/a&gt; is the recommended toolchain when working with OCaml. This new installer enables programmers to quickly set up the OCaml developer environment, so they don't need to waste precious coding time with a lengthy installation process. If you come across any obstacles, the Platform team encourages you to open a &lt;a href=&quot;https://github.com/tarides/ocaml-platform-installer/issues&quot;&gt;GitHub Issue&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We've also updated the state of the Platform, making several important changes like promoting &lt;code&gt;odoc&lt;/code&gt; and OCamlformat from Incubate to Active. We have &lt;a href=&quot;https://discuss.ocaml.org/t/ann-ocaml-platform-installer-alpha-release/10652&quot;&gt;notified the OCaml Community&lt;/a&gt; about the Platform Installer's alpha release, so you can read about all the new changes and the simple installation process on the &lt;a href=&quot;https://discuss.ocaml.org/t/ann-ocaml-platform-installer-alpha-release/10652&quot;&gt;OCaml Discuss post&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Stay tuned to our blog as well as our &lt;a href=&quot;https://twitter.com/tarides_&quot;&gt;Twitter feed&lt;/a&gt; to get the latest updates on the OCaml 5 release!&lt;/p&gt;</content><id>https://tarides.com/blog/2022-10-18-ocaml-s-platform-installer-alpha-release</id><title type="text">OCaml's Platform Installer Alpha Release</title><updated>2022-10-18T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-10-17-ocaml-5-beta-release" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Back in June, we announced the &lt;a href=&quot;https://tarides.com/blog/2022-06-15-ocaml-5-alpha-release&quot;&gt;OCaml 5 alpha release&lt;/a&gt;, and today we're excited to announce &lt;a href=&quot;https://discuss.ocaml.org/t/ocaml-5-0-0-first-beta-release/10623&quot;&gt;the first beta release&lt;/a&gt;! Now is an excellent time to test it and report positive or negative feedback on your projects (i.e., did it work, did you see impressive performance speed up, did you have issues finding documentation, etc.)&lt;/p&gt;
&lt;p&gt;This beta version stabilised several &lt;a href=&quot;https://opam.ocaml.org/&quot;&gt;opam&lt;/a&gt; packages, fixed several small internal runtime processes (especially the &lt;code&gt;systhreads&lt;/code&gt; library), and tweaked the Domain and Effect interface, just to name a few improvements. This version also enables you to update your libraries and software. See the &lt;a href=&quot;https://discuss.ocaml.org/t/ocaml-5-0-0-first-beta-release/10623&quot;&gt;post on the OCaml Discuss forum&lt;/a&gt; for installation instructions and more information. While you're there, join the growing and vibrant OCaml community!&lt;/p&gt;
&lt;p&gt;The full OCaml release is expected by the end of the year. Just in time for Christmas! Perhaps more importantly, in time for the new &lt;a href=&quot;https://adventofcode.com/&quot;&gt;Advent of Code calendar&lt;/a&gt;, so you can play around with OCaml 5 with Multicore support.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-10-17-ocaml-5-beta-release</id><title type="text">OCaml 5 Beta Release</title><updated>2022-10-17T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-10-14-real-world-ocaml-book-giveaway" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;&lt;em&gt;Real World OCaml is a fantastic book on OCaml and functional programming &amp;ndash; a great resource for beginners and experienced users alike. At Tarides, we want to support new learners of OCaml as much as we can, making it easier for people to become part of the vibrant community surrounding the language.&lt;/em&gt;
Tarides is proud to announce that we are sponsoring the Gold Open Access release of &lt;a href=&quot;https://www.cambridge.org/core/books/real-world-ocaml-functional-programming-for-the-masses/052E4BCCB09D56A0FE875DD81B1ED571&quot;&gt;&lt;em&gt;Real World OCaml&lt;/em&gt;, 2nd Edition&lt;/a&gt; by Yaron Minsky and Anil Madhavapeddy! It&amp;rsquo;s published by Cambridge University Press, and Tarides is making it possible for everyone to download the book to their local device. You can also receive free copies of the book (see below).&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#accessible-to-everyone-and-free-copies&quot; aria-label=&quot;accessible to everyone and free copies permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Accessible to Everyone and Free Copies&lt;/h2&gt;
&lt;p&gt;Since its first release in 2013, the book has been a fantastic resource for members across the community. On the Open Access release, its authors said, &amp;ldquo;As long-standing members of the open-source community, we are excited to see our work made more accessible for all users of OCaml.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;The authors and publisher have generously agreed to give away some physical copies of &lt;em&gt;Real World OCaml&lt;/em&gt;. They really want to reward the amazing and active members of the community who are so engaged with the book. That&amp;rsquo;s why &lt;em&gt;ten people&lt;/em&gt; who get a PR merged with a suggested improvement to the book on &lt;a href=&quot;https://github.com/realworldocaml/book&quot;&gt;GitHub&lt;/a&gt; will receive a &lt;em&gt;free copy&lt;/em&gt; of &lt;em&gt;Real World OCaml!&lt;/em&gt; Just email &lt;a href=&quot;mailto:rwo@tarides.com&quot;&gt;rwo@tarides.com&lt;/a&gt; when your PR has been merged, and we'll let you know if you're one of the lucky 10 who receive a book!&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#gold-open-access&quot; aria-label=&quot;gold open access permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Gold Open Access&lt;/h2&gt;
&lt;p&gt;Until recently, you could read &lt;em&gt;Real World OCaml&lt;/em&gt; online, but for offline access, you had to rely on the printed version. With Gold Open Access, you can now download a PDF to your local device for easy access at any time.&lt;/p&gt;
&lt;p&gt;Whilst this expanded access will benefit everyone, one group that we are particularly excited to support are new learners. OCaml 5.0 is right around the corner, and we want to make the entry to OCaml for new users as easy as possible. Making the book more accessible also aligns with Tarides&amp;rsquo;s inclusivity goals; lowering the barriers to entry into the community will encourage greater participation among people who otherwise would not have had the means to join.&lt;/p&gt;
&lt;p&gt;On this topic, David Tranah, the editorial director of Mathematical Sciences and Information Technology at Cambridge University Press, shares his unique insight into the benefits of Open Access: &amp;ldquo;Gold Open Access publishing allows anyone, anywhere, who can connect to the internet to stay up-to-date on the latest research. This in turn drives innovation and leads to new discoveries.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;We of course encourage anyone with the means to purchase a physical copy of the book, as it&amp;rsquo;s the result of a lot of hard work and dedication, and it comes in a beautifully printed physical edition.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#real-world-ocaml&quot; aria-label=&quot;real world ocaml permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Real World OCaml&lt;/h2&gt;
&lt;p&gt;The first version of Real World OCaml was written by Yaron Minsky, Anil Madhavapeddy, and Jason Hickey. Since its release, several contributors have improved on the original text, adding new examples, correcting errors, and expanding on chapters. The second edition was published in 2021 by Anil and Yaron and includes the most recent improvements and changes for an updated version of the book.&lt;/p&gt;
&lt;p&gt;The book itself covers several aspects of OCaml, from fundamental concepts like functors and objects, to different tools and techniques, including the OCaml Platform and JSON, as well as a section on the compiler and runtime system. It takes its reader on a journey through OCaml moving from basics to increasingly advanced topics, making it the perfect companion for anyone regardless of their level of OCaml.&lt;/p&gt;
&lt;p&gt;Over the years, Tarides has supported Real World OCaml by contributing to the book&amp;rsquo;s tooling infrastructure. Some of that work has transformed into &lt;a href=&quot;https://github.com/realworldocaml/mdx&quot;&gt;standalone community projects like MDX&lt;/a&gt; that help to improve all OCaml documentation.&lt;/p&gt;
&lt;p&gt;The book also has a mutually beneficial relationship with OCaml.org, as Thibaut Mattio (currently leading the &lt;a href=&quot;https://tarides.com/blog/2022-05-02-ocaml-org-reboot-user-centric-design-content&quot;&gt;community redesign effort&lt;/a&gt; of &lt;a href=&quot;https://ocaml.org&quot;&gt;OCaml.org&lt;/a&gt;) explains: &amp;ldquo;There are crosslinks between &lt;em&gt;Real World OCaml&lt;/em&gt; and V3 of OCaml.org. The new package documentation site is a great accompaniment to Real World OCaml, and there are multiple links to it embedded within the book for API documentation.&amp;rdquo; This is just one example showing how &lt;em&gt;Real World OCaml&lt;/em&gt; is used in projects and interacting with new content in a productive and useful way.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#about-the-authors&quot; aria-label=&quot;about the authors permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;About the Authors&lt;/h2&gt;
&lt;p&gt;Anil Madhavapeddy is Professor of Planetary Computing at the University of Cambridge and a fellow of Pembroke College. He has a wide range of experience, having worked in industry (NetAPP, Citrix, Intel), academia (Cambridge, Imperial, UCLA), and open source (OCaml, OpenBSD, Xen, Docker).
Joining Jane Street in 2003, Yaron Minsky is to thank for introducing the company to OCaml. Founding the firm&amp;rsquo;s quantitative research group, he managed the transition of all its core infrastructure to OCaml, ultimately making it the world&amp;rsquo;s largest industrial user of OCaml. Minsky has also been an avid lecturer, blogger, and writer on the topic of programming, publishing articles in &lt;em&gt;Communications of the ACM&lt;/em&gt; and the &lt;em&gt;Journal of Functional Programming.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Summing up their thoughts on the Open Access upgrade, Anil and Yaron say: &amp;ldquo;Open Access has been shown to encourage the usage of a particular work, resulting in increased citations and public engagement. We are excited for what this move will mean when it comes to greater accessibility for users of OCaml worldwide: making it easy to use excerpts from our book in new projects, encouraging new learners, and supporting teachers in their work.&amp;rdquo;&lt;/p&gt;</content><id>https://tarides.com/blog/2022-10-14-real-world-ocaml-book-giveaway</id><title type="text">Real World OCaml Book Giveaway!</title><updated>2022-10-14T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-10-12-8-ocaml-libraries-to-make-your-life-easier" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;OCaml is a statically-typed programming language that emphasizes readability, programmer efficiency, and semantic clarity. This powerful and efficient language has been gaining popularity among developers. The growing adoption of OCaml is because it's fast, type safe, and secure. It can be used in industries where performance and security matter, like &lt;a href=&quot;https://ocaml.org/success-stories/sensor-analytics-and-automation-platform-for-sustainable-agriculture&quot;&gt;IoT&lt;/a&gt;, &lt;a href=&quot;https://ocaml.org/success-stories/peta-byte-scale-web-crawler&quot;&gt;Data Analytics&lt;/a&gt;, or &lt;a href=&quot;https://ocaml.org/success-stories/large-scale-trading-system&quot;&gt;financial services&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Like any other programming language, there are numerous libraries available for OCaml that can make your life easier as a developer. In this article, we will explore some of the top OCaml libraries that will help streamline your workflow and boost your productivity as a programmer.&lt;/p&gt;
&lt;p&gt;All these libraries and tools are open source, so they&amp;rsquo;re distributed under a free software licence.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#a-few-helpful-ocaml-libraries&quot; aria-label=&quot;a few helpful ocaml libraries permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A Few Helpful OCaml Libraries&lt;/h2&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#lwt&quot; aria-label=&quot;lwt permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;strong&gt;&lt;code&gt;Lwt&lt;/code&gt;&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ocsigen/lwt&quot;&gt;Lwt&lt;/a&gt; is a library for writing asynchronous code. It provides many helpful abstractions for writing asynchronous code such as promises and futures. This is a very useful library for writing network applications, like web servers. That said, the &lt;a href=&quot;https://ocaml.org/p/eio/0.5&quot;&gt;Eio library&lt;/a&gt; in the forthcoming release of OCaml 5.0 might become preferable!&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#dream&quot; aria-label=&quot;dream permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;strong&gt;Dream&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;Dream is described as a &amp;quot;tidy, feature-complete Web framework&amp;quot; on &lt;a href=&quot;https://ocaml.org/p/dream/1.0.0~alpha4&quot;&gt;OCaml.org&lt;/a&gt;. Dream has a simple programming model where web apps are merely functions, and it supports TLS, WebSockets, and GraphQL. Plus it has cryptography helpers! It's easy-to-use and documented &lt;a href=&quot;https://aantron.github.io/dream/&quot;&gt;all in one place&lt;/a&gt;. The entire Dream API is available there, where you can also find many examples.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#cmdliner&quot; aria-label=&quot;cmdliner permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;strong&gt;&lt;code&gt;Cmdliner&lt;/code&gt;&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://ocaml.org/p/cmdliner/1.1.0/doc/index.html&quot;&gt;This library&lt;/a&gt; is used by several packages to build command line tools, which is beneficial when you want to write an executable in OCaml. &lt;code&gt;Cmdliner&lt;/code&gt; gives programmers a simple, compositional method for turning command line arguments into OCaml values. Not only can you then pass those values to functions, &lt;code&gt;Cmdliner&lt;/code&gt; can automatically handle syntax errors, help messages, and UNIX man page generation as well.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#alcotest&quot; aria-label=&quot;alcotest permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;strong&gt;Alcotest&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;This colorful framework performs simple unit tests on a simple interface. &lt;a href=&quot;https://github.com/mirage/alcotest&quot;&gt;Alcotest&lt;/a&gt; only displays faulty runs at the end of the output, along with full logs for your inspection. The straightfoward, expressive query language makes it easy to select which tests to run, and the results are displayed in a fun rainbow of colors.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#base&quot; aria-label=&quot;base permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;strong&gt;&lt;code&gt;base&lt;/code&gt;&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;Although the &lt;a href=&quot;https://dev.realworldocaml.org/prologue.html#the-core-standard-library&quot;&gt;&lt;em&gt;standard library&lt;/em&gt;&lt;/a&gt; is somehow minimalist, multiple extensions exist to make programmers' lives easier. For instance &lt;code&gt;base&lt;/code&gt;, created and maintained by Jane Street, is used to develop critical applications by industrial users. &lt;code&gt;base&lt;/code&gt;is written in pure OCaml and has no dependencies other than the OCaml standard library. The &lt;code&gt;base&lt;/code&gt; library is useful for building many applications. Read more about &lt;code&gt;base&lt;/code&gt; in the book &lt;a href=&quot;https://dev.realworldocaml.org/prologue.html#the-core-standard-library&quot;&gt;*Real World OCaml&lt;/a&gt;.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#yojson&quot; aria-label=&quot;yojson permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;strong&gt;Yojson&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ocaml-community/yojson&quot;&gt;Yojson&lt;/a&gt; is an OCaml library for creating and reading JSON data in OCaml. JSON is a data format that is commonly used in web applications. The Yojson bindings can be used to easily generate and parse JSON data in OCaml.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#notty&quot; aria-label=&quot;notty permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;strong&gt;Notty&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;This interesting &lt;a href=&quot;https://ocaml.org/p/notty/0.2.3&quot;&gt;OCaml library&lt;/a&gt; enables the user to write declarative terminal UI. Notty is based on a notion
of composable images, and it delivers a more simple and expressive model than the basic terminal programming. Engineers know that programming terminals are tedious, so Notty makes it enjoyable!&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#ppxlib&quot; aria-label=&quot;ppxlib permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;strong&gt;&lt;code&gt;ppxlib&lt;/code&gt;&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;PreProcessor eXtensions, or PPX for short, are used for meta-programming, like for generating boilerplate or for extending the OCaml syntax. PPX act on the AST and are integrated into the language via two AST features: &lt;a href=&quot;https://ocaml.org/manual/attributes.html&quot;&gt;attributes&lt;/a&gt; and &lt;a href=&quot;https://ocaml.org/manual/extensionnodes.html&quot;&gt;extension nodes&lt;/a&gt;. &lt;a href=&quot;https://github.com/ocaml-ppx/ppxlib&quot;&gt;&lt;code&gt;ppxlib&lt;/code&gt;&lt;/a&gt; is a set of tools and libraries that enables programmers both to write and use PPX. See &lt;a href=&quot;https://tarides.com/blog/2019-05-09-an-introduction-to-ocaml-ppx-ecosystem&quot;&gt;this Tarides blog post&lt;/a&gt; on how to write PPX and &lt;a href=&quot;https://ocaml.org/docs/metaprogramming&quot;&gt;this official guide&lt;/a&gt; on how to use PPX.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;The tools available in OCaml make it easy to prototype new applications and build production-quality software. In fact, the full release of OCaml 5.0 with Multicore support is on the horizon, and &lt;a href=&quot;https://tarides.com/blog/2022-06-15-ocaml-5-alpha-release&quot;&gt;the alpha version has already been released&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;OCaml libraries help you write beautiful, elegant code in this powerful and versatle language. There has never been a better time to give OCaml a try, and now you know there are beneficial libraries to help you code. The libraries covered in this article are just a few examples. For more information, please visit &lt;a href=&quot;https://ocaml.org/packages&quot;&gt;ocaml.org&lt;/a&gt;&lt;/p&gt;</content><id>https://tarides.com/blog/2022-10-12-8-ocaml-libraries-to-make-your-life-easier</id><title type="text">8 OCaml Libraries to Make Your Life Easier</title><updated>2022-10-12T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-10-10-icfp-2022-review" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;After two years of online conferences, it was fantastic to have ICFP 2022 in person. The conference organisers had done a fantastic job adjusting to online conferences, but nothing beats the hallway track for meeting new people and catching up with old friends. This year, Slovenia's capital hosted the event. Ljubljana was a beautiful city to visit, with plenty of classic European architecture and even a castle to explore.&lt;/p&gt;
&lt;p&gt;My conference schedule was packed. I had a talk to present on Friday and five preceding days of conference talks to attend. The first three days were a whirlwind of talks (some on the edge of my understanding) and hallway track conversations.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/3b3345860da2a9852cbef933f9018178/b6249/OCamlMoon.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 61.1764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAADBf/EABYBAQEBAAAAAAAAAAAAAAAAAAMBAv/aAAwDAQACEAMQAAABK02aHzplNf/EABoQAAIDAQEAAAAAAAAAAAAAAAECAAMSBBH/2gAIAQEAAQUC5UVoeeuWDx2GK9GYDT//xAAYEQACAwAAAAAAAAAAAAAAAAAAAQISIf/aAAgBAwEBPwGT0sf/xAAXEQEBAQEAAAAAAAAAAAAAAAABAAIS/9oACAECAQE/ATK3Df/EABwQAAMAAQUAAAAAAAAAAAAAAAABEQISITEykf/aAAgBAQAGPwJ6lTqOGDx2qOX6Vn//xAAcEAACAgIDAAAAAAAAAAAAAAAAAREhUWFx4fH/2gAIAQEAAT8hpSnZGz0KUohbI2thnrCdBfJ//9oADAMBAAIAAwAAABB0L//EABcRAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQMBAT8QhhkM/8QAFhEAAwAAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/EEloy//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExcfD/2gAIAQEAAT8QNFCcTmCcYtsLFkEqjhOr6EL2Y39nsVlKe2n/2Q=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/3b3345860da2a9852cbef933f9018178/7bf67/OCamlMoon.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;OCaml's Trajectory&quot; title=&quot;&quot; srcset=&quot;/static/3b3345860da2a9852cbef933f9018178/651be/OCamlMoon.jpg 170w,
/static/3b3345860da2a9852cbef933f9018178/d30a3/OCamlMoon.jpg 340w,
/static/3b3345860da2a9852cbef933f9018178/7bf67/OCamlMoon.jpg 680w,
/static/3b3345860da2a9852cbef933f9018178/b6249/OCamlMoon.jpg 922w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;em&gt;&lt;a href=&quot;https://twitter.com/yminsky/status/1569956010483220481?s=20&amp;amp;t=Fp12V9v11Xp2kMP0TmOhoQ&quot;&gt;Image by Yaron Minsky of Jane Street&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#ocaml-reaches-for-the-stars&quot; aria-label=&quot;ocaml reaches for the stars permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;OCaml Reaches for the Stars&lt;/h2&gt;
&lt;p&gt;Although it happened mid-week, I want to start with KC Sivaramakrishnan's keynote, &lt;a href=&quot;https://icfp22.sigplan.org/details/ocaml-2022-papers/16/OCaml-5-0-Concurrent-and-Parallel-programming-for-OCaml&quot;&gt;Retrofitting Concurrency &amp;ndash; Lessons from the Engine Room&lt;/a&gt;, as it was definitely the highlight of ICFP. He covered the full story of introducing parallelism and concurrency into OCaml, along with references to papers published along the way. &lt;a href=&quot;https://youtu.be/6BhmRz7eqiE&quot;&gt;Watch the video of his keynote&lt;/a&gt;. The &amp;quot;Where do we go from here?&amp;quot; slide ties together the effect system with targeting Javascript, modal types to avoid heap allocations, unboxed types to control memory layout, and Flamba2 for aggressive compiler optimisation. This is hugely exciting for the OCaml community. It brought together many threads of work into a coherent picture.&lt;/p&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/6BhmRz7eqiE&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;allowfullscreen&quot;&gt;&lt;/iframe&gt;
&lt;p&gt;There was a real buzz afterwards from both OCaml and Haskell people I talked with. It set the stage for the ML Workshop on Thursday, which included &lt;a href=&quot;https://icfp22.sigplan.org/details/mlfamilyworkshop-2022-papers/14/Efficient-and-Scalable-Parallel-Functional-Programming-Through-Disentanglement&quot;&gt;Efficient and Scalable Parallel Functional Programming Through Disentanglement&lt;/a&gt;, &lt;a href=&quot;https://icfp22.sigplan.org/details/mlfamilyworkshop-2022-papers/13/Unboxed-types-for-OCaml&quot;&gt;Unboxed Types for OCaml&lt;/a&gt;, &lt;a href=&quot;https://icfp22.sigplan.org/details/mlfamilyworkshop-2022-papers/10/Module-Shapes-for-Modern-Tooling&quot;&gt;Module Shapes for Modern Tooling&lt;/a&gt;, &lt;a href=&quot;https://icfp22.sigplan.org/details/ocaml-2022-papers/9/Stack-allocation-for-OCaml&quot;&gt;Stack Allocation for OCaml&lt;/a&gt;, and &lt;a href=&quot;https://icfp22.sigplan.org/details/mlfamilyworkshop-2022-papers/4/Boxroot-fast-movable-GC-roots-for-a-better-FFI&quot;&gt;Boxroot, Fast Movable GC Roots for a Better FFI&lt;/a&gt;, picking up themes from the keynote. The full playlist for the ML Workshop is &lt;a href=&quot;https://www.youtube.com/playlist?list=PLyrlk8Xaylp7f8T7L5SFFwOS5_c5d1Jyq&quot;&gt;available on YouTube&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/1b16e350a80feeef58c015e1e446a037/e1596/sudhaICFP.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAUBAgME/8QAFAEBAAAAAAAAAAAAAAAAAAAAA//aAAwDAQACEAMQAAAB5YvgSORSMP8A/8QAGRABAQEBAQEAAAAAAAAAAAAAAQIRAAMS/9oACAEBAAEFAqc4XiZy72YfjzEz/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAERE//aAAgBAwEBPwGmMv/EABcRAQADAAAAAAAAAAAAAAAAAAABERP/2gAIAQIBAT8BttD/xAAbEAACAQUAAAAAAAAAAAAAAAAAEQECECFBkf/aAAgBAQAGPwLEjdlUSb6f/8QAHBAAAwABBQAAAAAAAAAAAAAAAAERITFRYXGB/9oACAEBAAE/IUZk5Mqowj3Jsl1qvR8DfJKwX//aAAwDAQACAAMAAAAQ/wA//8QAFhEBAQEAAAAAAAAAAAAAAAAAACFh/9oACAEDAQE/EKjZ/8QAFhEBAQEAAAAAAAAAAAAAAAAAACFh/9oACAECAQE/EJrJ/8QAGxABAQEBAAMBAAAAAAAAAAAAAREhADFBUbH/2gAIAQEAAT8Qw1vwjzqKIWWbx9KCjXejsaSMEcfZ65jXy+PrhMQS5J+d/9k='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/1b16e350a80feeef58c015e1e446a037/7bf67/sudhaICFP.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Sudha OCaml Workshop&quot; title=&quot;&quot; srcset=&quot;/static/1b16e350a80feeef58c015e1e446a037/651be/sudhaICFP.jpg 170w,
/static/1b16e350a80feeef58c015e1e446a037/d30a3/sudhaICFP.jpg 340w,
/static/1b16e350a80feeef58c015e1e446a037/7bf67/sudhaICFP.jpg 680w,
/static/1b16e350a80feeef58c015e1e446a037/990cb/sudhaICFP.jpg 1020w,
/static/1b16e350a80feeef58c015e1e446a037/c44b8/sudhaICFP.jpg 1360w,
/static/1b16e350a80feeef58c015e1e446a037/e1596/sudhaICFP.jpg 2048w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Thursday also featured the &lt;a href=&quot;https://icfp22.sigplan.org/details/icfp-2022-tutorials/1/OCaml-5-for-the-working-programmer&quot;&gt;OCaml 5.0 for the Working Programmer&lt;/a&gt; tutorial, presented by &lt;a href=&quot;https://twitter.com/tarides_/status/1570346706448879617&quot;&gt;my colleague Sudha Parimala&lt;/a&gt; (above) and Marek Kubica at Tarides. There are &lt;a href=&quot;https://github.com/Sudha247/ocaml5-tutorial-icfp-22&quot;&gt;slides and exercises&lt;/a&gt; to work through to help you understand effects and parallelism in OCaml.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#friday-a-full-day-of-ocaml&quot; aria-label=&quot;friday a full day of ocaml permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Friday: A Full Day of OCaml&lt;/h2&gt;
&lt;p&gt;The final day was dedicated to OCaml Workshops. KC kicked off the first session with a keynote on the &amp;quot;here and now&amp;quot; of OCaml 5.0. His presentation addressed developers' frequently asked questions when moving from sequential OCaml 4 to 5.0, discussed the details of the merge process, and included a deep dive of the developments since the merge of Multicore OCaml early this year. His talk concluded with a call to action, encouraging OCaml developers to start migrating to OCaml 5.0, even if they do not immediately plan to use the new concurrency and parallelism features.&lt;/p&gt;
&lt;p&gt;The keynote was followed by Jan Midtgaard, Principal Engineer at Tarides, talking about a number of testing techniques and tools for concurrent programs that Tarides has developed for OCaml 5.0. This was followed by Deepali Ande, KC's student at IIT Madras, presenting a novel way to enable different schedulers written using effect handlers to communicate with each other.&lt;/p&gt;
&lt;p&gt;These talks ended up being so popular that there was standing room only, so during the coffee break after the first session, the ICFP organisers announced to everyone that the remaining OCaml presentations would be in &amp;quot;the fanciest theatre ever,&amp;quot; an amphitheatre known as the &amp;Scaron;tih Room (below).&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/796b7001a1f7e4388328e00e8b4f1014/d2602/audience.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIDBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAActq0uTgL//EABoQAAIDAQEAAAAAAAAAAAAAAAABAgMRITH/2gAIAQEAAQUCxo9fUKWCsHZFn//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABgQAAIDAAAAAAAAAAAAAAAAAAAxECEi/9oACAEBAAY/AslyhH//xAAZEAACAwEAAAAAAAAAAAAAAAAAAREhMUH/2gAIAQEAAT8hVhpG3iZNOTeDq6uogVo52bNRnw//2gAMAwEAAgADAAAAEP8AD//EABcRAQADAAAAAAAAAAAAAAAAAAABEYH/2gAIAQMBAT8Qimv/xAAXEQEAAwAAAAAAAAAAAAAAAAAAEUFh/9oACAECAQE/ELRj/8QAHBABAAMBAAMBAAAAAAAAAAAAAQARITFBYXGx/9oACAEBAAE/EHbSzbxlWK8pz5cM6jw3Oh0vhfqWVydA/UXF4AXlB4xn/9k='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/796b7001a1f7e4388328e00e8b4f1014/7bf67/audience.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Full Ampitheatre OCaml&quot; title=&quot;&quot; srcset=&quot;/static/796b7001a1f7e4388328e00e8b4f1014/651be/audience.jpg 170w,
/static/796b7001a1f7e4388328e00e8b4f1014/d30a3/audience.jpg 340w,
/static/796b7001a1f7e4388328e00e8b4f1014/7bf67/audience.jpg 680w,
/static/796b7001a1f7e4388328e00e8b4f1014/990cb/audience.jpg 1020w,
/static/796b7001a1f7e4388328e00e8b4f1014/c44b8/audience.jpg 1360w,
/static/796b7001a1f7e4388328e00e8b4f1014/d2602/audience.jpg 4032w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;I presented our collective work on bringing OBuilder to non-Linux platforms. OBuilder is the underlying library responsible for providing sandboxed build environments for &lt;a href=&quot;https://ci.ocamllabs.io/&quot;&gt;ocaml-ci&lt;/a&gt;, &lt;a href=&quot;https://opam.ci.ocaml.org/&quot;&gt;opam-repo-ci&lt;/a&gt;, and &lt;a href=&quot;http://check.ocamllabs.io&quot;&gt;opam-healthcheck&lt;/a&gt;. The talk covered the architecture of OBuilder, showing how it gets used in our multi-archtecture cluster of build machines. I also reviewed the Linux implementation that uses native Linux containerisation technology, like runC and cgroups. Then, moving onto the implementation on macOS, I demonstrated using user isolation to provide sandboxing with some file system tricks, followed by the implementation on Windows using Docker for Windows, which during testing found a number of interesting bugs in LWT and GNU Tar. The full details are available in the &lt;a href=&quot;https://github.com/tmcgilchrist/ocaml-2022-submission/blob/master/ocurrent.pdf&quot;&gt;Extended Abstract&lt;/a&gt; and on GitHub &lt;a href=&quot;https://github.com/ocurrent/obuilder/&quot;&gt;https://github.com/ocurrent/obuilder/&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The OCaml Workshop also featured an impressive back-to-back presentation from David Allsopp on opam's CLI compatibility work and the upcoming opam 2.2 features. He also covered how to make the OCaml compiler relocatable and how that will allow for fast switch creation in opam. Congratulations to David for making such a polished and well-received double show!&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/cb41f25f5d9f79b79a7e4c880a05b98e/17052/ICFP.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 61.1764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBP/EABcBAAMBAAAAAAAAAAAAAAAAAAECBAX/2gAMAwEAAhADEAAAAcza0J4LGP8A/8QAGBAAAgMAAAAAAAAAAAAAAAAAAQIREiD/2gAIAQEAAQUCUWLLBx//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPwGI/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8Bqv/EABgQAAIDAAAAAAAAAAAAAAAAAAABESAh/9oACAEBAAY/AoMdf//EABgQAAMBAQAAAAAAAAAAAAAAAAABETEh/9oACAEBAAE/IdVLgiFprZWx8dXCsiP/2gAMAwEAAgADAAAAECzv/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAEDAQE/EFrtm//EABcRAAMBAAAAAAAAAAAAAAAAAAABETH/2gAIAQIBAT8Q1USf/8QAGxABAAMAAwEAAAAAAAAAAAAAAQARITFBYZH/2gAIAQEAAT8Q0bWKF/YjeMA78qBLaX0guVSdTRV15hVxP//Z'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/cb41f25f5d9f79b79a7e4c880a05b98e/7bf67/ICFP.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;ICFP&quot; title=&quot;&quot; srcset=&quot;/static/cb41f25f5d9f79b79a7e4c880a05b98e/651be/ICFP.jpg 170w,
/static/cb41f25f5d9f79b79a7e4c880a05b98e/d30a3/ICFP.jpg 340w,
/static/cb41f25f5d9f79b79a7e4c880a05b98e/7bf67/ICFP.jpg 680w,
/static/cb41f25f5d9f79b79a7e4c880a05b98e/990cb/ICFP.jpg 1020w,
/static/cb41f25f5d9f79b79a7e4c880a05b98e/c44b8/ICFP.jpg 1360w,
/static/cb41f25f5d9f79b79a7e4c880a05b98e/17052/ICFP.jpg 1994w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#functional-programming-development&quot; aria-label=&quot;functional programming development permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Functional Programming Development&lt;/h2&gt;
&lt;p&gt;Although OCaml certainly stole the show after &lt;a href=&quot;https://youtu.be/6BhmRz7eqiE&quot;&gt;KC's keynote&lt;/a&gt;, earlier in the week I attended several fascinating workshops, a few of which I outline below. There was also a strong theme of Effects talks throughout the third day of ICFP, which I plan to come back to and review the papers in more detail. Below are some highlights, but the full Haskell Implementors Workshop (HIW) is &lt;a href=&quot;https://www.youtube.com/playlist?list=PLyrlk8Xaylp4kkqJltshENjF_SL7-fDTn&quot;&gt;available on YouTube&lt;/a&gt;.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#haskell&quot; aria-label=&quot;haskell permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Haskell&lt;/h3&gt;
&lt;p&gt;On Sunday, I spent my day in the Haskell Implementors Workshop, which kicked off with the &amp;quot;State of GHC&amp;quot; talk from Simon Peyton Jones. Simon covered all the new and important developments in 9.4 and &lt;a href=&quot;https://gitlab.haskell.org/ghc/ghc/-/wikis/status/ghc-9.6&quot;&gt;9.6&lt;/a&gt;. For me, the complete overhaul of &lt;a href=&quot;https://www.haskell.org/ghc/blog/20220807-ghc-9.4.1-released.html&quot;&gt;GHC&amp;rsquo;s Windows support&lt;/a&gt;, including many fixes in WinIO, refactoring of GHC's error messages, and the ongoing work to upsteam GHCJS and WebAssembly backends into GHC, were the most exciting changes. The other takeaway was how Cabal development has been overhauled with a new team managing the project and the resulting acceleration of improvements making their way into Cabal, starting from Cabal 3.6. That, combined with the significantly improved Haskell LSP support, means Haskell tooling is in a great place.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#ghc--racket&quot; aria-label=&quot;ghc  racket permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GHC &amp;amp; Racket&lt;/h3&gt;
&lt;p&gt;Alexis King's talk, &amp;quot;&lt;a href=&quot;https://icfp22.sigplan.org/details/hiw-2022/6/A-look-across-the-pond-a-comparison-between-GHC-and-Racket-compilation-models&quot;&gt;A Look Across the Pond: A Comparison Between GHC and Racket Compilation Models&lt;/a&gt;,&amp;quot; was a great highlight on how Racket tooling works and how Cabal could be further improved, and perhaps how we could improve opam. The key idea was that Racket uses a set of core data structures to represent packages and provides functions across those data structures, with the end-user tooling being a very thin wrapper around these functions. Alexis demonstrated how to query and manipulate the set of installed packages within Racket in a way that's impossible with current Cabal. This is an intriguing idea that hopefully gets some attention, and I wonder if the more dynamic representation available in Racket makes this easier compared to Haskell.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#ghc--mu&quot; aria-label=&quot;ghc  mu permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GHC &amp;amp; Mu&lt;/h3&gt;
&lt;p&gt;My second recommendation is &amp;quot;&lt;a href=&quot;https://icfp22.sigplan.org/details/hiw-2022/8/Compiling-Mu-with-GHC-Halfway-Down-the-Rabbit-Hole&quot;&gt;Compiling Mu with GHC: Halfway Down the Rabbit Hole&lt;/a&gt;&amp;quot; by Georgo Erdi, which covered the effort to port Mu to reuse the GHC compiler frontend and backend as much as possible. Currently Mu uses a custom compiler for its strict Haskell variant that includes MultiParam Typeclasses and Functional Dependencies, along with a variation on Type Families. I like hearing about compiler engineering efforts that need to handle existing codebases and think through the trade-offs. The choice of Functional Dependencies and Multiparam Typeclasses is a sweet spot in the design space for typeclasses, with Purescript choosing a similar approach.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#ocaml-reception&quot; aria-label=&quot;ocaml reception permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;OCaml Reception&lt;/h2&gt;
&lt;p&gt;Overall the ICFP had a huge buzz of excitement around OCaml 5.0 featuring Multicore support and effects. The palpable enthusiasm after &lt;a href=&quot;https://youtu.be/6BhmRz7eqiE&quot;&gt;KC's impressive keynote&lt;/a&gt; lasted throughout the rest of the week. I had many great conversations with both OCaml and Haskell people about the new features and how exciting the future is for OCaml. In fact, the OCaml Farewell Reception, held at the Ljubljana Zoo, attracted three times the expected number of attendees because everyone wanted to keep talking about the new features coming soon in OCaml 5.0. I spoke at length with a senior Haskell programmer who was very interested in OCaml Multicore, and we all enjoyed sampling a local honey liqueur and having a hot meal, which helped warm us that cool, rainy evening. As a special treat, the ICFP organisers even arranged for a real live camel to make an appearance! It was a delightful evening, and the perfect ending to ICFP 2022.&lt;/p&gt;
&lt;p&gt;In the end, the week in Ljubljana was fulfilling, both on a personal and professional level. After over two years of limited in-person events, it was truly refreshing to meet and network with colleagues face to face.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/9dc69c41b73b46497cdeacb56da93b43/d2602/dragon.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFAgP/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAv/aAAwDAQACEAMQAAABoLcM1L5FD//EABkQAAMBAQEAAAAAAAAAAAAAAAECAxEAEv/aAAgBAQABBQInAtmo+97wKwnzXrv/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPwGI/8QAFhEBAQEAAAAAAAAAAAAAAAAAABES/9oACAECAQE/Aa0//8QAHBAAAgICAwAAAAAAAAAAAAAAAAECERBBEiEi/9oACAEBAAY/AuQ/NRW8OPY3Ro//xAAbEAEAAwADAQAAAAAAAAAAAAABABEhMUFRYf/aAAgBAQABPyF17BcEgA31MzMKyVBfOBqPvQ+UZP/aAAwDAQACAAMAAAAQo8//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPxBZH//EABURAQEAAAAAAAAAAAAAAAAAACEQ/9oACAECAQE/EGx//8QAGxABAAMBAAMAAAAAAAAAAAAAAQARMVEhQYH/2gAIAQEAAT8QawNILQ/YDaDYqkw9QYqmUdRCPLOzZvXQTI3o3CwOeZ//2Q=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/9dc69c41b73b46497cdeacb56da93b43/7bf67/dragon.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Ljubljana Dragon&quot; title=&quot;&quot; srcset=&quot;/static/9dc69c41b73b46497cdeacb56da93b43/651be/dragon.jpg 170w,
/static/9dc69c41b73b46497cdeacb56da93b43/d30a3/dragon.jpg 340w,
/static/9dc69c41b73b46497cdeacb56da93b43/7bf67/dragon.jpg 680w,
/static/9dc69c41b73b46497cdeacb56da93b43/990cb/dragon.jpg 1020w,
/static/9dc69c41b73b46497cdeacb56da93b43/c44b8/dragon.jpg 1360w,
/static/9dc69c41b73b46497cdeacb56da93b43/d2602/dragon.jpg 4032w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;em&gt;The Famous Ljubljana Dragon Bridge&lt;/em&gt;&lt;/p&gt;</content><id>https://tarides.com/blog/2022-10-10-icfp-2022-review</id><title type="text">ICFP 2022 Review</title><updated>2022-10-10T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-09-23-tarides-sponsors-high-school-hackers" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Tarides is excited to sponsor the &lt;a href=&quot;https://esolangconf.com/&quot;&gt;Paradigm Conference&lt;/a&gt; (previously EsoLangConf) high school hackathon. This weekend, students from all over the world will team up to solve tricky programming problems, investigate diverse features of a range of programming languages, and build cool things!&lt;/p&gt;
&lt;p&gt;At Tarides, we are always looking for new ways to increase the awareness and adoption of OCaml. The Paradigm Conference is a fantastic opportunity for all students interested in computer science to discover real-world use cases of OCaml.&lt;/p&gt;
&lt;p&gt;If you are a high school student interested in using OCaml to solve fun and complex problems while learning new skills and meeting new people, you can register for the conference &lt;a href=&quot;https://docs.google.com/forms/d/e/1FAIpQLSdEuny13Vb7n3tMiJ9r1Ci3OoRSWhlU3nO73gjDdmpZywVnKw/viewform&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#what-makes-this-conference-unique&quot; aria-label=&quot;what makes this conference unique permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What Makes this Conference Unique?&lt;/h2&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#created-by-students-for-students&quot; aria-label=&quot;created by students for students permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Created by Students for Students&lt;/h3&gt;
&lt;p&gt;Rohan Mehta and the organisational team provide a safe and inclusive hackathon space for attendees from anywhere in the world to explore different programming languages and concepts. Breaking out of the standard computer science curriculum, they have designed a hackathon specifically for high school students to showcase non-mainstream languages and the diversity of programming approaches available.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#a-diversity-of-programming-paradigms&quot; aria-label=&quot;a diversity of programming paradigms permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A Diversity of Programming Paradigms&lt;/h3&gt;
&lt;p&gt;The conference features different language tracks, focussing specifically on functional, array-based, and knowledge-based programming. Each team will choose from OCaml, Haskell, Clojure, Wolfram, and APL, letting them explore the unique features of these less well-known languages and discovering their benefits for themselves. The conference puts the joy of programming at the top of the priority list, giving students a fantastic opportunity to experiment and broaden their horizons.&lt;/p&gt;
&lt;p&gt;If you want to learn about pattern matching, macros, or higher-order functions, then you&amp;rsquo;re in the right place!&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#knowledge-sharing&quot; aria-label=&quot;knowledge sharing permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Knowledge Sharing&lt;/h3&gt;
&lt;p&gt;The organisers have gathered learning resources for every language in the conference&amp;mdash;a mammoth task in itself! Not only are they widely sharing knowledge that already exists (but may not be easy to find), but they are also creating &lt;a href=&quot;https://docs.google.com/document/d/e/2PACX-1vRtBufinbvANjQUMJrFdKyQ0VhsICM6QJ5K040MswBFMqGxuIGDrgLYsDLT-4txw1ZkVd-AJ0LCjCCo/pub?urp=gmail_link&quot;&gt;new living documents&lt;/a&gt; for each language built from these existing resources and their own learning experiences.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#combined-coding-competitions-and-world-class-lectures&quot; aria-label=&quot;combined coding competitions and world class lectures permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Combined Coding Competitions and World-Class Lectures&lt;/h3&gt;
&lt;p&gt;The team has worked hard to create an engaging and interesting event by interspersing talks from industry language users and programming language experts with coding competitions and hackathon events. Naturally, any conference wouldn&amp;rsquo;t be complete without swag! Each attendee will receive a sticker and t-shirt, with additional prizes for the competition winners.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#get-involved&quot; aria-label=&quot;get involved permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Get Involved!&lt;/h2&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#attending&quot; aria-label=&quot;attending permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Attending&lt;/h3&gt;
&lt;p&gt;Students will join teams (of up to 5) by either creating one in advance or registering as an individual. Everyone will be allocated to a team once the conference starts.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#mentoring&quot; aria-label=&quot;mentoring permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Mentoring&lt;/h3&gt;
&lt;p&gt;If you are a high school student and you&amp;rsquo;re interested in attending, you can sign up here. If you have a bit more experience with any of the languages featured, you can join as a mentor and help students grasp new languages and concepts.&lt;/p&gt;
&lt;p&gt;Rohan and his team promise that if you attend Paradigm Conf 2022 &amp;ldquo;your programming worldview will be flipped upside down!&amp;rdquo;&lt;/p&gt;
&lt;p&gt;You can find the Paradigm Conference on &lt;a href=&quot;https://www.instagram.com/esolangconf/&quot;&gt;Instagram&lt;/a&gt; and &lt;a href=&quot;https://twitter.com/EsolangT&quot;&gt;twitter&lt;/a&gt;&lt;/p&gt;</content><id>https://tarides.com/blog/2022-09-23-tarides-sponsors-high-school-hackers</id><title type="text">Tarides Sponsors High School Hackers</title><updated>2022-09-23T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-09-06-tarides-sponsors-girls-can-code" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;&lt;em&gt;The tech industry has long struggled with a lack of diversity. This existing imbalance combined with social and educational problems such as early gender bias still tends to prevent lots of people, including women, from entering the field. &lt;em&gt;Girls Can Code&lt;/em&gt; aims to help young women learn programming and gain valuable experience working on projects alongside other like minded individuals.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Tarides is proud to share that we sponsored a &lt;a href=&quot;https://girlscancode.fr&quot;&gt;&lt;em&gt;Girls Can Code&lt;/em&gt;&lt;/a&gt; summer camp! Between Aug 22nd and 27th, the camp offered participants a fully-packed week of programming, socialising, and learning.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#what-is-girls-can-code&quot; aria-label=&quot;what is girls can code permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What is Girls Can Code?&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;Girls Can Code&lt;/em&gt; is an initiative launched by the organisation &lt;a href=&quot;https://prologin.org&quot;&gt;&lt;em&gt;Prologin&lt;/em&gt;&lt;/a&gt;, hosting summer camps specifically aimed at teaching young women about computer programming. No prior experience is required, and they accept participants from secondary school and up through the equivalent of A-Levels. Attendance is free, since the events are run by students who generously volunteer their time and expertise.&lt;/p&gt;
&lt;p&gt;Camps come in two variants: long and short. The long camps last for a week and the short ones for a weekend. The short camps cover less content, but can be organised more frequently. They are always in the form of a practical introduction to computer science, but may focus on special topics. The week-long summer camps start with an introduction to Python and then continue with several tutorials on various topics. Finally, all participants have the chance to complete a personal project on either robotics, video games, or microcontrollers.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#impact&quot; aria-label=&quot;impact permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Impact&lt;/h2&gt;
&lt;p&gt;At Tarides, we&amp;rsquo;re committed to using our resources to foster diversity and inclusion. Our own goal is to have 50% of our tech roles be filled by women. For that to be a reality, not just at Tarides but everywhere, more women need to feel welcome in the tech space. Sadly, according to this &lt;a href=&quot;https://www.lemonde.fr/campus/article/2017/12/11/femmes-et-informatique-vingt-ans-de-desamour_5227726_4401467.html&quot;&gt;Le Monde article&lt;/a&gt;, only 11% of French women chose to pursue IT careers in 2010. A more &lt;a href=&quot;https://technation.io/diversity-and-inclusion-in-uk-tech/#executive-summary&quot;&gt;recent survey&lt;/a&gt; by Tech Nation showed that in the UK, only 26% of the tech workforce is made up by women. While this number is better, there&amp;rsquo;s still a lot of work to be done before women make up 50% of the workforce in tech.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Girls Can Code&lt;/em&gt; works proactively to inspire a generation of young French women and make a difference in the sector. They have been arranging summer camps since 2014 and have been growing steadily since. We&amp;rsquo;re proud to support their efforts for a more equitable future!&lt;/p&gt;</content><id>https://tarides.com/blog/2022-09-06-tarides-sponsors-girls-can-code</id><title type="text">Tarides Sponsors Girls Can Code</title><updated>2022-09-06T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-08-26-tarides-goes-on-holiday" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;&lt;em&gt;Relaxing in today&amp;rsquo;s world can be difficult. Taking the time you need to cool off, refocus, and explore something new requires a solid amount of time in which you can disconnect from daily habits and find a new beat.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;At Tarides we address this by providing the framework needed for our employees to take that unbroken time away from work. In August, all Tarides employees get two weeks of paid leave to go away and come back refreshed.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#how-it-began&quot; aria-label=&quot;how it began permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;How it Began&lt;/h2&gt;
&lt;p&gt;We first trialled the two weeks of leave in 2021 to help alleviate the stress caused by the pandemic. Taking a solid two weeks off would allow everyone to slow down and enjoy the last of the summer months (or winter for our Australian colleagues!) without having to worry about losing pay or using up annual leave in the face of an uncertain global situation.&lt;/p&gt;
&lt;p&gt;The results were very positive, with a lot of good feedback across the teams. People came back refreshed and inspired, easily making up for the time away. An important takeaway from the Tarides team was that since everyone was away at the same time, no one had to worry about having a pile of work waiting for them when they came back. This made everyone&amp;rsquo;s holiday more enjoyable and restful.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#its-back&quot; aria-label=&quot;its back permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;It&amp;rsquo;s Back!&lt;/h2&gt;
&lt;p&gt;Since it was a very popular measure last year, we decided to reintroduce it as a recurring event! From August 8th to August 19th, Tarides had its official 2022 office closure. We hope the entire Tarides team took some time to go on adventures or simply relax before the rest of the year.&lt;/p&gt;
&lt;p&gt;Taking time off does not just allow everyone to recharge their batteries, but it also lets them experience new things that can generate moments of inspiration. That said, rest is also very powerful: when we rest, we prepare for the challenges ahead, increase our resilience, and strengthen our resolve.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s to a great rest of 2022!&lt;/p&gt;</content><id>https://tarides.com/blog/2022-08-26-tarides-goes-on-holiday</id><title type="text">Tarides Goes on Holiday!</title><updated>2022-08-26T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-08-02-irmin-in-the-browser" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#introduction&quot; aria-label=&quot;introduction permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Over the past six months, I have been working on using Irmin in the browser, including &lt;code&gt;irmin-server&lt;/code&gt; and the GraphQL interface. This has been fun and a great learning journey for me. Before this internship, &lt;code&gt;irmin-server&lt;/code&gt; was primarily a Unix-based application. My project was to port &lt;code&gt;irmin-server&lt;/code&gt; to work in the browser and design interfaces for people to interact with the store (Irmin stores).&lt;/p&gt;
&lt;p&gt;I was paired to work with Patrick Ferris as my mentor and with the entire Irmin team, who all contributed immensely to this project.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#irmin-and-irmin-server&quot; aria-label=&quot;irmin and irmin server permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Irmin and &lt;code&gt;irmin-server&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;Irmin is simply a data store (database). It is based on the same design principle as Git with features to merge and branch data stores. Irmin has several stores (&lt;code&gt;irmin-mem&lt;/code&gt;, &lt;code&gt;irmin-indexeddb&lt;/code&gt;, &lt;code&gt;irmin-fs&lt;/code&gt;, &lt;code&gt;irmin-chunk&lt;/code&gt;, &lt;code&gt;irmin-git&lt;/code&gt;) and store interfaces (&lt;code&gt;irmin-http&lt;/code&gt;, &lt;code&gt;irmin-graphql&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;&lt;code&gt;irmin-server&lt;/code&gt; is a high-performance server for Irmin. For efficient communication, it implements a specialised &lt;a href=&quot;https://github.com/mirage/irmin-server/blob/master/PROTOCOL.md&quot;&gt;wire-protocol&lt;/a&gt; to send and receive data over a bytestream. It wraps an Irmin store, providing a way to connect to the server and access the store via its API using a client. But the client makes an assumption that the user is on a Unix machine, which makes &lt;code&gt;irmin-server&lt;/code&gt; primarily a Unix-based application.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#irminirmin-client-in-the-browser&quot; aria-label=&quot;irminirmin client in the browser permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code&gt;irmin/irmin-client&lt;/code&gt; in the Browser&lt;/h2&gt;
&lt;p&gt;In this modern age, it's become a necessity to make applications &amp;quot;offline first.&amp;quot; Offline-First applications function without being affected by the intermittent lack of a network connection. It usually implies the ability to sync data between multiple devices. Irmin as a data store supports multiple backends, making it very portable. Plus, Irmin's mergeable replicated data-types make it much easier to build applications that can transform the state offline and resynchronise the state later, just like Git. With this concept, resynchronising Irmin stores (from server to client) is much simpler on &lt;code&gt;irmin-server&lt;/code&gt;, which implements a specialised wire protocol for efficient communication. Making &lt;code&gt;irmin/irmin-client&lt;/code&gt; work in the browser simply means that it would be possible to create offline-first web applications.&lt;/p&gt;
&lt;p&gt;More information on offline-first applications can be found &lt;a href=&quot;https://2022.ecoop.org/home/plf-2022&quot;&gt;here&lt;/a&gt;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-problems&quot; aria-label=&quot;the problems permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Problems&lt;/h2&gt;
&lt;p&gt;An initial summary of the problem was published on this &lt;a href=&quot;https://github.com/mirage/irmin-server/issues/46&quot;&gt;issue&lt;/a&gt;, but here is a quick breakdown of the problems we identified.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;irmin-server&lt;/code&gt; was tightly coupled around &lt;code&gt;conduit-lwt-unix&lt;/code&gt;:&lt;/strong&gt; &lt;code&gt;irmin-server&lt;/code&gt; was initially designed to be a Unix-based application that established communication with a client via &lt;code&gt;conduit-lwt-unix&lt;/code&gt;. This became a problem because &lt;code&gt;conduit-lwt-unix&lt;/code&gt; cannot establish a communication from a browser. This meant that there was a need to abstract the I/O module so that every client will provide its I/O.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Reuse some internal modules:&lt;/strong&gt; We needed to reuse the &lt;code&gt;irmin-server&lt;/code&gt; internal logic related to the protocol but provide a portable I/O interface that can work in the browser.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Provide a browser communication channel:&lt;/strong&gt; We needed a non-blocking way to establish a channel to create communication between &lt;code&gt;irmin-server&lt;/code&gt; and the browser, and also pass data across this channel.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-solutions&quot; aria-label=&quot;the solutions permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Solutions&lt;/h2&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#irmin-server-was-tightly-coupled-around-conduit-lwt-unix&quot; aria-label=&quot;irmin server was tightly coupled around conduit lwt unix permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code&gt;irmin-server&lt;/code&gt; was tightly coupled around &lt;code&gt;conduit-lwt-unix&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;Thanks to Zach Shipko, who abstracted the I/O library and split out &lt;code&gt;irmin-client-unix&lt;/code&gt; and &lt;code&gt;irmin-client-cli&lt;/code&gt; to have their own I/O module that depends on &lt;code&gt;conduit-lwt-unix&lt;/code&gt; (&lt;a href=&quot;https://github.com/mirage/irmin-server/pull/32&quot;&gt;here&lt;/a&gt;), a client can connect to a running &lt;code&gt;irmin-server&lt;/code&gt; using its own I/O module. While he was working on the restructuring, I spent my time working on a sample project that combines &lt;code&gt;dream&lt;/code&gt; with &lt;code&gt;irmin-graphql&lt;/code&gt; (more on this project).&lt;/p&gt;
&lt;p&gt;With the coupling out of the way, the next step was to create &lt;code&gt;irmin-client-jsoo&lt;/code&gt;, a browser client with its own I/O module.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#irmin-server-was-primarily-a-unix-based-application&quot; aria-label=&quot;irmin server was primarily a unix based application permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code&gt;irmin-server&lt;/code&gt; was primarily a Unix-based application&lt;/h3&gt;
&lt;p&gt;The &lt;code&gt;irmin-server&lt;/code&gt; initial architecture had to be restructured to accommodate other platforms. To achieve this, &lt;code&gt;irmin-client&lt;/code&gt; was no longer coupled with a specific I/O implementation. Rather, a Unix-based one was provided over conduit flows, which are &lt;code&gt;Lwt_io&lt;/code&gt; input and output channels. This channel was established over a TCP connection or a Unix domain socket.&lt;/p&gt;
&lt;p&gt;Right now, &lt;code&gt;irmin-server&lt;/code&gt; can communicate with two (2) clients: &lt;code&gt;irmin-client-cli&lt;/code&gt; from a command line and &lt;code&gt;irmin-client-unix&lt;/code&gt; from a Unix-based machine. This project was about creating a third client: &lt;code&gt;irmin-client-jsoo&lt;/code&gt;, to be called from browser applications.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#enable-communication-from-the-browser&quot; aria-label=&quot;enable communication from the browser permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Enable communication from the browser&lt;/h3&gt;
&lt;p&gt;After considering other options to create a communication channel for &lt;code&gt;irmin-client-jsoo&lt;/code&gt;, like HTTP, RPC, etc., Patrick suggested WebSocket, so we decided to go with WebSocket, a bidirectional communication protocol between client and server.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-challenges&quot; aria-label=&quot;the challenges permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Challenges&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;irmin-server&lt;/code&gt; uses flows to communicate between the server and the client and flows are bytestreams. WebSocket provides a bidirectional communication channel in the browser, but it is not stream-oriented rather it is message-oriented.&lt;/p&gt;
&lt;p&gt;TCP (Transmission Control Protocol) is a type of protocol or standard to transfer information over the Internet while WebSocket is a message-oriented application protocol, which uses TCP as the transportation layer.&lt;/p&gt;
&lt;p&gt;The idea behind the WebSocket protocol consists of reusing the established TCP connection between a client and server. Even though WebSocket is built on TCP, the data it passes is always either sent as a whole &amp;quot;message&amp;quot; or not at all. These implementations are non-blocking.&lt;/p&gt;
&lt;p&gt;Since we are avoiding a full redesign of the &lt;code&gt;irmin-server&lt;/code&gt; protocol, we had to make the message-oriented process seem like bytestreams of data.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#more-on-irmin-client-jsoo&quot; aria-label=&quot;more on irmin client jsoo permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;More on &lt;code&gt;irmin-client-jsoo&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;Communicating with &lt;code&gt;irmin-server&lt;/code&gt; from the browser is very easy. You can achieve that by following these steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Pin &lt;code&gt;irmin-server&lt;/code&gt;, using this command: &lt;code&gt;opam pin add git+https://github.com/mirage/irmin-server/commit#013a28fd1507f8ba69494515533119804903aa99&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Set up the server.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;open Lwt.Syntax
module Store = Irmin_mem.KV.Make (Irmin.Contents.String)
module Server = Irmin_server.Make (Store)

let main =
  let uri = Uri.of_string &amp;quot;ws://localhost:9090/ws&amp;quot; in
  let config = Irmin_git.config &amp;quot;penit&amp;quot; in
  let* store = Store.Repo.v config in
  let* main = Store.main store in
  let* server = Server.v ~uri config in
  let () = Format.printf &amp;quot;Listening on %a@.&amp;quot; Uri.pp uri in
  Server.serve server

let () = Lwt_main.run main&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/dinakajoy/pen-it-down/blob/main/server/server.ml&quot;&gt;Check out this implementation&lt;/a&gt;&lt;/p&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;Create the client and ping the server.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;module Store = Irmin_mem.KV.Make (Irmin.Contents.String)
module Client = Irmin_client_jsoo.Make (Store)

let config = Irmin_client_jsoo.config (Uri.of_string &amp;quot;ws://localhost:9090/ws&amp;quot;)
let client = Client.Repo.v config in
Client.ping client&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;More examples can be found on &lt;a href=&quot;https://github.com/mirage/irmin-server/tree/master/examples&quot;&gt;here&lt;/a&gt;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#my-projects&quot; aria-label=&quot;my projects permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;My Projects&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Simple Mini GitHub:&lt;/strong&gt;
I worked on this project to experiment with combining &lt;code&gt;irmin-graphql&lt;/code&gt; with &lt;code&gt;dream&lt;/code&gt;. This turned out simpler than I thought. You only need to expose &lt;code&gt;irmin-graphql&lt;/code&gt; schema. In this application, you simply enter a GitHub repository, and the repository details such as name, date, author, commit message, and README file will be displayed. You can also open &lt;code&gt;/graphiql&lt;/code&gt; and make queries.&lt;/p&gt;
&lt;p&gt;The full code can be accessed &lt;a href=&quot;https://github.com/dinakajoy/simple_mini_github&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Pen-It-Down:&lt;/strong&gt;
Pen-it-down is a note app that uses &lt;code&gt;irmin-indexeddb&lt;/code&gt; and &lt;code&gt;irmin-server&lt;/code&gt; to show an offline-first functionality. Users can type in their notes without being bothered about internet connectivity. You can create, edit, delete, and sync your notes to the server.&lt;/p&gt;
&lt;p&gt;The full code can be accessed &lt;a href=&quot;https://github.com/dinakajoy/pen-it-down&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Working on this project was challenging! I am so glad I had the opportunity to work on it, even though there were days I felt lost. Some days I was confused because it seemed I was doing the wrong thing. Other days I was happy because things worked as expected! It&amp;rsquo;s basically been about research and experimenting for me. I learned a lot from Patrick and Zach. I was exposed to networking concepts like the network layers, client-server handshake, data encryption, and decryption, and I got to try out WebSocket for the first time. I look forward to building more projects with OCaml.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-08-02-irmin-in-the-browser</id><title type="text">Irmin in the Browser</title><updated>2022-08-02T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-07-19-tarides-is-on-the-wavestone-radar" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;&lt;em&gt;Cybersecurity is a growing concern for individuals and companies alike. At Tarides, security is at the centre of every solution we provide, and this year we have been recognised for our efforts! We&amp;rsquo;ve been accepted to &lt;a href=&quot;https://tarides.com/blog/2022-06-28-thales-cyber-station-f-selection&quot;&gt;Cyber@StationF&amp;rsquo;s acceleration program&lt;/a&gt; and are now featured in the 2022 Cybersecurity Startup Radar.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Tarides is proud to announce that we&amp;rsquo;re part of the &lt;a href=&quot;https://www.wavestone.com/en/insight/cybersecurity-startups-radar-2022/&quot;&gt;2022 Cybersecurity Startup Radar&lt;/a&gt; by Wavestone and BPIFrance! It spotlights promising startups who are making a difference in the cybersecurity arena. Tarides has been featured in the Radar twice before, in 2019 and in 2020.&lt;/p&gt;
&lt;p&gt;Tarides is featured under the &amp;lsquo;IoT Security&amp;rsquo; section of the Wavestone Radar, demonstrating our commitment to creating safer and more efficient software for the IoT (Internet of Things) ecosystem. At Tarides, security-by-design is at the core of everything we do; it&amp;rsquo;s our guiding development principle that we use to produce a variety of solutions addressing the different challenges present in this space.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#taridess-cybersecurity-solutions&quot; aria-label=&quot;taridess cybersecurity solutions permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Tarides&amp;rsquo;s Cybersecurity Solutions&lt;/h2&gt;
&lt;p&gt;Most of today&amp;rsquo;s software solutions are very complex and as a result often inefficient and vulnerable to attack. It is well documented that IoT technology and devices can pose safety risks due to their development environment and limited processing capabilities that don&amp;rsquo;t offer full protection from attacks.&lt;/p&gt;
&lt;p&gt;Our technology solves these problems in a revolutionary way by combining the features of OCaml (focused on security, safety, and efficiency) with state-of-the-art tools (as part of MirageOS) to provide solutions to complex problems where mistakes can have disastrous consequences.&lt;/p&gt;
&lt;p&gt;Firstly, we provide several solutions relating to device connectivity, from internet protocols to low-bandwidth networks. Secondly, we build custom applications that are securely deployed on IoT devices either on bare-metal or within hypervisors. MirageOS provides an efficient IoT environment with a small footprint. Finally, we address the IoT security layer via formally verified cryptographic libraries and other security building blocks that match the latest standards.&lt;/p&gt;
&lt;p&gt;We maintain a special focus on cybersecurity to ensure that efficiency and security go hand-in-hand, and that one is not achieved at the expense of the other. We develop and maintain secure, fast, and performant code solutions that leverage OCaml's strong safety features for reliable results. We collaborate closely with the thriving open-source community surrounding the language, which constantly tests and audits its performance.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#about-the-radar&quot; aria-label=&quot;about the radar permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;About the Radar&lt;/h2&gt;
&lt;p&gt;The Radar is used to analyse the French cybersecurity sector: what solutions are being worked on, what trends are emerging, and what kind of innovation is happening. In light of the current geopolitical climate, cybersecurity is a major strategic issue now more than ever. Consequently, this year&amp;rsquo;s Radar is perhaps even more salient than those of previous years, as it highlights the role of France&amp;rsquo;s innovation ecosystem in advancing cybersecurity goals.
By being featured, Tarides gains a lot of visibility in the sector and can also discover other startups and promising projects in the same field. We&amp;rsquo;re excited to be part of this great networking opportunity!&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#about-wavestone--bpi-france&quot; aria-label=&quot;about wavestone  bpi france permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;About Wavestone &amp;amp; BPI France&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.wavestone.com/en/&quot;&gt;Wavestone&lt;/a&gt; operates at the intersection of management and consulting, helping their clients not just overcome but master challenges whether they be digital, competitive, or environmental. Their mission is to guide organisations during critical transformations, helping them obtain the best results. Furthermore, they are also committed to promoting ethical and sustainable solutions that benefit society as a whole.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.bpifrance.com&quot;&gt;BPI France&lt;/a&gt; is a financial institution whose mission is to support entrepreneurs and visionaries who take risks to achieve their goals and grow their businesses. BPI France has many resources that they make available to companies, offering support for innovation, coaching, acceleration programmes, and international expansion. They focus on smaller businesses such as microbusinesses, SMEs, and mid-caps, but also offer solutions for larger companies.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-07-19-tarides-is-on-the-wavestone-radar</id><title type="text">Tarides is on the Wavestone Radar!</title><updated>2022-07-19T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-07-12-faster-incremental-builds-with-dune-3" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;In February 2022, we released Dune 3.0. This updated version is the result of considerable development work over the previous six months. Dune 3.0 contains many new features, one of which is &amp;ldquo;watch mode,&amp;rdquo; an exciting new feature explained below.&lt;/p&gt;
&lt;p&gt;As a build system, Dune&amp;rsquo;s main goal is to build targets. These targets can be either files (like an executable file) or &amp;ldquo;aliases,&amp;rdquo; a group of targets that can have a visible outcome (like running tests). By default, when running a build, Dune receives a target. Dune will then build it and exit. For example &lt;code&gt;dune build&lt;/code&gt; (an alias for &lt;code&gt;dune build @all&lt;/code&gt;) will build everything it knows about, then exit.&lt;/p&gt;
&lt;p&gt;When working on a piece of code, many developers use an edit-save-build loop:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Edit a piece of code&lt;/li&gt;
&lt;li&gt;Save the corresponding file&lt;/li&gt;
&lt;li&gt;Run a build command&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Using the outcome of the build (i.e., Did the build work? Did the tests all pass?), developers start a new iteration of this loop manually, but it&amp;rsquo;s more efficient to have a quick, automated iteration process. This is the goal of the &amp;ldquo;watch mode.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;When active, Dune will watch the source files in a project, and when one of them has changed, it will re-execute the same build command automatically and display the results of the build. It doesn&amp;rsquo;t exit automatically, so it continues watching for changes. This is more efficient because the developer can stay focussed in their text editor and see the build start automatically when the file is saved. You can enable watch mode by passing the &lt;code&gt;-w&lt;/code&gt; flag to &lt;code&gt;dune&lt;/code&gt;, like &lt;code&gt;dune build -w&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;A simple implementation is to have a special process check for file changes in the source tree and run the build command when something has changed. This works, but it isn&amp;rsquo;t a very precise solution. First because the external process doesn&amp;rsquo;t know about the relationships between the files, so it will run more builds than necessary. For example, changing a README file usually should not trigger a new build because it isn&amp;rsquo;t a source file. But also, there are various subtleties to handle. If a file is changed while a build is running, a new build should be started, but the previous one should also be cancelled.&lt;/p&gt;
&lt;p&gt;For these reasons, it&amp;rsquo;s more efficient to have the build system itself &amp;ldquo;drive&amp;rdquo; the watch mode. This is how it&amp;rsquo;s implemented in Dune 1.x and Dune 2.x. When starting a build in watch mode for a certain target, Dune computes the set of files that can influence this target (using the build rules) and calls an external process that can subscribe to file changes. When a file changes, Dune cancels existing builds and will start a new one.&lt;/p&gt;
&lt;p&gt;This is better, but it&amp;rsquo;s still not very efficient. To see why, let&amp;rsquo;s see what Dune does and how it can be fast.&lt;/p&gt;
&lt;p&gt;To run a build, Dune needs to do two things:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Load the rules: detect the workspace (determine which files to consider), parse the &lt;code&gt;dune&lt;/code&gt; files (open them, transform them into s-expressions and stanzas), and interpret them (execute the logic to transform the stanzas into rules)&lt;/li&gt;
&lt;li&gt;Execute the rules: copy files around, call external processes, etc.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The time it takes to load the rules is related to the size of the current workspace (number and size of &lt;code&gt;dune&lt;/code&gt; files). This is particularly noticeable in organisations that use a monorepo (all the source code in a large Dune workspace). It's difficult to make this step fast because it has a lot of work to do, but it's doable by avoiding computing the same things over and over, made possible by an internal memoisation framework. An initial version of this system is described &lt;a href=&quot;https://dune.build/blog/new-computation-model/&quot;&gt;in this blog post&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The time it takes to execute the rules depends on the amount of work necessary. For example, a clean build needs to execute most of the build actions, while a second full build usually needs to execute no rule at all. To make this step fast, Dune tries to avoid executing actions that wouldn't change the final outcome (a technique called early cutoff), and it executes independent actions in parallel.&lt;/p&gt;
&lt;p&gt;In the context of the watch mode, whenever a new build starts, Dune has to forget everything it knows about the workspace, so it will reload all the rules. This is pretty wasteful.&lt;/p&gt;
&lt;p&gt;To do better, the new watch mode in Dune 3 makes rule loading incremental. For example, if a &lt;code&gt;dune&lt;/code&gt; file is edited to add a stanza, Dune parses it again, only adding the new rule. The other ones are not interpreted. This ensures very fast iteration times.&lt;/p&gt;
&lt;p&gt;This project was challenging because for it to work, everything in the Dune core had to be ported to the memoisation API. For instance, the library loading code (which looks for library definitions in the current opam switch and in the Dune workspace) relied on a &amp;ldquo;classic&amp;rdquo; cache (a global hash table) to avoid parsing files repeatedly. However, this does not play nice with the memoisation API, which assumes that the functions it caches are all pure. So, in Dune 3, this piece of code has been rewritten on top of the memoisation API. This has another benefit: since file system accesses (&amp;ldquo;does this file exist?&amp;rdquo;) are cached too, the memoisation API now has an idea of which functions can read which files. This is used to re-evaluate only the affected parts of the rule graph once a file is modified.&lt;/p&gt;
&lt;p&gt;Thanks to that work, watch mode is now a lot more responsive than in Dune 2.x. This performance improvement is barely noticeable in small-to-medium-sized projects, but it is essential in a workspace with several million lines of OCaml code. In such a setting, re-evaluating rules over and over (either by manually running &lt;code&gt;dune build&lt;/code&gt; or by using the strategy in Dune 2.x) means that the feedback loop takes dozens of seconds instead being almost instantaneous.&lt;/p&gt;
&lt;p&gt;As Dune performance improves, it's able to support workspaces that are larger and larger. This means that the bottlenecks shift to different places. We'll continue to improve Dune so that it stays a build system that's convenient to use and endlessly scalable.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-07-12-faster-incremental-builds-with-dune-3</id><title type="text">Faster Incremental Builds with Dune 3</title><updated>2022-07-12T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-07-05-the-magic-of-merlin" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Tarides provides support and development services for OCaml tools, packages, and libraries for our commercial partners and for the benefit of the entire OCaml community. We focus on groundbreaking innovation, feature development, and crucial maintenance of OCaml-based projects. One of these projects is called Merlin, an advanced Integrated Development Environment (IDE).&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#overview&quot; aria-label=&quot;overview permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Overview&lt;/h2&gt;
&lt;p&gt;When someone hears the word &amp;quot;Merlin,&amp;quot; images of King Arthur, the Round Table, and the Holy Grail might come to mind. This fantasy world introduces us to Merlin, the mighty wizard who becomes Arthur's advisor and mentor. When speaking in the world of technology, our Merlin's magic comes in the form of a powerful editor service that offers completion, typing, navigation, refactoring, and code generation. This IDE was made specifically for OCaml, so it complements the safety and expressiveness of the OCaml language with powerful tools. In short, Merlin is a loyal companion that magically helps OCaml developers be more productive and write better programs!&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#installing-merlin&quot; aria-label=&quot;installing merlin permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Installing Merlin&lt;/h2&gt;
&lt;p&gt;Merlin integrates with most editors, including Visual Studio Code (VSCode), via the Language Server Protocol (LSP). It also implements custom features on top of LSP to enable powerful developer workflows that are only available in OCaml. As a result, Merlin helps developers write in OCaml more easily, as they&amp;rsquo;re provided with instant feedback on any possible errors that they could make. It helps train these programmers to make fewer errors in the future and eases project maintenance by automating complex (and otherwise error-prone) workflows.&lt;/p&gt;
&lt;p&gt;The easiest way to install Merlin is by using VSCode's OCaml extension. See the &lt;a href=&quot;https://github.com/ocamllabs/vscode-ocaml-platform#readme&quot;&gt;manual&lt;/a&gt; for more information. You can also use Merlin through Vim or GNU Emacs. Read more on &lt;a href=&quot;https://ocaml.github.io/merlin/&quot;&gt;OCaml.org's Merlin page&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Once the installation process is complete, your editor will automatically start Merlin whenever an &lt;code&gt;.ml&lt;/code&gt; or &lt;code&gt;.mli&lt;/code&gt; file is opened.&lt;/p&gt;
&lt;p&gt;Voil&amp;agrave;! So easy!&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#merlin-in-use&quot; aria-label=&quot;merlin in use permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Merlin in Use&lt;/h2&gt;
&lt;p&gt;Here's a glimpse of what Merlin looks like in VSCode:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/6f0c10eb54f23b147c8ce58d47bfcd4d/ddf4f/merlin.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 79.41176470588235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC40lEQVR42p2UXWsbRxSGN42TGieEtohKinZnZz9mP7Qz+6WV1qod2RVy4jYkF7pK6I0vpEJjTKD0qoL8qkJ/wELzjwILK94wI8l2invThYczZ5jzznsOw2qapmnTV6/aL16/9tNywsrJlnLC0rRkFxcXbD6fs9nLl2w2m7GyLL9AnimKwi/Lsq1tv3vHk8lfpycnSHn0SUS8DiNR8zitIy7qk9Mf6/EPx3V5OK6Ho7IWcVLHSapI0qzO8sGnvBiCc/H3TvCgKIoqT2MUodfkIkYhfAjOEYYCtuPCth1Qaiksy75G7nuevw7DEJTSfzRN25eCjwaDrBKCwzBp4wR99EMPHnNgOg5YGMD3PBiEgNyBYRhrGfv9vhT8eiM4flZFxRGIrjcO82FZFqjrgdouDF2XRXeKbVmbpokkFjcOi9FhxZMcJiGN34/AGINJrQ0mgSy4U8wwoOu6Ekzj+EZwNBxWSRzDtmmTZhx+EMC2bNWmdHcXUtByXTDmrWVHfhjeCA5HoypJEtlqY7keJLYfyblADjyKNusgCBQyD/sRfCHAOV/bti2d3mq5KJSgruuNQeTtJohJQeUsKf3PlvVeD91uV7X8hWCSJBXn8ok4jes6sCyqZrdrzff9jaswVEi3O4IgUA4Nw/i3IMfJKG+eHR8jyzKFLJAOpfuiKJDnOQaDgVrvctmyvJAQcmuGw2El4hieqTeDPEd5OMaoPLwmzTKIOIE8EycpgrAPx3XhugyW46w9PwAhtx72eDSuEiGgt79trF4b9On3sPVN3OWK3iaSTgtGp6Ui6bTWtNuC0W593D3sA3P+c0Xf/gHzbNG0Zwt0zxaQsTNbgJwvYbxY4unZUuW950uFcf4rOrMlemeLdef8HVpHb64dPtCO2Hx/+suH7376/c+908vVw+nVal9xufrm/Gr1+Pkmfzi9XB3MNusn273H06vV3vT9h/uT3+ZKS/5tttzXNG3vfyJrv5I6nwE/qXcOEwWh+AAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/6f0c10eb54f23b147c8ce58d47bfcd4d/c5bb3/merlin.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Merlin in VSCode&quot; title=&quot;&quot; srcset=&quot;/static/6f0c10eb54f23b147c8ce58d47bfcd4d/04472/merlin.png 170w,
/static/6f0c10eb54f23b147c8ce58d47bfcd4d/9f933/merlin.png 340w,
/static/6f0c10eb54f23b147c8ce58d47bfcd4d/c5bb3/merlin.png 680w,
/static/6f0c10eb54f23b147c8ce58d47bfcd4d/b12f7/merlin.png 1020w,
/static/6f0c10eb54f23b147c8ce58d47bfcd4d/b5a09/merlin.png 1360w,
/static/6f0c10eb54f23b147c8ce58d47bfcd4d/ddf4f/merlin.png 1624w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Merlin is the default IDE tool for OCaml developers. It's utilised by many commercial OCaml users who are funding maintenance work and evolutions of the project. For instance, Jane Street developers, sysadmin, and traders confidently use Merlin to browse, maintain, and modify an OCaml codebase that runs into millions of lines of code. This codebase provides the foundation for Jane Street's financial market trading around the world. It critically depends on tools (such as Merlin&amp;rsquo;s) to ensure it can continue to evolve while functioning safely.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#beneficial-features-in-merlin&quot; aria-label=&quot;beneficial features in merlin permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Beneficial Features in Merlin&lt;/h2&gt;
&lt;p&gt;One of Merlin's main developers, Fr&amp;eacute;d&amp;eacute;ric Bour, says his favourite feature is &amp;quot;completion,&amp;quot; which has the ability to complete a prefix typed by a programmer in a manner that is (somewhat) relevant in the context. He says, &amp;quot;I like it for two reasons: less things to remember (and in a programming language, usually you have to recall exactly because there is not much room for fuzzy interpretation) and also it makes things 'discoverable.' Sometimes you work in an area that is new to you, and looking at the Merlin view with its suggestions really helps engineers become acquainted with this program.&amp;quot;&lt;/p&gt;
&lt;p&gt;The Tarides CTO, Thomas Gazagnaire, loves that Merlin &amp;quot;is the perfect companion to any professional OCaml developer. It helps navigate completely new codebases by providing the necessary feedback to learn the project (and the OCaml language!) quicker. It is also super useful to refactor large pieces of existing code, with immediate feedback and hints. I remember very clearly when I started using Merlin on my projects. It provided me a great productivity boost that completely changed the way I programmed in OCaml and made me much more effective. Tarides is now committed to make sure this tool continues to be supported actively. We're always adding new features to improve developer productivity, like value and type renaming, semantic search over a whole project, etc.&amp;rdquo;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#learn-more&quot; aria-label=&quot;learn more permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Learn More&lt;/h2&gt;
&lt;p&gt;If you'd like to read more about Merlin, or become a contributor, visit its &lt;a href=&quot;https://github.com/ocaml/merlin&quot;&gt;GitHub repo&lt;/a&gt;, and feel free to &lt;a href=&quot;https://github.com/ocaml/merlin/issues&quot;&gt;open an Issue&lt;/a&gt; if you have any suggestions. Please &lt;a href=&quot;mailto:contact@tarides.com&quot;&gt;contact us&lt;/a&gt; if you would like to subscribe to commercial support or discuss future development.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-07-05-the-magic-of-merlin</id><title type="text">The Magic of Merlin</title><updated>2022-07-05T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-06-28-thales-cyber-station-f-selection" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;&lt;em&gt;The online world is becoming an increasingly bigger part of our everyday lives, bringing the issue of cybersecurity to the forefront of more and more minds. At Tarides we put security at the centre of everything we do, and we&amp;rsquo;re honoured to be part of &lt;em&gt;Cyber@Station F&lt;/em&gt; in 2022.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Tarides is thrilled to announce that we have been selected for the &lt;a href=&quot;https://cyber-at-stationf.com/en/startups&quot;&gt;Cyber@Station F Acceleration Program!&lt;/a&gt; It&amp;rsquo;s a fantastic opportunity for Tarides to exchange information and collaborate with other startups, as well as connect with the cybersecurity giant Thales.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-program&quot; aria-label=&quot;the program permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Program&lt;/h2&gt;
&lt;p&gt;The  &lt;a href=&quot;https://cyber-at-stationf.com//&quot;&gt;Cyber@Station F&lt;/a&gt; program was established by &lt;a href=&quot;https://thalesdigital.io/&quot;&gt;Thales Digital Factory&lt;/a&gt; at &lt;a href=&quot;https://stationf.co&quot;&gt;Station F&lt;/a&gt; to &amp;ldquo;help accelerate startups&amp;rsquo; development in cybersecurity by providing them advice, expertise, and access to our big markets.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Thales Cyber@Station F is a startup acceleration program that centres around the areas of cybersecurity &amp;amp; trust. It guides its participants through four stages: Select, Define, Deliver &amp;amp; Test, and Business Acceleration. The stages are designed to give each startup an opportunity to come up with and test a proof of concept with potential clients, which if successful is then developed further.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#what-we-do&quot; aria-label=&quot;what we do permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What We Do&lt;/h2&gt;
&lt;p&gt;At Tarides we know that a lot of today&amp;rsquo;s technology solutions are overly complex, vulnerable to attack, and time consuming to develop. As an alternative to this, we provide secure, safe, and efficient solutions by leveraging the features of OCaml in combination with cutting-edge tools and technologies. In collaboration with a rich open-source community, we develop and maintain the OCaml language, the operating system MirageOS including Unikernels, as well as a range of developer tools.&lt;/p&gt;
&lt;p&gt;The OCaml language is efficient, writes safe and secure code, and is easy to maintain and adapt thanks to its modular nature. When combined with MirageOS and Unikernels, which reduce runtime complexity for lightweight and accurate results, OCaml&amp;rsquo;s already impressive features are used more effectively. Finally, our range of modern, easy-to-use tools offer developers a range of options for writing projects in OCaml.&lt;/p&gt;
&lt;p&gt;Cybersecurity is at the heart of what we do, and we&amp;rsquo;re excited to combine our knowledge and experience with the substantial resources offered by Thales and Station F. We are also looking forward to engaging with other companies in the same industry and discovering new opportunities for our projects and our clients.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#thales&quot; aria-label=&quot;thales permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Thales&lt;/h2&gt;
&lt;p&gt;Thales is a global leader in technology innovations and solutions specialising in digital and &amp;lsquo;deep tech&amp;rsquo; innovations such as Big Data, artificial intelligence, connectivity, cybersecurity, and quantum technology. Their goal is to invest in these technologies to build a better future that people can trust. Thales focuses on five vertical markets: digital identity and security, defence and security, aerospace, space, and transport. Their clients play a central role in these socially important markets.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#station-f&quot; aria-label=&quot;station f permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Station F&lt;/h2&gt;
&lt;p&gt;Located in Paris, Station F is a startup campus that hosts over 1000 startups. StationF offers everything an entrepreneur needs to start and grow their business, making over 35 public services, 150 perks, and 600 workshops and events available to people in their network. Their services include startup programs on specific themes, special mentorship offices, a Flatmates service, exclusive discounts, and much more.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#more-coming-soon&quot; aria-label=&quot;more coming soon permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;More Coming Soon&lt;/h2&gt;
&lt;p&gt;The programme started at the beginning of June, and we&amp;rsquo;ll follow up with more developments as they happen. In the meantime, we&amp;rsquo;ve selected some relevant posts and information on our work in cybersecurity you can read if you want to know more. We&amp;rsquo;ve received funding from the EU for our work on a &lt;a href=&quot;https://tarides.com/blog/2021-04-30-scop-selected-for-dapsi-initiative&quot;&gt;secure open messaging&lt;/a&gt; platform, we&amp;rsquo;ve been laureates of the &lt;a href=&quot;https://tarides.com/blog/2019-07-05-i-lab-2019&quot;&gt;i-Lab innovation contest&lt;/a&gt; for our work on Osmose, and we&amp;rsquo;ve won the &lt;a href=&quot;https://tarides.com/blog/2019-12-11-tarides-wins-the-fic-2020-startup-award&quot;&gt;2020 FIC startup award&lt;/a&gt;.  If you want to read up on the technical side of things, these papers on &lt;a href=&quot;https://www.usenix.org/system/files/conference/usenixsecurity15/sec15-paper-kaloper-mersinjak.pdf&quot;&gt;unikernels&lt;/a&gt; and on  &lt;a href=&quot;https://anil.recoil.org/papers/2018-hotpost-osmose.pdf&quot;&gt;Osmose&lt;/a&gt; are a good place to start.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-06-28-thales-cyber-station-f-selection</id><title type="text">Thales Cyber@Station F Selection</title><updated>2022-06-28T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-06-23-team-tarides-visits-a-17th-century-chateau" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;&lt;em&gt;Everyone at Tarides recently had the opportunity to meet up in person for the first time! Since the global pandemic left much of our distributed team unable to meet, we organised a working retreat that brought all our teams together to work, learn, and have fun.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;This was the first formal retreat we&amp;rsquo;ve held as a company, and our goals were to provide an opportunity to disconnect from day-to-day work, meet with new people, and discuss new projects - all in a novel environment surrounded by fresh air and open space. During the course of the pandemic, Tarides grew from 36 to 71 people based in 11+ countries, with few of them ever having met in person. As soon as it was safe to do so, we knew that gathering together would give us an invaluable experience in building and reinforcing our own company culture.&lt;/p&gt;
&lt;p&gt;This May, all members of Tarides were invited to a beautiful 17th century chateau at Les Pr&amp;eacute;s D&amp;rsquo;Ecoublay, surrounded by fields, orchards, and lush green forests. Attendees participated in exciting workshops, team-building activities, tech-talks, and inspiring discussions. Over the course of two days, everyone had plenty of time to collaborate, socialise, and eat fantastic food!&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#what-we-got-up-to&quot; aria-label=&quot;what we got up to permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What We Got Up To&lt;/h3&gt;
&lt;p&gt;The fun began at 9am on Thursday, May 19th, when Tarides&amp;rsquo;s distributed global team gathered to make their way to what was to be their castle for the next two days. Greeted by a feast of French pastries and fresh fruit, introductions were made between people from Australia, France, India, Germany, the USA, the UK, and many more countries.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#tech-talks--tutorials&quot; aria-label=&quot;tech talks  tutorials permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Tech Talks &amp;amp; Tutorials&lt;/h4&gt;
&lt;p&gt;Over the next couple of days, the itinerary left plenty of space for knowledge sharing via tutorials and &amp;lsquo;tech talks&amp;rsquo; or presentations. KC Sivaramakrishnan gave everyone a sneak peak of OCaml 5 with a detailed &lt;a href=&quot;https://github.com/kayceesrk/ocaml5-tutorial/&quot;&gt;tutorial&lt;/a&gt;. The tutorial is openly available on GitHub. Please give us feedback if you try it!&lt;/p&gt;
&lt;p&gt;Engineers Sonja Heinze and Jan Midtgaard held presentations (so-called &amp;lsquo;tech talks&amp;rsquo;) in the main hall for everyone&amp;rsquo;s benefit. Sonja&amp;rsquo;s talk was on the benefits of &lt;a href=&quot;https://www.outreachy.org&quot;&gt;Outreachy&lt;/a&gt;, an open-source internship coordinator that creates opportunities for those most affected by underrepresentation or discrimination. Jan introduced everyone to property-based testing, a fascinating way to test the &amp;lsquo;correctness&amp;rsquo; of code. The goal of the 'tech talks' is to provide a safe space for people to share their work with others, where everyone is welcome to ask questions and discuss the topics covered.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#cross-team-collaboration&quot; aria-label=&quot;cross team collaboration permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Cross-Team Collaboration&lt;/h4&gt;
&lt;p&gt;There were also plenty of opportunities for teams to meet and work together, with individual meeting rooms readily at hand. The coffee machines (and accompanying sweets) in each room significantly boosted the productivity of all teams! Teamwork was not limited to individual groups, but time was made for cross-team brainstorming and collaboration.&lt;/p&gt;
&lt;p&gt;All of the teams at Tarides are working towards the big OCaml 5.0 release scheduled for later this year, and we took the opportunity to use this release as a focal point to align our goals for the next few months. Each team spent some time together to conceptualise their team-specific goals first, and then the Team Leads followed up with an &amp;quot;office hours&amp;quot; drop in session to discuss cross-project interaction and ideas. Creating dedicated space to think beyond the usual daily tasks and projects proved to be really valuable, producing insights and connections that may have otherwise been missed.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fun--games&quot; aria-label=&quot;fun  games permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Fun &amp;amp; Games!&lt;/h4&gt;
&lt;p&gt;It wouldn&amp;rsquo;t be a working retreat without opportunities for relaxation and fun! We got competitive in a treasure hunt that had us searching the forest and tall grasses for clues. There was plenty of time to explore the vast castle grounds, which included a pool, archery arena, ping pong table, karaoke pavilion, and much more.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#until-next-time&quot; aria-label=&quot;until next time permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Until Next Time&lt;/h3&gt;
&lt;p&gt;The off-site was a huge success! As a distributed team, it&amp;rsquo;s important to occasionally get together and put a face to a name (or Slack and GitHub handle!). Everyone at Tarides looks forward to the next off-site, wherever it may take place.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-06-23-team-tarides-visits-a-17th-century-chateau</id><title type="text">Team Tarides Visits a 17th Century Chateau</title><updated>2022-06-23T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-06-21-functional-conf-2022" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;This year, Tarides attended the 2022 &lt;em&gt;Functional Conf&lt;/em&gt; in India. Tarides&amp;rsquo;s engineers Sudha Parimala and Shakthi Kannan gave presentations on the OCaml platform and &lt;em&gt;Sandmark&lt;/em&gt;, a continuous benchmarking tool for Multicore OCaml.&lt;/p&gt;
&lt;p&gt;The &lt;em&gt;Functional Conf&lt;/em&gt; is a three-day conference on everything functional programming! It&amp;rsquo;s a great event for beginners and experienced developers alike. Beginners have the opportunity to be introduced to different functional programming languages and understand their fundamental principles, and those who are more experienced have plenty to learn from both participants and speakers on how they have leveraged functional programming in their projects.&lt;/p&gt;
&lt;p&gt;This year&amp;rsquo;s &lt;em&gt;Functional Conf&lt;/em&gt; was held online and attended by people from around the world. It has been referred to as &amp;ldquo;Asia&amp;rsquo;s premiere functional programming conference&amp;rdquo; and welcomes participants from a broad range of backgrounds.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#ocaml-platform-2022&quot; aria-label=&quot;ocaml platform 2022 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;em&gt;OCaml Platform 2022&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=tv4_Le4E-gQ&quot;&gt;Sudha Parimala&amp;rsquo;s talk&lt;/a&gt; is a great introduction to OCaml and its features, covering the installation process and &amp;quot;Hello World,&amp;quot; as well as more advanced topics such as the text editor, publishing a library, and debugging. For the &lt;em&gt;Functional Conf&lt;/em&gt;, it was a great way to give people interested in functional programming a taste of OCaml and what makes it stand out.&lt;/p&gt;
&lt;p&gt;The presentation is a fantastic resource for people who are starting their journey in OCaml and want to know more about what they can do with the language, as well as for people further ahead looking for inspiration on different ways to progress.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#benchmarking-multicore-ocaml&quot; aria-label=&quot;benchmarking multicore ocaml permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;em&gt;Benchmarking (Multicore) OCaml&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=_-4XNtKs3wM&quot;&gt;Shakthi Kannan&amp;rsquo;s talk&lt;/a&gt; centres around Sandmark, the benchmarking suite designed to test various parts of the OCaml compiler and its runtime. Benchmarking is a challenging process. As a result, there are few tools available that do the job well. OCaml&amp;rsquo;s Sandmark can test various performance axes such as CPU, memory, and I/O, as its tools build the compiler under various configuration settings. It also comes with a dashboard that lets the user explore the results of benchmarking runs in an interactive and easily digestible format.&lt;/p&gt;
&lt;p&gt;In his talk, Shakthi describes the journey to Sandmark, originally developed to support the Multicore OCaml project. He covers the challenges the team faced and the lessons they learned along the way, especially with an evolving programming language and the need to support multiple CPU architectures. It&amp;rsquo;s an amazing resource for teams who are looking to set up their own benchmarking procedures, and it is also a great example of how to approach a difficult task as a team.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#in-conclusion&quot; aria-label=&quot;in conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;em&gt;In Conclusion&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;The &lt;em&gt;Functional Conf&lt;/em&gt; is a great conference that brings the growing community of functional programmers together. It offers opportunities for people to learn about functional programming and exchange information with others in similar fields. Tarides is proud to have participated in their effort to bring functional languages to the forefront of programming.&lt;/p&gt;
&lt;p&gt;To learn more about &lt;em&gt;Functional Conf&lt;/em&gt; you can visit &lt;a href=&quot;https://confengine.com/conferences/functional-conf-2022&quot;&gt;their website&lt;/a&gt;, along with the individual pages on &lt;a href=&quot;https://confengine.com/conferences/functional-conf-2022/proposal/16096/ocaml-platform-in-2022&quot;&gt;Sudha&amp;rsquo;s talk&lt;/a&gt; and &lt;a href=&quot;https://confengine.com/conferences/functional-conf-2022/proposal/16102/fast-and-curious-benchmarking-multicore-ocaml&quot;&gt;Shakthi&amp;rsquo;s talk&lt;/a&gt;, respectively.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-06-21-functional-conf-2022</id><title type="text">Functional Conf 2022</title><updated>2022-06-21T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-06-15-ocaml-5-alpha-release" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;&lt;em&gt;OCaml 5 is live! This major release introduces domains and effects, delivering unprecedented speed and efficiency to OCaml. Testing shows that OCaml 5 is able to outperform Go and closely match Rust in terms of performance. Keep reading for more details!&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Tarides is thrilled that the alpha release of the long-awaited OCaml 5 is live! OCaml 5 is the culmination of over 8 years of research and engineering into concurrency and parallelism support for OCaml, made real thanks to hard work and dedication from all corners of the community. Tarides has been a major contributor to the engineering effort. Our engineers have contributed not only to the core compiler but also to the tools around release readiness, ecosystem compatibility testing, and continuous performance monitoring.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;If you are using OCaml in an industrial setting (or if you are interested to do so), we'd like to make sure everything is ready for you to move to OCaml 5 and benefit from the new performance boost. Tell us what you need in this &lt;a href=&quot;https://framaforms.org/tarides-ocaml-5-user-survey-1655303113&quot;&gt;user survey&lt;/a&gt;.&lt;/strong&gt;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#what-kind-of-performance-to-expect&quot; aria-label=&quot;what kind of performance to expect permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What Kind of Performance to Expect?&lt;/h2&gt;
&lt;p&gt;This update brings &lt;em&gt;unprecedented results&lt;/em&gt; in terms of performance, with an HTTP server based on OCaml 5&amp;rsquo;s &lt;a href=&quot;https://github.com/ocaml-multicore/eio&quot;&gt;&lt;code&gt;Eio&lt;/code&gt;&lt;/a&gt; being able to serve 1M+ requests/sec, outperforming Go&amp;rsquo;s &lt;code&gt;nethttp&lt;/code&gt;, and closely matching Rust&amp;rsquo;s &lt;code&gt;hyper&lt;/code&gt; performance! This is just a small indication of OCaml 5&amp;rsquo;s potential in terms of speed and efficiency.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/9f0b97bdb5cfc231e1a387bb218f08c4/133ae/http_load1.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.47058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABp0lEQVR42pVT266bQAzM//9c1ZdIfYoSaNPCsjebvbKeIwgVJ03zcIxGvi2jWYxPrbVfACIABjB/Be2ISYBFRL6fRMS01qCNldExiAjGGDjnUEp5i5wzllowx4zBcsPDfpxSSialBDUOMv68out6nM9n3O93iMgLWhNgjyktmPwMpdRBSETGGAtjJ5nm31CTRtd1sNZuL/3PUhVoz5idBpJBpukgZGYzKQVPJGWpu4q24bAHcV0arPPwekALBmh5q+ecnxWO4whmlldFe75UkJ2g1R/k2QJSP3eRUzoIQwhGaw3v/T+Ee9wqmh9QvMY7e1GolFqnuxPK9jxOMiqP4EzQ2cFlB5vs5l3a82wxff6G3nszTdN25SaPeq4R7HpY18MXhsseqUas/UWWZ2ABRXoeyl+FqzAXNXpzAQWN9dS7Sb+9cqnFMM+w1oiNGioqLG3BV+yJcN2UNaKZpB96tNrARIgxblh/+hACYkzbhqy11TPz1tv9Qdha6/d99CFEyiVTCIHmeabL5ULX65X6vqfb7UZd1225UopijFRKIWYmAA5AEZFvH4+X8/tF5WSuAAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/9f0b97bdb5cfc231e1a387bb218f08c4/c5bb3/http_load1.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;HTTP Load&quot; title=&quot;&quot; srcset=&quot;/static/9f0b97bdb5cfc231e1a387bb218f08c4/04472/http_load1.png 170w,
/static/9f0b97bdb5cfc231e1a387bb218f08c4/9f933/http_load1.png 340w,
/static/9f0b97bdb5cfc231e1a387bb218f08c4/c5bb3/http_load1.png 680w,
/static/9f0b97bdb5cfc231e1a387bb218f08c4/b12f7/http_load1.png 1020w,
/static/9f0b97bdb5cfc231e1a387bb218f08c4/b5a09/http_load1.png 1360w,
/static/9f0b97bdb5cfc231e1a387bb218f08c4/133ae/http_load1.png 1424w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/2f196c5af826e76e47ebc6a902b9182d/2a08f/http_cores.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.47058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB1ElEQVR42o2Ti2ocMQxF8/9fV2hpoUmhLd3s7oxnM7b8fp3imWw2gfQhEBYyOraurbvW2txaS4AHwtXbq/g/3AEd+HQHSCkFrXVPKXH1khM5jzhykcBiAuIixgWM9bs7z2o95yfT2O3rXYxRQgiISK+10nuH3pGQebKRp1BZFsV8OiDOYazDhPLieuwbdwOKiCilNuAGA0pt/Fw8qXV6FAgrFAfZQhKIKyRDrxF6IsV3gNba3tqeX30m5LqDonmW52qjgwat7odFTdLzW+D5fMYY00erpXUuLsP6C5J/Zuwy7OAb/NpRSukGdM5tN9yAwEFn7KqgeP5l7wKNMbIsC3Y8Sod5OtGDIfVCqhHJwuxnJj9hsmFNGp30HkdNqAEJ9gbUWr9oaENCLmdCdZzsaSssLVN7pbSyrcNTrfhSqK3ismM2rzS01m43dN73i1I8Pn3HjNfs/Y+tOh+ZF8Ooezw8omZ1A+acxTnHNE/94cdHUot/U20HOsXl8sD9/Te+fPnM8Xi8Aa+TMqupKz1vNdZavPeMbzTi8fF3kNvyuRQueh0Pue0ppd4Aj7VWl1KSUqrUVsV7P6ZHxmFDksPhINM0DWlkTNbIB+clXOMQdM45Ax9+A/9C8wMsNAJhAAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/2f196c5af826e76e47ebc6a902b9182d/c5bb3/http_cores.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;HTTP Cores&quot; title=&quot;&quot; srcset=&quot;/static/2f196c5af826e76e47ebc6a902b9182d/04472/http_cores.png 170w,
/static/2f196c5af826e76e47ebc6a902b9182d/9f933/http_cores.png 340w,
/static/2f196c5af826e76e47ebc6a902b9182d/c5bb3/http_cores.png 680w,
/static/2f196c5af826e76e47ebc6a902b9182d/b12f7/http_cores.png 1020w,
/static/2f196c5af826e76e47ebc6a902b9182d/b5a09/http_cores.png 1360w,
/static/2f196c5af826e76e47ebc6a902b9182d/2a08f/http_cores.png 1422w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;As it&amp;rsquo;s an alpha version, it&amp;rsquo;s still subject to some change and fine tuning. This means that we need your help to make OCaml 5 better! Please give &lt;a href=&quot;https://discuss.ocaml.org&quot;&gt;plenty of feedback&lt;/a&gt; and &lt;a href=&quot;https://github.com/ocaml/ocaml/issues&quot;&gt;report any bugs&lt;/a&gt; you find.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#under-the-hood&quot; aria-label=&quot;under the hood permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Under the Hood&lt;/h2&gt;
&lt;p&gt;The alpha release of OCaml 5 adds support for shared memory parallel execution via &lt;em&gt;domains&lt;/em&gt; and a new model for concurrent execution via &lt;em&gt;effect handlers&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Domains enable shared-memory parallel programming that allow OCaml programs to run on multiple cores. With domains, OCaml programs will scale better by exploiting multicore processing. Effect handlers are a mechanism for concurrent programming. With the introduction of effect handlers, simple direct-style OCaml code will be flexible, easy to develop, debug, and maintain. No more monads for concurrency! These features will benefit the entire ecosystem and community, and we expect it to attract many new users to the language.&lt;/p&gt;
&lt;p&gt;The Standard Library is gaining several of the parallelism primitives previously only found in the Threads library (Condition, Mutex, and Semaphore). Interestingly, having added domains and effects, we hope and expect that most users will never need to use them directly! Instead, we warmly encourage users to look at adopting &lt;a href=&quot;https://github.com/ocaml-multicore/domainslib&quot;&gt;&lt;code&gt;domainslib&lt;/code&gt;&lt;/a&gt; to parallelise programs and &lt;a href=&quot;https://github.com/ocaml-multicore/eio&quot;&gt;&lt;code&gt;Eio&lt;/code&gt;&lt;/a&gt; as a replacement for Lwt/Async monadic-style concurrency.&lt;/p&gt;
&lt;p&gt;This work seeks to remain entirely backwards-compatible. Programs written for any version of OCaml 4, even if they use the Thread library, will continue to work with the same semantics, similar performance, and as always for OCaml, without crashes.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#next-steps&quot; aria-label=&quot;next steps permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Next Steps&lt;/h2&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#installation&quot; aria-label=&quot;installation permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Installation&lt;/h3&gt;
&lt;p&gt;For instructions on how to install OCaml 5 on your machine, &lt;a href=&quot;https://discuss.ocaml.org/t/ocaml-5-0-zeroth-alpha-release/10026&quot;&gt;Florian Angeletti&amp;rsquo;s Discuss post&lt;/a&gt; goes into great detail on how to do so, depending on what version of OCaml you&amp;rsquo;re running and what machine you have. KC Sivaramakrishnan has also created a &lt;a href=&quot;https://github.com/kayceesrk/ocaml5-tutorial/&quot;&gt;tutorial&lt;/a&gt; on OCaml 5 that introduces its new parallelism features, a great resource for anyone looking to make the most of the update.&lt;/p&gt;
&lt;p&gt;Other OCaml 5 documentation includes information on &lt;a href=&quot;https://kcsrk.info/webman/manual/parallelism.html&quot;&gt;parallelism&lt;/a&gt;, &lt;a href=&quot;https://kcsrk.info/webman/manual/effects.html&quot;&gt;effect handlers&lt;/a&gt;, and the &lt;a href=&quot;https://kcsrk.info/webman/manual/memorymodel.html&quot;&gt;memory model&lt;/a&gt;.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#feedback&quot; aria-label=&quot;feedback permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Feedback&lt;/h3&gt;
&lt;p&gt;We want to reiterate that as with any alpha release of OCaml, we&amp;rsquo;re keen to hear about bugs and performance regressions. The move to parallel OCaml may bring new debugging challenges, but it remains the case that pure OCaml programs which do not use unsafe features should absolutely never crash. We&amp;rsquo;ll be taking part in the discussion on &lt;a href=&quot;https://github.com/ocaml/ocaml/issues&quot;&gt;GitHub&lt;/a&gt;, &lt;a href=&quot;https://discuss.ocaml.org&quot;&gt;Discuss&lt;/a&gt;, and &lt;a href=&quot;https://twitter.com/tarides_?s=20&amp;amp;t=xD04dp9D8eDpCxX6WDkC0A&quot;&gt;Twitter&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The change in major version number (from 4.&lt;em&gt;n&lt;/em&gt; to 5.&lt;em&gt;n&lt;/em&gt;) may result in minor breaking changes which affect your packages, particularly if you&amp;rsquo;ve been allowing some deprecation warnings to slip through in the past! We&amp;rsquo;ll be following up with more information about the required tweaks that may be required for packages supporting both old and new versions of OCaml, as well as with specifics on the testing infrastructure.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#survey&quot; aria-label=&quot;survey permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Survey&lt;/h3&gt;
&lt;p&gt;As discussed above, we&amp;rsquo;ve created a &lt;a href=&quot;https://framaforms.org/tarides-ocaml-5-user-survey-1655303113&quot;&gt;user survey&lt;/a&gt; to help us get a better sense of how people are planning on using OCaml 5. It would be very helpful if you could fill it out for us, which should only take a few minutes.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#ocaml-5-timeline&quot; aria-label=&quot;ocaml 5 timeline permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;OCaml 5 Timeline:&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;The beta release will take place once these &lt;a href=&quot;https://github.com/ocaml/ocaml/milestone/40&quot;&gt;issues&lt;/a&gt; have been resolved.&lt;/li&gt;
&lt;li&gt;The final release is expected in September.&lt;/li&gt;
&lt;li&gt;There is &lt;em&gt;no time limit&lt;/em&gt; on reporting bugs, so please &lt;a href=&quot;https://github.com/ocaml/ocaml/issues&quot;&gt;report them here&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#further-reading&quot; aria-label=&quot;further reading permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Further Reading&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&quot;https://discuss.ocaml.org/tag/multicore-monthly&quot;&gt;Multicore monthlies&lt;/a&gt;, produced by Shakthi Kannan and Anil Madhavapeddy, provide important context for the work behind OCaml 5 and what&amp;rsquo;s coming with the release.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-06-15-ocaml-5-alpha-release</id><title type="text">OCaml 5 Alpha Release</title><updated>2022-06-15T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-06-13-adding-merkle-proofs-to-tezos" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;The Upcoming Tezos &lt;a href=&quot;https://tezos.gitlab.io/protocols/013_jakarta.html#protocol-jakarta&quot;&gt;Jakarta Protocol&lt;/a&gt; will support compact Merkle
proofs to scale the network's trust infrastructure.
This allows nodes that do not trust each other to agree on the
validity of Tezos transactions with orders of magnitude smaller
storage requirements.
For instance, the block &lt;a href=&quot;https://tzstats.com/2400319&quot;&gt;2,400,319&lt;/a&gt;,
containing 402 transactions and 638 operations,
can be validated using a Merkle proof of 6.3 MB instead of requiring
a Tezos node with at least 3.4 GB of storage, a savings of 99.8%!&lt;/p&gt;
&lt;p&gt;Tarides contributed to Jakarta by extending the Tezos
storage system to support compact
storage proofs. This
feature extends the compact cryptographic representation of the ledger
state to sequences of operations. As a result, nodes that do not trust
each other can still agree on the series of operations' validity,
even if they don't know the entire contents of the ledger. The
upcoming stateless nodes (like &lt;a href=&quot;https://tezos.gitlab.io/user/light.html&quot;&gt;Tezos
light-client&lt;/a&gt;),
&lt;a href=&quot;https://tezos.gitlab.io/user/proxy.html&quot;&gt;proxies&lt;/a&gt;, and mechanisms that allow the exchange of trust between disjointed tamper-proof storage (like &lt;a href=&quot;https://tezos.gitlab.io/alpha/transaction_rollups.html&quot;&gt;L2
transactional-rollups&lt;/a&gt;,
L2 smart-contract rollups,...) will use these proofs to scale the
Tezos trust infrastructure to &lt;a href=&quot;https://research-development.nomadic-labs.com/tezos-is-scaling.html&quot;&gt;new heights&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The Merkle Proof API is one of the last major features that we integrated from
&lt;a href=&quot;https://www.dailambda.jp/blog/2019-08-08-plebeia/&quot;&gt;Plebeia&lt;/a&gt;. It is
the result of a years-long collaboration between
&lt;a href=&quot;https://www.dailambda.jp/&quot;&gt;DaiLambda&lt;/a&gt; and Tarides to improve the
storage system of Tezos.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#a-very-quick-tour-of-tezos&quot; aria-label=&quot;a very quick tour of tezos permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A (Very) Quick Tour of Tezos&lt;/h3&gt;
&lt;p&gt;The Tezos network builds trust between its nodes by using two components:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;(i)&lt;/strong&gt; a tamper-proof database that can generate cryptographic hashes,
which uniquely and compactly represent the state of its contents; and&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;(ii)&lt;/strong&gt; a consensus algorithm to share these cryptographic hashes
across the network of (potentially adversarial) nodes.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Both components have seen impressive improved performance
recently. First, for &lt;strong&gt;(i)&lt;/strong&gt;, we've discussed
the improvements that we released in &lt;a href=&quot;https://tarides.com/blog/2022-04-26-lightning-fast-with-irmin-tezos-storage-is-6x-faster-with-1000-tps-surpassed&quot;&gt;Octez v13 to improve
the efficiency of the storage component by a factor of 6&lt;/a&gt;. Second, for &lt;strong&gt;(ii)&lt;/strong&gt;, the consensus algorithm in Ithaca 2 changed from a
Nakamoto-style algorithm (like Bitcoin) to
&lt;a href=&quot;https://arxiv.org/abs/2001.11965&quot;&gt;Tenderbake&lt;/a&gt; -- a Byzantine Fault
Tolerance consensus with deterministic finality. This change
significantly improved the time it takes for converging towards a
uniquely agreeing state hash in the Tezos network.&lt;/p&gt;
&lt;p&gt;The Merkle proofs that we
introduced in the Jakarta Protocol will allow us to &lt;a href=&quot;https://research-development.nomadic-labs.com/tezos-is-scaling.html&quot;&gt;improve the
chain's performance even
more&lt;/a&gt;.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-tezos-ledger-is-a-merkle-tree&quot; aria-label=&quot;the tezos ledger is a merkle tree permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Tezos Ledger is a Merkle Tree&lt;/h3&gt;
&lt;p&gt;Tezos represents the ledger state (for instance, the amount of tokens
owned by everyone) as a Merkle tree, using the
&lt;a href=&quot;https://irmin.io&quot;&gt;Irmin&lt;/a&gt; storage library. Merkle trees are immutable
tree-like data structures where each leaf is labelled with a
cryptographic hash. Each node's hash is then obtained by
recursively hashing its children's label. Tezos then combines that
root hash computation with its consensus protocol to make sure every
node in the network agrees on the ledger's state.&lt;/p&gt;
&lt;p&gt;But there is another interesting aspect of Merkle trees that was not
exposed and used by Tezos until now: &lt;em&gt;Merkle proofs&lt;/em&gt;. In the protocol
&lt;code&gt;J&lt;/code&gt; proposal, we are introducing a new feature: Merkle proofs for
Tezos as partial, compressed, Merkle trees. In a blockchain, as in
Tezos, Merkle proofs are an efficient way to verify the integrity of
operations over Merkle trees. For this reason, Merkle proofs are
a central part of the optimistic rollups projects that will
be available with the Tezos
&lt;a href=&quot;https://tezos.gitlab.io/protocols/013_jakarta.html&quot;&gt;Jakarta Protocol&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In collaboration with DaiLambda, Marigold, Nomadic Labs, and TriliTech,
we have integrated &lt;a href=&quot;https://github.com/camlspotter/plebeia&quot;&gt;Plebeia&lt;/a&gt;
Merkle proofs in Irmin. Plebeia use Patricia binary trees that are capable of
generating very compact Merkle proofs. For instance, the proof of
100 operations can be represented within 46 kB, while storing the full
Tezos context requires 3.4 GB of disk storage to store the relevant context.
This compactness comes from its specialised store structure and clever
optimisations, such as path compression and inlining. We have been
working with the DaiLambda team to unite Irmin and Plebeia's strengths
and bring built-in compact Merkle proof support to Tezos. We added
support for both the existing storage stack, where trees have a
branching factor of 32, and for new L2 storage systems that could use
binary trees directly. We have also worked with Marigold and Nomadic
Labs to propose an alternative representation of these proofs using
streams, that comes with a simplified verification algorithm.
A stream proof encodes the same information as a regular proof.
However, instead of being
encoded as a tree, the proof is encoded as a sequence of steps that
reveal a Merkle tree lazily, from root to leaves.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Kind of Proofs&lt;/th&gt;
&lt;th&gt;1 op.&lt;/th&gt;
&lt;th&gt;100 ops.&lt;/th&gt;
&lt;th&gt;1k ops.&lt;/th&gt;
&lt;th&gt;10k ops.&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;binary Merkle trees&lt;/td&gt;
&lt;td&gt;0.7kB&lt;/td&gt;
&lt;td&gt;46kB&lt;/td&gt;
&lt;td&gt;371kB&lt;/td&gt;
&lt;td&gt;2.8MB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;stream binary Merkle trees&lt;/td&gt;
&lt;td&gt;1kB&lt;/td&gt;
&lt;td&gt;75kB&lt;/td&gt;
&lt;td&gt;602kB&lt;/td&gt;
&lt;td&gt;4.5MB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Merkle B-trees (32 children)&lt;/td&gt;
&lt;td&gt;3.1kB&lt;/td&gt;
&lt;td&gt;158kB&lt;/td&gt;
&lt;td&gt;1232kB&lt;/td&gt;
&lt;td&gt;7.8MB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;stream Merkle B-trees (32 children)&lt;/td&gt;
&lt;td&gt;3.1kB&lt;/td&gt;
&lt;td&gt;158kB&lt;/td&gt;
&lt;td&gt;1238kB&lt;/td&gt;
&lt;td&gt;7.9MB&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;The table above shows the size for such proofs, using 2.5M entries (the current number of entries in &lt;code&gt;/data/contracts/index&lt;/code&gt; in the Tezos context). We are simulating 1, 100, 1000, and 10_000 random read operations on the entries, and we display the size of the related proofs.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#an-example&quot; aria-label=&quot;an example permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;An Example&lt;/h3&gt;
&lt;p&gt;Let's look at a simple example of a Merkle proof produced for ensuring
tamper-proof banking account statements.&lt;/p&gt;
&lt;p&gt;We can model a bank that stores its customer balances in the form of a
Merkle tree. To avoid publishing the entire contents of its customer
accounts, this bank can publicly export the bank's Merkle tree's
hash. To let 3rd-parties validate an operation, it can also produce
Merkle proofs that reveal the balance of some customers. Anyone in
possession of a Merkle proof can hash it and verify that it hashes
identically to the public hash announced by the bank. This equality of
hash is proof of correctness.&lt;/p&gt;
&lt;p&gt;Our bank contains the balances for Eve (30 coins), Ben (10 coins), and
Bob (20 coins). It stores the customers in a radix tree (Eve's balance
is stored under &lt;code&gt;&amp;quot;e&amp;quot;, &amp;quot;v&amp;quot;, &amp;quot;e&amp;quot;&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Irmin stores data as hash trees: whenever data is added to the
database, the corresponding nodes in the tree are hashed in order to
then generate the hash of the root node. The hash of a commit also
acts as a reference for accessing it in the future. This storage
format is close to Merkle proofs. It suffices to blind the part of the
tree that a transaction has not accessed to generate its proof. For
example, the account statement for Eve is in green. It doesn't leak
sensitive information about the other customers: only the letter &amp;quot;b&amp;quot;
is leaked. The hash corresponds to Bob and Ben's subtree.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/3f72a55ae57b0494cd400fb80392b28a/84cc5/Merkle-Proof.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 41.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3UlEQVR42mNgQAWiDAwMvAwMDOwMDAz8DPgBEwMDgwhUPSeUzQSW+f//PyOILv5cLFb0pmhqwdOC5SWfS1xAYqv+r2JGN6n+fz1YY/nncqf8Z/lLil8Xz2z9XymOUPGfAWxg/Zl6rnl35xVNfDi5YNXttR5gA1dhMbAeYuDs67ONZz+aXTbt/oyCVWdWycEVhF4JZSt5VdJT+rR0W+2zxqz/ny/qvni6afPz52tWf/myQx/ii3ommMtKP5aqFr8oXlH5onJT48su6/+vj8Y+e7Z+5717S+eCDVx3bZ3w2kdrs8rfFdv5P/GXvXXrgOGzZwfTHz7cG3f37mkzaLAwwVy75+4es/lP5yenfkg1DX2ULPT27XLZd+/W2N27t8ycoexN2bLyZ+VHq17XZvw/coT3y/uty549W3f07dudns+ebbJ/9mztvlev163+//qIVMrbLO3y1+W7yp+XH2h53WKCHJ5w0HG5Q3Pvnb1Boe/SwLF669Z+i7t3T/nu38/A8vRpPdf9+ycCbt8+4PgfFM7/GZhWXF/huP72egeGegam//X/QYaBwp8RFK7gsPWd4qsSvzm+r35/PQvY++va3LZu7aqFWbh9e2/l8uWN/jB++Krw8Pit8dlYXQcEAFTe55/GR6BAAAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/3f72a55ae57b0494cd400fb80392b28a/c5bb3/Merkle-Proof.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Merkle Proof&quot; title=&quot;&quot; srcset=&quot;/static/3f72a55ae57b0494cd400fb80392b28a/04472/Merkle-Proof.png 170w,
/static/3f72a55ae57b0494cd400fb80392b28a/9f933/Merkle-Proof.png 340w,
/static/3f72a55ae57b0494cd400fb80392b28a/c5bb3/Merkle-Proof.png 680w,
/static/3f72a55ae57b0494cd400fb80392b28a/84cc5/Merkle-Proof.png 898w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The Figure shows the difference between a Merkle tree (on the left) and a Merkle proof (on the right). In Merkle proofs, some subtrees can be blinded and represented only by their hash. Here the subtree under H2 is blinded and replaced by its hash. Thanks to this, Merkle trees and Merkle proofs will have the same root hash. Merkle proofs are hence very useful to provide Merkle tree summaries for a subset of the full data available.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Merkle proofs are thus partial Merkle trees, with the same root hash. But proofs
can also be represented using an alternate definition: a stream of elements
that needs to be visited in order to build the tree's root hash. There is
a one-to-one correspondence between the two representations, but stream proofs
are easier to implement as they encode the order in which nodes have to be visited to verify the proof. However, stream proofs need to carry the hash of all the intermediate nodes, while tree proofs can omit those. As a consequence, tree proofs are smaller than stream proofs, as shown in the above table.&lt;/p&gt;
&lt;p&gt;For instance, in the above Figure, the equivalent stream proof is the sequence:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A leaf with 30 coins;&lt;/li&gt;
&lt;li&gt;A node with hash &lt;code&gt;H3&lt;/code&gt; with a child (&amp;quot;e&amp;quot;, &amp;quot;30 coins&amp;quot;);&lt;/li&gt;
&lt;li&gt;A node with hash &lt;code&gt;H1&lt;/code&gt; with a child (&amp;quot;v&amp;quot;, &lt;code&gt;H3&lt;/code&gt;);&lt;/li&gt;
&lt;li&gt;A node with hash &lt;code&gt;H0&lt;/code&gt; with two children (&amp;quot;e&amp;quot;, &lt;code&gt;H1&lt;/code&gt;) and (&amp;quot;b&amp;quot;, &lt;code&gt;H2&lt;/code&gt;).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A verifier can just apply these elements in sequence to verify that &lt;code&gt;H0&lt;/code&gt; is
a valid root hash.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#merkle-proofs-in-irmin&quot; aria-label=&quot;merkle proofs in irmin permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Merkle Proofs in Irmin&lt;/h3&gt;
&lt;p&gt;If you want more details about the Merkle proof implementation, head
over to the
&lt;a href=&quot;https://mirage.github.io/irmin/irmin/Irmin/module-type-S/Tree/Proof/index.html&quot;&gt;documentation&lt;/a&gt;
or at &lt;a href=&quot;https://github.com/mirage/irmin/pull/1802&quot;&gt;https://github.com/mirage/irmin/pull/1802&lt;/a&gt; for the example above
revisited in Irmin.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-06-13-adding-merkle-proofs-to-tezos</id><title type="text">Adding Merkle Proofs to Tezos</title><updated>2022-06-13T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-06-09-ocaml-matrix-a-virtual-world" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#introduction&quot; aria-label=&quot;introduction permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Introduction&lt;/h3&gt;
&lt;p&gt;One of Tarides' projects is to create an open and secure infrastructure for &lt;a href=&quot;https://tarides.com/blog/2022-03-08-secure-virtual-messages-in-a-bottle-with-scop&quot;&gt;communication protocols&lt;/a&gt;, initially focusing on emails and &lt;a href=&quot;https://matrix.org/&quot;&gt;Matrix&lt;/a&gt;. This will allow organisations to self-host their messaging services, using either personal cloud resources or low-cost embedded devices. Individuals and organisations can use this framework to avoid having their emails and messages read and managed by third parties.&lt;/p&gt;
&lt;p&gt;Every component of our system is carefully designed as independent libraries, using modern development techniques to avoid the common reported threats and flaws. For instance, the protocols' implementation is written in a type-safe language and tested with state-of-the-art, coverage-driven tests, such as fuzzing. Then it's deployed as unikernels for enhanced security, model quality, and library portability. The combination of these techniques will increase users&amp;rsquo; trust to migrate their personal data to these new secure services.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-matrix&quot; aria-label=&quot;the matrix permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Matrix&lt;/h3&gt;
&lt;p&gt;When hearing the word &lt;em&gt;Matrix&lt;/em&gt;, people invariably think about Neo and his ability to see the code behind his virtual world. In lieu of the cultural connection to the popular film series, the Matrix Communication Standard creators respond to the implicit assumption regarding their choice of name: &amp;ldquo;We are called Matrix because we provide a structure in which all communication can be matrixed together.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Communication is essential to our society to both create and maintain relationships, whether personal or professional. As we progress further into this age of information, people communicate and stay connected through online and text-based communication. Gone are the days when someone would pick up a phone to call a friend or family member. Now, most people send a text message or email as the default. Thus, online communication has become the norm in our current society. Inevitably, this online communication is vulnerable to malicious actors trying to invade our privacy and hijack our correspondence. Tarides has addressed this issue and aims to host community discussions about open-source projects.&lt;/p&gt;
&lt;p&gt;Matrix is an established protocol for human-to-human and human-to-machine communications, including instant messaging. OCaml Matrix is an OCaml implementation of the Matrix protocol. This provides a secure communication layer which is based on MirageOS&amp;rsquo;s unikernel technology in order to reduce the attack surface. It uses Irmin as storage for the communication content to ensure integrity, and we have integrated it into the CI system for all OCaml projects.&lt;/p&gt;
&lt;p&gt;Let's take a closer look at the &lt;code&gt;ocaml-matrix&lt;/code&gt; component and explore some details about the Matrix Communication Standard to see if it&amp;rsquo;s indeed communication matrixed together or if it&amp;rsquo;s comparable to Neo&amp;rsquo;s Matrix with people plugged into a virtual world.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#matrix-beginnings-history&quot; aria-label=&quot;matrix beginnings history permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Matrix Beginnings (History)&lt;/h3&gt;
&lt;p&gt;Matrix is an open standard for interoperable, decentralised, real-time communication over the Internet, created in 2014 inside &lt;a href=&quot;https://www.amdocs.com&quot;&gt;Amdocs&lt;/a&gt;, a company specialised in software and services for communications. &lt;a href=&quot;https://matrix.org&quot;&gt;Matrix&lt;/a&gt; provides fully decentralised and federated architecture, so they don&amp;rsquo;t store users&amp;rsquo; information in a centralised location. This means when people join one of the Matrix virtual rooms to send messages, video chat, or share files, their exchanges are truly private, especially with Matrix&amp;rsquo;s end-to-end encryption. Matrix&amp;rsquo;s decentralised, federated architecture ensures communication integrity and availability in every room.&lt;/p&gt;
&lt;p&gt;Matrix is openly &lt;a href=&quot;https://spec.matrix.org/latest/&quot;&gt;specified&lt;/a&gt; and &lt;a href=&quot;https://github.com/matrix-org&quot;&gt;implemented&lt;/a&gt; with the open-source reference implementation server &lt;a href=&quot;https://github.com/matrix-org/synapse&quot;&gt;Synapse&lt;/a&gt; and client &lt;a href=&quot;https://github.com/vector-im&quot;&gt;Element&lt;/a&gt;, previously Riot, which already have several, astute security features and allow end-to-end encryption. Starting in 2018, the French Government deployed a private federation of &lt;a href=&quot;https://github.com/matrix-org/synapse-dinsic&quot;&gt;Matrix home servers&lt;/a&gt; and &lt;a href=&quot;https://github.com/tchapgouv&quot;&gt;Tchap&lt;/a&gt;, an open-source client forked from Riot. The French National Cybersecurity Agency (&lt;a href=&quot;https://www.ssi.gouv.fr/en/&quot;&gt;ANSSI&lt;/a&gt;) jointly works with the Interdepartmental Digital Directorate (&lt;a href=&quot;https://www.numerique.gouv.fr/dinum/&quot;&gt;DINUM&lt;/a&gt;) on a cybersecurity audit of Tchap. Matrix&amp;rsquo;s interesting security features include end-to-end capable search and enables private rooms&amp;rsquo; end-to-end encryption by default.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#matrix-reloaded-architecture&quot; aria-label=&quot;matrix reloaded architecture permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Matrix Reloaded (Architecture)&lt;/h3&gt;
&lt;p&gt;Users interact by sending and receiving events in Matrix rooms. Each Matrix user registers a homeserver that is identified by a unique ID, like &amp;ldquo;Neo:tarides.com.&amp;rdquo; The registration goes through a client application that connects to a Matrix homeserver via the client-server API. This allows users to perform actions such as sending messages, controlling rooms, or synchronising their conversation history. All communication in a Matrix room replicates across the room participants&amp;rsquo; homeservers, so every homeserver connected to a room stores the content of the room&amp;rsquo;s history.&lt;/p&gt;
&lt;p&gt;Basically, the user communicates to a home server via a client application. Once the user decides to join a room, the client sends this request to the homeserver, and it&amp;rsquo;s the homeserver&amp;rsquo;s responsibility to connect the user to the room, to store the history of the messages of that room, and to send the messages back to the user. The homeserver gets all this information by talking with the other users&amp;rsquo; homeservers in that room. This way, if a homeserver goes down, the conversation can continue as the remaining homeservers are still exchanging messages. When a homeserver comes back online, it resynchronises the messages. It receives old ones from other homeservers and inserts its own into others&amp;rsquo; timelines.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/918b2b99cc0728b9ab6397e8d967bf2b/0f7d5/servers.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 85.88235294117648%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACVElEQVR42pWU62/SUBiH/cP9auKHfTGZ0RiNl/hlGVMzY0zchm4DBm7l1lGgF4TScrGMMS5taWkfQxlLlmwwT3Jy0nPe9+n7O+d3ziPWtCAMGQ2vcF2Hh7RH9y2EIYRzYBBQUVT0Vvd6PlyM/wP0ZwGjic+VE+B4IWpnQt1y0PsuY3eGeWFHMQ8CTmcBantCvWtTNsc0ei7vf9XZy3coG0Pk1pBkxUL/O75RshLo+AGa2Sd2IPI10+S00uHtd5Gf2SYfv52itK7IaQOa1uRhwJCQQ9FkY+sUpdFl97jEzr7AWa7K9vwnJxq7SQXbDx8o2Z8xsAOKkoxQlBjbHrlimWpZxnE9kpks5VobPwhXVzg/vWUfXFiYzQZNvc5gcIlpGGSzZ+RzAnKlzHTqLrSEwd0Vut6MtGqT1QaUpXPq7UuSqodiXPLl8ydK5yJ59YK9XI+iKFEoFCgaUwq6y2g0urHSDdAP4Lhk8XI7jqT+YRpC7Ejmw+4hkqxGxs4rXZ7HUhxkRLRajZ39HC9iRwiServCJd0wmjzdfE2xZkTfJ5nfPHu3RaPTiyTLFYnNV2/Y/pGI1tPJYx4/2SBRkO/eQ9+fUZIqCEKW6XSK588Qz0tomobjONGNyeULKMqiIrPVJl8QGQ5Hq0/ZsiyKYpF+vx+BVFXFtm3G4zHVajUCt1qtqK+1zVL+MnmeJMsyqVSKRCKBYRiYpkmv17sVv9rY10Ge50WATCaDIAjE43FEUWQymdwLW/naLJMURYlskk6nI4usgq15vhZJ8z2bV6br+lrYHPgPbUwKUipbjG8AAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/918b2b99cc0728b9ab6397e8d967bf2b/c5bb3/servers.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Matrix Architecture&quot; title=&quot;&quot; srcset=&quot;/static/918b2b99cc0728b9ab6397e8d967bf2b/04472/servers.png 170w,
/static/918b2b99cc0728b9ab6397e8d967bf2b/9f933/servers.png 340w,
/static/918b2b99cc0728b9ab6397e8d967bf2b/c5bb3/servers.png 680w,
/static/918b2b99cc0728b9ab6397e8d967bf2b/0f7d5/servers.png 993w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Matrix Architecture Image Description: Matrix users communicate via Matrix clients, which can be web client, a mobile client, desktop clients, or embedded clients built into existing apps like Slack via Matrix bridges. It could even be a piece of hardware (e.g., a drone) that is Matrix enabled. A user's client connects via an unique ID to a single homeserver, which stores the communication history and account information for that user. It also shares data with the wider Matrix federation by synchronising communication history with other homeservers. The conversations among users take place in rooms that have their contents replicated across all of the homeservers associated with the users present in a room.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The centralised communication architectures keep the data within their own systems, which induces a series of security issues. For example, usually the centralised systems offer very little transparency regarding their implementations. This means that, for the claimed purpose of security, the centralised system could either hide backdoors or have security flaws that pose serious issues to privacy. By contrast, an open-source system promotes transparent development, which provides assurance regarding the liability of the implementation by allowing ad-hoc code audits. Moreover, the decentralised architecture empowers users to host their own conversations rather than all their data being stored by the service provider. This renders less incentives for attacks targeting massive data leaks and, in combination with the confidentiality ensured by the end-to-end encryption, induces an increased level of security while promoting ownership and data sovereignty.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#matrix-revolutions-in-ocaml&quot; aria-label=&quot;matrix revolutions in ocaml permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Matrix Revolutions (in OCaml)&lt;/h3&gt;
&lt;p&gt;Matrix&amp;rsquo;s &lt;a href=&quot;https://www.matrix.org/security-disclosure-policy/&quot;&gt;Hall of Fame&lt;/a&gt; shows several ethical researchers&amp;rsquo; investigative work into Matrix&amp;rsquo;s security vulnerabilities. For example, a recently discovered &lt;a href=&quot;https://www.cvedetails.com/cve/CVE-2021-44538/&quot;&gt;buffer overflow&lt;/a&gt; produces a considerable information disclosure in other Matrix implementations, such as Element. At Tarides, we mitigate a consistent class of these vulnerabilities with the OCaml development environment, which provides secure-by-design guarantees for the &lt;a href=&quot;https://github.com/mirage/ocaml-matrix&quot;&gt;OCaml Matrix&lt;/a&gt; project.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/d41f7a6ccb861f1d923be5320b068db1/d26aa/architecture.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 99.41176470588235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAACz0lEQVR42oWUzW7TQBDH+zi8CScuPA9XJCQeANEjUi85cIhAIEq/oG1oIIlISiikje06iR3bcZ3d9deu7T/aTe2mbVJGGltr7/525j+7s4Fry/McjDG4rgvXcWBbFkzThG7o0PQhRqORGpeu6zpM81KtW7YN+SiKAmEYotvtotPpoN/vK0CSJNj7uY13J2/hXTngKUccx8qFENA0DYZhoGRUQAmbzWZotVqo1Wqo1+tot9tqwsngELu9D6AxWSxEUUWT5TnOzy/uR0gZg2VZt3bigqsI2t02jr8fYTAYqIiX5+RFoVK/B2RLwDwv1ESpjYwgIXPEMw8izytQaXJs6MYqIF0AixRFEqAQUTVBhAypP6vG54MBGo0Ger3eeiAlc1jeHLz1GsGbx4iar5DKtLlAV2/j29kX0IQhyQBCGTTNAGOhAujrgLZPMf/4EuazR3Dev4CbAD6NcND/hPqPGuzAhUczBIRhqBnwZv41UF8FJHA8H6POAXY2n+OydYDyuyzI3vEOPM+rFsVJgizLFkBjVYSUwrZtiLzA36GBOOXXogMXwyH6Z78hRFYVQgLlW2loGA9XWVWyuDn9CQ/B4quyrotCLcH/CyyvUnmAj2wNdb1fLZCZnJ7+qiRYC5xMJhVwESXAM4Gn+5t4sruFP8ECYE9tNJtNdbPWFkVevfJHeXjLCLcujrDZ/4owE0tJ3zQU2ShuAUuAbAiT8VhFSygFIURtdHJ4jL3tzyDzOQgl6rt0WUjpURTdj1Bamqaqw0iNnKmt2pjjOJhYE+W2ZSvdpMt/0+lUbXjXNu7ezTjNQCKhNPJ9XwEYZfDpDCPbVGDHdbDObgHzLINLAuiOpSSQPlYyhAhYAMu5ibQ8hw8D8wLMdxFYBjRdUy3LHJkQYYyGa2BfO0PgeqqLSx2Xi7g25YJzFEmqxJadWRaJJykIj+FHFGmcgDIKzvnKlP8B+7r2ro51kbsAAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/d41f7a6ccb861f1d923be5320b068db1/c5bb3/architecture.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Matrix Servers&quot; title=&quot;&quot; srcset=&quot;/static/d41f7a6ccb861f1d923be5320b068db1/04472/architecture.png 170w,
/static/d41f7a6ccb861f1d923be5320b068db1/9f933/architecture.png 340w,
/static/d41f7a6ccb861f1d923be5320b068db1/c5bb3/architecture.png 680w,
/static/d41f7a6ccb861f1d923be5320b068db1/d26aa/architecture.png 839w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;OCaml Matrix Architecture: The OCaml CI Client is a bot that communicates with Matrix servers via the TLS protocol, such as the &lt;code&gt;ocaml-matrix&lt;/code&gt; server. The &lt;code&gt;ocaml-matrix&lt;/code&gt; server is the unikernel that ensures the communication with other Matrix servers from the federation to synchronise upon events in the Matrix rooms. For this purpose, OCaml Matrix exchanges DNS information with a unikernel that plays the role of a Primary DNS Server and connects with an Irmin storage unit to save the rooms&amp;rsquo; states.&lt;/p&gt;
&lt;p&gt;Our &lt;code&gt;ocaml-matrix&lt;/code&gt; server manages its own clients, who create public rooms for events and messaging. It also handles foreign servers; their users can ask to join these public rooms. This server interacts with other servers and manages their users requests for registration and event updates in public rooms via the server-to-server communication API. Our OCaml implementation follows the Matrix specification standard. From this, we extract the parts describing the subset of Matrix components that we choose to implement for our OCaml Matrix MVP (Minimum Viable Product). However, the MVP applies its constraints while taking into account that other servers would not be aware of them by using errors/rights restrictions provided by the Matrix standard.&lt;/p&gt;
&lt;p&gt;We also implemented an OCaml-CI client that communicates with the Matrix servers via the client-server API. This client implements a subset of the actions defined in the specification and is meant to be used as a bot only (and would therefore not need to drift apart from this subset). The OCaml-CI client was specifically designed to allow an easy implementation for our OCaml server, but it is totally compatible with other Matrix homeservers. We tested the integration of the OCaml-CI client with both Synapse and our &lt;code&gt;ocaml-matrix&lt;/code&gt; server, and we used it for testing throughout the &lt;code&gt;ocaml-matrix&lt;/code&gt; server implementation.&lt;/p&gt;
&lt;p&gt;For now, we&amp;rsquo;ve only given the OCaml Matrix access to public rooms because they don&amp;rsquo;t require the end-to-end encryption protocol. Nevertheless, we define support for encrypted communication via the &lt;em&gt;Key&lt;/em&gt; module, and we note that most of the encryption algorithms used by the end-to-end encryption protocol are available in MirageOS unikernels via the &lt;a href=&quot;https://github.com/mirage/mirage-crypto&quot;&gt;&lt;code&gt;mirage-crypto&lt;/code&gt; library&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We deployed the &lt;code&gt;ocaml-matrix&lt;/code&gt; server as an end-to-end application and converted it into the unikernel format. The process of unikernel deployment enables the&lt;code&gt;ocaml-matrix&lt;/code&gt; unikernel&amp;rsquo;s compatibility to run on various platforms in isolation, increasing the security level of the Matrix server. The unikernel format of the Matrix server is &lt;a href=&quot;https://github.com/mirage/ocaml-matrix/tree/mirage/ci-server-mirage&quot;&gt;completed for Unix&lt;/a&gt; and in the final stages for the platforms ported by Solo5. It is noteworthy to say that throughout the stage of &lt;code&gt;ocaml-matrix&lt;/code&gt; unikernel deployment, we&amp;rsquo;ve had our share of &lt;a href=&quot;https://github.com/aantron/dream&quot;&gt;dream&lt;/a&gt;-ing. Going through this experience was a game changer.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#matrix-resurrections-future-work&quot; aria-label=&quot;matrix resurrections future work permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Matrix Resurrections (Future Work)&lt;/h3&gt;
&lt;p&gt;Although we&amp;rsquo;re thrilled about the progress thus far, there is still much work to do. We plan to revive the OCaml Matrix to improve or add certain features. First, we will add user access to private rooms with end-to-end encryption and more authentication methods that follow Matrix specifications and GDPR recommendations. We will also adopt a methodology for testing and benchmarking for both the &lt;code&gt;ocaml-matrix&lt;/code&gt; client and server, integrate the &lt;code&gt;ocaml-matrix&lt;/code&gt; codebase into OCaml Multicore, create other &lt;code&gt;ocaml-matrix&lt;/code&gt; unikernel deployments, and evaluate the security model provided in the Matrix specifications. Finally, we&amp;rsquo;ll update and complete the implementation according to the latest Matrix specifications.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusions&quot; aria-label=&quot;conclusions permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusions&lt;/h3&gt;
&lt;p&gt;Having said all of the above, we invite you to decide whether the Matrix name comes from the provided federated structure in which all communication can be matrixed together or from the idea that it's creating a virtual world that is sustained by the users plugged into it. Do you want to know the truth behind the Matrix? It&amp;rsquo;s up to you. Will you choose the blue pill or the red pill?&lt;/p&gt;</content><id>https://tarides.com/blog/2022-06-09-ocaml-matrix-a-virtual-world</id><title type="text">OCaml Matrix: A Virtual World</title><updated>2022-06-09T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-06-02-tarides-sponsors-12th-annual-journ-e-francilienne" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Tarides is proud to sponsor the 12th annual programming contest &lt;em&gt;&lt;a href=&quot;https://journees-franciliennes-de-programmation.org/&quot;&gt;Journ&amp;eacute;es Franciliennes de Programmation!&lt;/a&gt;&lt;/em&gt; On the 31st of May 2022, students from three different Parisian universities met at La Sorbonne University to engage in some friendly but lively competition.&lt;/p&gt;
&lt;p&gt;Bachelor students from La Sorbonne (Paris 6), Paris Cit&amp;eacute; (Paris 7), and Paris Saclay (Paris 11) participated in a day-long programme creating solutions to a variety of problems. The aim of the competition was not that participants needed to demonstrate detailed knowledge on specific areas of programming, but rather that they applied their combined knowledge of programming usefully. At the end of the day, participants were awarded points based on the problems they&amp;rsquo;d solved during the day and the winners were announced.&lt;/p&gt;
&lt;p&gt;The event was organised by teachers and researchers of computer science, some of whom specialise in OCaml. It was a great opportunity for students to experiment with OCaml under the guidance and supervision of experienced programmers.&lt;/p&gt;
&lt;p&gt;Tarides provided computer science books for the participants, along with some fun Tarides swag!&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/f9130c96d1856810faa612631daa7d10/00172/classroom1.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 74.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAENElEQVR42i2UW0yTBwBG/yxZtjm3KQOVm0AFqrXlotYWKLRCwVKGFYptgUqh4K9UKhTKHXRdC8LKRRQn6NQ6NUO3RIfJvCxuzkm8RLPNzOkumGUPuzxotphlS2Y8i2bn6Xs6+Z6OMPnBRdqHjmB278TZNsTxk9NcnZnh5rWrhA4eQp9rRJKcSrbeRM1mD07Rg9FoJjFRRljYQhLjEzEXr6NivYnUpTKEW3dm+f6XhwSPnWc0dJpj0xfZ2hXEVtdCS/87NPvHENsC6EwOjFaRnsAIvTv6yFBnEx4RTYZaw/joCE2uepTpqxCePHnCU3yhC8x8/eOzvffMNU5fuc3BszcYO3mRqS++RewapbrZj2njVpq2B7HWeVHnlaA1WMhda0WtKUKXb0b4/Y+/eAwcnp7h7JXbz4SHz8xw7tYsl+/9xvuXbnN59gHBY58wcPQ8fUcv0D5ynI7RKdp2vktj9xCtvcN42gI0t/YhPHz0N4/+eczU+Rt8PPPNM+Glm3c5e+s+1396wEfXv+OHP//lw8/vYG7y4RoKsWfqU/ZMfcbw4WkGdx9h177jDI7uZ3B4AuHLez9z/9cHnDh3jcDEKb66O0twYoqhyZMED5xgc88Y/sG9dA+HWPuGFbN9C33BQ2wfOIC3K0DAP4avtZdyaxVbXc0IpZZmrOUeCq3NxCqtZJjcGMsaUGWWkpSajyrXRlpKNhqZmsyUdMRKO2UaLfVVtYz7duCr34RPrKGuMIfUhHiE4tJt5OodVDu9lBU7CA7sY31NB2EJGcyPXcmm6jr2BzqptVioKsrFbshDKYmk32lirLGG4caNhN7y0mIrpmS1AmFBSinxS/PIVBqQSLN5L3SC3o43iUtQUGGppKG2Gp9HpNJmRTQX0GS30VNVgsuYg89Zilmfg3xJEklxSShXqBBSNJWsSV9DfGIWijQdjgoR6TIlmlUZ+MUNHPR7OeC14atZh7+xhkCDnSqdEkdBFpUFGhwGLYWZKnLS0zFlZyAkqcuJkuqZE6siQ6FCJl3Ny5Fy5i1KQiWX4zFrcRvlBMxpTG7Jp6lUS266HLtxDc51ery2ItwlBTSU6BmotyLkV3hZINURHreCVxdKiYhZzvyoZbz0uoSwhQnERS/GoU+nx5aDboWCNGkyWanLqd9gwF1WiKfcRHd1Gf0uO4PuaoS67ZMostcTl6xmbriEiEXxWDQr0S5fytywKF6cF0nMYgmdYjnlRXnYDDr0KxU4DJr/X1nY1yWyu6OeXa0uhN7xU1ic7SyRaYhOXk2UTENKcjJamYRXwmJ5LWwRMVHR2AxZGLNX0ddQgdtSSKe9mKGGcsbbnOxurWW0pY5hj4jgnzjD2g3biIyRkaXWkaMtYrFEzpz5cYRHxCNLTEIufVqWcJ57/gWKcpSMt9ext3Mzk91b2N/tYrzDxUizyNtuJ/8BvTyX8P1q2t8AAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/f9130c96d1856810faa612631daa7d10/c5bb3/classroom1.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Programming Contest at La Sorbonne&quot; title=&quot;&quot; srcset=&quot;/static/f9130c96d1856810faa612631daa7d10/04472/classroom1.png 170w,
/static/f9130c96d1856810faa612631daa7d10/9f933/classroom1.png 340w,
/static/f9130c96d1856810faa612631daa7d10/c5bb3/classroom1.png 680w,
/static/f9130c96d1856810faa612631daa7d10/b12f7/classroom1.png 1020w,
/static/f9130c96d1856810faa612631daa7d10/00172/classroom1.png 1044w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/45b6fb8ff402f4cf6d7d0e2437c22d4c/20751/classroom2.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 74.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAELElEQVR42gXBeU/TBwCA4V+27I8lW7IjC6IoQ8UjagjhtEI5hZZyCZWKIFDK1YLUAkVKOQXKUUtBQBiXSlk5HBUHaqUoEzYE3URwivfmvsi75xGqGhso1F8kSiIhwN8HrwP7+cbNjW937cY3JIy4dCVF5dUYDAa0xWpCREF47/PksLcXF0oKWF9b5d2793x495bNjWcINW2tGNo70NfVoNVqyMpKJykpjpi4OCIl8UQnygkMi+Hg4UMc9fUhSBRMRKQYaWwE4SEBFOSko87NIC9TjuqcHMHS34epr58h+xS2mbt0D9mx9NuobTJTYbxEoa6aeHkGx8MikMikiMNDEYeLiJVGERUdQXCQP2GhwaQmSUhLliBc6buC5Wo/47fmWPz9KQ7HHI5ZJxPTc9in5ni09px7i4uo83PIyVQQFinmmJ8v0TIpaVkZZBXkkaspIr9YTbG2GGFkdJifxmzMuBZZ33iB0+nC5Vpk4f4Csw4Hf6yusbm1SVtjNdWVWqrqjWTnZpMgi0KRnUle6XnySrUolCqUynMI12/cYNBm5/aDJd7+84mN7Te8ePOR7e33bL16zfb7//hrc4MBqwlzax0GQwXq3DSKlCnI4mM4q8whR6NBLI3HLzgAYXR8jFH7FA7XA7Y/fGRla5snL9/y5/prVp9u8eLNv2y++puRPgv6i+Wk5JdzOq+M3LOJFJ5JJjVRQnCoiCBRIG67dyBcH7cxYp9kYt7Jyw+fWHnynJXHz1laXsP12zKPHq/yaHmJ/h4zxnoDhvZOUvQ9SOMkqFJlRJ3w50S4mGP79yAO8UMY+9nG2ORNxh2/srL+jAXXQ5zO+zjv3mF+dobZmQkc0zY6LW0UqzIo1ShJUOnwPnKEr77+kh17PPHYu4/d7j9wcJ8HgrnDRFNLK90Dwzjv3GX21i2mpyYYHR6gv7cLS3szKmUmAYH+FCoVWNsaSIs/ybm0VBQnjxPqd4DvPDxxd9/Jrh3fIzTW19Bg6qDFepXBoWE6Oy10tJlobqiluqyEnpYKVGeTyIk9xsD5WIaMCqJjoklOlZMY7ofIxwsPDzc+/+IzpCdFCFbrZcwWM5eamzE1NXG5tYXmWgO1leU0VRQy1FXH+MQkHQY13aWnGNf4YS0I47RoL4m+7sgjjpIv8yUv+QRL4x0I+os6mhuMNNRUUmsoo8ZYRXeXlcGBAUaujVFnukxdk4ne6gLm61O4VxZEifQwsoAfKUs4SlV6CFZNJMvTvTwbq0BQFCnR6UrRl+vQX1DT02VmcuIm1UYjam0JJmM5Ny4V80t5FIOlseizJXh67SHYx5tiuZiSU4HUqVOYv2bB1ShByMxXceZ0NLrCbNpbzdivttJlyCRNHsd5jYqRSgW3y8ToZIfIUilJTojm0P6dRPl7U5gQiDrlOA/nJrnXo2OhLpz/AS25yLxu53aSAAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/45b6fb8ff402f4cf6d7d0e2437c22d4c/c5bb3/classroom2.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Student Creating Solutions&quot; title=&quot;&quot; srcset=&quot;/static/45b6fb8ff402f4cf6d7d0e2437c22d4c/04472/classroom2.png 170w,
/static/45b6fb8ff402f4cf6d7d0e2437c22d4c/9f933/classroom2.png 340w,
/static/45b6fb8ff402f4cf6d7d0e2437c22d4c/c5bb3/classroom2.png 680w,
/static/45b6fb8ff402f4cf6d7d0e2437c22d4c/b12f7/classroom2.png 1020w,
/static/45b6fb8ff402f4cf6d7d0e2437c22d4c/20751/classroom2.png 1037w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;</content><id>https://tarides.com/blog/2022-06-02-tarides-sponsors-12th-annual-journ-e-francilienne</id><title type="text">Tarides Sponsors 12th Annual Journes Franciliennes</title><updated>2022-06-02T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-05-02-ocaml-org-reboot-user-centric-design-content" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Tarides is pleased to announce the launch of the updated community site, &lt;a href=&quot;https://ocaml.org/&quot;&gt;ocaml.org&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Over the past year and a half, we have supported and collaborated with members of the OCaml community on the creation of an updated community website. We are proud to present new features and improvements that will benefit both existing and new generations of OCaml users.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#features&quot; aria-label=&quot;features permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Features&lt;/h3&gt;
&lt;p&gt;Some of the quality-of-life improvements that users can expect from this update include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://ocaml.org/packages&quot;&gt;Package documentation&lt;/a&gt; site which contains the documentation of every version of every OCaml package&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ocaml.org/opportunities&quot;&gt;Job board&lt;/a&gt; to list job opportunities from the community&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ocaml.org/blog&quot;&gt;Syndicated blog&lt;/a&gt; that links to blog articles from the community and offers original blog posts&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ocaml.org/success-stories&quot;&gt;Success stories&lt;/a&gt; that explore how notable companies solve real-world challenges using OCaml&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ocaml.org/learn&quot;&gt;New documentation site&lt;/a&gt; which aggregates resources and tutorials to learn OCaml&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ocaml.org/play&quot;&gt;OCaml playground&lt;/a&gt; to try OCaml directly in the browser&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-road-so-far&quot; aria-label=&quot;the road so far permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Road So Far&lt;/h3&gt;
&lt;p&gt;We have worked hard to address concrete requirements from users and provide solutions for the new website. The 2020 OCaml Community Survey highlighted several areas to improve, resulting in new features and content being added.&lt;/p&gt;
&lt;p&gt;The survey concluded that the original site lacked easily accessible package documentation, and that job applicants and employers had a difficult time connecting. To address this, we decided early on to include both a &lt;a href=&quot;https://ocaml.org/opportunities&quot;&gt;job board&lt;/a&gt; and a fully-incorporated package documentation page. The job board now provides a place where job seekers can discover opportunities in OCaml, and employers can look for applicants. The &lt;a href=&quot;https://ocaml.org/packages&quot;&gt;package documentation&lt;/a&gt; page allows users to find, explore, and compare documentation all conveniently located in one place. Additionally, the team wanted to improve site navigation. This included ensuring easy pathfinding between related topics, together with a focus on improving overall accessibility, allowing successful navigation within the site.&lt;/p&gt;
&lt;p&gt;Taking the perspective of different users of the site inspired the creation of brand-new content like &lt;a href=&quot;https://ocaml.org/success-stories&quot;&gt;Success Stories&lt;/a&gt; that highlight ways professionals, academics, and others use OCaml to solve hard problems, create impact, and foster collaboration.  It also inspired the new area for &lt;a href=&quot;https://ocaml.org/learn/&quot;&gt;tutorials and guides&lt;/a&gt;, as well as the &lt;a href=&quot;https://ocaml.org/play&quot;&gt;OCaml playground&lt;/a&gt;, both aimed at making learning OCaml easier and more engaging.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#looking-ahead&quot; aria-label=&quot;looking ahead permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Looking Ahead&lt;/h3&gt;
&lt;p&gt;There is still plenty of room for improvement and new ideas, and now is a great time for the community to be more involved. We&amp;rsquo;d like everyone in the community to participate in improving the site and we have created a &lt;a href=&quot;https://github.com/ocaml/ocaml.org/blob/main/CONTRIBUTING.md&quot;&gt;contribution guide&lt;/a&gt; to make the process easier. Please reach out on the &lt;a href=&quot;https://github.com/ocaml/ocaml.org/issues&quot;&gt;issue tracker&lt;/a&gt; with ideas and suggestions. We are especially looking for people to help maintain and run the website, and improve the content and general user-experience to help grow our community even more!&lt;/p&gt;
&lt;p&gt;To learn more about the reboot and how to get involved please read the &lt;a href=&quot;https://discuss.ocaml.org/t/v3-ocaml-org-we-are-live/9747&quot;&gt;original Discuss post&lt;/a&gt;.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-05-02-ocaml-org-reboot-user-centric-design-content</id><title type="text">OCaml.org Reboot: User-Centric Design &amp; Content</title><updated>2022-05-02T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-04-26-lightning-fast-with-irmin-tezos-storage-is-6x-faster-with-1000-tps-surpassed" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Over the last year, the Tarides
storage team has been focused on scaling the storage layer of &lt;a href=&quot;https://tezos.gitlab.io/&quot;&gt;Octez&lt;/a&gt;,
the most popular node implementation for the &lt;a href=&quot;https://tezos.com/&quot;&gt;Tezos&lt;/a&gt; blockchain. With
the upcoming release of Octez v13, we are reaching our performance goal of
&lt;strong&gt;supporting one thousand transactions per second&lt;/strong&gt; (TPS) in the
storage layer! This is a &lt;strong&gt;6x improvement&lt;/strong&gt; over Octez 10. Even better, this
release also &lt;strong&gt;makes the storage layer orders of magnitude more stable&lt;/strong&gt;,
with a &lt;strong&gt;12x improvement in the mean latency of operations&lt;/strong&gt;. At the
same time, we &lt;strong&gt;reduced the memory usage by 80%&lt;/strong&gt;.
Now Octez requires a mere 400 MB of RAM to bootstrap nodes!&lt;/p&gt;
&lt;p&gt;In this post, we'll explain how we achieved these milestones thanks to
&lt;a href=&quot;https://irmin.org&quot;&gt;Irmin 3&lt;/a&gt;, the new major release of the &lt;a href=&quot;https://mirage.io&quot;&gt;MirageOS&lt;/a&gt;-compatible
storage layer developed and maintained by Tarides and used by Tezos.
We'll also explain what this means for the Tezos community now and
in the future.&lt;/p&gt;
&lt;p&gt;As explained by a &lt;a href=&quot;https://research-development.nomadic-labs.com/tps-evaluation.html&quot;&gt;recent post on Nomadic Labs
blog&lt;/a&gt;,
there are various ways to evaluate the throughput of Tezos. Our
purpose is to optimise the Tezos storage and identify and fix
bottlenecks. Thus, our benchmarking setup replays actual data (the
150k first blocks of the Hangzhou Protocol on Tezos Mainnet,
corresponding to the period Dec 2021 &amp;ndash; Jan 2022) and explicitly
excludes the networking I/O operations and protocol computations to
focus on the context I/O operations only. Thanks to this setup we
managed to identify, fix, and verify that we removed the main
I/O bottlenecks present in Octez:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/f859bd5c186c91df46c59f296d8f40b6/58a91/transactions_per_second.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 68.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAC4jAAAuIwF4pT92AAACOElEQVR42rWSX0hTcRTHj7lnTROikAKJcGEuFfpnKr3FNP+8RRTSiyRp9WBlIAkF0UNEhBkEvRhBSC8pBFmjKCgwl3NDdGkoy7vNXb129Tf7bff+7jd2r1uyRVTUgS/n/M45v8/v8OMQERGALAAb+vv7s7u7X9ks3236RD6pxDld6+pZlGk1NqLtG4mKcol25BDl5xDl5RJtKSAqzCfaWWDVEkrUtm4ioux0im3gxdttnPM6xplTVVmdyiwxzmvdo5Mn3rwfPTXsHj/5bmSsWVHVoxyoZUCdAtQzrjk55/XLy9yeIsqy0gDLBDLNSBOMqAp59jO+ySFA6Ppa380UUJLkxkRG13UhhMAvZQBK7xlIZysQ7jwMPjdlAoUW+3vg4p0WhNocCHdUgn/xZwJlWan/I2DPaYTayxC+WA0+9ykTGAiEm/4pUFZUc8IETTcvGdCFAcMwIIQV68kc1gOrEJN+8ofhsNyQnNCE6BpgwsQaVIPQ41b8OxNK0kJTcm2Gxpdw3xXAk5EFaLqBqQjHjWcSrg0E4JpYNpuW7rYicq4ccmc14sFpa22E9gMYiSw6NS0u4vH4ypFbPlbY8YHZu9xs/utqdMi3EC29Mrqyq+sju/p0lgGIzt9uiQbbylaCF6rYasBvvqLFYtdTwN7eR3kej6fE7/fba7sGHUXH71VWnH9c7vVOFvcNDpccaO07uLf94f5LD1wOaWam+OXlY6U9jfsOPW+u2eN7PWQfm5jY7fV6N9P/sO8HOc+Go2/nugAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/f859bd5c186c91df46c59f296d8f40b6/c5bb3/transactions_per_second.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Bar chart of mean transactions per second for various Irmin
configurations&quot; title=&quot;&quot; srcset=&quot;/static/f859bd5c186c91df46c59f296d8f40b6/04472/transactions_per_second.png 170w,
/static/f859bd5c186c91df46c59f296d8f40b6/9f933/transactions_per_second.png 340w,
/static/f859bd5c186c91df46c59f296d8f40b6/c5bb3/transactions_per_second.png 680w,
/static/f859bd5c186c91df46c59f296d8f40b6/b12f7/transactions_per_second.png 1020w,
/static/f859bd5c186c91df46c59f296d8f40b6/b5a09/transactions_per_second.png 1360w,
/static/f859bd5c186c91df46c59f296d8f40b6/58a91/transactions_per_second.png 1990w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Comparison of the Transactions Per Second (TPS) performance between Octez 10,
11, 12 and 13 while replaying the 150k
first blocks of the Hangzhou Protocol on Tezos Mainnet&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;.
Octez 13 reaches 1043 TPS on average which is a &lt;strong&gt;6x improvement&lt;/strong&gt; over Octez 10.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#merkle-databases-to-index-or-not-to-index&quot; aria-label=&quot;merkle databases to index or not to index permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Merkle databases: to index or not to index&lt;/h3&gt;
&lt;p&gt;A Tezos node keeps track of the blockchain state in a database called the
&lt;em&gt;context&lt;/em&gt;. For each block observed by the node, the context stores a
corresponding &lt;a href=&quot;https://en.wikipedia.org/wiki/Merkle_tree&quot;&gt;tree&lt;/a&gt; that witnesses the state of the chain at that
block.&lt;/p&gt;
&lt;p&gt;Each leaf in the tree contains some data (e.g., the balance of a particular
wallet) which has a unique hash. Together these leaf hashes uniquely determine
the hashes of their parent nodes all the way up to the root hash of the tree.
In the other direction &amp;ndash; moving down the tree from the root &amp;ndash; these hashes form
&lt;em&gt;addresses&lt;/em&gt; that allow each node to later be recovered from disk. In the Octez
node, the context is implemented using &lt;a href=&quot;https://irmin.org&quot;&gt;Irmin&lt;/a&gt;, an open-source OCaml
library that solves exactly this problem: storing trees of data in which each
node is addressed by its hash.&lt;/p&gt;
&lt;p&gt;As with any database, a crucial aspect of Irmin's implementation is its
&lt;a href=&quot;https://en.wikipedia.org/wiki/Database_index&quot;&gt;index&lt;/a&gt;, the component that maps addresses to data locations
(in this case, mapping hashes to offsets within a large append-only data file).
Indexing each object in the store by hash has some important advantages: for
instance, it ensures that the database is totally
&lt;a href=&quot;https://en.wikipedia.org/wiki/Data_deduplication&quot;&gt;deduplicated&lt;/a&gt; and enables fast random access to any
object in the store, regardless of position in the tree.&lt;/p&gt;
&lt;p&gt;As discussed in &lt;a href=&quot;https://tarides.com/2020-09-01-introducing-irmin-pack&quot;&gt;our &lt;code&gt;irmin-pack&lt;/code&gt; post&lt;/a&gt;, the context index was
optimised for very fast reads at the cost of needing to perform an expensive
maintenance operation at regular intervals. This design was very effective in
the early months of the Tezos chain, but our &lt;a href=&quot;https://tarides.com/2021-10-04-the-new-replaying-benchmark-in-irmin&quot;&gt;recent work on benchmarking the
storage layer&lt;/a&gt; revealed two problems with it:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;content-addressing bottlenecks transaction throughput&lt;/strong&gt;. Using hashes as
object addresses adds overhead to both reads and writes: each read requires
consulting the index, and each write requires adding a new entry to it. At
the current block rate and block size in Tezos Mainnet, these overheads are
not a limiting factor, but this will change as the protocol and shell become
faster. Our overall goal is to support a future network throughput of &lt;strong&gt;1000
transactions per second&lt;/strong&gt;, and doing this required rethinking our reliance on
the index.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;maintaining a large index impacts the stability of the node&lt;/strong&gt;. The larger
the index becomes, the longer it takes to perform regular maintenance
operations on it. For sufficiently large contexts (i.e., on archive nodes),
the store may be unable to perform this maintenance quickly enough, leading
to long pauses as the node waits for service from the storage layer.
In the context of Tezos, this can lead to users occasionally exceeding the
maximum time allowed for baking or endorsing a block, losing out on the
associated rewards.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Over the last few months, the storage team at Tarides has been hard at work
addressing these issues by switching to a &lt;em&gt;minimal indexing&lt;/em&gt; strategy in the
context. This feature is now ready to ship, and we are delighted to present the
results!&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#consistently-fast-transactions-surpassing-the-1000-tps-threshold&quot; aria-label=&quot;consistently fast transactions surpassing the 1000 tps threshold permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Consistently fast transactions: surpassing the 1000 TPS threshold&lt;/h3&gt;
&lt;p&gt;The latest release of Irmin ships with a &lt;a href=&quot;https://github.com/mirage/irmin/pull/1510&quot;&gt;new core feature&lt;/a&gt;
that enables object addresses that are not hashes. This feature unlocks many
future optimisations for the Octez context, including things like automatic
inlining and layered storage. Crucially, it has allowed us to &lt;a href=&quot;https://github.com/mirage/irmin/pull/1659&quot;&gt;switch to using
direct pointers&lt;/a&gt; between internal objects in the Octez
context, eliminating the need to index such objects entirely! This has two
immediate benefits:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;read operations no longer need to search the index&lt;/strong&gt;, improving the overall
speed of the storage considerably;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;the index can be shrunk by a factor of 360&lt;/strong&gt; (from 21G to 59MB in our tests!). We now only need to index
&lt;em&gt;commit&lt;/em&gt; objects in order to be able to recover the root tree for a given
block at runtime. This &amp;quot;minimal&amp;quot; indexing strategy results in indices that
fit comfortably in memory and don't need costly maintenance. As of Octez 13,
&lt;a href=&quot;https://gitlab.com/tezos/tezos/-/merge_requests/4714&quot;&gt;minimal indexing is now the default&lt;/a&gt; node
behaviour&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-2&quot; class=&quot;footnote-ref&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So what is the performance impact of this change? As detailed in our &lt;a href=&quot;https://tarides.com/2021-10-04-the-new-replaying-benchmark-in-irmin&quot;&gt;recent
post on replay benchmarking&lt;/a&gt;, we were able to isolate and
measure the consequences of this change by &amp;quot;replaying&amp;quot; a previously-recorded
trace of chain activity against the newly-improved storage layer. This process
simulates a node that is bottlenecked purely by the storage layer, allowing us
to assess its limits independently of the other components of the shell.&lt;/p&gt;
&lt;p&gt;For these benchmarks, we used a replay trace containing the first 150,000
blocks of the Hangzhou Protocol deployment on Tezos Mainnet (corresponding to
the period December 2021 &amp;ndash; January 2022)&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-3&quot; class=&quot;footnote-ref&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;One of the most important metrics collected by our benchmarks is overall
throughput, measured in &lt;em&gt;transactions&lt;/em&gt; processed per second (TPS). In this
context, a &amp;quot;transaction&amp;quot; is an individual state transition within a particular
block (e.g., a balance transfer or a smart contract activation). We
queried the &lt;a href=&quot;https://tzstats.com/docs/api#tezos-api&quot;&gt;TzStats API&lt;/a&gt; in order to determine the number
of transactions in each block and thus, our measured transaction throughput.
As shown in the graph above, doing this for the last few releases of Octez
reveals that storage TPS has skyrocketted from ~200 in Octez 12 to more than
1000 in Octez 13! &amp;#128640;&lt;/p&gt;
&lt;p&gt;As a direct consequence, the total time necessary to replay our Hangzhou trace
on the storage layer has decreased from ~1 day to ~4 hours. We're nearly 6
times faster than before!&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/7d4ca3167883d6cdcafbc1b29a6fecc0/11214/cpu_time.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 70%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAC4jAAAuIwF4pT92AAACoUlEQVR42rXRX0hTURwH8EMqBGFmNssVwcw0XQQVCbl8VB8c9mQQlE4io+gh6MFmD0sfssDqpQizSS8SDA3/QOayQoxS5p1/pnO62bRyi8jltrvtunPv/cau25zlgy994cf93XPO/XAuP0KiAbCttrYlRafTJet0H5INBiRF1v6uyL7BYEiKVKyP7ZF/c2wHIelphBzYTUh2GiFpuwjZJyNEnkFI7p61PmcnIQfT197zUgnJSCWEbMQApAAoBVBOgXIA6khRyqm/LLrPjYzNaBiL/eJnZqbG4wuc5ShVewNcReTJcpyaUloBQBUHBwY+7QewgrWIwWAI4XAYCRETakNEUeSjrSkOulw+Gc8LEvhy+KdYo5/F5Rd2mJx+6WSY8vB5fdgsm4JGIyPnwlQCtZ0LYuYNE7JujqJ3fBmCIKCx5xu0HU48ef8DoiBIa7HieV4CBUFYBycn5/euRsGG7kXx0C0GefVmGKc88IcoiposON4wgcqnNkDcAjg4aM2KgXe6F0VFHYPDWjP6pzwIcBRlD6dRfM8CTZt9a6DxIyMPcateCexaB99YPGBDYZQ8mIaqyYIqvR2iwIPnKYRoUUolkOf5xKG4ZDQ6lIaer3HQOP0bwbAQB6v19vgwqCBCkOa+yVAcDndmmPLSDRt7v4vZ2nHk3p7AW6tXAksf2XDmvhWatnnpS97twMpIH9jRfvDLriiY8Mtzcy5ZkFt1AwKn63KyijoTm6M1sX2TvwK+ABcoabb4VXcn/FUtVlYAAp6O5sDSVSW7dOUI6xvq8EUuSjluKA5WV+u2MwyTv7AwV3Dt8Tul/EJLkULTdkr/erjAbJ4qOHm9vVB5qVVVVt95YtbpzB971qh8Xll0uv18caHlVWu+1eE4arPZFOR/5A/EW7alDaEAbAAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/7d4ca3167883d6cdcafbc1b29a6fecc0/c5bb3/cpu_time.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Bar chart of CPU time elapsed during replay for various Irmin configurations&quot; title=&quot;&quot; srcset=&quot;/static/7d4ca3167883d6cdcafbc1b29a6fecc0/04472/cpu_time.png 170w,
/static/7d4ca3167883d6cdcafbc1b29a6fecc0/9f933/cpu_time.png 340w,
/static/7d4ca3167883d6cdcafbc1b29a6fecc0/c5bb3/cpu_time.png 680w,
/static/7d4ca3167883d6cdcafbc1b29a6fecc0/b12f7/cpu_time.png 1020w,
/static/7d4ca3167883d6cdcafbc1b29a6fecc0/b5a09/cpu_time.png 1360w,
/static/7d4ca3167883d6cdcafbc1b29a6fecc0/11214/cpu_time.png 1943w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Comparison of CPU time elapsed between Octez 10, 11, 12, and 13 while replaying the 150k
first blocks of the Hangzhou Protocol on Tezos Mainnet&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;. While Octez 10 took 1 day to complete
the replay, Octez 13 only takes 4 hours and is nearly &lt;strong&gt;6 times faster&lt;/strong&gt; than
before!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Overall throughput is not the only important metric, however. It's also
important that the &lt;em&gt;variance&lt;/em&gt; of storage performance is kept to a minimum, to
ensure that unrelated tasks such as endorsement can be completed promptly. To
see the impact of this, we can inspect how the total block time varies
throughout the replay:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/ece9651cd311f011c589c2d69159a3fb/41b28/block_time.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 68.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAC4jAAAuIwF4pT92AAACfklEQVR42rWST0gUURzHn1kR9MfMJIPIS2BQqNm9Lt1cDwXeOgTBHjpEh6A87SmIkCg6eejSKRZqwWRDWDFTMUyyzTWyUnNHd92Z3XHGebMz+/7MN2Z2zU2Xbn3hy/vN7/fe5/3ejyGkrDoAe6LRaH04HN4XiUT2+va/ffu1ioN9kchoUNvas1UnNVRPyKljhLQdJqT1KCFnjpRXP3e2iZDmFkJON5bjxoZyrfXATkjdld57DZmMeklV1dAvRenOZtWQrus9lNLu9Nr61bGp5I3p2fnribGPN5eVzDU/r+tmj2maIT+mlIYYY5cB1AfE/v6B4xuUpYoMyOYK0ty04XkeKvJ2+C/ljKKshD8AHAqA95+9bnJtmvKEwLqmS9OiEEJASrnLft7nFl2GdZ1iakGV6YKDUolvA8N3Hp9kjKX8axhjknMeHKxlH7ZpO0gu5/FuPoevq5tyZtmCbrnbwNt9T05wzgMg51zWhnGUGEc6Z2B2qYDPKyZ+rtugbkkyD2C8qsO+B8+bORcBUAghaz3Vl2oUMblQwKruQkgZzFlKISvnqoFP/wCrO/S8Mki3HHxazGPqex6Ww4N8MM/yTHcD/ScLUX4yJJeQAlJwGNSBolmY+KYhlTaxQUvwJEcw44o5Y7LSyDbw1t1HLYbN5y0OKAVHrhQYljQHXxQLc4oFh0n8Q7t/m4cD0YbFJWUmu5aR2bWsZWg528yr1DXytrQKtmvkqa2rdnEjT6tt65pt65pV1DXuFu0kgIMBsLc3sj85MdI292GkY2J0uHN6cvL828HBrvHxkXOx2FDn8NBQZywau/g+EW+vXhOJePurV4Nd8Xj8wouXbzrI/9Bv8eQCA8jzo1EAAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/ece9651cd311f011c589c2d69159a3fb/c5bb3/block_time.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Line graph of block time during replay for various Irmin configurations&quot; title=&quot;&quot; srcset=&quot;/static/ece9651cd311f011c589c2d69159a3fb/04472/block_time.png 170w,
/static/ece9651cd311f011c589c2d69159a3fb/9f933/block_time.png 340w,
/static/ece9651cd311f011c589c2d69159a3fb/c5bb3/block_time.png 680w,
/static/ece9651cd311f011c589c2d69159a3fb/b12f7/block_time.png 1020w,
/static/ece9651cd311f011c589c2d69159a3fb/b5a09/block_time.png 1360w,
/static/ece9651cd311f011c589c2d69159a3fb/41b28/block_time.png 1967w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Comparison of block time latencies between Octez 10, 11, 12, and 13 while replaying the 150k
first blocks of the Hangzhou Protocol on Tezos Mainnet&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;. Octez 13's mean block validation time is
23.2 &amp;plusmn; 2.0 milliseconds while Octez v10 was down from 274 &amp;plusmn; 183 milliseconds
(and a worst-case peak of 800 milliseconds!). This &lt;strong&gt;12x improvement in
opearation's mean latency&lt;/strong&gt; leads to much more consistent endorsement rights for bakers.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Another performance metric that has a big impact on node maintainers is the
&lt;em&gt;maximum memory usage&lt;/em&gt; of the node, since this sets a lower bound on the
hardware that can run Octez. Tezos prides itself on being deployable to very
resource-constrained hardware (such as the Raspberry Pi), so this continues
to be a focus for us. Thanks to the reduced index size, Octez 13 greatly
reduces the memory requirements of the storage layer:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/1d03d5bf0827a0964a9fabb3b753e7ec/8b4e6/memory_usage.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 69.41176470588235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAC4jAAAuIwF4pT92AAACgUlEQVR42rWST0hUQRzHp7JTRaWZSZG1mbraqUO2JEGHCFKjoEukEQp2zYL802EhiJRuQoZpCkVEC4YamoQgFGKt7rru2qarUb1thbJczff0vTdv5hvz3q6t6MFLX/gyw8z8PvOdP4TEBGCDs78/yeVybRJ2OvuThAFsFHNiTPTj83FXVDRtjq8hq5W9jZB9yYTYthOSsYOQ1K2E7N9JSOoeQnJSCEnfZY2nxNbFTVbCAIhdTlFKixVFKQZQJPqU0sLw9I+LA+6PZb7AZOmA218Wjf45TykKFVUtFqYUZwGImoJlYDD4PYVxJsES11QNmqYjQTzBK8Q5N2LtiDi6CezsG0zTdGoCXe6fvLw1hLLWEAZCc2YRNQwwxta0YRgmkDH2DyhJc8mabpjAO10ST78xjN2VQ3jhnokBmUiwphljq4EioapZCet7wjyr1ovMGg/aPRZQ0ykY5yLNehNKywnresI8s8YLW7UH7cO/TKDBOJhBxUWtP+GSqodNYHcMWOXBy1jCt+NRdLoj+PB53jw+E0lNUxiUrn2HOmXfEhMerPKga+Q3VJ2hqGEcjntjuNw8iSXdrIdqcNPxV14B7OsbTNOp9W3qX0f44dujsNX48Go0Cs3guNA4iYL6IK62TUETxdIYZnvbMNvbChoet75NInBMkpIXNX1CPGhdt7RwqHpIPnBrSO7wziiKqivnGoKy4+6ofKXpk7wIKPPdjUrkWo4cqciW5960LTBRqKmDTqfTAp4uubnF5/NlTX8N5V5/9C4vo7TFsbfkcf7Djve5gUDAfrzy2bG88uYTZ2rbjwYmvti9T+/ntlw66XhSUpAfeP7AHgxOHfH7/TbyP/QXU7PamJYN6osAAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/1d03d5bf0827a0964a9fabb3b753e7ec/c5bb3/memory_usage.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Bar chart of maximal memory usage during replay for various Irmin configurations&quot; title=&quot;&quot; srcset=&quot;/static/1d03d5bf0827a0964a9fabb3b753e7ec/04472/memory_usage.png 170w,
/static/1d03d5bf0827a0964a9fabb3b753e7ec/9f933/memory_usage.png 340w,
/static/1d03d5bf0827a0964a9fabb3b753e7ec/c5bb3/memory_usage.png 680w,
/static/1d03d5bf0827a0964a9fabb3b753e7ec/b12f7/memory_usage.png 1020w,
/static/1d03d5bf0827a0964a9fabb3b753e7ec/b5a09/memory_usage.png 1360w,
/static/1d03d5bf0827a0964a9fabb3b753e7ec/8b4e6/memory_usage.png 1953w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Comparison of maximal memory usage (as reported by &lt;code&gt;getrusage(2)&lt;/code&gt;) between
Octez 10, 11, 12, and 13 while replaying the 150k first blocks of the Hangzhou
Protocol on Tezos Mainnet&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;. &lt;strong&gt;The peak memory usage is x5 less&lt;/strong&gt;
in the Octez 13 storage layer compared to  Octez 10**, owing to the
significantly reduced size of the index. 400 MB of RAM is now enough
to bootstrap Octez 13!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Finally, without an index the context store can no longer guarantee to have perfect object deduplication. Our tests and benchmarks show that this choice has relatively little impact on the context size as a whole, particularly since it no longer needs to store an index entry for every object!&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/523e2c8043f4c5d2849fe0df928c6bb2/5551c/storage_size.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.47058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACV0lEQVR42rXSX0hTURwH8PNQLhUMLSxlTtGVwywYc3OSoWV/JKmHxF6CopferUCwP+DIh9Sieiikh15CX5SghyZFjZFDs9q8mxcsqUzJ650Su5une+/v3nt+4d0o17P94AfnwI8P39/hEJJVdgshlcWkwFpEttsKCbEVkjz3bpJrt6a7upTk1+4iBTVFJM9RQvIriwlx7Mg2SEdOMpmsAYB6SqlbWJXqExQ8QoJ6AMAdic01P3v5/uTbKf7oqD/U9unL90MA1C1JUj0A9QClbgCoAwCvLMtVhNhbLbpuhDBdhmHoCIqCG4oZuo6qIrP1c6bRYIgaywwwpmdmhwkpb9qmatr4+k2UFP1R4Ae7659nj4MCS8kaW02p7Mm4gINvFnFoUsSUojOUUyw1F2ErsXdMmeeZDqqWAYdMUFZUMyG3kDT2dIexoiuMjmthjEsKzi5R9PbG0NMbw8O3o7j8C1H/FkGh04tipwfF7haExIqZ0NC04SxwZjFluHwc7r8ZQc+tKK4kVfy8TPHYHR6P9PN46j6PcRPkULjaiMJlL4rXT/wD2lstsvoXdPZwuO9GBOt8HMbXQYFiywCPzX0z2HaPR9EEp1G4cjADHv/fYE1HzuaCVm/uxjfclJUVNf1tNgd0XdpKZcVMGF2QDGfP9B9QTMg4u7SWBS6vIWpfI1mg8lM0QQAYJoQ0bfH7/SUfQ6Hy0cCkteLcw+rS0z6n/fxg1VgwWPZ05HW542x/7d72vgOuCw8cz199sHEvRq0DZxocXa0NzpGLjZVTwbGywMRERSAQ2PkbI/banxhhFNQAAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/523e2c8043f4c5d2849fe0df928c6bb2/c5bb3/storage_size.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Line graph of storage size during replay for various Irmin configurations&quot; title=&quot;&quot; srcset=&quot;/static/523e2c8043f4c5d2849fe0df928c6bb2/04472/storage_size.png 170w,
/static/523e2c8043f4c5d2849fe0df928c6bb2/9f933/storage_size.png 340w,
/static/523e2c8043f4c5d2849fe0df928c6bb2/c5bb3/storage_size.png 680w,
/static/523e2c8043f4c5d2849fe0df928c6bb2/b12f7/storage_size.png 1020w,
/static/523e2c8043f4c5d2849fe0df928c6bb2/b5a09/storage_size.png 1360w,
/static/523e2c8043f4c5d2849fe0df928c6bb2/5551c/storage_size.png 1763w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Comparison of storage size between Octez 10, 11, 12, and 13 while replaying the 150k
first blocks of the Hangzhou Protocol on Tezos Mainnet&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;. Octez 13's uses similar disk resources
than previous versions: the duplicated data is fully compensated by the
reduced indexed size.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;What this means for users of the Octez shell:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;The general I/O performance of the storage layer is vastly improved&lt;/strong&gt;, as
the storage operations are 6 times faster and a have 12 times lower mean
latency while the memory usage is divided by 5.&lt;/li&gt;
&lt;li&gt;In particular, this mode &lt;strong&gt;eliminates the risk of losing baking rewards&lt;/strong&gt;
due to long index merges.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#migrating-your-octez-node-to-use-the-newer-storage&quot; aria-label=&quot;migrating your octez node to use the newer storage permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Migrating your Octez node to use the newer storage&lt;/h3&gt;
&lt;p&gt;Irmin 3 is included with &lt;a href=&quot;http://tezos.gitlab.io/releases/version-13.html&quot;&gt;Octez v13-rc1&lt;/a&gt;, which has just been released today.
The storage format is &lt;strong&gt;fully
backwards-compatible&lt;/strong&gt; with Octez 12, and no migration process is required to
upgrade.&lt;/p&gt;
&lt;p&gt;Newly-written data after the shell upgrade will automatically benefit from the
new, direct internal pointers, and existing data will continue being read as
before. Performing a bootstrap (or importing a snapshot) with Octez 13 will
build a context containing only direct pointers. Node operators should upgrade
as soon as possible to benefit.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-future-of-the-octez-storage-layer&quot; aria-label=&quot;the future of the octez storage layer permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The future of the Octez storage layer&lt;/h3&gt;
&lt;p&gt;Irmin 3 is just the beginning of what the Tarides storage team has in store for
2022. Our next focus is on implementing the next iteration of the &lt;em&gt;layered
store&lt;/em&gt;, a garbage collection strategy for rolling nodes. Once this has landed,
we will collaborate with the Tarides Multicore Applications team to help
migrate Octez to using the newly-merged Multicore OCaml.&lt;/p&gt;
&lt;p&gt;If this work sounds interesting, the Irmin team at Tarides is &lt;a href=&quot;https://tarides.com/jobs/senior-software-engineer-irmin&quot;&gt;currently
hiring&lt;/a&gt;!&lt;/p&gt;
&lt;p&gt;Thanks for reading, and &lt;a href=&quot;https://twitter.com/tarides_&quot;&gt;stay tuned&lt;/a&gt; for future updates from
the Irmin team!&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr/&gt;
&lt;ol&gt;
&lt;li&gt;Our benchmarks compare Octez 10.2, 11.1, 12.0, and 13.0-rc1 by replaying the 150k first blocks of the Hangzhou Protocol on Tezos Mainnet (corresponding to the period Dec 2021 &amp;ndash; Jan 2022) on &lt;a href=&quot;https://metal.equinix.com/product/servers/c3-small/&quot;&gt;an Intel Xeon E-2278G processor&lt;/a&gt; constrained to use at most 8 GB RAM. Our benchmarking setup explicitly excludes the networking I/O operations and protocol computations to focus on the context I/O operations only. Octez 10.2 uses Irmin 2.7.2, while both Octez 11.1 and 12.0 use Irmin 2.9.1 (which explains why the graphs are similar). Octez v13-rc1 uses Irmin 3.2.1, which we just released this month (Apr 2022).&lt;a href=&quot;https://tarides.com/feed.xml#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;The trade-off here is that without an index the context store can no longer guarantee to have perfect deduplication, but our testing and benchmarks indicate that this has relatively little impact on the size of the context as a whole (particularly after accounting for no longer needing to store an index entry for every object!).&lt;a href=&quot;https://tarides.com/feed.xml#fnref-2&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;To reproduce these benchmarks, you can download the replay trace we used &lt;a href=&quot;http://data.tarides.com/lib_context/hangzou-level2.tgz&quot;&gt;here&lt;/a&gt; (14G). This trace can be replayed against a fork of &lt;code&gt;lib_context&lt;/code&gt; available &lt;a href=&quot;https://github.com/ngoguey42/tezos/tree/new-action-trace-recording&quot;&gt;here&lt;/a&gt;.&lt;a href=&quot;https://tarides.com/feed.xml#fnref-3&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><id>https://tarides.com/blog/2022-04-26-lightning-fast-with-irmin-tezos-storage-is-6x-faster-with-1000-tps-surpassed</id><title type="text">Lightning Fast with Irmin: Tezos Storage is 6x faster with 1000 TPS surpassed</title><updated>2022-04-26T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-04-19-tarides-partners-with-50intech" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#50intech&quot; aria-label=&quot;50intech permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;50inTech&lt;/h3&gt;
&lt;p&gt;Tarides is proud to have been recognised by 50inTech and &lt;a href=&quot;https://app.50intech.com/company/tarides&quot;&gt;featured on their website&lt;/a&gt;! 50inTech&amp;rsquo;s mission is to achieve a 50% representation of women in tech by 2050.&lt;/p&gt;
&lt;p&gt;To this end, 50inTech runs several amazing initiatives that generate opportunities for women looking to have successful careers in tech. Their job board matches talented women with inclusive companies that are hiring, the 50inTech Gender Score helps European companies measure their level of gender-inclusion, and their free virtual bootcamps provide their network of 15,000 women in Europe with crucial networking and mentoring opportunities.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#partnership&quot; aria-label=&quot;partnership permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Partnership&lt;/h3&gt;
&lt;p&gt;Tarides has been selected as an &amp;ldquo;inclusive company,&amp;rdquo; based on metrics including work-life balance, equal pay, fair career path, and diversity and inclusion policies.  We are incredibly proud to be recognised in this way, and we will continue to invest in programs and initiatives to further increase diversity and inclusion.&lt;/p&gt;
&lt;p&gt;Our partnership with 50inTech connects us with a highly-skilled, diverse set of people, and we hope that this collaboration will help us achieve our target of filling 50% of Tarides&amp;rsquo;s tech roles with women. Currently that number is 20%, and we&amp;rsquo;d like to increase it!&lt;/p&gt;
&lt;p&gt;Read more about our diversity and inclusion goals, and &lt;a href=&quot;https://app.50intech.com/company/tarides?page=jobs&quot;&gt;see our open positions on 50inTech&amp;rsquo;s website&lt;/a&gt;.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#previous-efforts&quot; aria-label=&quot;previous efforts permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Previous Efforts&lt;/h3&gt;
&lt;p&gt;As Tarides has grown, we have made continuous efforts towards making OCaml and our place within its community more inclusive and diverse. As our CEO Gemma Gordon says, &amp;ldquo;Different opinions, experiences, backgrounds, and strategies are essential for innovation and vital to the success of Tarides.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;In this vein, we have supported initiatives such as: &lt;em&gt;&lt;a href=&quot;https://www.outreachy.org/&quot;&gt;Outreachy&lt;/a&gt;&lt;/em&gt;, where we sponsor three paid remote internships per quarter for people experiencing systemic bias and underrepresentation in the tech industry; &lt;em&gt;&lt;a href=&quot;https://adatechschool.fr/&quot;&gt;Ada Tech School&lt;/a&gt;&lt;/em&gt;, which is a programming school that facilitates greater access to programming positions and promotes the feminisation of tech; and &lt;em&gt;&lt;a href=&quot;https://shecancode.io/&quot;&gt;SheCanCode&lt;/a&gt;&lt;/em&gt;, whose mission is to close the tech gender gap. All of these enterprises help women enter, remain, and excel in the tech industry.&lt;/p&gt;
&lt;p&gt;Tarides remains committed to inclusivity and continuously looks for ways to reach out to new groups, gain new perspectives, and diversify our workforce. Read more about our mission to support women in tech on &lt;a href=&quot;https://app.50intech.com/company/tarides?page=diversity&quot;&gt;50inTech&amp;rsquo;s website&lt;/a&gt;.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-04-19-tarides-partners-with-50intech</id><title type="text">Tarides Partners with 50inTech!</title><updated>2022-04-19T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-04-14-what-s-new-in-mirageos-4" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#mirageos-40-release-week&quot; aria-label=&quot;mirageos 40 release week permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;MirageOS 4.0 Release Week&lt;/h2&gt;
&lt;p&gt;Tarides is thrilled to see the great responses to &lt;a href=&quot;https://mirage.io/blog/announcing-mirage-40&quot;&gt;MirageOS
4.0&lt;/a&gt; and the excitement
that&amp;rsquo;s building across the community. We&amp;rsquo;re proud to have played an
important part in its development and release, bringing great tools
and opportunities to OCaml developers. If you haven&amp;rsquo;t kept up with
what&amp;rsquo;s been going on since the release, here is a summary of several
articles posted by various OCaml users.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#cross-compilation&quot; aria-label=&quot;cross compilation permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Cross-Compilation&lt;/h3&gt;
&lt;p&gt;The MirageOS 4.0 update brings with it a major change in its build
system to support &lt;a href=&quot;https://dune.build/&quot;&gt;the Dune build system&lt;/a&gt;.
Tarides has been working on this feature since 2019,
iterating on various design solutions in the &lt;code&gt;mirage&lt;/code&gt; tool with
&lt;a href=&quot;https://github.com/mirage/mirage/issues/969&quot;&gt;mirage/mirage/#&lt;/a&gt;,
&lt;a href=&quot;https://github.com/mirage/mirage/pull/979&quot;&gt;mirage/mirage#979&lt;/a&gt;,
&lt;a href=&quot;https://github.com/mirage/mirage/pull/1020&quot;&gt;mirage/mirage/#1020&lt;/a&gt;,
&lt;a href=&quot;https://github.com/mirage/mirage/pull/1024&quot;&gt;mirage/mirage#1024&lt;/a&gt;,
&lt;a href=&quot;https://github.com/mirage/mirage/pull/1153&quot;&gt;mirage/mirage#1153&lt;/a&gt;, and
finally &lt;a href=&quot;https://github.com/mirage/mirage/pull/1226&quot;&gt;miarge/mirage#1226&lt;/a&gt;.
This incremental process resulted in making several contributions to
upstream OCaml for features and tools required to support
the flexible building of MirageOS libraries: for
instance, adding support for &lt;a href=&quot;https://dune.readthedocs.io/en/stable/variants.html&quot;&gt;virtual library and
variants&lt;/a&gt; in Dune
with &lt;a href=&quot;https://github.com/ocaml/dune/pull/1900&quot;&gt;ocaml/dune#1900&lt;/a&gt;,
&lt;a href=&quot;https://github.com/ocaml/dune/pull/2098&quot;&gt;ocaml/dune#2098&lt;/a&gt;, and
&lt;a href=&quot;https://github.com/ocaml/dune/pull/2169&quot;&gt;ocaml/dune#2169&lt;/a&gt;; or the
development or a new opam plugin to manage
&lt;a href=&quot;https://github.com/ocamllabs/opam-monorepo&quot;&gt;mono-repositories&lt;/a&gt;. We
are happy to see it released to all with Mirage 4.0.&lt;/p&gt;
&lt;p&gt;What makes Dune a great option to build MirageOS is that it allows for
customisable cross-compilation flags to compile MirageOS to different
architectures. Using Dune also enables developers to use the Merlin
tool to access a rich set of IDE features when writing
applications. It unlocks a new development workflow based on
&lt;code&gt;opam-monorepo&lt;/code&gt;, which downloads all the unikernel dependencies into a
single Dune workspace. Having a single workspace containing all of the
unikernel&amp;rsquo;s code lets developers edit code anywhere in the stack,
which makes work like debugging libraries and improving APIs a faster
and more enjoyable experience. In his &lt;a href=&quot;https://mirage.io/blog/2022-03-30.cross-compilation&quot;&gt;excellent article on build
contexts in MirageOS
4.0&lt;/a&gt;, Lucas
Pluvinage goes into detail about how to use the new cross-compilation
features to build MirageOS unikernels for new architectures.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#email-in-ocaml--mr-mime&quot; aria-label=&quot;email in ocaml  mr mime permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Email in OCaml &amp;amp; Mr. MIME&lt;/h3&gt;
&lt;p&gt;Mr. MIME is an OCaml library that aims to give its users peace of mind
when it comes to the security of their email communications. Mr. MIME
is built on unikernels and deploys them to handle email traffic. At
Tarides, we got a grant from &lt;a href=&quot;https://dapsi.ngi.eu/&quot;&gt;NGI DAPSI&lt;/a&gt; to
work on this project, and several of our engineers have been busy
working hard to make it happen.&lt;/p&gt;
&lt;p&gt;Several other libraries support the Mr. MIME library and enable it to
transform an email into an OCaml value, then create an email from it
again. An amazing thing about Mr. MIME is its reliability. Using the
&lt;a href=&quot;https://github.com/mirage/hamlet&quot;&gt;&lt;code&gt;hamlet&lt;/code&gt;&lt;/a&gt; tool, which proposes a
large corpus of emails for Mr. MIME to parse and re-encode, the team
can prove that Mr. MIME doesn&amp;rsquo;t alter anything in the message between
the parser and the encoder.&lt;/p&gt;
&lt;p&gt;The team behind Mr. MIME has also created the library
&lt;em&gt;&lt;a href=&quot;https://github.com/mirage/colombe&quot;&gt;Colombe&lt;/a&gt;&lt;/em&gt; that implements the
foundations of an SMTP protocol with the ability to upgrade its flow
to TLS, giving its users an extra layer of security. A goal for the
future is to provide a full SMTP stack that&amp;rsquo;s able to send and receive
emails.&lt;/p&gt;
&lt;p&gt;Mr. MIME also allows its users to manipulate emails through the use of
CLI tools, including
&lt;a href=&quot;https://github.com/mirage/ocaml-dkim&quot;&gt;&lt;code&gt;ocaml-dkim&lt;/code&gt;&lt;/a&gt;, a tool to verify
and sign an email, and
&lt;a href=&quot;https://github.com/mirage/spamtacus&quot;&gt;&lt;code&gt;spamtacus&lt;/code&gt;&lt;/a&gt;, a tool which
analyses the incoming email to determine if it&amp;rsquo;s spam or not. The
&lt;a href=&quot;https://github.com/mirage/ptt&quot;&gt;ptt repo&lt;/a&gt; contains several more as well.&lt;/p&gt;
&lt;p&gt;If you want to find out more information about Mr. MIME, including
details about its architecture, please read Romain Calascibetta&amp;rsquo;s
&lt;a href=&quot;https://mirage.io/blog/2022-04-01-Mr-MIME&quot;&gt;article&lt;/a&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#mirageos-in-production&quot; aria-label=&quot;mirageos in production permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;MirageOS in Production&lt;/h2&gt;
&lt;p&gt;The use of MirageOS benefits not only Tarides, but it also enables
several other companies to make their products better. Below are a
couple of examples from &lt;a href=&quot;https://docker.com&quot;&gt;Docker&lt;/a&gt; and
&lt;a href=&quot;https://robur.coop&quot;&gt;Robur&lt;/a&gt; on how they use MirageOS to their
advantage.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#vpn-kit&quot; aria-label=&quot;vpn kit permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;VPN Kit&lt;/h3&gt;
&lt;p&gt;Docker Desktop is a tool that enables its users to build and share
containerised or isolated applications in either a Mac or Windows
environment. Its main challenge is that running Docker on macOS or
Windows is difficult in terms of compatibility, as Linux primitives
are unavailable on those platforms.&lt;/p&gt;
&lt;p&gt;This is where VPN Kit comes in; it uses MirageOS to bridge the gap
between Linux primitives and macOS or Windows by reading the raw
ethernet frames coming out of the Linux VM and translating them into
macOS or Windows high-level syscalls. In this way, MirageOS networking
libraries transparently handle the traffic of millions of containers
every day.&lt;/p&gt;
&lt;p&gt;To find out more go read the article &amp;ldquo;How MirageOS Powers Docker
Desktop&amp;rdquo; &lt;a href=&quot;https://mirage.io/blog/2022-04-06.vpnkit&quot;&gt;on mirage.io&lt;/a&gt;
or
&lt;a href=&quot;https://www.docker.com/blog/how-docker-desktop-networking-works-under-the-hood/&quot;&gt;on docker.com&lt;/a&gt;.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#robur-projects&quot; aria-label=&quot;robur projects permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Robur Projects&lt;/h3&gt;
&lt;p&gt;Robur uses MirageOS for several of their projects, including OpenVPN,
DNS Projects, and CalDAV. All of these projects are written in OCaml
and are deployed as MirageOS unikernels.&lt;/p&gt;
&lt;p&gt;The DNS Projects include the &amp;lsquo;Let&amp;rsquo;s Encrypt&amp;rsquo;-Certified DNS solver, a
DNS resolver, and an authoritative DNS server. Robur&amp;rsquo;s DNS server
ensures that the internet user gets to the right IP address, whilst
its DNS resolver finds the exact server to handle the user&amp;rsquo;s
request. Only strictly necessary elements are included in order to
keep the codebase as small as possible for security and
simplicity.&lt;/p&gt;
&lt;p&gt;CalDAV is the most recent unikernel released by Robur. As the name
implies, CalDAV is a protocol used to synchronise calendars.
Its minimal codebase comes with significant security benefits.&lt;/p&gt;
&lt;p&gt;To find out more go read the article &amp;ldquo;MirageOS Unikernels at Robur&amp;rdquo; on
&lt;a href=&quot;https://mirage.io/blog/2022-04-08.robur&quot;&gt;mirage.io&lt;/a&gt;.&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;To learn more about MirageOS, take a look at some recent articles at
&lt;a href=&quot;https://mirage.io&quot;&gt;mirage.io&lt;/a&gt;.
If you&amp;rsquo;re interested in working with Tarides or
incorporating MirageOS tools in your project, please &lt;a href=&quot;https://tarides.com/company&quot;&gt;contact us via
our website&lt;/a&gt;.&lt;/p&gt;</content><id>https://tarides.com/blog/2022-04-14-what-s-new-in-mirageos-4</id><title type="text">What's New in MirageOS 4!</title><updated>2022-04-14T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-03-29-mirageos-4-released" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Tarides is delighted to announce that &lt;a href=&quot;https://mirage.io&quot;&gt;MirageOS 4&lt;/a&gt; is finally released! As core contributors to the project, we are proud to have been part of the journey to 4.0.&lt;/p&gt;
&lt;p&gt;What is MirageOS?
MirageOS is a library operating system that constructs unikernels for fast and secure network applications that work across a variety of cloud computing and mobile platforms. The goal of MirageOS is to give the individual control of their own data and take back control of their privacy.&lt;/p&gt;
&lt;p&gt;It achieves these goals in several ways, from securely deploying &lt;a href=&quot;https://github.com/roburio/unipi&quot;&gt;static website hosting&lt;/a&gt; with &lt;em&gt;Let&amp;rsquo;s Encrypt&lt;/em&gt; certificate provisioning and a secure &lt;a href=&quot;https://github.com/mirage/ptt&quot;&gt;SMTP stack&lt;/a&gt;, to ensuring data privacy with decentralised communication infrastructures like &lt;a href=&quot;https://github.com/mirage/ocaml-matrix&quot;&gt;Matrix&lt;/a&gt;, &lt;a href=&quot;https://github.com/roburio/openvpn&quot;&gt;OpenVPN Servers&lt;/a&gt;, and &lt;a href=&quot;https://github.com/roburio/tlstunnel&quot;&gt;TLS tunnels&lt;/a&gt;, as well as using &lt;a href=&quot;https://github.com/mirage/ocaml-dns&quot;&gt;DNS(SEC) Servers&lt;/a&gt; for better authentication.&lt;/p&gt;
&lt;p&gt;Over the years since its first release in 2013, the Mirage ecosystem has grown to include &lt;a href=&quot;https://github.com/mirage/&quot;&gt;hundreds of libraries&lt;/a&gt; and service millions of daily users, along with several major commercial users that rely on MirageOS to keep their code secure. Examples of this include &lt;a href=&quot;https://www.docker.com/blog/how-docker-desktop-networking-works-under-the-hood/&quot;&gt;Docker Desktop&amp;rsquo;s VPNkit&lt;/a&gt;, the &lt;a href=&quot;https://www.citrix.com/fr-fr/products/citrix-hypervisor/&quot;&gt;Citrix Hypervisor&lt;/a&gt;, as well as &lt;a href=&quot;https://robur.io&quot;&gt;Robur&lt;/a&gt;, &lt;a href=&quot;https://www.nitrokey.com/products/nethsm&quot;&gt;Nitrokey&lt;/a&gt;, and Tarides itself!&lt;/p&gt;
&lt;p&gt;What&amp;rsquo;s in the New Release?
The new release focuses on better integration with existing ecosystems. For example, it is now much easier to integrate with existing OCaml libraries, as MirageOS 4 is now using &lt;code&gt;dune&lt;/code&gt; to build unikernels.&lt;/p&gt;
&lt;p&gt;There has also been a major change in how MirageOS compiles projects with the introduction of a new tool called &lt;a href=&quot;https://github.com/ocamllabs/opam-monorepo&quot;&gt;&lt;code&gt;opam-monorepo&lt;/code&gt;&lt;/a&gt; that separates package management from building the resulting source code. The Opam plugin can create a lock file for project dependencies, download and extract dependency sources locally, and even set up a &lt;a href=&quot;https://dune.readthedocs.io/en/stable/dune-files.html#dune-workspace-1&quot;&gt;Dune workspace&lt;/a&gt;, which then enables &lt;code&gt;dune build&lt;/code&gt; to build everything simultaneously.&lt;/p&gt;
&lt;p&gt;The new release also adds systematic support for cross-compilation to all supported unikernel targets, meaning that libraries that use C stubs can now have those stubs seamlessly cross-compiled to a desired target.&lt;/p&gt;
&lt;p&gt;To find out more about the new release please read &lt;a href=&quot;https://mirage.io/blog/announcing-mirage-40&quot;&gt;the official release post on Mirage.io&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Keep an eye on &lt;a href=&quot;https://mirage.io&quot;&gt;mirage.io&lt;/a&gt;'s blog over the next two weeks for more posts on the exciting new things that come with MirageOS 4.0, starting with &amp;ldquo;Introduction to Build Contexts in MirageOS 4.0&amp;rdquo; tomorrow!&lt;/p&gt;</content><id>https://tarides.com/blog/2022-03-29-mirageos-4-released</id><title type="text">MirageOS 4 Released!</title><updated>2022-03-29T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-03-08-secure-virtual-messages-in-a-bottle-with-scop" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;People love to receive mail, especially from loved ones. It&amp;rsquo;s heartwarming to read
each word as their thoughts touch our deepest feelings. Now imagine someone else
reading those private sentiments, like a postal worker. Imagine how violated they&amp;rsquo;d
feel if their postal carrier handed them an open letter with a knowing smile. Of course,
people trust that postal employees won&amp;rsquo;t read their personal correspondence;
however, they regularly risk their privacy when sending emails, images, and messages.&lt;/p&gt;
&lt;p&gt;Around 300 billion emails traverse the Internet every single day. They travel
through portals with questionable security, and the messages often contain
private or sensitive data. Most online communication services are composed of
multiple components with complex interactions. If anything goes wrong, it
results in critical security incidents. This leaves an unlocked door for
malicious hackers to breach private information for profit or just for fun.
Since it takes considerable technical skills and reliable infrastructure to
operate a secure email service, most Internet users must
rely on third-parties operators. In practice, there
are only a few large companies that can handle communications with the
proper security levels. Unfortunately for regular people, these companies
profit from mining their personal data. Due to this global challenge, Tarides
focused their efforts to address these issues and find solutions to protect
both personal and professional data.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#an-innovative-solution&quot; aria-label=&quot;an innovative solution permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;An Innovative Solution&lt;/h3&gt;
&lt;p&gt;Our work resulted in the project &amp;quot;Secure-by-Design Communications Protocols&amp;quot;
(SCoP), a secure, easily deployable solution to preserve users' privacy. In
essence, SCoP puts your messages in a secure, virtual &amp;lsquo;bottle&amp;rsquo; to protect it
from invasive actions. This bottle represents a secure architecture using
type-safe languages and unikernels for both email and instant messaging.
We mould &lt;a href=&quot;https://mirage.io/&quot;&gt;unikernels&lt;/a&gt; (specialised applications that
run on a VM) into refined meshes linked by TLS-firm communication pipes,
as depicted in the image below.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/6c94ba14bec3537413c603635b78c123/0f98f/Dapsi_4.001.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB3FtiFGD/xAAXEAEBAQEAAAAAAAAAAAAAAAAAEQEQ/9oACAEBAAEFAmdiP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABcQAAMBAAAAAAAAAAAAAAAAAAABICH/2gAIAQEABj8CHs//xAAbEAADAAIDAAAAAAAAAAAAAAAAAREhMUFRgf/aAAgBAQABPyG5zj0us2ael0LXJCCD/9oADAMBAAIAAwAAABDb3//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/EFf/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPxBH/8QAHBAAAgICAwAAAAAAAAAAAAAAABEBITGhQWGB/9oACAEBAAE/EOSyIuBBwK2YLD2Ol+hBjcNnXs//2Q=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/6c94ba14bec3537413c603635b78c123/7bf67/Dapsi_4.001.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;TLS Communication Pipes&quot; title=&quot;&quot; srcset=&quot;/static/6c94ba14bec3537413c603635b78c123/651be/Dapsi_4.001.jpg 170w,
/static/6c94ba14bec3537413c603635b78c123/d30a3/Dapsi_4.001.jpg 340w,
/static/6c94ba14bec3537413c603635b78c123/7bf67/Dapsi_4.001.jpg 680w,
/static/6c94ba14bec3537413c603635b78c123/990cb/Dapsi_4.001.jpg 1020w,
/static/6c94ba14bec3537413c603635b78c123/c44b8/Dapsi_4.001.jpg 1360w,
/static/6c94ba14bec3537413c603635b78c123/0f98f/Dapsi_4.001.jpg 1920w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The SCoP virtual bottle creates a trustworthy information flow where dedicated
unikernels ensure security for communication from origin to destination. We
carefully design every component of SCoP as independent libraries, using
modern development techniques to avoid the common reported threats and flaws.
The &lt;a href=&quot;https://ocaml.org&quot;&gt;OCaml&lt;/a&gt;-based development enables this safe online
environment, which eliminates many exploited security pitfalls. Moreover,
our SCoP project comes with energy-efficient consumption provided by the
lightweight and low-latency design components.&lt;/p&gt;
&lt;p&gt;We mostly focused on the sender&amp;rsquo;s side, securing the message inside the SCoP
bottle. For instant messages, we created a capsule with a
&lt;a href=&quot;https://github.com/mirage/ocaml-matrix&quot;&gt;Matrix client library&lt;/a&gt;,
and for emails we based our bottle on the &lt;a href=&quot;https://github.com/mirage/ptt&quot;&gt;SMTP protocol&lt;/a&gt;
and &lt;a href=&quot;https://github.com/mirage/mrmime&quot;&gt;Mr. MIME&lt;/a&gt;. For further protection,
we developed the bottle&amp;rsquo;s &amp;lsquo;cork&amp;rsquo; with the
&lt;a href=&quot;https://github.com/mirage/hamlet&quot;&gt;Hamlet email corpus&lt;/a&gt;.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-scop-processes&quot; aria-label=&quot;the scop processes permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The SCoP Processes&lt;/h3&gt;
&lt;p&gt;First, we generated Hamlet, a collection of emails to test our parser
implementation against existing projects, to ensure that they kept equivalence
between the encoder and decoder. After we successfully parsed and encoded one
million emails, we used Hamlet to stress-test our SMTP stack.&lt;/p&gt;
&lt;p&gt;Secondly, we created an SMTP extension mechanism and support for SPF, including
an implementation for DMARC, a security framework in addition to DKIM and SPF.
We completed four components: SPF, DKIM, SMTP, and Mr. MIME, which can generate
a correctly-signed email, signatures, and the DKIM field containing the signatures.&lt;/p&gt;
&lt;p&gt;In essence, we designed the SMTP sender bottle with a mesh of unikernels connected
via secured communication pipes. The SMTP Submission Server unikernel receives
the sender&amp;rsquo;s authentication credentials against the secured database maintained
by Irmin. After it confirms the credentials, it sends the email for sealing
(via a TLS pipe) to the DKIM signer. Then the DKIM signer unikernel, responsible
for handling IP addresses, communicates via the nsupdate protocol with the Primary
DNS Server. The DKIM signer places the sender&amp;rsquo;s and receiver&amp;rsquo;s addresses on the email,
seals it with the DKIM signature, and sends it to the SMTP relay for distribution.
The SMTP relay unikernel communicates with the DNS resolver unikernel to locate the
receiver by the DNS name, then it coordinates this location with the Irmin database
to verify the authorization according to the SPF protocol. After all these checks
have passed, the signed and sealed email is secured in the SCoP bottle and launched
through Cyberspace.&lt;/p&gt;
&lt;p&gt;Next, we developed the Matrix protocol&amp;rsquo;s client library, and we used it to enable
notifications from the CI system, testing all the new OCaml packages. We also
designed an initial PoC for a Matrix&amp;rsquo;s server-side daemon.&lt;/p&gt;
&lt;p&gt;We made significant progress in deploying DNSSEC, a set of security extensions over
DNS. While we completed our first investigation into the DNSSEC prototype, we also
discovered several issues, so we addressed those as lessons learned.&lt;/p&gt;
&lt;p&gt;Finally, we completed the &lt;a href=&quot;https://github.com/tarides/unikernels&quot;&gt;SCoP bottle&lt;/a&gt; with
the email receiver, which &lt;a href=&quot;https://github.com/mirage/spamtacus&quot;&gt;Spamtacus&lt;/a&gt; (the
Bayesian spam filter) guards against spam intruders. Furthermore, the
&lt;a href=&quot;https://github.com/mirage/ocaml-matrix&quot;&gt;OCaml-Matrix&lt;/a&gt; server represents
our solution to take care of the instant communication in the Matrix federation.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#a-secure-by-design-smtp-stack&quot; aria-label=&quot;a secure by design smtp stack permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A Secure-by-Design SMTP Stack&lt;/h3&gt;
&lt;p&gt;We researched state-of-the-art email spam filtering methods and identified machine
learning as the main trend. We followed this path and equipped our email architecture
with a spam-filter unikernel, which uses a Bayesian method for supervised learning
of spam and acts as a proxy for internet communication in the SMTP receiver. This
spam filter works in two states: preparation, where the unikernel detects spam,
and operation, where the unikernel integrates into the SMTP receiver unikernel
architecture to filter spam emails. Our spam-filter unikernel can also be used
independently as an individual anti-spam tool to help enforce GDPR rules and protect
the user&amp;rsquo;s privacy by preventing spam-induced attacks, such as phishing.&lt;/p&gt;
&lt;p&gt;We integrated our spam filter into a unikernel positioned at the beginning
of the SMTP receiver stack. This acts as a first line of defence in an eventual
attack targeting the receiver in order to maintain functionality. The spam-filter
unikernel can be extended to act as an antivirus by analysing the email attachment
for certain features known to characterise malware. We&amp;rsquo;ve already set the premises
for the antivirus by using a prototype analysis of the email attachments. Moreover,
the spam-filter unikernel can contribute with a list of frequent spammers to the
firewall, which we plan to add into the SMTP receiver as the next step in our development of SCoP.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#how-the-technology-works&quot; aria-label=&quot;how the technology works permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;How the Technology Works&lt;/h3&gt;
&lt;p&gt;DKIM, SPF, and DMARC are three communication protocols meant to ensure email
security by verification of sender identity. The latest RFC standards for
DKIM, SPF, and DMARC are RFC8463, RFC7208, and RFC7489, respectively.&lt;/p&gt;
&lt;p&gt;DKIM provides a signer protocol and the associated verifier protocol. DKIM
signer allows the sender to communicate which email it considers legitimate.
Our implementation of the DKIM verifier is associated with the SMTP receiver,
it follows the RFC8463 standard and supports the ED25519 signing algorithm,
i.e., the elliptic curve cryptography generated from the formally verified
specification in the fiat project from MIT.&lt;/p&gt;
&lt;p&gt;SPF is an open standard that specifies a method to identify legitimate mail
sources, using DNS records, so the email recipients can consult a list of IP
addresses to verify that emails they receive are from an authorised domain.
Hence, SPF is functioning based on the blacklisting principle in order to
control and prevent sender fraud. Our implementation of the SPF verifier
follows the RFC7208 standard.&lt;/p&gt;
&lt;p&gt;DMARC (Domain-based Message Authentication, Reporting, and Conformance) enables
a sender to indicate that their messages comply with SPF and DKIM, and applies
clear instructions for the recipient to follow if an email does not pass SPF or
DKIM authentications (reject, junk, etc.). As such, DMARC is used to create
domain reputation lists, which can help determine the actual email source
and mitigate spoofing attacks. Our implementation of the DMARC verifier is
integrated in the SMTP receiver and follows the RFC7489 standard.&lt;/p&gt;
&lt;p&gt;Our secure-by-design SMTP stack contains the DKIM/SPF/DMARC verifier unikernel
on the receiver side. This unikernel verifies the email sender&amp;rsquo;s DNS
characteristics via a TLS communication pipe, and in case the DNS verification
passes, the spam-labelled email goes to the SMTP relay to be dispatched to the
email client. However, in case the DNS verification doesn&amp;rsquo;t pass, we can use
the result to construct a DNS reputation list to improve the SMTP security
via a blacklisting firewall.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#matrix-server&quot; aria-label=&quot;matrix server permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Matrix Server&lt;/h3&gt;
&lt;p&gt;The Matrix server in our OCaml Matrix implementation manages clients who are
registered to rooms that contain events. These represent client actions, such
as sending a message. Our implementation follows the Matrix specification
standard. From here, we extracted the parts describing the subset of the Matrix
components we chose to implement for our OCaml Matrix server MVP. The OCaml
implementation environment provides secure-by-design properties and avoids
various vulnerabilities, like the buffer overflow recently discovered that
produces considerable information disclosure in other Matrix implementations,
e.g., Element.&lt;/p&gt;
&lt;p&gt;The Matrix clients are user applications that connect to a Matrix server via the
client-server API. We implemented an OCaml-CI client, which communicates with the
Matrix servers via the client-server API and tested the integration of the OCaml-CI
communication with both Synapse and our OCaml Matrix server. Please note that our
OCaml Matrix server supports a client authentication mechanism based on user name
identification and password, according to the Matrix specification for authentication
mechanisms.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#spam-filter&quot; aria-label=&quot;spam filter permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Spam Filter&lt;/h3&gt;
&lt;p&gt;We researched the state of the art in email spam filtering and we identified machine
learning as the main trend. We follow this trend and we equip our email architecture
with a spam filter unikernel, which uses a Bayesian method for supervised learning of
spam and acts as a proxy to the internet communication in the SMTP receiver. The spam
filter implementation works in two stages: preparation, when the unikernel is trained
to detect spam, and operation, when the unikernel is integrated into the SMTP receiver
architecture of unikernels to filter the spam emails. It is worth mentioning that the
spam filter unikernel can be used independently as an individual anti-spam tool to help
enforce the GDPR rules and protect the user's privacy by preventing spam induced attacks
such as phishing.&lt;/p&gt;
&lt;p&gt;We integrate the spam filter into an unikernel positioned at the beginning of the
SMTP receiver stack as the first line of defence in an eventual attack targeting the
receiver. In this situation, the unikernel format provides isolation of the attack and
allows the SMTP receiver to maintain functionality. The spam filter unikernel can be
extended to act as an antivirus by analysing the email attachment for certain features
that are known to characterise malware. We have already set the premises for the antivirus
by a prototype analysis of the email attachments. Moreover, the spam filter unikernel could
contribute with a list of frequent spammers to the firewall, which is planned to be added
into the SMTP receiver, as the next step in future work.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-dapsi-initiative&quot; aria-label=&quot;the dapsi initiative permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The DAPSI Initiative&lt;/h3&gt;
&lt;p&gt;Much of the SCoP project was possible thanks to &lt;a href=&quot;https://dapsi.ngi.eu&quot;&gt;the DAPSI initiative&lt;/a&gt;.
They gave Tarides the incentive to further explore an open and secure infrastructure for
communication protocols, especially emails. First, DAPSI supported our team by providing
necessary financing, but their contribution to our project&amp;rsquo;s prosperity runs much deeper
than funding. DAPSI facilitated multiple coaching sessions that helped broaden our horizons
and established reachable goals. Notably, their business coaching enabled us to identify
solutions for our market strategy. Their technical coaching and training offered access
to data portability experts and GDPR regulations, which opened our perspective to novel
trends and procedures. Additionally, DAPSI helped raise our visibility by organising public
communications, and DAPSI&amp;rsquo;s feedback revealed insights on how to better exploit our project&amp;rsquo;s
potential and what corners of the cyber-ecosystem to prioritise. We are deeply grateful to
DAPSI for their support and backing, and we&amp;rsquo;re thrilled to have passed Phase 2!&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#up-next-for-scop&quot; aria-label=&quot;up next for scop permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Up Next for SCoP&lt;/h3&gt;
&lt;p&gt;We&amp;rsquo;re excited to further develop this project. We&amp;rsquo;ll be experimenting with deploying
unikernels on a smaller chipset, such as IoT. We&amp;rsquo;d also like to research secure data
porting in other domains such as journalism, law, or banking.&lt;/p&gt;
&lt;p&gt;Of course we&amp;rsquo;ll be maintaining each of the SCoP components in order to follow the latest
available standards and state-of-the-art technology, including periodical security
analyses of our code-base and mitigation for newly discovered vulnerabilities.&lt;/p&gt;
&lt;p&gt;As in all of our work at Tarides, we strive to benefit the entire OCaml community and beyond.
Please find more information on SCoP through our blog posts:
&lt;a href=&quot;https://tarides.com/blog/2021-04-30-scop-selected-for-dapsi-initiative&quot;&gt;DAPSI Initiative&lt;/a&gt;
and &lt;a href=&quot;https://tarides.com/blog/2021-10-14-scop-selected-for-dapsi-phase2&quot;&gt;DAPSI Phase 1&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/50ddca27efa367497d954f667fc921f8/a76d6/DAPSI_generic.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 3.5294117647058822%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAABABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAIDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAHSsFSCf//EABYQAQEBAAAAAAAAAAAAAAAAAAMQM//aAAgBAQABBQIc0n//xAAWEQADAAAAAAAAAAAAAAAAAAACEDH/2gAIAQMBAT8BCr//xAAWEQADAAAAAAAAAAAAAAAAAAABEDH/2gAIAQIBAT8BNX//xAAXEAADAQAAAAAAAAAAAAAAAAAAAhCB/9oACAEBAAY/AlNn/8QAGBAAAgMAAAAAAAAAAAAAAAAAALEQMYH/2gAIAQEAAT8hcZXMf//aAAwDAQACAAMAAAAQiA//xAAWEQEBAQAAAAAAAAAAAAAAAAAAATH/2gAIAQMBAT8QyR//xAAVEQEBAAAAAAAAAAAAAAAAAAAQMf/aAAgBAgEBPxCx/8QAGxAAAgEFAAAAAAAAAAAAAAAAAAEhMUGhsfD/2gAIAQEAAT8QzNhT4lFkf//Z'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/50ddca27efa367497d954f667fc921f8/7bf67/DAPSI_generic.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Sequence of entity logos: in association with NGI, EU, Zabala, FGS,
cap-digital, IMT Starter, Fraunhofer IAIS.&quot; title=&quot;&quot; srcset=&quot;/static/50ddca27efa367497d954f667fc921f8/651be/DAPSI_generic.jpg 170w,
/static/50ddca27efa367497d954f667fc921f8/d30a3/DAPSI_generic.jpg 340w,
/static/50ddca27efa367497d954f667fc921f8/7bf67/DAPSI_generic.jpg 680w,
/static/50ddca27efa367497d954f667fc921f8/990cb/DAPSI_generic.jpg 1020w,
/static/50ddca27efa367497d954f667fc921f8/a76d6/DAPSI_generic.jpg 1139w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;</content><id>https://tarides.com/blog/2022-03-08-secure-virtual-messages-in-a-bottle-with-scop</id><title type="text">Secure Virtual Messages in a Bottle with SCoP</title><updated>2022-03-08T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-03-01-segfault-systems-joins-tarides" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;We are delighted to announce that Segfault Systems, a spinout from IIT-Madras,
is joining Tarides. Tarides has worked closely with Segfault Systems over the
last couple of years, most notably on the award-winning Multicore OCaml project
and the upstreaming plans for OCaml 5.0. This alliance furthers the goals of
Tarides, bringing the compiler and benchmarking expertise of the Segfault team
directly into the Tarides organisation.&lt;/p&gt;
&lt;p&gt;KC Sivaramakrishnan, CEO &amp;amp; CTO of Segfault Systems says that &amp;ldquo;Segfault Systems
was founded to secure the foundations of scalable systems programming in OCaml.
We have successfully incorporated cutting-edge research on
&lt;a href=&quot;https://dl.acm.org/doi/10.1145/3453483.3454039&quot;&gt;concurrent&lt;/a&gt; and
&lt;a href=&quot;https://dl.acm.org/doi/10.1145/3408995&quot;&gt;parallel&lt;/a&gt; programming into OCaml. This
addresses the long-standing need of OCaml developers to utilise the widely
available multicore processing on modern machines. Tarides is at the forefront
of OCaml developer tooling and platform support, and we are excited to join the
team to make OCaml the best tool for industrial-strength concurrent and parallel
programming.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;We&amp;rsquo;re thrilled to have the Segfault Systems team join Tarides,&amp;rdquo; says Thomas
Gazagnaire, CTO of Tarides. &amp;ldquo;They have been integral to the success of the
Multicore OCaml project, which has combined cutting edge research and
engineering with consistent communication, promoting Multicore OCaml as an
upstream candidate to the core developer team, as well as
&lt;a href=&quot;https://discuss.ocaml.org/tag/multicore-monthly&quot;&gt;publishing monthly reports&lt;/a&gt;
for the wider community. We look forward to working with our new partners to
make OCaml the tool of choice for developers.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;All of Segfault Systems&amp;rsquo; existing responsibilities and open-source commitments
will migrate over to Tarides, where work will continue towards the three main
objectives in 2022:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Releasing OCaml 5.0 with support for domains and effect handlers&lt;/li&gt;
&lt;li&gt;Supporting the ecosystem to migrate the OCaml community over to OCaml 5.0&lt;/li&gt;
&lt;li&gt;Improving developer productivity for OCaml 5.0 by releasing the best platform
tools&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#ocaml-50&quot; aria-label=&quot;ocaml 50 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;OCaml 5.0&lt;/h1&gt;
&lt;p&gt;The next major release of OCaml, version 5.0, will feature primitive support for
parallel and concurrent programming through domains and effect handlers. The
goal is to ensure that the fine balance that OCaml has struck between ease of
use, correctness and performance over the past 25 years continues into the
future with these additional features.&lt;/p&gt;
&lt;p&gt;Domains enable shared-memory parallel programming allowing OCaml programs to run
on multiple cores: with domains, OCaml programs will scale better by exploiting
multicore processing. Effect handlers are a mechanism for concurrent
programming: with the introduction of effect handlers, simple direct-style OCaml
code will be flexible, easy to develop, debug and maintain (no more monads for
concurrency!). These features will benefit the entire ecosystem and community,
and we expect it to attract many new users to the language.&lt;/p&gt;
&lt;p&gt;As part of the Multicore OCaml project, the team developed
&lt;a href=&quot;https://github.com/ocaml-bench/sandmark&quot;&gt;Sandmark&lt;/a&gt;, a suite of sequential and
parallel benchmarks together with the infrastructure necessary to carefully run
the programs and analyse the results. Sandmark has been instrumental in
assessing and tuning the scalability of parallel OCaml programs and ensuring
that OCaml 5.0 does not introduce performance regressions for existing
sequential programs compared to OCaml 4.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/12df31eaf97ae56b3834fd6308095524/bce1e/scalability.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 74.11764705882352%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACQ0lEQVR42k2U25akMAhF/f9PrdJozA0I5MwC7Z5+SFkSCORscFNV673jPE9c14njPCFzgpmRUsK+7xhjYM4Z7+53HAeu6wrbfd9I6Vw5Z49JWynFzAxqC1cXXH2CZGKZYa0VK/ZVf99/ltt8D8DyH54zbZ/Px6YtfO+OThIO9nuYvQc/NjXF4CehryeR4ay08lDkTmmrtdhRBmgq8Gae+gZOfZZMDBYclZGH4KaJQhI+eyF0nlGhmaWNZZpvMBH6GBBmqBlSHficd6yzdAyZ6MSg0cE0sEzjRrUPt6055dFQRMy1KKWGwETkyULwWgpqLZgiYfO987zCz/c9rtaKnPNqrTm8tF3XZfYHQFx5alT53/ZAsffdGYga5AVlZv+v7FAiu0zcnbG7nk55GRpPVBI0ktDVE9chSIVwVg4gbmvEi3R5fNrGGJbKwFEpgt3Bg/d7IHdBcQidHyiFkBuDX4Buc7+r8RoaRbmG07z83hpyvqA6oydlathaq0/P2cJdG0q5Q1tyQKK474Jy5+WgmOip0KvyyfCJ+OnDqFQEgygq82ARCTC5dux3D13f7lj+f3pjp5TsLxC/igUA11Cjz6KJXwBXY1zNpXEY+j4fKKqWtuM44kAX/h6CQhMsGoFn49+p8edZKXyc8s/opUrYb1qZzGPSxswxKVejINh5xuFXpajWSXpgGxxA1jtuXt3dCKUz8FPhfKAIs+idsx77rqM3FRFlJj3PU/d919aauo8w6ff71ZSSjjHCb/TuPvP92nz/AcCWknYEqb1mAAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/12df31eaf97ae56b3834fd6308095524/c5bb3/scalability.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Matrix of graphs showing scalability of various multicore OCaml workloads&quot; title=&quot;&quot; srcset=&quot;/static/12df31eaf97ae56b3834fd6308095524/04472/scalability.png 170w,
/static/12df31eaf97ae56b3834fd6308095524/9f933/scalability.png 340w,
/static/12df31eaf97ae56b3834fd6308095524/c5bb3/scalability.png 680w,
/static/12df31eaf97ae56b3834fd6308095524/b12f7/scalability.png 1020w,
/static/12df31eaf97ae56b3834fd6308095524/b5a09/scalability.png 1360w,
/static/12df31eaf97ae56b3834fd6308095524/bce1e/scalability.png 1696w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p align=&quot;center&quot;&gt;&lt;i&gt;Scalability of compute intensive OCaml programs&lt;/i&gt;&lt;/p&gt;
&lt;p&gt;Sandmark is now run as &lt;a href=&quot;https://sandmark.ocamllabs.io&quot;&gt;a nightly service&lt;/a&gt;
monitoring the performance of OCaml 5 as it is being developed. Development will
continue to make it even easier to use and more practical by fully integrating
it with &lt;a href=&quot;https://github.com/ocurrent/current-bench&quot;&gt;current-bench&lt;/a&gt; (the continuous
benchmarking system based on OCurrent).
&lt;a href=&quot;https://tarides.com/company/&quot;&gt;Get in touch&lt;/a&gt; if you want to know more.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#ecosystem&quot; aria-label=&quot;ecosystem permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Ecosystem&lt;/h1&gt;
&lt;p&gt;At Tarides we want all OCaml users to benefit from the new features that OCaml
5.0 will bring, and this means ensuring that the ecosystem is fully prepared. We
aim to develop and maintain a robust set of libraries that work with domains and
effects, together with a diverse parallel benchmarking and performance profiling
suite to use with OCaml 5 applications. The
&lt;a href=&quot;https://discuss.ocaml.org/t/eio-0-1-effects-based-direct-style-io-for-ocaml-5/9298&quot;&gt;first version of Eio&lt;/a&gt;,
the effects-based direct-style IO stack for OCaml 5.0, has been released,
generating lots of interesting discussion within the community. Eio not only
makes it easier to develop, debug and maintain applications utilising
asynchronous IO, but is also able to take advantage of multiple cores when
available.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/873029eb073713d1fbaf8ad64bcee1cd/133ae/http_load.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.47058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABpklEQVR42pVT2Y7bMAzc//+5oi8B+hQkdhs01k3dB2dhx4A3TfOwFAZDUfKAFM2P3vsfAAmABxC+g3H4xEAfY/z8YGY9xoDShhcbQETQWsNai1rrW5RS0FtFSAV34wce9usj56xzzhDLnZffF0zTjNPphNvtBmZ+wRgM7L7LHdIFCCEOQSLSWhtoI1mGG6QUmKYJxpjto/9ZagzlPIJTQNYoXh6C3nsthYAj4tLbnsXYcNhDuPUBYx2cumNEDYyyxUspzxkuywLvPb9mtO97AxkJJf6iBANw+3qKkvMhGGPUSik45/4R3P3RMNwddS3vjb1kKIRYu7sL8rYeNz2aX+ALQVULWyxMNhvb8mBTDOTXN3TOaSnlVvLgR7y0BG9nGDvDVQ9bHHJLWM8792eggxI9N+XIELBJYdZnUFRYb73r9NuSa63a+wBtFJskIZNAHx3fsSfBdVJWjwLxfJ8x2timJaW0Yf3pY4wbrxOyxlb23m+xnQ/BMca8z6NLMVGphWKMFEKg8/lMl8uF5nmm6/VK0zRteyEEpZSo1kreewJgAVRm/vEJckDz870337gAAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/873029eb073713d1fbaf8ad64bcee1cd/c5bb3/http_load.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Line chart showing the scalability of HTTP server implementations in OCaml, Rust and Go&quot; title=&quot;&quot; srcset=&quot;/static/873029eb073713d1fbaf8ad64bcee1cd/04472/http_load.png 170w,
/static/873029eb073713d1fbaf8ad64bcee1cd/9f933/http_load.png 340w,
/static/873029eb073713d1fbaf8ad64bcee1cd/c5bb3/http_load.png 680w,
/static/873029eb073713d1fbaf8ad64bcee1cd/b12f7/http_load.png 1020w,
/static/873029eb073713d1fbaf8ad64bcee1cd/b5a09/http_load.png 1360w,
/static/873029eb073713d1fbaf8ad64bcee1cd/133ae/http_load.png 1424w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p align=&quot;center&quot;&gt;&lt;i&gt;HTTP server performance using 24 cores&lt;/i&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/d0eff71860d106c6e544df7b61f23d7b/2a08f/http_cores.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.47058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB0UlEQVR42o2Ti2obMRBF8/9fV2hpoA6Uljq2d7W29X7PKdqN4wTSx8Blh1l0pLkjPfTe5957BgIQb+pv8v+QBwT48gDYWitaa8k5c1Mpm3JOnG1kMRHrE8ZHjAubfOTqIqeL6Wzx7SGlZGOMWGultYaIgAg2Fi4ucYkNtSjm4x7rPcZ5TKyv0rGxGH8HWmutUmoFrjCgts7PJZC7IMlBvED1UBxkC+kK2SAtgWRy+gDonJPet/o1FGJt28JkeB+jgw69IWnANVnP74Gn0wljjIxWaxfOvsD1F+Twwths2HyXO/qlo5zzHei9X0+4AoG9Lrirghr4V3wINMbYZVlwYygC83REoiZLJbeELZY5zkxhwhTDNWt01luersQWcdHdgVrrVw9dzNjzkdg8R3dEF03thSaN2uv6HcqtEWql9YYvntm88dA5t57QhyBnNfN8+Y4Z0xT5Y6s+JNRiGOue98+oWd2BpRTrvWeaJ3n68Zks6W+ubUCvOJ937HZPPD5+5XA43IG3lzKrSZSe1zXOOUIIjGs08nHxN5Bf67lWFq3HINd/Sql3wENrzeecba3Ntt7Gy1k1NhuW7Pd7O03TsMaOlzXq0Qcbb3mMupRSgE+/AQXK8wbpvTSdAAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/d0eff71860d106c6e544df7b61f23d7b/c5bb3/http_cores.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Line chart showing the load response of HTTP server implementations in OCaml, Rust and Go&quot; title=&quot;&quot; srcset=&quot;/static/d0eff71860d106c6e544df7b61f23d7b/04472/http_cores.png 170w,
/static/d0eff71860d106c6e544df7b61f23d7b/9f933/http_cores.png 340w,
/static/d0eff71860d106c6e544df7b61f23d7b/c5bb3/http_cores.png 680w,
/static/d0eff71860d106c6e544df7b61f23d7b/b12f7/http_cores.png 1020w,
/static/d0eff71860d106c6e544df7b61f23d7b/b5a09/http_cores.png 1360w,
/static/d0eff71860d106c6e544df7b61f23d7b/2a08f/http_cores.png 1422w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p align=&quot;center&quot;&gt;&lt;i&gt;HTTP server scaling maintaining a constant load of 1.5 million requests per second&lt;/i&gt;&lt;/p&gt;
&lt;p&gt;The early results are quite promising. An HTTP server based on Eio is able to
serve 1M+ requests/sec on 24 cores, outperforming Go's &lt;code&gt;nethttp&lt;/code&gt; and closely
matching Rust's &lt;code&gt;hyper&lt;/code&gt; performance. Eio is still heavily under development.
Expect even better numbers for its stable release planned later this year.&lt;/p&gt;
&lt;p&gt;The next step is to iterate on the design in collaboration with the community
and our partners. &lt;a href=&quot;https://tarides.com/company/&quot;&gt;Get in touch&lt;/a&gt; if you have
performance-sensitive applications that you'd like to port to Eio, so we can
discuss how the design can meet your needs.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#ocaml-platform&quot; aria-label=&quot;ocaml platform permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;OCaml Platform&lt;/h1&gt;
&lt;p&gt;In collaboration with community members and commercial funders, Tarides has been
developing and defining the
&lt;a href=&quot;https://v3.ocaml.org/learn/platform&quot;&gt;OCaml platform tool suite&lt;/a&gt; for the last
four years. The goal of the platform is to provide OCaml developers with easy
access to high-quality, practical development tools to build any and every
project. We will continue to develop and maintain these tools, and make them
available for OCaml 5. &lt;a href=&quot;https://tarides.com/company/&quot;&gt;Reach out to us&lt;/a&gt; if you
have specific feature requests to make your developer teams more efficient.&lt;/p&gt;
&lt;p&gt;This alliance brings the headcount of Tarides up to 60+ people, all working
towards making OCaml the best language for any and every project.
&lt;a href=&quot;https://tarides.com/company/&quot;&gt;Join us&lt;/a&gt;!&lt;/p&gt;</content><id>https://tarides.com/blog/2022-03-01-segfault-systems-joins-tarides</id><title type="text">Segfault Systems Joins Tarides</title><updated>2022-03-01T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2022-01-27-ocaml-labs-joins-tarides" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Today I am incredibly delighted to announce that &lt;a href=&quot;https://anil.recoil.org/projects/ocamllabs&quot;&gt;OCaml
Labs&lt;/a&gt;, a spinout from the
&lt;a href=&quot;http://www.cl.cam.ac.uk/&quot;&gt;University of Cambridge&lt;/a&gt;, is joining
&lt;a href=&quot;https://tarides.com/&quot;&gt;Tarides&lt;/a&gt;. After successfully collaborating on
many OCaml projects over the last four years, this alliance will
combine the expertise of both groups and enable us to bring OCaml, one
of the most advanced programming languages in the world, into
mainstream use. Combining forces will accelerate OCaml development and
its broader adoption. Furthermore, it will bring the security,
portability, and performance of OCaml to a large spectrum of
use-cases: from academic endeavours, such as formal methods and
existing threats within cyber-security, to real-world applications for
climate change, sustainable agriculture, and even space exploration!&lt;/p&gt;
&lt;p&gt;All of OCaml Labs&amp;rsquo; existing responsibilities and open-source
commitments will migrate over to Tarides, and thanks to how closely
the teams already work, business will continue without interruption to
continuity or delivery. Gemma Gordon will step up as CEO of Tarides,
and I will continue to lead the technological vision and strategy as
CTO. As Prof. Anil Madhavapeddy, founder of OCaml Labs and scientific
advisor of Tarides, points out, &amp;ldquo;The cutting edge research we
conducted at the University over the past decade has now migrated into
mainline OCaml, and so the ongoing curation and development will now
happen on a commercially supported basis. I&amp;rsquo;m excited to continue
collaborating on research with Tarides from the University of
Cambridge.&amp;rdquo; Tarides will continue the work started at OCaml Labs and
invest in the growth, health, and development of OCaml alongside its
wider use-cases.&lt;/p&gt;
&lt;p&gt;I am honoured to have the incredible OCaml Labs team - the team who
carefully designed and crafted &lt;a href=&quot;https://discuss.ocaml.org/tag/multicore-monthly&quot;&gt;Multicore OCaml&lt;/a&gt; - join Tarides. We
share a similar view that a common plague affects the ever-growing
software industry, namely the bad quality of software and the
omnipresence of bugs. However, this is not a fatal flaw. Tools
developed by OCaml Labs over the years do not compromise on quality,
and they allow dev teams to automatically fix at least 70% of
&lt;a href=&quot;https://msrc-blog.microsoft.com/2019/07/18/we-need-a-safer-systems-programming-language/&quot;&gt;security
bugs&lt;/a&gt;
and &lt;a href=&quot;https://googleprojectzero.blogspot.com/p/0day.html&quot;&gt;0-days security
exploits&lt;/a&gt;. Consequently,
OCaml is a simple yet powerful language that can respond to the many
challenges developers face today. Since Tarides&amp;rsquo;s inception, we have
envisioned a future where all OCaml applications are easily deployable
as specialised, secure, and energy-efficient
&lt;a href=&quot;https://mirage.io&quot;&gt;MirageOS&lt;/a&gt; unikernels. This alliance is a step
further in that direction. Since OCaml is the language used to develop
MirageOS, Tarides has continuously developed and maintained parts of
the OCaml ecosystem since its creation. Our alliance with OCaml Labs
makes this more evident. The MirageOS ecosystem critically depends on
OCaml, and the OCaml ecosystem benefits from innovations coming from
the MirageOS project. Tarides is therefore fully committed to making
the synergy between OCaml and MirageOS a success.&lt;/p&gt;
&lt;p&gt;Several exciting projects related to Multicore OCaml are coming to a
head this year. The OCaml 5.0 release will support multicore and
effects handlers, influencing every aspect of the language and its
ecosystem. The update will significantly improve both performance and
user experience whilst maintaining existing features that make OCaml
the language of choice for building, for instance, verification
software tools. Using the teams&amp;rsquo; combined experience and zest for
innovation, Tarides is looking to the future of the OCaml language and
community with excitement. We will continue to push the boundaries of
exploration whilst focusing on what's good for the
community. &lt;strong&gt;Therefore, this alliance will complement the commercial
offering of Tarides and contribute to Tarides' mission: empowering
developers, communities and organisations to adopt OCaml as their
primary programming experience by providing training, expertise, and
development services around the OCaml language.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;We are thrilled to be part of an organisation innovating in many
areas around operating systems, distributed systems, and security with
the &lt;a href=&quot;https://irmin.org&quot;&gt;Irmin&lt;/a&gt; distributed store and the MirageOS
unikernel projects,&amp;rdquo; says Gemma Gordon, CEO of Tarides. &amp;ldquo;I am
incredibly proud of the people OCaml Labs has collaborated with. We
have been able to build a sustainable open-source community, with
people from various backgrounds all collaborating together. It used to
be that people would have to volunteer their time on OCaml, or work in
academic research. We have created an additional funded path, one that
has increased the diversity and innovation of our community. I&amp;rsquo;m
excited to continue to be part of a group that brings the best minds
together to solve the many problems the software industry faces
today. I look forward to building a flourishing and sustainable
commercial business with existing Tarides partners as well as
developing new collaborative opportunities.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;This alliance brings the headcount of Tarides up to 60+ people, all
working towards making OCaml the best language for any and every
project. Join our team: &lt;a href=&quot;https://tarides.com/company&quot;&gt;https://tarides.com/company&lt;/a&gt;&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#ocaml-labs&quot; aria-label=&quot;ocaml labs permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;OCaml Labs&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;OCaml Labs has been at the forefront of innovation in OCaml for
nearly a decade. It was founded at the University of Cambridge by
Prof. Anil Madhavapeddy in 2012 and developed into a spin-out
consultancy company in 2016. OCaml Labs' mission was to push OCaml and
functional programming forward as a platform, making it a more
effective tool for all users (including large-scale industrial
deployments) while at the same time growing the appeal of the language
to broaden its applicability and popularity.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;OCaml Labs has been instrumental in developing and maintaining the
OCaml platform for OCaml usage at an industrial scale. OCaml Labs
contributed to the development and maintenance of the
&lt;a href=&quot;https://opam.ocaml.org/&quot;&gt;opam&lt;/a&gt; package management
ecosystem and of the OCaml community website, &lt;a href=&quot;https://ocaml.org/&quot;&gt;https://ocaml.org/&lt;/a&gt;,
first launched in 2012. These sites act as hubs for the OCaml community
to showcase the state-of-the-art and facilitate innovation. A new and
improved version of the site has been &lt;a href=&quot;https://v3.ocaml.org/&quot;&gt;released under
beta&lt;/a&gt; this month. In addition, OCaml Labs' most
significant (and technically complex) project, OCaml Multicore, will
finally come to fruition this year. Work on this project began in
2014, followed by award-winning papers and presentations in 2020 and
the announcement in late 2021 that Multicore will become part of the
mainline OCaml compiler.&lt;/em&gt;&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#tarides&quot; aria-label=&quot;tarides permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Tarides&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;Tarides is a tech start-up founded in Paris in 2018 by pioneers of
programming languages and cloud computing. They develop a software
infrastructure platform to deploy secure, distributed applications
with strict resource constraints and low-latency performance
requirements. This platform builds upon innovative and open-source
projects such as MirageOS and Irmin and underpins mission-critical
deployments such as
&lt;a href=&quot;https://tarides.com/blog/2021-03-04-florence-and-beyond-the-future-of-tezos-storage&quot;&gt;Tezos&lt;/a&gt;,
Citrix XenServer, or &lt;a href=&quot;https://www.docker.com/blog/how-docker-desktop-networking-works-under-the-hood/&quot;&gt;Docker for
Desktop&lt;/a&gt;. In
addition, Tarides uses unikernel technologies and applies the research
done in programming languages to real-world systems to build safe and
performant applications.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Tarides has been part of the Founder program of Station F in 2018. In
addition, it got selected in France for the &lt;a href=&quot;https://tarides.com/blog/2019-07-05-i-lab-2019&quot;&gt;Concours d&amp;rsquo;Innovation
i-Lab&lt;/a&gt;, organised by
the French Ministry of Higher Education, Research and Innovation in
partnership with Bpifrance. This national contest awards company
creation and innovative technologies. Tarides got awarded during the
&lt;a href=&quot;https://tarides.com/blog/2019-12-11-tarides-wins-the-fic-2020-startup-award&quot;&gt;FIC
2020&lt;/a&gt;,
the leading European cybersecurity event.&lt;/em&gt;&lt;/p&gt;</content><id>https://tarides.com/blog/2022-01-27-ocaml-labs-joins-tarides</id><title type="text">OCaml Labs Joins Tarides</title><updated>2022-01-27T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2021-11-23--signals-and-threads-podcast-what-is-an-operating-system" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;November has become MirageOS month! Between the upcoming official MirageOS 4.0 release, making custom Christmas Tree garlands
with &lt;a href=&quot;https://tarides.com/blog/2021-11-11-mirageos-workshop-working-with-the-raspberry-pi-4&quot;&gt;MirageOS on a Raspberry Pi&lt;/a&gt;,
and now &lt;a href=&quot;https://signalsandthreads.com/what-is-an-operating-system&quot;&gt;this &amp;quot;What is an Operating System?&amp;quot; podcast&lt;/a&gt; (featuring Tarides advisor and core MirageOS maintainer Anil Madhavapeddy), it truly is MirageOS month!&lt;/p&gt;
&lt;p&gt;MirageOS can do much more than program a Raspberry Pi for Christmas decor. From
&lt;a href=&quot;https://tarides.com/blog/2021-11-18-tarides-hyper-partners-in-agricultural-innovation&quot;&gt;agricultural monitoring&lt;/a&gt; to
&lt;a href=&quot;https://tarides.com/blog/2021-06-29-tarides-introduces-osmose-at-the-open-source-innovation-sprint&quot;&gt;smart buildings&lt;/a&gt;, its
applications cover a wide range of needs. For example, it can also be used in critical pieces of infrastructure where security is of paramount importance, such as the &lt;a href=&quot;https://tarides.com/blog/2020-04-20-the-future-of-tezos-on-mirageos&quot;&gt;Tezos blockchain&lt;/a&gt;.
Combined with &lt;a href=&quot;https://irmin.org&quot;&gt;Irmin&lt;/a&gt;, it allows developers to build secure-by-design, offline-first systems and invert
the current cloud-centric model for designing applications to securely connect physical spaces with extremely low latency
and high bandwidth, using local-area computation capabilities.&lt;/p&gt;
&lt;p&gt;You can read the entire &lt;a href=&quot;https://signalsandthreads.com/what-is-an-operating-system/&quot;&gt;transcript here&lt;/a&gt; and find links to multiple places to listen through podcast apps.&lt;/p&gt;</content><id>https://tarides.com/blog/2021-11-23--signals-and-threads-podcast-what-is-an-operating-system</id><title type="text">'Signals and Threads' Podcast: What is an Operating System?</title><updated>2021-11-23T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2021-11-18-tarides-hyper-partners-in-agricultural-innovation" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;We are thrilled to announce a partnership between Tarides and &lt;a href=&quot;https://hyper.ag&quot;&gt;Hyper&lt;/a&gt;, a technology provider in the agritech space who&amp;rsquo;s building
an &amp;quot;operating system for high-performing farms.&amp;quot; Indoor and vertical farms are becoming tech businesses that require scalable,
flexible, and easy-to-use tools to facilitate data analysis and thereby increase productivity. According to the &lt;a href=&quot;https://www.eitfood.eu/blog/post/is-vertical-farming-really-sustainable&quot;&gt;State of Indoor
Farming 2020 Report&lt;/a&gt;, &amp;ldquo;40% of vertical and indoor farms are
implementing data analytics and control automation to increase yield and lower cost of production.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Hyper&amp;rsquo;s product offers a developer-friendly platform for modern farms to integrate analytics and automation without
worrying about hardware, scaling, or maintenance. There is a natural synergy between Hyper's product and Tarides&amp;rsquo;s mission
to bring robust and scalable functional systems to the industry. Both teams will be working on technology to help solve
some big problems the world faces.&lt;/p&gt;
&lt;p&gt;First, some context about how agriculture affects our environment:&lt;br/&gt;
&lt;strong&gt;The world&amp;rsquo;s population is growing, but the size of our planet is not.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Agriculture is currently responsible for:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;75% of the world&amp;rsquo;s deforestation&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;50% of the world&amp;rsquo;s habitable land&lt;/li&gt;
&lt;li&gt;70% of the world's freshwater withdrawals&lt;/li&gt;
&lt;li&gt;26% of the greenhouse gas emissions&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-2&quot; class=&quot;footnote-ref&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It&amp;rsquo;s an important time for indoor farming, as it&amp;rsquo;s already producing twenty times (20x) more yield per area while using 95% less water and
zero (0) pesticides. Plus, indoor farming will reduce the carbon footprint by cutting their food miles in half (50%)&lt;sup&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fn-3&quot; class=&quot;footnote-ref&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;. Vertical farming
complements traditional farming by growing fresh produce for cities in a sustainable way.&lt;/p&gt;
&lt;p&gt;Hyper's mission is to simplify the integration of sensors and controllers for data collection and automation. Their roadmap is
focused on implementing real-time computation of metrics for environmental data gathered from farms, prototyping computer vision models
for crop analysis, and automated crop traceability infrastructure. With their data platform, growers can optimise yield and reduce operating
costs by getting access to crop growth metrics and climate automation profiles without a dedicated engineering team.&lt;/p&gt;
&lt;p&gt;Hyper's founders are experienced engineers and OCaml hackers who have worked on IoT and data analytics products in the past in the retail,
biotech, and multimedia industries. Utilizing our MirageOS ecosystem, Hyper's sensor networks and cameras are continuously collecting
millions of data points across large-scale farming operations to ensure consistent crop quality, detect issues early, and automate climate
control. Since the technology is offline-first, it enables Hyper to collect this data securely, without the risk of breach or loss, as is
sometimes the case in cloud computing.&lt;/p&gt;
&lt;p&gt;As a technological partner, Tarides will help Hyper build a scalable IoT platform that leverages the OCaml ecosystem. Our support will
help Hyper bring the product to the market faster while also contributing to the open-source IoT ecosystem for MirageOS and related
projects. Hyper&amp;rsquo;s IoT platform will be fully open-source next year and will focus on implementing better support for MQTT, CoAP, and other protocols.&lt;/p&gt;
&lt;p&gt;A new version of MirageOS will be released in November, so this exciting announcement couldn't come at a better time! Hyper&amp;rsquo;s use of
the &lt;a href=&quot;https://mirage.io&quot;&gt;MirageOS&lt;/a&gt; ecosystem to build its data intelligence product is yet another real-world example that displays the
power and efficiency of MirageOS.&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s truly exciting technology because we&amp;rsquo;re at a point in history where even the most adamant climate change critics have begun to admit
the climate is indeed changing. There are things we can each do to contribute, so Tarides is proud to collaborate with a company that&amp;rsquo;s
actively seeking solutions to help reduce the amount of greenhouse gas emissions while increasing productivity.&lt;/p&gt;
&lt;p&gt;Hyper currently has production deployments in vertical and indoor farms in the UK and East Africa and is planning on scaling the
operations in the coming months.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#sources&quot; aria-label=&quot;sources permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;SOURCES&lt;/h4&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr/&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://ourworldindata.org/drivers-of-deforestation&quot;&gt;https://ourworldindata.org/drivers-of-deforestation&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ourworldindata.org/food-ghg-emissions&quot;&gt;https://ourworldindata.org/food-ghg-emissions&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-2&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ourworldindata.org/environmental-impacts-of-food&quot;&gt;https://ourworldindata.org/environmental-impacts-of-food&lt;/a&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fnref-3&quot; class=&quot;footnote-backref&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><id>https://tarides.com/blog/2021-11-18-tarides-hyper-partners-in-agricultural-innovation</id><title type="text">Tarides &amp; Hyper: Partners in Agricultural Innovation</title><updated>2021-11-18T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2021-11-11-mirageos-workshop-working-with-the-raspberry-pi-4" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Earlier this week, Romain Calascibetta hosted an in-house MirageOS workshop for employees, both locally and remotely
around the world. This interactive workshop taught participants how to build an operating system on a Raspberry
Pi 4 using MirageOS. They got to create their own OS and play with projects, like one they dubbed &lt;em&gt;GuirlandeOS&lt;/em&gt; for
which they programmed an LED garland to trim their Christmas tree, creating their own customized light show! There will
be a dedicated blog to &lt;em&gt;GuirlandeOS&lt;/em&gt; soon.&lt;/p&gt;
&lt;p&gt;That&amp;rsquo;s one fun example of what can be done with MirageOS and Raspberry Pi, but the possibilities are endless.
For example, one could use this dynamic pair to create solar-powered websites (something we&amp;rsquo;ll hear more about next week).&lt;/p&gt;
&lt;p&gt;The spirit of &lt;a href=&quot;https://mirage.io&quot;&gt;MirageOS&lt;/a&gt; is that anyone can integrate it, even if they don't work at Tarides. Although the
workshop was only for employees, MirageOS is for everyone! Since it's autonomous from Tarides, we encourage you
to play with MirageOS and see what you can create.&lt;/p&gt;
&lt;p&gt;Romain has opened the contents of his informative workshop to the world! Follow along with
&lt;a href=&quot;https://drive.google.com/file/d/1NeYA5pjN-4xjFWCpyYxkVSsn4ii9Nktp/view?usp=drivesdk&quot;&gt;his slides&lt;/a&gt;,
which will walk you through the MirageOS toolchain to create your very own projects. You can read more about the
Raspberry Pi process &lt;a href=&quot;https://github.com/mirage/mirage/pull/1253&quot;&gt;in this repo&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Early next week, we&amp;rsquo;ll continue with MirageOS month by showcasing a podcast where Anil Madhavapeddy
talks about those solar-powered websites and more!&lt;/p&gt;
&lt;p&gt;Happy hacking!&lt;/p&gt;</content><id>https://tarides.com/blog/2021-11-11-mirageos-workshop-working-with-the-raspberry-pi-4</id><title type="text">MirageOS Workshop: Working with the Raspberry Pi 4</title><updated>2021-11-11T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2021-11-09-mirageos-4-0-preview-live-presentation" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;The official release of MirageOS 4.0 quickly approaches! Learn about some general MirageOS concepts and get a
sneak park at the forthcoming changes in MirageOS 4.0 during a LIVE presentation today at 15h CET.&lt;/p&gt;
&lt;p&gt;Lucas Pluvinage will lead you through a live-streaming presentation to acquaint you with MirageOS 4.0. You&amp;rsquo;ll learn
what kinds of problems MirageOS can solve and about Functoria, the compilation model. Then Lucas will also discuss the switch
to the&amp;nbsp;Dune&amp;nbsp;build system and how that enables cross-compilation, not to mention the creation of new compilation targets,
such as the Raspberry Pi!&lt;/p&gt;
&lt;p&gt;Watch the live presentation today at 15h CET. Just go to: &lt;a href=&quot;https://meet.google.com/iqy-urht-rcn&quot;&gt;https://meet.google.com/iqy-urht-rcn&lt;/a&gt;, or dial &amp;#8234;(FR) +33 1 87 40 43 45&amp;#8236; with
the PIN: &amp;#8234;288 878 885&amp;#8236;#. You can also find other phone numbers here:&amp;nbsp;&lt;a href=&quot;https://tel.meet/iqy-urht-rcn?pin=3736259978366&quot;&gt;https://tel.meet/iqy-urht-rcn?pin=3736259978366&lt;/a&gt; if you're not in France.&lt;/p&gt;
&lt;p&gt;This presentation will be a great introduction to Romain Calascibetta's forthcoming MirageOS workshop tomorrow.
Check back on this blog and &lt;a href=&quot;https://twitter.com/tarides_&quot;&gt;follow us on Twitter&lt;/a&gt; to find out more about how to watch
and participate in this informative workshop tomorrow!&lt;/p&gt;
&lt;p&gt;Until then, check out Lucas' presentation today at 15h CET.&lt;/p&gt;</content><id>https://tarides.com/blog/2021-11-09-mirageos-4-0-preview-live-presentation</id><title type="text">MirageOS 4.0 Preview Live Presentation</title><updated>2021-11-09T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2021-10-14-scop-selected-for-dapsi-phase2" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;&lt;strong&gt;In April, &lt;a href=&quot;https://tarides.com/blog/2021-04-30-scop-selected-for-dapsi-initiative&quot;&gt;we announced&lt;/a&gt; that the &lt;a href=&quot;https://dapsi.ngi.eu&quot;&gt;DAPSI initiative&lt;/a&gt; accepted
the proposal for our Secure-by-Design Communication Protocols (SCoP) project. Today, we are thrilled to announce that SCoP has passed the initiative&amp;rsquo;s Phase 1,
and we are now on our way to Phase 2!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;SCoP is an open, secure, and resource-efficient infrastructure to engineer a modern basis for open messaging (for existing and emerging protocols)
using type-safe languages and unikernels&amp;mdash;to ensure your private information remains secure. After all, you wouldn&amp;rsquo;t like your postal carrier reading
your snail mail, so why should emails be any different?&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#challenges&quot; aria-label=&quot;challenges permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Challenges&lt;/h2&gt;
&lt;p&gt;To operate an email service requires many technical skills and reliable infrastructure. As a result, only a few large companies can handle emails with
the proper security levels.  Unfortunately, the core business model of these companies is to mine your personal data.&lt;/p&gt;
&lt;p&gt;The number of emails exchanged every day is expected to reach 333 billion in 2022. That&amp;rsquo;s a considerable amount of data, much of it private or sensitive,
sent across Cyberspace through portals with questionable security. The &amp;lsquo;memory unsafe&amp;rsquo; languages used in most communication services leave far too much room
for mistakes that have serious ramifications, like security flaws that turn into security breaches, leaving your personal or business information vulnerable to
malicious hackers.&lt;/p&gt;
&lt;p&gt;Due to this global challenge, we set out to build a simple, secure, easily deployable solution to preserve users' privacy, and we&amp;rsquo;re making great strides toward
accomplishing that goal. We base our systems on scientific foundations to last for decades and drive positive change for the world. Our robust understanding of
both theory and practice enables us to solve these security problems, so we explore ideas where research and engineering meet at the intersection of the domains
of operating systems, distributed systems, and programming languages.&lt;/p&gt;
&lt;p&gt;Every component of SCoP is carefully designed as independent libraries, using modern development techniques to avoid the common reported threats and flaws.
For instance, the implementation of protocol parsers and serializers are written in a type-safe language and tested using fuzzing. Combining these techniques
will increase users' trust to migrate their personal data to these new, more secure services.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#architecture&quot; aria-label=&quot;architecture permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Architecture&lt;/h2&gt;
&lt;p&gt;The architecture of the SCoP communication service is composed of an Email Service based on a secure extension of the SMTP protocol, and a decentralised
real-time communication system based on Matrix.&lt;/p&gt;
&lt;p&gt;The &lt;a href=&quot;https://github.com/dinosaure/ptt&quot;&gt;SMTP&lt;/a&gt; and &lt;a href=&quot;https://github.com/clecat/ocaml-matrix&quot;&gt;Matrix&lt;/a&gt; protocols implemented in SCoP follow the separation of
concerns design principle, meaning that the SMTP Sender and SMTP Receiver are designed as two distinct units. They&amp;rsquo;re implemented as isolated micro-services
which run as unikernels. The SMTP Sender, Receiver, and Matrix are all configurable, and each configuration comes with a security risk analysis report to
understand possible privacy risks&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#progress&quot; aria-label=&quot;progress permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Progress&lt;/h2&gt;
&lt;p&gt;Not only are we on our way to Phase 2 in the &lt;a href=&quot;https://dapsi.ngi.eu&quot;&gt;DAPSI Initiative&lt;/a&gt;, but we&amp;rsquo;re also proud to report that we&amp;rsquo;re on track with our
planned milestones!&lt;/p&gt;
&lt;p&gt;Our &lt;strong&gt;first milestone&lt;/strong&gt; was to generate a corpus of emails to test our parser implementation against existing projects in order to detect differences
between the descriptions specified in the RFCs. We now have 1 million emails that have been parsed/encoded without any issues! Our email corpus keeps
isomorphism between the encoder and decoder, and you can find it in this &lt;a href=&quot;https://github.com/mirage/hamlet&quot;&gt;GitHub Repo&lt;/a&gt;, as we encourage implementors of other languages to use it to improve
their trust in their own implementation.&lt;/p&gt;
&lt;p&gt;We set out to implement an SMTP extension mechanism and support for SPF as well as implement DMARC, a security framework, on top of DKIM and SPF for our
&lt;strong&gt;second milestone&lt;/strong&gt;, and we are right on target. To date, we&amp;rsquo;ve completed four components:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/dinosaure/ocaml-spf&quot;&gt;SPF&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/dinosaure/ocaml-dkim&quot;&gt;DKIM&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/dinosaure/ptt&quot;&gt;SMTP&lt;/a&gt; can send and verify emails&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://tarides.com/blog/2019-09-25-mr-mime-parse-and-generate-emails&quot;&gt;MrMIME&lt;/a&gt; can generate the email, then SMTP sends the email (signed by a DKIM private key). We can correctly sign an email, generate a signature, and the DKIM field containing the signature. When the email is received, we check the DKIM signature and the SPF metadata.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For our &lt;strong&gt;third milestone&lt;/strong&gt;, we set out to implement DNSSEC, a set of security extensions over DNS. This security layer verifies the identity of an email sender
through DKIM/SPF/DMARC, but it also needs security extensions in the DNS protocol. We completed our initial investigation of a DNSSEC implementation prototype,
and we discovered several issues, like some of the elliptic curve cryptography was missing. Those necessary cryptographic primitives are now available, so we
should complete this milestone by the end of the month.&lt;/p&gt;
&lt;p&gt;Finally, our &lt;strong&gt;fourth milestone&lt;/strong&gt; was to implement the Matrix protocol (client and server). We completed the protocol&amp;rsquo;s client library, which sends a notification
from OCaml CI. Plus, we have a PoC, and Matrix&amp;rsquo;s server-side, which received the notification, is also complete.&lt;/p&gt;
&lt;p&gt;Although we still have much work ahead of us, we&amp;rsquo;re quite pleased with the progress thus far, and so is the DAPSI Initiative! Follow our progress by &lt;a href=&quot;https://tarides.com/feed.xml&quot;&gt;subscribing
to this blog&lt;/a&gt; and our &lt;a href=&quot;https://twitter.com/tarides_&quot;&gt;Twitter feed (@tarides_)&lt;/a&gt; for the latest updates.&lt;/p&gt;
&lt;br/&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/50ddca27efa367497d954f667fc921f8/a76d6/DAPSI_generic.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 3.5294117647058822%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAABABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAIDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAHSsFSCf//EABYQAQEBAAAAAAAAAAAAAAAAAAMQM//aAAgBAQABBQIc0n//xAAWEQADAAAAAAAAAAAAAAAAAAACEDH/2gAIAQMBAT8BCr//xAAWEQADAAAAAAAAAAAAAAAAAAABEDH/2gAIAQIBAT8BNX//xAAXEAADAQAAAAAAAAAAAAAAAAAAAhCB/9oACAEBAAY/AlNn/8QAGBAAAgMAAAAAAAAAAAAAAAAAALEQMYH/2gAIAQEAAT8hcZXMf//aAAwDAQACAAMAAAAQiA//xAAWEQEBAQAAAAAAAAAAAAAAAAAAATH/2gAIAQMBAT8QyR//xAAVEQEBAAAAAAAAAAAAAAAAAAAQMf/aAAgBAgEBPxCx/8QAGxAAAgEFAAAAAAAAAAAAAAAAAAEhMUGhsfD/2gAIAQEAAT8QzNhT4lFkf//Z'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/50ddca27efa367497d954f667fc921f8/7bf67/DAPSI_generic.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Sequence of entity logos: in association with NGI, EU, Zabala, FGS,
cap-digital, IMT Starter, Fraunhofer IAIS.&quot; title=&quot;&quot; srcset=&quot;/static/50ddca27efa367497d954f667fc921f8/651be/DAPSI_generic.jpg 170w,
/static/50ddca27efa367497d954f667fc921f8/d30a3/DAPSI_generic.jpg 340w,
/static/50ddca27efa367497d954f667fc921f8/7bf67/DAPSI_generic.jpg 680w,
/static/50ddca27efa367497d954f667fc921f8/990cb/DAPSI_generic.jpg 1020w,
/static/50ddca27efa367497d954f667fc921f8/a76d6/DAPSI_generic.jpg 1139w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;</content><id>https://tarides.com/blog/2021-10-14-scop-selected-for-dapsi-phase2</id><title type="text">SCoP Passed Phase 1 of the DAPSI Initiative!</title><updated>2021-10-14T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2021-10-04-the-new-replaying-benchmark-in-irmin" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;As mentioned in our &lt;a href=&quot;https://forum.tezosagora.org/t/tezos-storage-irmin-summer-2021-update/3744&quot;&gt;Tezos Storage / Irmin Summer 2021 Update&lt;/a&gt; on the Tezos Agora forum, the Irmin team's goal has been to improve Irmin's performance in order to speed up the &lt;em&gt;Baking Account&lt;/em&gt; migration process in Octez, and we managed to make it 10x faster in the first quarter of 2021. Since then, we've been working on a new benchmark program for Irmin that's based on the interactions between Irmin and Octez. This won't just help make Irmin even faster, it will also help speed up the Tezos blockchain process and enable us to monitor Irmin's behavior in Octez.&lt;/p&gt;
&lt;p&gt;Octez is the &lt;a href=&quot;https://gitlab.com/tezos/tezos&quot;&gt;Tezos node implementation&lt;/a&gt; that uses Irmin to store the blockchain state, so Irmin is a core component of Octez that's responsible for virtually all the filesystem operations. Whether a node is launched to produce new blocks (aka &amp;ldquo;bake&amp;rdquo;) or just to participate in peer-to-peer sharing of existing blocks, it must first update itself by rebuilding blocks individually until it reaches the head of the blockchain. This first phase is called &lt;em&gt;bootstrapping&lt;/em&gt;, and once it reaches the blockchain head, we say it has been &lt;em&gt;bootstrapped&lt;/em&gt;. Currently, the &lt;em&gt;bootstrapped&lt;/em&gt; phase processes 2 block per minute, which is the rate at which the Tezos blockchain progresses. The next goal is to increase that rate to 12 blocks per minute.&lt;/p&gt;
&lt;p&gt;Irmin stores the content of the Tezos blockchain on a disk using the &lt;code&gt;irmin-pack&lt;/code&gt; library. There is one-to-one correspondence between the Tezos block and the Irmin commits. Each time Tezos produces a block, Irmin produces a commit, and then the Tezos block hash is computed using the Irmin commit hash. The Irmin developers are working on improving the &lt;code&gt;irmin-pack&lt;/code&gt; performance which in turn will improve the performance of Octez.&lt;/p&gt;
&lt;p&gt;A benchmark program is considered &amp;ldquo;fair&amp;rdquo; when it's representative of how the benchmarked code is used in the real world&amp;mdash;for example, the access-patterns to Irmin. A standard database benchmark would first insert random data and then remove it. Such a synthetic benchmark would fail to reproduce the bottlenecks that occur when the insertions and removal are interleaved. Our solution to &amp;ldquo;fairness&amp;rdquo; is radical: &lt;em&gt;replaying&lt;/em&gt;. Within a sandboxed environment, we &lt;em&gt;replay&lt;/em&gt; a real world situation.&lt;/p&gt;
&lt;p&gt;Basically, our new benchmark program makes use of a benchmarked code and records statistics for later analysis. The program is stored in the &lt;code&gt;irmin-bench&lt;/code&gt; library and makes use of operation traces (called &lt;em&gt;action traces&lt;/em&gt;) when Octez runs with Irmin. Later, the program replays the recorded operations one at a time while simultaneously recording tonnes of statistics (called stat traces). Data analysis of the stat traces may reveal many interesting facts about the behaviour of Irmin, especially if we tweak:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the configuration of Irmin (e.g., what&amp;rsquo;s the impact of doubling the size of a certain cache?)&lt;/li&gt;
&lt;li&gt;the replay parameters (e.g., does Irmin's performance decay over time? Does &lt;code&gt;irmin-pack&lt;/code&gt; perform as well after 24 hours of replay as after 1 minute of replay?)&lt;/li&gt;
&lt;li&gt;the hardware (e.g., does &lt;code&gt;irmin-pack&lt;/code&gt; perform well on a Raspberry Pi?)&lt;/li&gt;
&lt;li&gt;the code of Irmin (e.g., does this PR have an impact on performance?)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This benchmarking process is similar to the record-replay feature available with &lt;a href=&quot;https://docs.tezedge.com/tezedge/record-replay&quot;&gt;TezEdge&lt;/a&gt;.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#recording-the-action-trace&quot; aria-label=&quot;recording the action trace permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Recording the Action Trace&lt;/h3&gt;
&lt;p&gt;By adding logs to Tezos, we can record the Tezos-Irmin interactions and thus capture the Irmin &amp;ldquo;view&amp;rdquo; of Tezos. We&amp;rsquo;ve recorded &lt;em&gt;action traces&lt;/em&gt; during the &lt;em&gt;bootstrapping&lt;/em&gt; phase of Tezos nodes, which started from &lt;em&gt;Genesis&lt;/em&gt;&amp;mdash;the name of the very first Tezos block inserted into an empty Irmin store.&lt;/p&gt;
&lt;p&gt;The interaction surface between Irmin and Octez is quite simple, so we were able to reduce it to eight (8) elementary operations:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;checkout&lt;/code&gt;, to pull an Irmin tree from disk;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;find&lt;/code&gt;, &lt;code&gt;mem&lt;/code&gt; and &lt;code&gt;mem_tree&lt;/code&gt;, read only operations on an Irmin tree;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;add&lt;/code&gt;, &lt;code&gt;remove&lt;/code&gt; and &lt;code&gt;copy&lt;/code&gt;, write only operations on an Irmin tree;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;commit&lt;/code&gt;, to push an Irmin tree to disk.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It&amp;rsquo;s important to remember that Irmin behaves much like Git. It has built-in snapshotting and is compatible with Git itself when using the &lt;code&gt;irmin-git&lt;/code&gt; library. In fact, these operations are very similar to Git, too.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#sequence-of-operations&quot; aria-label=&quot;sequence of operations permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Sequence of Operations&lt;/h3&gt;
&lt;p&gt;To illustrate further, here's a concrete example of an operation sequence inside an action trace:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/d133a7455102c1b17e30fae407e04c78/7131f/ygWh3cg.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 48.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABUElEQVR42p2S246DMAxE+f9f7FOhlJCbAyUhNzorp6uq25furiVrHAWdjG26SVpITRCKcJkUyDlYaxFjBMf9fv+hn6JT2sJYB20IQswgogZ0zkFrDSll05TS74DX2YBdssPhKqGNaQBjDJRSTXPOLUspH51253OP4TLiMo449wPGcQRZwtAPEEKg73ucTqfmlN3zKBh6HAdqra1+faSTysLQAqUJ5G7Q1kAaAalmKPuArOuKbdua8ii4vt1u7Y6VnT+B46QwzQoMFrOC8xYmCISyIdX9+eGrk/f6bYYW4nvTo9AwRMgl47/RbT5gjwmsIUaEsGMPO0IIrTVOPnvvse8P5Y1zq8EHpBKxF496r63uLpOGMgt425rW9guZmbDYFc4s8FtATrlBOPkhXgaDeUG5JOQaG7AcGZ1zK7wPILc0l8uyIIaEHApqrqj5+FPLXwLCB+BdtA6oAAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/d133a7455102c1b17e30fae407e04c78/c5bb3/ygWh3cg.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;ygWh3cg&quot; title=&quot;&quot; srcset=&quot;/static/d133a7455102c1b17e30fae407e04c78/04472/ygWh3cg.png 170w,
/static/d133a7455102c1b17e30fae407e04c78/9f933/ygWh3cg.png 340w,
/static/d133a7455102c1b17e30fae407e04c78/c5bb3/ygWh3cg.png 680w,
/static/d133a7455102c1b17e30fae407e04c78/7131f/ygWh3cg.png 710w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This shows Octez&amp;rsquo;s first interaction with Irmin at the very beginning of the blockchain! The first block, &lt;em&gt;Genesis&lt;/em&gt;, is quite small (it ends at operation #5), but the second one is massive (it ends at operation #309273). It contains no transactions because it only sets up the entire structure of the tree. It precedes the beginning of Tezos' initial protocol called &amp;ldquo;Alpha I&amp;rdquo;.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#benchmark-benefits&quot; aria-label=&quot;benchmark benefits permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Benchmark Benefits&lt;/h3&gt;
&lt;p&gt;Our benchmark results convey the sheer magnitude of the Tezos blockchain and the role that Irmin plays within it. We&amp;rsquo;ve recorded a trace that covers the blocks from the beginning the blockchain in June 2018 all the way up to May 2021. It weighs &lt;strong&gt;96GB&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Although it took &lt;strong&gt;34 months&lt;/strong&gt; for Tezos to reach that state, bootstrapping so far takes only &lt;strong&gt;170 hours&lt;/strong&gt;, and replaying it takes a mere &lt;strong&gt;37 hours&lt;/strong&gt; on a section of the blockchain that contains &lt;strong&gt;1,343,486 blocks&lt;/strong&gt;. On average, this corresponds to &lt;strong&gt;1 per minute&lt;/strong&gt; when the blocks were created, &lt;strong&gt;132 per minute&lt;/strong&gt; when bootstrapping, and &lt;strong&gt;611 per minute&lt;/strong&gt; during replay.&lt;/p&gt;
&lt;p&gt;On this particular section of the blockchain, Octez had &lt;strong&gt;1,089,853,521 interactions&lt;/strong&gt; with Irmin. On average, this corresponds to &lt;strong&gt;12 per second&lt;/strong&gt; when the blocks were created, &lt;strong&gt;1782 per second&lt;/strong&gt; during bootstrapping, and &lt;strong&gt;8258 per second&lt;/strong&gt; during replay.&lt;/p&gt;
&lt;p&gt;The chart below demonstrates how many of each Irmin operation occur per block (on average):&lt;/p&gt;
&lt;center&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/c87031f583955f306e8c64611c474c01/0b533/4yKd8iQ.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAACOElEQVR42q2Uz0/TYBjHy8HEg2f/Ds+evPlPGGLiycSLiRdPHkjwByEDTdQYjQeDkoBcCBc9gMHEEHVCHCAZW7sNV1jX9V3LurZ7249Z2YAxBsPwJE/apM/zeZ/v0+d9FE6xKIpi79eUfgObTD+MYg9POEDpmQ2UnRqaqqLregek+Rr9T4V6dZdyuRwT7EDyIidIqBaGL/fAJwFlGMXeVWzreeOXjvIxhTK1wvWlQtf3DuBhOUelNa3iSy5/2mTg7TwX3nzm0twGfxyvFd+jwqWC4Itq0TgUISMQQiCsCtcWsyiTSZTJn1xZUHFbcXE/D01CDJxYLjJwdwblzhSPFjL745KvS9azKrZZJut43E6VuLmyTcrxOxR0VTj4bhll8BXKrddcTXztkC6lJAzDrlmsyYikHVAUVUzDoGQYuK67B5xd3+Hi/TmUe7O8XMrHCW3pruuxurZG1XEIgSAMaQQB+q7L9E6NVHGHgqpStW183z/o4YZR4/e20yUjkBLPdWN9zWHRyhaZdJqtv1s49fp+ezokR8f82XQtYFp3eF+0+SY8gmbjAbvu4bVApw52yAHscdbkiWYxmq8ytGkyV9rt634rxw3xjO4woglGVgsM/dhgPFdlXLOoBL1vyInAD0WbUU0wnEzzYHGFsaxJQrPY9hpnBLYiv4s6wxmTMU3wNCd4mKkwUbT3W3Lm9SWjiHmzxvO84FnOYlJ3MPqQ2xPYThKNkJIvaZzHgg2PHBCdx8Y+C6gN/AdwOvk4iuviYwAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/c87031f583955f306e8c64611c474c01/0b533/4yKd8iQ.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;4yKd8iQ&quot; title=&quot;&quot; srcset=&quot;/static/c87031f583955f306e8c64611c474c01/04472/4yKd8iQ.png 170w,
/static/c87031f583955f306e8c64611c474c01/9f933/4yKd8iQ.png 340w,
/static/c87031f583955f306e8c64611c474c01/0b533/4yKd8iQ.png 500w&quot; sizes=&quot;(max-width: 500px) 100vw, 500px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;/center&gt;
&lt;p&gt;This next chart displays where the time is spent during replay:&lt;/p&gt;
&lt;center&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/85cffd35d784692988f8aa1f04e9180a/78797/u5Fv2Zb.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+0lEQVR42m2S3UuTURzHTzOCoIjoIor+gYKEgijzKgqEbqMuuiq8DkbgRV0UBE0kI3GJXgw0CvKikiJoCQ5xa26SaKwXnRbMVuGm5V6e9/M8n9jjszfrB+dwXr7nw+/3O1+BFw5gA6ZpIqV01/+Lis6SNoqiuDrHAacyeSFqQu9MUTVMy2o6a4S5w3FYXc1h6AaaqlIuK3Vg9Y0ubQKzWU69+Mi5V58Z+7peg0A9i/yGyvWHEU50PuLayw/M/y5AJdMq0PaE/ngG0TtFS38McX8KEUzyOlty7yy7nur5rmeII7fY0d5D65MErZNpoj/WQJouVJiaxvLPHPv6I4hgDN9QguOjc1wYDnMjGGJ5caEGS6RW8J2+i6+9m72XQxyOZmgZmyOQWnF/wLDkZg+zRZVdg3HEQBzfYJLO8U+8mZjgwb0e4tPTWJZ0geHYF7a13UG0BTh0dYSOt0vsH4zQnVygtJanUCwiqo2/GE67JW8fiCP63nHw8TyJ73m0YgFTbgI1Q3LsyjDi6G12d/TRNbnIyVCUpzNLGKUNdMOsA38pJpfG0+wJzXBg5D03ExkM6VAulcjl8uiG4epS3/Kc9Y+y80wv/uezpDUNXdOxPGf8Y5s/ukXZanahbdvuoOHH1wsquikxdQ3bq6AZ2GARF9JgQmfLumm/xfh/AdfyvSRRvmoCAAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/85cffd35d784692988f8aa1f04e9180a/c5bb3/u5Fv2Zb.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;u5Fv2Zb&quot; title=&quot;&quot; srcset=&quot;/static/85cffd35d784692988f8aa1f04e9180a/04472/u5Fv2Zb.png 170w,
/static/85cffd35d784692988f8aa1f04e9180a/9f933/u5Fv2Zb.png 340w,
/static/85cffd35d784692988f8aa1f04e9180a/c5bb3/u5Fv2Zb.png 680w,
/static/85cffd35d784692988f8aa1f04e9180a/b12f7/u5Fv2Zb.png 1020w,
/static/85cffd35d784692988f8aa1f04e9180a/78797/u5Fv2Zb.png 1125w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;/center&gt;
&lt;p&gt;With &lt;code&gt;irmin-pack&lt;/code&gt;, an OCaml thread managed by the &lt;a href=&quot;https://github.com/mirage/index/&quot;&gt;&lt;code&gt;index&lt;/code&gt; library&lt;/a&gt; is running concurrently to the main thread (i.e., the &lt;em&gt;merge&lt;/em&gt; thread), a fraction of the durations (shown above) are actually spent in that thread. Refer to this &lt;a href=&quot;https://tarides.com/blog/2020-09-01-introducing-irmin-pack&quot;&gt;blog post&lt;/a&gt; for more details on &lt;code&gt;index&lt;/code&gt;'s &lt;em&gt;merges&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;The following chart illustrates how memory usage evolves during replay:&lt;/p&gt;
&lt;center&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/fda8364be92a0ed94a1228298ea88b68/20c85/F0bORTg.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABPklEQVR42lVR2ZKDMAzj/z+yQ4G2U66E3Ld2bBZm98EjJbFlW+kAwDmHWWmsxt74ly/a3HhxftcGX22wKY1hGLDvOzprLZZlQUoZpQGRsDaOi6dckEu98X7PBSEXxJSglMJxHOhSSkxKyQDaia1xlHzyWgpaq6j1RMqj+1bprv6+N96001pjnmfknDn5Er7F0ViICksp/0R9SFDGw1gPIQSklOhijHy4BLX10C5C24hDOxgXIZXDIgy+u2ZcpWWchYHUnmu2bWOdjsZc1pUTduXPBBehSJC6+8SipVZkmrCduB8On88H/eOBcRgwjuPpIf3ytgvIQ4P8pE/KKXF475DzibQJNQ8hIIQIGwLe7zfGccLr9WJujEFH3kzTxD7SyH3/hHMe67pyVyEk+ueTV6JCChInPymH6gi99+zzDyuFal8TivU4AAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/fda8364be92a0ed94a1228298ea88b68/c5bb3/F0bORTg.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;F0bORTg&quot; title=&quot;&quot; srcset=&quot;/static/fda8364be92a0ed94a1228298ea88b68/04472/F0bORTg.png 170w,
/static/fda8364be92a0ed94a1228298ea88b68/9f933/F0bORTg.png 340w,
/static/fda8364be92a0ed94a1228298ea88b68/c5bb3/F0bORTg.png 680w,
/static/fda8364be92a0ed94a1228298ea88b68/20c85/F0bORTg.png 999w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;/center&gt;
&lt;p&gt;On a logarithmic scale, this last chart shows the evolution of the &lt;em&gt;write amplification&lt;/em&gt;, which indicates the amount of rewriting (e.g., at the end of the replay, 20TB of data have been written to disk in order to create a store that weighs 73GB).&lt;/p&gt;
&lt;center&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/865f6695d4f8132e84cadef0cd099f38/20c85/PhNqloN.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoElEQVR42l2SiY7iMBBE8//fyAADTMhB7CSObzs1qs6CRmvJ8iH36+5yNQAQQoDSGnqe0fc9hmGAUgrbtsFaC2ctvHOyOmexGgu9GMyrwag0brebvMs5o0kpYSBkMVDG4vz1hev3N4IPqLWi7jt8KggF0C5iCRkmFqwhYw0FajFof34wTRPWdUXDCud5hjEG+74jxYicEmKumGyAcgnKBmypIOaMXCpDUEtBDB4xRqmOK0fDKrTW0h4HAyYbMfsMn5IkqbUckFrlzNa89yilHEWkhHEcsSwLGoK6vpcsO4DBBIT0FwDEUsAbFyI27+EILFWmcV40ZALCG2Yj3W4bFl/gYkauFaHusLkca4zYBBYQqask21G4r1VgHyDL1kpBLSuUzwilymS11IWTLvjbMschRf20/Hq95B8aXozDgF4t0Im5D404CXsH/g98vyHMOfdJ2rx/7N4NaF8Ks1biRz5iRmpLsXmmLbjnJ16vV1wuF5xOJ5zPZ3GKtEwg237c76Jl27ZSPoMfjwe6rhPRaXZCaHgGEvB8PsV/7CT9c8Qv74AHIrmjuNoAAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/865f6695d4f8132e84cadef0cd099f38/c5bb3/PhNqloN.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;PhNqloN&quot; title=&quot;&quot; srcset=&quot;/static/865f6695d4f8132e84cadef0cd099f38/04472/PhNqloN.png 170w,
/static/865f6695d4f8132e84cadef0cd099f38/9f933/PhNqloN.png 340w,
/static/865f6695d4f8132e84cadef0cd099f38/c5bb3/PhNqloN.png 680w,
/static/865f6695d4f8132e84cadef0cd099f38/20c85/PhNqloN.png 999w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;/center&gt;
&lt;p&gt;The &lt;em&gt;merge&lt;/em&gt; operations of the &lt;code&gt;index&lt;/code&gt; library are the source of this poor &lt;em&gt;write amplification&lt;/em&gt;. The Irmin team is working hard on improving this metric:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;on the one hand, the new &lt;em&gt;structured keys&lt;/em&gt; feature of the upcoming Irmin 3.0 release will help to reduce the pressure on the &lt;code&gt;index&lt;/code&gt; library,&lt;/li&gt;
&lt;li&gt;on the other hand, we are working on algorithmic improvements of &lt;code&gt;index&lt;/code&gt; itself.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Another nice way to use the trace is for testing. When replaying a trace, we can recompute the commit hashes and check that they correspond to the trace hashes, so the benchmark acts as additional tests to ensure we don't compromise the hashes computed in Tezos.&lt;/p&gt;
&lt;p&gt;Complex changes to Tezos can be simulated first in Irmin. For example, the &lt;a href=&quot;https://gitlab.com/tezos/tezos/-/merge_requests/2771&quot;&gt;path flattening in Tezos&lt;/a&gt; feature (merged in August 2021) can now be tested earlier in the process with our benchmark. Prior to the trace benchmarks, we first had to make the changes in Tezos to understand their repercussions on Irmin directly from the Tezos benchmarks.&lt;/p&gt;
&lt;p&gt;Lastly, we continue to test alternative libraries and compare them with the ones integrated in Tezos; however, using these alternative libraries to build Tezos nodes has proven to be more complicated than merely adding them in Irmin and running our benchmarks. While testing continues on most new libraries, we can definitely use replays to compare our &lt;a href=&quot;https://github.com/mirage/cactus/&quot;&gt;new &lt;code&gt;cactus&lt;/code&gt; library&lt;/a&gt; as a replacement for our &lt;a href=&quot;https://github.com/mirage/index/&quot;&gt;&lt;code&gt;index&lt;/code&gt; library&lt;/a&gt;.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#future-directions&quot; aria-label=&quot;future directions permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Future Directions&lt;/h3&gt;
&lt;p&gt;While the &lt;em&gt;action trace&lt;/em&gt; recording was only made possible on a development branch of Octez, we would next like to upstream the feature to the main branch of Octez, which would give all users the option to record Tezos-Irmin interactions. This would simplify bug reporting overall.&lt;/p&gt;
&lt;p&gt;Although the first version only deals with the &lt;em&gt;bootstapping&lt;/em&gt; phase of Tezos, an upcoming goal is to make it possible to benchmark the &lt;em&gt;boostrapped&lt;/em&gt; phase of Tezos as well. Additionally, we plan to replay the multiprocess aspects of a Tezos node in the near future.&lt;/p&gt;
&lt;p&gt;The first stable version of this benchmark has existed in Irmin&amp;rsquo;s development branch since Q2 2021, and we will release it as part of &lt;code&gt;irmin-bench&lt;/code&gt; for Irmin 3.0 in Q4 2021. This release will allow integration into the &lt;a href=&quot;https://github.com/ocaml-bench/sandmark&quot;&gt;Sandmark OCaml&lt;/a&gt; benchmarking suite.&lt;/p&gt;
&lt;p&gt;Follow the Tarides blog for future Irmin updates.&lt;/p&gt;</content><id>https://tarides.com/blog/2021-10-04-the-new-replaying-benchmark-in-irmin</id><title type="text">The New Replaying Benchmark in Irmin</title><updated>2021-10-04T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://marigold.dev/blog/announcing-hangzhou/" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;The last upgrade of the Tezos protocol, Granada, activated on August 6th, 2021.
We are now glad to announce a new protocol proposal, Hangzhou, the result of a
collaborative work from various teams.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This is a joint post with &lt;a href=&quot;https://www.nomadic-labs.com/&quot;&gt;Nomadic Labs&lt;/a&gt;,
&lt;a href=&quot;https://marigold.dev/&quot;&gt;Marigold&lt;/a&gt;, &lt;a href=&quot;https://www.oxheadalpha.com/&quot;&gt;Oxhead Alpha&lt;/a&gt;
and &lt;a href=&quot;https://www.dailambda.jp/&quot;&gt;DaiLambda&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;</content><id>https://marigold.dev/blog/announcing-hangzhou/</id><title type="text">Announcing Tezos 8th protocol upgrade proposal: Hangzhou</title><updated>2021-09-21T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2021-09-06-tarides-returns-to-fic-2021" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Last year, Tarides had the honour of winning the &amp;ldquo;Coup de Coeur&amp;rdquo; Startup Award
at the International Cybersecurity Forum (FIC). It&amp;rsquo;s the leading cybersecurity
event in the EU. It&amp;rsquo;s both a forum, to present and discuss innovations and
reflect on the state of the European cybersecurity ecosystem, and a trade fair,
where cybersecurity and other tech professionals can meet and network.&lt;/p&gt;
&lt;p&gt;This year, Tarides returns to FIC with their own booth! Our representatives,
including founder and CEO of Tarides, Thomas Gazagnaire, look forward to making
new connections, looking for collaborators, and catching up with colleagues.&lt;/p&gt;
&lt;p&gt;The FIC theme for 2021 centres on encouraging &amp;ldquo;a collective and collaborative
cybersecurity.&amp;rdquo; From the &lt;a href=&quot;https://www.forum-fic.com/en/home/discover/what-is-the-fic.htm&quot;&gt;FIC
Website&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;rdquo;Collective, because each stakeholder is responsible not only for its own
security but also for the security of every other stakeholder, and therefore of
the whole. Collaborative, because cooperation and information sharing are
essential to compensate the asymmetry between the &amp;laquo;attacker&amp;raquo; and the
&amp;laquo;defender&amp;raquo;&amp;hellip;FIC 2021 will focus on the major operational, industrial,
technological, and strategic challenges of cooperation&amp;rdquo;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Solutions for most cybersecurity issues already exist, and we at Tarides are
happy to consult on our many solutions that can make your systems more secure.
From secure emails to runtime protection to secure IoT protocols, our
representatives can help!&lt;/p&gt;
&lt;p&gt;So stop by the Tarides booth at FIC to chat about your options. We&amp;rsquo;ll have
snacks and other goodies, too!&lt;/p&gt;</content><id>https://tarides.com/blog/2021-09-06-tarides-returns-to-fic-2021</id><title type="text">Tarides Returns to FIC 2021</title><updated>2021-09-06T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2021-08-26-benchmarking-ocaml-projects-with-current-bench" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Regular CI systems are optimised for workloads that do not require stable performance over time. This makes them unsuitable for running performance benchmarks.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ocurrent/current-bench&quot;&gt;&lt;code&gt;current-bench&lt;/code&gt;&lt;/a&gt; provides a predictable environment for performance benchmarks and a UI for analysing results over time. Similar to a CI system, it runs on pull requests and branches which allows performance to be analysed and compared.  It can currently be enabled as an app on GitHub repositories with zero configuration. Several public repositories are running&lt;code&gt;current-bench&lt;/code&gt;, including &lt;a href=&quot;https://github.com/mirage/irmin&quot;&gt;Irmin&lt;/a&gt; and &lt;a href=&quot;https://github.com/ocaml/dune&quot;&gt;Dune&lt;/a&gt;. We plan to enable it on more projects in the future.&lt;/p&gt;
&lt;p&gt;In this article, we give a technical overview of &lt;code&gt;current-bench&lt;/code&gt;, showing how results are collected and analysed, requirements for using it and how we built the infrastructure for stable benchmarks. We also describe future work that would allow more OCaml projects to run &lt;code&gt;current-bench&lt;/code&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#introduction&quot; aria-label=&quot;introduction permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Introduction&lt;/h2&gt;
&lt;p&gt;For performance critical software, we must run benchmarks to ensure that there's no regression. Running benchmarks before the user submits their pull request is tedious, and since every user might have a different machine, you can't be sure if the benchmarks performed actually improved or regressed performance.&lt;/p&gt;
&lt;p&gt;Our &lt;code&gt;current-bench&lt;/code&gt; aims to solve this problem by providing a stable benchmarking platform that runs every time the user submits a pull request and compares the result to the benchmarks on the main branch. As &lt;code&gt;current-bench&lt;/code&gt; is zero-configuration, users can enroll their repository to run benchmarks with ease. This &lt;code&gt;current-bench&lt;/code&gt; has helped projects ensure that regression doesn't happen, so you can merge code with more confidence.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#architecture&quot; aria-label=&quot;architecture permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Architecture&lt;/h2&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/2924487e1eab06d8ffdb4bc2e3cdbbd1/37523/current-bench-arch.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABm0lEQVR42sWSzStEYRTGf66Z6874mMbXSLPSCNkoMhZyIyPjo0aZMEoZM0UZFhbsRkqWUgoxRZSIha0FpVjg37GwcfXqTF2U8bFw6nQ+et/nfZ5zXvhsOmAADn5jsa6NzqH2jd5IcD0cC2136LpeBwSBcsApD+iS57aZyIm1PHP5sjp/ZaWGz5+CNWO1gAv8LgFtBPxAAaDlBIz3Z25TI8f387HTx8TgwXVVWV0L0ACFPsAD1ANVApiXEzAajeaD6YBmp2VZecJKyXbLERV932KXw7JsKkS2/lcgh2y7FCixLcYttVtqdaZI6i8fzQeqZeNqhoXiPumVAcUSm2RMrncIaobpdFpTMRAIFHi9Xo8AeISJIUy8tlx5pcze+I58u9t7mi03RJEw4227TIR3E8nBw6PpyNF2vG9/fzS0qaRhmuoXvF0wZG6azbOA2jupKs5GLs5Wkg/WWurueWn8xor3HyRVv80fdcmlVqBZ/qRuc+PDHxWGoZ2eeO/e4tRAZm4ynFkY696qtSsQdk7+zdSGTTPtyHp2FD+xVxMqWejaiiYDAAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/2924487e1eab06d8ffdb4bc2e3cdbbd1/c5bb3/current-bench-arch.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Figure 1: Current bench architecture&quot; title=&quot;&quot; srcset=&quot;/static/2924487e1eab06d8ffdb4bc2e3cdbbd1/04472/current-bench-arch.png 170w,
/static/2924487e1eab06d8ffdb4bc2e3cdbbd1/9f933/current-bench-arch.png 340w,
/static/2924487e1eab06d8ffdb4bc2e3cdbbd1/c5bb3/current-bench-arch.png 680w,
/static/2924487e1eab06d8ffdb4bc2e3cdbbd1/37523/current-bench-arch.png 720w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#benchmarking-pipeline&quot; aria-label=&quot;benchmarking pipeline permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Benchmarking Pipeline&lt;/h3&gt;
&lt;p&gt;As shown in Figure 1 (above), the benchmarking infrastructure uses &lt;code&gt;ocurrent&lt;/code&gt;&lt;sup&gt;&lt;a href=&quot;https://icfp20.sigplan.org/details/ocaml-2020-papers/6/OCaml-CI-A-Zero-Configuration-CI&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;, an embedded Domain Specific Language to write a pipeline. The &lt;code&gt;ocurrent&lt;/code&gt; command computes the build incrementally and helps with static analysis. Whenever a pull request is opened on a repository monitored by &lt;code&gt;current-bench&lt;/code&gt;, a &lt;code&gt;POST&lt;/code&gt; request is sent to the server running the pipeline. The pipeline fetches the head commit on the pull request and uses Docker to compile the code, and then it runs the &lt;code&gt;make bench&lt;/code&gt; command inside the generated Docker image.&lt;/p&gt;
&lt;p&gt;The pipeline runs on a single node, and the process is pinned to a single core to ensure there's no contention of resources when running the benchmarks. Once finished, the raw JSON result is stored in a &lt;code&gt;Postgres&lt;/code&gt; database, which the frontend can query using a &lt;code&gt;GraphQL&lt;/code&gt; API, as shown in Figure 2 below.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/766e96b985de064519c776b0c59635b7/d0c2f/current-bench-ui.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 63.52941176470588%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACQklEQVR42oVS227aQBD1P4dL2vdKfexH5DE/wCVVlTwgJWqIwARDDFFNK/DaOMZre+1d26eaIdC+VB3paHauqzkz1u23rxiNRri/v8fd3S0uu120Wy102210Ox186Hb/jU4H7YsWPl5eon1xgS+fP8H69TJGmcU4JCmklFguFnBdF57nwdtssNvtGNvt9oyTvXZdPE9mmNk25rNnfH94gOXaD/j56mLnC8RxDKUUjDH4n9R1A601I89z9r2u17Ds+QuiWMJojSzLIILgnHAsrLHxNgiEgPB9HA4H1FXFEwghsN+HiKKIc5fLJayZs0ZeGJRleWwYhojiGKWpoUrDyPISmSohM8WgWF5opHmBJM3ZR+IsFrCmtgNtGlSVQZpmSKTBdkecSpiqhjYV9tEbfBFCFSVKbeCLACIIIbOccyhelBrO3IFlTyc8Vl1XkDLDagVsNjXqqgaaBg2jRhiG8H3/TENZanjeD+a7UIrHt20b1mQyQVXVXEhBLtxtefyTUCyK3jgeBAF8IfgiTkK8JzLF3HFgPT4+8qZIqqriscLowNwQf3GqkDCHBTeWaYb9WwKZFcx9LBUvtWkAhxo+PY25EdCw5hGKAlob/oiWReOdTolsbfT7yRiOkY+E7tcaj8ccpIJj8XHb1JSh1PnNEyjFIJtySSuV/zmb6XR65olAhCdJwkdOPNHdkT5xSh9TnPykT7lUu1qtYF1dXaHX62E4HKLf7+Pm5oZ1v9dj3XvXZA8HAwwGA37/7ac31V1fX+M360e9eIw2X7cAAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/766e96b985de064519c776b0c59635b7/c5bb3/current-bench-ui.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Figure 2: Current bench UI&quot; title=&quot;&quot; srcset=&quot;/static/766e96b985de064519c776b0c59635b7/04472/current-bench-ui.png 170w,
/static/766e96b985de064519c776b0c59635b7/9f933/current-bench-ui.png 340w,
/static/766e96b985de064519c776b0c59635b7/c5bb3/current-bench-ui.png 680w,
/static/766e96b985de064519c776b0c59635b7/b12f7/current-bench-ui.png 1020w,
/static/766e96b985de064519c776b0c59635b7/b5a09/current-bench-ui.png 1360w,
/static/766e96b985de064519c776b0c59635b7/d0c2f/current-bench-ui.png 1362w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The frontend supports historical navigation and provides comparison with the default branch. It allows users to select a pull request of which they want to see the graphs. The graphs display the individual result of the head commit and the comparison with the commits on the default branch. The frontend permits users to select the historical interval when they want to compare benchmarks, and it also shows the standard deviation.  Once the benchmarks have run successfully, the pipeline sets the pull request status to the frontend URL. Then the user can look at the graphs.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#hardware-optimisation&quot; aria-label=&quot;hardware optimisation permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Hardware Optimisation&lt;/h3&gt;
&lt;p&gt;Our &lt;code&gt;current-bench&lt;/code&gt; uses the hardware optimisations developed for OCaml multicore compiler benchmarks &lt;a href=&quot;https://github.com/ocaml-bench/ocaml_bench_scripts#notes-on-hardware-and-os-settings-for-linux-benchmarking&quot;&gt;(presented at ICFP OCaml Workshop 2019)&lt;/a&gt; with a few modifications to allow the benchmarks to run inside Docker containers. To get stable performance, we configured the kernel to isolate some of the CPU cores. Linux then avoids scheduling other user processes automatically. We also disabled IRQ handling and power saving.&lt;/p&gt;
&lt;p&gt;The container that runs the benchmark is pinned to one of the isolated cores. Since I/O operations can make the benchmarks less stable, we use an in-memory &lt;code&gt;tmpfs&lt;/code&gt; partition in &lt;code&gt;/dev/shm&lt;/code&gt; for all storage. For NUMA enabled systems, we configure this partition to be allocated on the NUMA node of the isolated core. The pipeline disables ASLR inside the container automatically, which is normally blocked by the default Docker seccomp profile, so we have modified the profile to allow the &lt;code&gt;personality(2)&lt;/code&gt; syscall.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#enrolling-a-repository&quot; aria-label=&quot;enrolling a repository permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Enrolling a repository&lt;/h2&gt;
&lt;p&gt;To enroll a repository, you need to ensure the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Enable the &lt;a href=&quot;https://github.com/marketplace/ocaml-benchmarks&quot;&gt;ocaml-benchmarks&lt;/a&gt; GitHub app for your repository.&lt;/li&gt;
&lt;li&gt;The repository needs a &lt;code&gt;bench&lt;/code&gt; Makefile target. This is triggered from the &lt;code&gt;current-bench&lt;/code&gt; pipeline.&lt;/li&gt;
&lt;li&gt;The output of the &lt;code&gt;make bench&lt;/code&gt; target is JSON, which can be parsed by the pipeline and displayed by the frontend.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#future-work&quot; aria-label=&quot;future work permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Future work&lt;/h2&gt;
&lt;p&gt;Anyone who wants to roll out a continuous, zero-configured benchmarking infrastructure can set up the current-bench infrastructure. In the future, we want to scale &lt;code&gt;current-bench&lt;/code&gt; by isolating cores on multiple machines and adding a scheduler to ensure that benchmarks use only one core at a time per machine. We plan to add support for different benchmarking libraries that repositories can use&amp;mdash;for example, we currently support repositories using &lt;code&gt;bechamel&lt;/code&gt;.  We also aim to make the adoption of &lt;code&gt;current-bench&lt;/code&gt; easier by adding a conversion library that can convert any benchmark output into output parseable by &lt;code&gt;current-bench&lt;/code&gt;. We intend to add support for &lt;code&gt;quick&lt;/code&gt; and &lt;code&gt;slow&lt;/code&gt; benchmarks, which would allow users to have faster feedback loops on pull requests while ensuring they can still run more extensive, time consuming benchmarks to see the performance.&lt;/p&gt;
&lt;p&gt;Thank you for reading! You can check out the implementation for &lt;code&gt;current-bench&lt;/code&gt; &lt;a href=&quot;https://github.com/ocurrent/current-bench&quot;&gt;here&lt;/a&gt;!&lt;/p&gt;</content><id>https://tarides.com/blog/2021-08-26-benchmarking-ocaml-projects-with-current-bench</id><title type="text">Benchmarking OCaml projects with current-bench</title><updated>2021-08-26T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2021-08-26-tarides-engineers-to-present-at-icfp-2021" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;This year marks the 25th anniversary of the OCaml Language! It's an exciting
time for OCaml programmers and enthusiasts. A fun and informative way to
celebrate OCaml's birthday is to attend the &lt;a href=&quot;https://icfp21.sigplan.org/home/ocaml-2021&quot;&gt;26th Annual International
Conference on Functional
Programming&lt;/a&gt; (ICFP), held online
this year due to ongoing Covid restrictions. While this is disappointing news
for so many, it's beneficial to those of you outside France because now you
can hear professionals talk about cutting edge technology from the comfort of
your own home.&lt;/p&gt;
&lt;p&gt;Tarides engineers, as well as our colleagues at &lt;a href=&quot;https://tarides.com/ocamllabs.io&quot;&gt;OCaml Labs
Consultancy&lt;/a&gt; and &lt;a href=&quot;https://segfault.systems/&quot;&gt;Segfault Systems&lt;/a&gt;,
have some exciting presentations at this year's ICFP! Listen to talks on running
OCaml on multiple cores, generating fuzzing suites, benchmarking, and the
experimental OCaml effects.&lt;/p&gt;
&lt;p&gt;You can search the [complete ICFP
Timetable](&lt;a href=&quot;https://icfp21.sigplan.org/program/program-icfp-2021/?past=Show&quot;&gt;https://icfp21.sigplan.org/program/program-icfp-2021/?past=Show&lt;/a&gt;
upcoming events only&amp;amp;date=Fri 27 Aug 2021) for other topics of interest and read
below about our engineers' projects and presentations. Times are listed both in
London (GMT +1) and Paris (GMT +2) for ease of planning. The following talks are
scheduled for Friday, 27 August 2021.&lt;/p&gt;
&lt;p&gt;Grab a cup of coffee for our first morning talk at &lt;strong&gt;9am London / 10am Paris&lt;/strong&gt;
and learn about &lt;strong&gt;Adapting the OCaml Ecosystem for Multicore OCaml.&lt;/strong&gt; With the
soon-to-be released OCaml 5.0, there will be support for Shared-Memory
Parallelism. There&amp;rsquo;s increasing interest in the community to port existing
libraries to Multicore, so this talk will cover the arrival of Multicore and
what that means to the OCaml ecosystem. Our engineers will highlight existing
tools and provide methods for a smooth transition, so viewers can benefit from
Multicore parallelism. They'll also share some insights from their experience
porting existing libraries to Multicore OCaml.&lt;/p&gt;
&lt;p&gt;Read more about this topic on todays' post at &lt;a href=&quot;https://segfault.systems/blog/2021/adapting-to-multicore/&quot;&gt;Segfault
Systems&lt;/a&gt;, written by
one of tomorrow's presenters, &lt;a href=&quot;https://icfp21.sigplan.org/profile/sudhaparimala&quot;&gt;Sudha
Parimala&lt;/a&gt; of Segfault Systems.
Joining Sudha for the presentation are &lt;a href=&quot;https://icfp21.sigplan.org/profile/enguerranddecorne1&quot;&gt;Enguerrand
Decorne&lt;/a&gt; (Tarides),
&lt;a href=&quot;https://icfp21.sigplan.org/profile/sadiqjaffer&quot;&gt;Sadiq Jaffer&lt;/a&gt; (Opsian and OCaml
Labs Consultancy), &lt;a href=&quot;https://icfp21.sigplan.org/profile/tomkelly&quot;&gt;Tom Kelly&lt;/a&gt;
(OCaml Labs Consultancy), and &lt;a href=&quot;https://icfp21.sigplan.org/profile/kcsivaramakrishnan&quot;&gt;KC
Sivaramakrishnan&lt;/a&gt; of IIT
Madras.&lt;/p&gt;
&lt;p&gt;Next up is &lt;strong&gt;Leveraging Formal Specifications to Generate Fuzzing Suites&lt;/strong&gt; at
&lt;strong&gt;11:10 London / 12:10 Paris,&lt;/strong&gt; presented by Tarides' own &lt;a href=&quot;https://icfp21.sigplan.org/profile/nicolasosborne&quot;&gt;Nicolas
Osborne&lt;/a&gt; and &lt;a href=&quot;https://icfp21.sigplan.org/profile/clementpascutto&quot;&gt;Cl&amp;eacute;ment
Pascutto&lt;/a&gt;. They'll discuss
how developers typically first have to capture the semantics they want when
checking a library and then write the code implementing these tests and find
relevant test cases that expose possible misbehaviours. Through their work,
they'll present a tool that automatically takes care of those last two steps by
automatically generating fuzz testing suites from OCaml interfaces annotated
with formal behavioural specifications. They'll also show some ongoing
experiments on fuzzing capabilities and limitations applied to real-world
libraries.&lt;/p&gt;
&lt;p&gt;Next up is our talk on &lt;strong&gt;Continuous Benchmarking for
OCaml Projects&lt;/strong&gt; at &lt;strong&gt;12:30 London / 13:30 Paris&lt;/strong&gt;. Regular CI systems are
optimised for workloads that do not require stable performance over time, which
makes them unsuitable for running performance benchmarks. Tarides engineers
&lt;a href=&quot;https://icfp21.sigplan.org/profile/gargisharma&quot;&gt;Gargi Sharma&lt;/a&gt;, &lt;a href=&quot;https://icfp21.sigplan.org/profile/rizoisrof&quot;&gt;Rizo
Isrof&lt;/a&gt;, and &lt;a href=&quot;https://icfp21.sigplan.org/profile/magnusskjegstad&quot;&gt;Magnus
Skjegstad&lt;/a&gt; will discuss how
&lt;code&gt;current-bench&lt;/code&gt; provides a predictable environment for performance benchmarks
and a UI for analysing results over time. Similar to a CI system it runs on pull
requests and branches allowing performance to be analysed and compared, and it
can currently be enabled on as an app on GitHub repositories with zero
configuration. Several public repositories already run &lt;code&gt;current-bench&lt;/code&gt;,
including &lt;a href=&quot;https://github.com/mirage/irmin&quot;&gt;Irmin&lt;/a&gt; and
&lt;a href=&quot;https://github.com/ocaml/dune&quot;&gt;Dune&lt;/a&gt;, and they plan to enable it on more
projects in the future. &lt;a href=&quot;https://tarides.com/blog/2021-08-26-benchmarking-ocaml-projects-with-current-bench&quot;&gt;Read Gargi's recent blog post for more information on
benchmarking&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In this presentation, they will give a technical overview of &lt;code&gt;current-bench&lt;/code&gt;, showing how results are collected and analysed, requirements for using it, and how they built the infrastructure for stable benchmarks. They'll also cover some future work that will allow more OCaml projects to run &lt;code&gt;current-bench&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Immediately after the Benchmarking talk, catch &lt;strong&gt;A Multiverse of Glorious Documentation&lt;/strong&gt;
scheduled at &lt;strong&gt;12:50 London / 13:50 Paris.&lt;/strong&gt; &lt;a href=&quot;https://icfp21.sigplan.org/profile/lucaspluvinage1&quot;&gt;Lucas
Pluvinage&lt;/a&gt; of Tarides and
&lt;a href=&quot;https://icfp21.sigplan.org/profile/jonathanludlam&quot;&gt;Jonathan Ludlam&lt;/a&gt; of OCaml
Labs Consultancy will discuss the process of generating documentation for every
version of every package that can be built from the Opam repository and present
it as a single coherent website that's continuously updated as new packages are
released and old packages are updated. They will address the challenges of
caching, handling different compiler versions, and incompatible libraries. The
process has been implemented as an OCurrent pipeline named &lt;code&gt;ocaml-docs-ci&lt;/code&gt; and
is already available on Github. It has been used to produce the documentation of
more than 10,000 package versions, generating 2.5M HTML pages. That's 38GB of
artifacts!&lt;/p&gt;
&lt;p&gt;After a relaxing lunch, come back for &lt;strong&gt;Experiences with Effects&lt;/strong&gt; at &lt;strong&gt;15:30
London / 16:30 Paris&lt;/strong&gt;. Join OCaml Labs and Tarides engineers &lt;a href=&quot;https://icfp21.sigplan.org/profile/thomasleonard&quot;&gt;Thomas
Leonard&lt;/a&gt;, &lt;a href=&quot;https://icfp21.sigplan.org/profile/craigferguson&quot;&gt;Craig
Ferguson&lt;/a&gt;, &lt;a href=&quot;https://icfp21.sigplan.org/profile/patrickferris&quot;&gt;Patrick
Ferris&lt;/a&gt;, &lt;a href=&quot;https://icfp21.sigplan.org/profile/sadiqjaffer&quot;&gt;Sadiq
Jaffer&lt;/a&gt;, &lt;a href=&quot;https://icfp21.sigplan.org/profile/tomkelly&quot;&gt;Tom
Kelly&lt;/a&gt;, &lt;a href=&quot;https://icfp21.sigplan.org/profile/kcsivaramakrishnan&quot;&gt;KC
Sivaramakrishnan&lt;/a&gt;, and
&lt;a href=&quot;https://icfp21.sigplan.org/profile/anilmadhavapeddy&quot;&gt;Anil Madhavapeddy&lt;/a&gt; as they
talk about an exciting, experimental branch of Multicore OCaml that adds support
for effect handlers. In this presentation, they'll discuss their experiences
with effects, both from converting existing code and from writing new code. They
discovered that converting the Angstrom parser from a callback style to effects
greatly simplified the code while also improving performance and reducing
allocations. Their &lt;a href=&quot;https://github.com/ocaml-multicore/eio&quot;&gt;experimental Eio
library&lt;/a&gt; uses effects that allows
writing concurrent code in direct style, without the need for monads (as found
in Lwt or Async).&lt;/p&gt;
&lt;p&gt;Enjoy a full day of OCaml innovation and get to know some of our talented
engineers better by joining Tarides, OCaml Labs, and Segfault Systems at ICFP on
Friday, 27 August 2021. See you there!&lt;/p&gt;</content><id>https://tarides.com/blog/2021-08-26-tarides-engineers-to-present-at-icfp-2021</id><title type="text">Tarides Engineers to Present at ICFP 2021</title><updated>2021-08-26T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2021-07-20-tarides-at-womenhack-virtual-event" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Tarides takes great pride in a diverse workforce and strives to continue
bringing talented people to its team from around the globe. This is why Sonja
Heinze, a Tarides software engineer, and the Head of HR, H&amp;eacute;lo&amp;iuml;se Lutton, will
attend WomenHack, an online event dedicated to recruiting more women into the
tech world. They're participating not only to present Tarides to the Women In
Tech community, but to also network and possibly find new talented programmers
to join our growing team.&lt;/p&gt;
&lt;p&gt;The &lt;strong&gt;WomenHack&lt;/strong&gt; event has a unique setup similar to 'speed dating,' but for
prospective jobs. Each candidate is paired with a company, and they have 5
minutes to chat before moving on to the next company. This &amp;quot;rapid interview&amp;quot; is
both fun and efficient for all involved, and it ensures each company will meet
several talented candidates from diverse backgrounds, which increases their
chance of finding that perfect fit for an open position!&lt;/p&gt;
&lt;p&gt;From their website:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;https://womenhack.com/&quot;&gt;WomenHack&lt;/a&gt;&lt;/strong&gt; is a community that empowers women in
tech through events, jobs, and reviews. We aim to create a more inclusive and
diverse workplace for all. Our diversity recruiting events target some of the
most talented women in tech which include software developers, designers, and
product talent.&amp;nbsp;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Join us tomorrow, July 21st, at WomenHack! You can &lt;a href=&quot;https://womenhack.com/events/72907/?tickets&quot;&gt;get your ticket
here&lt;/a&gt;.&lt;/p&gt;</content><id>https://tarides.com/blog/2021-07-20-tarides-at-womenhack-virtual-event</id><title type="text">Tarides at WomenHack Virtual Event</title><updated>2021-07-20T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2021-06-29-tarides-introduces-osmose-at-the-open-source-innovation-sprint" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Tarides is excited to announce that our CEO, Dr. Thomas Gazagnaire, and Prof.
Anil Madhavapeddy, from the University of Cambridge, will present their
innovative platform OSMOSE at the Open Source Innovation Sprint (OSIS)
conference on 1 July 2021. This event is organized by
&lt;a href=&quot;https://systematic-paris-region.org&quot;&gt;Systematic&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;OSMOSE is a software platform made to manage digital infrastructure at scale,
securely and efficiently. It uses the groundbreaking creation of unikernels to
radically simplify the way applications are built and deployed for the cloud.&lt;/p&gt;
&lt;p&gt;Since digital transformation has become more and more dependent on cloud
computing, it has increasing problems with high response latency, security
risks, and resource inefficiencies&amp;mdash;all which make these services ultimately
unreliable. The demand for interconnected devices is ever increasing, but the
security of these devices remain unchecked, making them susceptible to security
vulnerabilities. This leaves consumers and businesses open to exploitation, as
demonstrated in reports of tech devices violating users&amp;rsquo; privacy, like sending
audio recordings without their knowledge or consent.&lt;/p&gt;
&lt;p&gt;Tarides addresses these issues with OSMOSE, a platform which combines hardware
and software elements to invert the current cloud-centric model. OSMOSE securely
connects with physical spaces to provide extremely low latency and
high-bandwidth, local-area computation capabilities, which can turn a fleet of
IoT devices into a local data-centre.&lt;/p&gt;
&lt;p&gt;This innovative platform enables computer resources to be tracked efficiently
and temporarily rented to users. This turns any IoT deployment into a local,
private cloud, allowing a better utilization of local resources and improved
security.&lt;/p&gt;
&lt;p&gt;Major components of OSMOSE already have commercial applications. It&amp;rsquo;s been used
to make existing cloud deployments more secure and efficient by companies such
as Amazon, Citrix, and Docker.&lt;/p&gt;
&lt;p&gt;Tarides applies a high-touch, mixed business strategy&amp;mdash;using consultancy services
to field test open source components under development. Tarides applies their
research to real-world systems to build unikernels, a secure-by-design and
resource-efficient application specialised to their run-time environments. If
interested in using OSMOSE as a solution for your business,
&lt;a href=&quot;https://tarides.com/company/&quot;&gt;please reach out to Tarides&lt;/a&gt; for more
information.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://systematic-paris-region.org/evenement/open-source-innovation-spring-edge-iot/&quot;&gt;Register for OSIS&lt;/a&gt;
to attend the OSMOSE presentation on 1 July 2021.&lt;/p&gt;</content><id>https://tarides.com/blog/2021-06-29-tarides-introduces-osmose-at-the-open-source-innovation-sprint</id><title type="text">Tarides Introduces OSMOSE at the Open-Source Innovation Sprint</title><updated>2021-06-29T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2021-04-30-scop-selected-for-dapsi-initiative" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;&lt;strong&gt;Tarides is taking part in the Data Portability &amp;amp; Services Incubator (DAPSI), a
3-year EU funded project that empowers internet innovators to develop new
solutions in the Data Portability field.&lt;/strong&gt;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#what-is-dapsi&quot; aria-label=&quot;what is dapsi permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What is DAPSI?&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&quot;https://dapsi.ngi.eu&quot;&gt;Data Portability and Services Incubator (DAPSI)&lt;/a&gt; is
an EU funded project, under the European Commission&amp;rsquo;s Next Generation Internet
(NGI) initiative. The aim of this initiave is to empower top internet innovators
to develop human-centric solutions. DAPSI addresses the challenge of personal
data portability on the internet, as foreseen under the GDPR and make it
significantly easier for citizens to have any data which is stored with one
service provider transmitted directly to another provider.&lt;/p&gt;
&lt;p&gt;Take a look at the &lt;a href=&quot;https://dapsi.ngi.eu/hall-of-fame/&quot;&gt;DAPSI innovators
portfolio&lt;/a&gt; to see more information about the
selected projects.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#what-is-our-project&quot; aria-label=&quot;what is our project permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What is our project?&lt;/h2&gt;
&lt;p&gt;Our project, called &lt;strong&gt;SCoP&lt;/strong&gt; for &lt;strong&gt;Secure-by-design Communication Protocols&lt;/strong&gt;,
is taking part in the DAPSI to tackle data portability issues in communication
services.&lt;/p&gt;
&lt;p&gt;Over the past few decades, the usage of emails has been massively widespread by
both individuals and companies. Billions of emails are sent every day and this
number is expected to increase to reach 333 billion of emails exchanged daily
in 2022. Moreover, as managing internet communication stacks have become
increasingly complex, end-users have tended to entrust this task to third-party
companies like Google and Microsoft. Furthermore, existing implementations of
these communication services rely on ad-hoc methodologies and memory-unsafe
languages, where minor developer errors can easily escalate into major security
flaws. The centralization of these communication services means that a single
successful attack leads to major personal data breaches.&lt;/p&gt;
&lt;p&gt;To fix this issue, &lt;strong&gt;our project aims to engineer a modern basis for open
messaging that supports existing protocols such as emails but is also extensible
and customizable for emerging protocols such as matrix&lt;/strong&gt;. We will be building
trustable implementations of these open protocols using type-safe languages and
we will deploy these implementations as specialized, secure and resource
efficient unikernels. They will become the basis of the communication system of
OSMOSE, Tarides&amp;rsquo; commercial solution for secure-by-design IoT infrastructure.&lt;/p&gt;
&lt;p&gt;Every component of that system will be carefully designed as independent
libraries, using modern development techniques to avoid the common reported
threats and flaws. For instance, the implementation of protocol parsers and
serializers will be written in a type-safe language and will be using fuzzing,
e.g state-of-the-art coverage-driven tests. The combination of these techniques
will increase users&amp;rsquo; trust to migrate their personal data to these new secure
services.&lt;/p&gt;
&lt;p&gt;Moreover, these techniques are also useful to produce a large and reusable
corpus of test materials, which we plan to release separately for other
implementations to use. It will give the tools to other developers to write the
next generation of messaging applications by extending the existing protocols
with more confidence.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#want-to-be-part-of-it&quot; aria-label=&quot;want to be part of it permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Want to be part of it?&lt;/h2&gt;
&lt;p&gt;Would you like to hear more about the project? Or want to deploy our solution?
This project will build on a number of existing components in
&lt;a href=&quot;https://mirage.io&quot;&gt;MirageOS&lt;/a&gt;, such as
&lt;a href=&quot;https://tarides.com/blog/2019-09-25-mr-mime-parse-and-generate-emails&quot;&gt;MrMime&lt;/a&gt;
and &lt;a href=&quot;https://tarides.com/blog/2020-09-08-irmin-september-2020-update&quot;&gt;Irmin&lt;/a&gt;,
so feel free to contribute to these existing components! Please reach out to &lt;a href=&quot;mailto:contact@tarides.com&quot;&gt;&lt;/a&gt;&lt;a href=&quot;mailto:contact@tarides.com&quot;&gt;contact@tarides.com&lt;/a&gt;.&lt;/p&gt;
&lt;br/&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/50ddca27efa367497d954f667fc921f8/a76d6/DAPSI_generic.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 3.5294117647058822%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAABABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAIDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAHSsFSCf//EABYQAQEBAAAAAAAAAAAAAAAAAAMQM//aAAgBAQABBQIc0n//xAAWEQADAAAAAAAAAAAAAAAAAAACEDH/2gAIAQMBAT8BCr//xAAWEQADAAAAAAAAAAAAAAAAAAABEDH/2gAIAQIBAT8BNX//xAAXEAADAQAAAAAAAAAAAAAAAAAAAhCB/9oACAEBAAY/AlNn/8QAGBAAAgMAAAAAAAAAAAAAAAAAALEQMYH/2gAIAQEAAT8hcZXMf//aAAwDAQACAAMAAAAQiA//xAAWEQEBAQAAAAAAAAAAAAAAAAAAATH/2gAIAQMBAT8QyR//xAAVEQEBAAAAAAAAAAAAAAAAAAAQMf/aAAgBAgEBPxCx/8QAGxAAAgEFAAAAAAAAAAAAAAAAAAEhMUGhsfD/2gAIAQEAAT8QzNhT4lFkf//Z'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/50ddca27efa367497d954f667fc921f8/7bf67/DAPSI_generic.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Sequence of entity logos: in association with NGI, EU, Zabala, FGS,
cap-digital, IMT Starter, Fraunhofer IAIS.&quot; title=&quot;&quot; srcset=&quot;/static/50ddca27efa367497d954f667fc921f8/651be/DAPSI_generic.jpg 170w,
/static/50ddca27efa367497d954f667fc921f8/d30a3/DAPSI_generic.jpg 340w,
/static/50ddca27efa367497d954f667fc921f8/7bf67/DAPSI_generic.jpg 680w,
/static/50ddca27efa367497d954f667fc921f8/990cb/DAPSI_generic.jpg 1020w,
/static/50ddca27efa367497d954f667fc921f8/a76d6/DAPSI_generic.jpg 1139w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;</content><id>https://tarides.com/blog/2021-04-30-scop-selected-for-dapsi-initiative</id><title type="text">Tarides project SCoP is selected as one of the brightest Data Portability projects in Europe!</title><updated>2021-04-30T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2021-03-04-florence-and-beyond-the-future-of-tezos-storage" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;In collaboration with Nomadic Labs, Marigold and DaiLambda, we're happy to
announce the completion of the next Tezos protocol proposal:
&lt;a href=&quot;http://doc.tzalpha.net/protocols/009_florence.html&quot;&gt;&lt;strong&gt;Florence&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://tezos.com/&quot;&gt;Tezos&lt;/a&gt; is an open-source decentralised blockchain network providing a
platform for smart contracts and digital assets. A crucial feature of Tezos is
&lt;a href=&quot;https://tezos.com/static/white_paper-2dc8c02267a8fb86bd67a108199441bf.pdf&quot;&gt;&lt;em&gt;self-amendment&lt;/em&gt;&lt;/a&gt;: the network protocol can be upgraded
dynamically by the network participants themselves. This amendment process is
initiated when a participant makes a &lt;em&gt;proposal&lt;/em&gt;, which is then subject to a
vote. After several years working on the Tezos storage stack, this is our first
contribution to a proposal; we hope that it will be the first of many!&lt;/p&gt;
&lt;p&gt;As detailed in today's &lt;a href=&quot;https://blog.nomadic-labs.com/florence-our-next-protocol-upgrade-proposal.html&quot;&gt;announcement from Nomadic Labs&lt;/a&gt;,
the Florence proposal contains several important changes, from the introduction
of Baking Accounts to major quality-of-life improvements for smart contract
developers. Of all of these changes, we're especially excited about the
introduction of &lt;em&gt;sub-trees&lt;/em&gt; to the blockchain context API. In this post, we'll
give a brief tour of what these sub-trees will bring for the future of Tezos.
But first, what &lt;em&gt;are&lt;/em&gt; they?&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#merkle-sub-trees&quot; aria-label=&quot;merkle sub trees permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Merkle sub-trees&lt;/h3&gt;
&lt;p&gt;The Tezos protocol runs on top of a versioned tree called the &amp;ldquo;context&amp;rdquo;, which
holds the chain state (balances, contracts etc.). Ever since the pre-Alpha era,
the Tezos context has been implemented using &lt;a href=&quot;https://github.com/mirage/irmin&quot;&gt;Irmin&lt;/a&gt; &amp;ndash; an open-source
Merkle tree database originally written for use by MirageOS unikernels.&lt;/p&gt;
&lt;p&gt;For MirageOS, Irmin&amp;rsquo;s key strength is flexibility: it can run over arbitrary
backends. This is a perfect fit for Tezos, which must be agile and
widely-deployable. Indeed, the Tezos shell has already leveraged this agility
many times, all the way from initial prototypes using a Git backend to the
optimised &lt;a href=&quot;https://tarides.com/blog/2020-09-01-introducing-irmin-pack&quot;&gt;&lt;code&gt;irmin-pack&lt;/code&gt;&lt;/a&gt; implementation used today.&lt;/p&gt;
&lt;p&gt;But Irmin can do more than just swapping backends! It also allows users to
manipulate the underlying Merkle tree structure of the store with a high-level
API. This &amp;ldquo;&lt;a href=&quot;https://mirage.github.io/irmin/irmin/Irmin/module-type-S/Tree/&quot;&gt;Tree&lt;/a&gt;&amp;rdquo; API enables lots of interesting use-cases of
Irmin, from mergeable data types (&lt;a href=&quot;https://kcsrk.info/papers/banyan_aplas20.pdf&quot;&gt;MRDTs&lt;/a&gt;) to zero-knowledge proofs.
Tezos doesn't use these more powerful features directly yet; that&amp;rsquo;s where Merkle
proofs come in!&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#proofs-and-lightweight-tezos-clients&quot; aria-label=&quot;proofs and lightweight tezos clients permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Proofs and lightweight Tezos clients&lt;/h3&gt;
&lt;p&gt;Since the Tezos context keeps track of the current &amp;quot;state&amp;quot; of the blockchain,
each participant needs their own copy of the tree to run transactions against.
This context can grow to be very large, so it's important that it be stored as
compactly as possible: this goal shaped the design of &lt;code&gt;irmin-pack&lt;/code&gt;, our latest
Irmin backend.&lt;/p&gt;
&lt;p&gt;However, it's possible to reduce the storage requirements even further via the
magic of Merkle trees: individuals only need to store a &lt;em&gt;fragment&lt;/em&gt; of the root
tree, provided they can demonstrate that this fragment is valid by sending
&amp;ldquo;&lt;a href=&quot;https://bentnib.org/posts/2016-04-12-authenticated-data-structures-as-a-library.html&quot;&gt;proofs&lt;/a&gt;&amp;rdquo; of its membership to the other participants.&lt;/p&gt;
&lt;p&gt;This property can be used to support ultra-lightweight Tezos clients, a feature
&lt;a href=&quot;https://gitlab.com/smelc/tezos/-/commits/tweag-client-light-mode&quot;&gt;currently being developed&lt;/a&gt; by TweagIO. To make this a reality,
the Tezos protocol needs fine-grained access to context sub-trees in order build
Merkle proofs out of them. Fortunately, Irmin already supports this! We
&lt;a href=&quot;https://gitlab.com/tezos/tezos/-/merge_requests/2457&quot;&gt;extended the protocol&lt;/a&gt; to understand sub-trees, lifting the power
of Merkle trees to the user.&lt;/p&gt;
&lt;p&gt;We&amp;rsquo;re excited to work with TweagIO and Nomadic Labs on lowering the barriers to
entering the Tezos ecosystem and look forward to seeing what they achieve with
sub-trees!&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#efficient-merkle-proof-representations&quot; aria-label=&quot;efficient merkle proof representations permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Efficient Merkle proof representations&lt;/h3&gt;
&lt;p&gt;Simply exposing sub-trees in the Tezos context API isn&amp;rsquo;t quite enough:
lightweight clients will also need to &lt;em&gt;serialize&lt;/em&gt; them efficiently, since proofs
must be exchanged over the network to establish trust between collaborating
nodes. Enter &lt;a href=&quot;https://dailambda.jp/blog/2020-05-11-plebeia/&quot;&gt;Plebeia&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Plebeia is an alternative Tezos storage layer &amp;ndash; developed by DaiLambda &amp;ndash; with
strengths that complement those of Irmin. In particular, Plebeia is capable of
generating very compact Merkle proofs. This is partly due to its specialized
store structure, and partly due to clever optimizations such as path compression
and inlining.&lt;/p&gt;
&lt;p&gt;We&amp;rsquo;re working with the DaiLambda team to unite the strengths of Irmin and
Plebeia, which will bring built-in Merkle proof support to the Tezos storage
stack. The future is bright for Merkle proofs in Tezos!&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#baking-account-migrations&quot; aria-label=&quot;baking account migrations permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Baking account migrations&lt;/h3&gt;
&lt;p&gt;Trees don&amp;rsquo;t just enable &lt;em&gt;new&lt;/em&gt; features; they have a big impact on performance
too! Currently, indexing into the context always happens from its &lt;em&gt;root&lt;/em&gt;, which
duplicates effort when accessing adjacent values deep in the tree. Fortunately,
the new sub-trees provide a natural representation for &amp;ldquo;cursors&amp;rdquo; into the
context, allowing the protocol to optimize its interactions with the storage
layer.&lt;/p&gt;
&lt;p&gt;To take just one example, DaiLambda recently exploited this feature to reduce
the migration time necessary to introduce Baking Accounts to the network by a
factor of 15! We&amp;rsquo;ll be teaming up with Nomadic Labs and DaiLambda to ensure that
Tezos extracts every bit of performance from its storage.&lt;/p&gt;
&lt;p&gt;It's especially exciting to have access to lightning-fast storage migrations,
since this enables Tezos to evolve rapidly even as the ecosystem expands.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#storage-in-other-languages&quot; aria-label=&quot;storage in other languages permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Storage in other languages&lt;/h3&gt;
&lt;p&gt;Of course, Tezos isn&amp;rsquo;t just an OCaml project: the storage layer also has a
performant Rust implementation as part of &lt;a href=&quot;https://github.com/simplestaking/tezedge&quot;&gt;TezEdge&lt;/a&gt;. We&amp;rsquo;re working with
&lt;a href=&quot;https://github.com/simplestaking&quot;&gt;Simple Staking&lt;/a&gt; to bring Irmin to the Rust community via an
&lt;a href=&quot;https://github.com/simplestaking/ocaml-interop&quot;&gt;FFI toolchain&lt;/a&gt;, enabling closer alignment between the different
Tezos shell implementations.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h3&gt;
&lt;p&gt;All in all, it&amp;rsquo;s an exciting time to work on Tezos storage, with many
open-source collaborators from around the world. We&amp;rsquo;re especially happy to see
Tezos taking greater advantage of Irmin&amp;rsquo;s features, which will strengthen both
projects and help them grow together.&lt;/p&gt;
&lt;p&gt;If all of this sounds interesting, you can play with it yourself using the
recently-released &lt;a href=&quot;https://github.com/mirage/irmin&quot;&gt;Irmin 2.5.0&lt;/a&gt;. Thanks for reading, and stay tuned for
future Tezos development updates!&lt;/p&gt;</content><id>https://tarides.com/blog/2021-03-04-florence-and-beyond-the-future-of-tezos-storage</id><title type="text">Florence and beyond: the future of Tezos storage</title><updated>2021-03-04T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2021-02-15-partnering-for-more-diversity-in-tech" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Tarides is very glad to announce our partnership with &lt;a href=&quot;https://adatechschool.fr&quot;&gt;Ada Tech
School&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Founded in 2019 and based in Paris (France), Ada Tech School, named for pioneer
computer scientist &lt;a href=&quot;https://en.wikipedia.org/wiki/Ada_Lovelace&quot;&gt;Ada Lovelace&lt;/a&gt;,
is a programming school designed for women but open to all. The program is
driven by three values: feminism, empathy and singularity. Its mission is to
facilitate access to programming positions and promote the feminization of tech,
by creating training that tackles the gender and cultural biases of IT.&lt;/p&gt;
&lt;p&gt;Unfortunately, the diversity of the candidate pool is very limited when a
company tries to fill positions. Barely 10% of computer science students in
France are girls. Ada Tech School is an excellent initiative to democratize
software education amongst women. The school was created so that women can land
a job easily in the IT industry through rigorous training, and then offer
ongoing coaching and support to ascend the professional ladder within tech
companies.&lt;/p&gt;
&lt;p&gt;At Tarides, we believe that a healthy team is a diverse one; and that trust,
fairness and inclusion are values needed to build a strong company.&lt;/p&gt;
&lt;p&gt;We are committed to doing better, not only by hiring a diverse team and
providing a welcoming work environment, but also by putting people first at
every stage. This means providing fair and equitable compensation as well as
meaningful career advancement opportunities for every employee.&lt;/p&gt;
&lt;p&gt;We believe that a great technology always derives from great people, regardless
of their background. Head &lt;a href=&quot;https://tarides.com/company&quot;&gt;here&lt;/a&gt; to see our
currently-open positions.&lt;/p&gt;</content><id>https://tarides.com/blog/2021-02-15-partnering-for-more-diversity-in-tech</id><title type="text">Partnering for more diversity in Tech</title><updated>2021-02-15T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2021-01-26-recent-and-upcoming-changes-to-merlin" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Merlin is a language server for the OCaml programming language; that is, a daemon
that connects to your favourite text editor and provides the usual services of
an IDE: instant feedback on warnings and errors, autocompletion, &amp;quot;type of the
code under the cursor&amp;quot;, &amp;quot;go to definition&amp;quot;, etc. As we (Fr&amp;eacute;d&amp;eacute;ric Bour, Ulysse
G&amp;eacute;rard and I) are about to do a new major release, we thought now would be a
good time to talk a bit about some of the changes that are going into this
release.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#project-configuration&quot; aria-label=&quot;project configuration permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Project configuration&lt;/h2&gt;
&lt;p&gt;Since its very first release, merlin has been getting information about the
project being worked on through a &lt;code&gt;.merlin&lt;/code&gt; file, which used to be written by
the user, but is now often generated by build systems.&lt;/p&gt;
&lt;p&gt;This had the advantage of being fairly simple: Merlin would just look in the
current directory if such a file existed, otherwise it would look in the parent
directories until it found one; and then read it. But there were also some
sore points: the granularity of the configuration is the directory not the file,
and this information is duplicated from the build system configuration (be it
dune, Makefiles, or, back in the days, ocamlbuild).&lt;/p&gt;
&lt;p&gt;After years of thinking about it, we've finally decided to make some light
changes to this process. Since version 3.4, when it scans the filesystem Merlin
is now looking for either a &lt;code&gt;.merlin&lt;/code&gt; file or a dune (or dune-project) file. And
when it finds one of those, it starts an external process in the directory where
that file lives, and asks that process for the configuration of the ml(i) file
being edited.&lt;/p&gt;
&lt;p&gt;The process in charge of communicating the configuration to Merlin will either
be a specific dune subcommand (when a dune file is found), or a dedicated
&lt;code&gt;.merlin&lt;/code&gt; reader program.&lt;/p&gt;
&lt;p&gt;We see several advantages in doing things this way (rather than, for instance,
changing the format of &lt;code&gt;.merlin&lt;/code&gt; files):&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;this change is entirely backward compatible, and indeed the transition has
already happened silently; although dune is still emitting &lt;code&gt;.merlin&lt;/code&gt; files,
this will only stop with dune 2.8.&lt;/li&gt;
&lt;li&gt;externalizing the reading of &lt;code&gt;.merlin&lt;/code&gt; files and simply requiring a
&amp;quot;normalized&amp;quot; version of the config (i.e. with no mention of packages, just of
flags and paths) allowed us to simplify the internals of Merlin.&lt;/li&gt;
&lt;li&gt;talking to the build system directly not only gets us a much finer grained
configuration (which is important when you build different executables with
different flags in the same directory, or if you apply different ppxes to
different files of a library), it opens the door to getting a nicer behavior
of Merlin in some circumstances. For instance, the build system can (and
does) tell Merlin when the project isn't built. Currently we only report that
information to the user when he asks for errors, alongside all the other
(mostly rubbish) errors. Which is already helpful in itself. But in the
future we can start filtering the other errors to only report those that
would remain even after building the project (e.g. parse errors).&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;There are however some changes to look out for:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;people who still use &lt;code&gt;.merlin&lt;/code&gt; files but do not install Merlin using opam need
to make sure to also have the &lt;code&gt;dot-merlin-reader&lt;/code&gt; binary in their PATH (it is
available as an opam package, but is also buildable from Merlin's git
repository)&lt;/li&gt;
&lt;li&gt;vim and emacs users who could previously load packages interactively (by
calling &lt;code&gt;M-x merlin-use&lt;/code&gt; or &lt;code&gt;:MerlinUse&lt;/code&gt;) cannot do that anymore, since Merlin
itself stopped linking with findlib. They'll have to write a &lt;code&gt;.merlin&lt;/code&gt; file.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#dropping-support-for-old-versions-of-ocaml&quot; aria-label=&quot;dropping support for old versions of ocaml permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Dropping support for old versions of OCaml&lt;/h2&gt;
&lt;p&gt;Until now, every release of Merlin has kept support from OCaml 4.02 to the
latest version of OCaml available at the time of that release.&lt;/p&gt;
&lt;p&gt;We have done this by having one version of &amp;quot;&lt;em&gt;the frontend&lt;/em&gt;&amp;quot; (i.e. handling of
buffer state, project configuration; analyses like &lt;em&gt;jump-to-definition&lt;/em&gt;,
&lt;em&gt;prefix-completion&lt;/em&gt;, etc.), but several versions of &amp;quot;&lt;em&gt;the backend&lt;/em&gt;&amp;quot; (OCaml's
ASTs, parser and typechecker), and choosing at build time which one to use.
The reason for doing this instead of having, for instance, one branch of Merlin
per version of OCaml, is that while the backends are fairly stable once
released, Merlin's frontend keeps evolving. Having just one version of it makes
it easier to add features and fix bugs (patches don't need to be duplicated),
whilst ensuring that Merlin's behavior is consistent across every version of
OCaml that we support.&lt;/p&gt;
&lt;p&gt;For this to work however, one needs a well defined API between the frontend and
all the versions of the backend. This implies mapping every versions of OCaml's
internal ASTs (which receive modifications from one version to the next), to a
unified one, so as to keep Merlin's various features version agnostic. But it
also means being resilient to OCaml's internal API changes. For instance between
4.02 and 4.11 there were big refactorings impacting: the way one accesses the
typing environment, the way one accesses the &amp;quot;load path&amp;quot; (the part of the file
system the compiler/Merlin is aware of), the way error message are produced, ...&lt;/p&gt;
&lt;p&gt;The rate of changes on the compiler is a lot higher than what it was when we
first started Merlin (7 years ago now!) which doesn't just mean that we have to
spend more and more time on updating the common interface, but also that the
interface is getting harder to define. Recently (with the 4.11 release) some of
the changes were significant enough that for some parts of the backend we just
didn't manage to produce a single interface to access old and new versions, so
instead we had to start duplicating and specializing parts of the frontend.
And we don't expect things to get much better in the near future.&lt;/p&gt;
&lt;p&gt;Furthermore, Merlin's backends are patched to be more resilient to parsing and
typing errors in the user's code. Those patches also need to be evolved at each
new release of the compiler.
The work required to keep the &amp;quot;unified interface&amp;quot; working was taking time away
from updating our patches properly, and our support of user errors has slowly
been getting worse over the past few years, resulting in less precise type
information when asked, incomplete results when asking for auto-completion, etc.&lt;/p&gt;
&lt;p&gt;Therefore we have decided to stop dragging older versions of OCaml along. We
plan to switch to a system where we have one branch of Merlin per version of
OCaml, and each opam release of Merlin will only be buildable with one version
of OCaml. We will keep maintaining all the relatively recent branches (that is:
4.02 definitely will not get fixes, but 4.06 is still in the clear). However,
all the new features will be developed against the latest version of OCaml and
cherry-picked to older branches if, and only if, there are no merge conflicts
and they work as expected without changes.&lt;/p&gt;
&lt;p&gt;We hope that this will make it easier for us to update to new versions of OCaml
(actually, we already know it does, working on adding support for 4.12 was
easier than for any of the other recent versions), will allow us to clean up
Merlin's codebase (let's call that a work in progress), and will free some time
to work on new features.&lt;/p&gt;
&lt;p&gt;You might wonder what all this changes for you, as a user, in practice. Well, it
depends:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;if you install Merlin from opam: nothing, or almost nothing. Everything that
you currently do with Merlin will keep working. In the future, perhaps some
new feature will appear that won't work on all versions. But that day hasn't
come yet.&lt;/li&gt;
&lt;li&gt;if you install Merlin some other way (manually?): you can't just fetch master
and build it anymore. You have to pick the appropriate branch for your
version of OCaml.&lt;/li&gt;
&lt;li&gt;if you're reusing Merlin's codebase as part of another project and (even
worse) have patches on it: come and talk to us if you haven't done so already!
We can try and integrate your patches, so that you only need to worry about
vendoring the right version(s) for your needs.&lt;/li&gt;
&lt;/ul&gt;
&lt;hr/&gt;
&lt;p&gt;Over the years, Merlin has received bugfixes and improvements from a long list of
people, but for the upcoming release Fr&amp;eacute;d&amp;eacute;ric and I are particularly grateful to
Rudi Grinberg, a long time and regular contributor who also maintains the OCaml
LSP project, as well as Ulysse G&amp;eacute;rard, who joined our team a year ago now. They
are in particular the main authors of the work to improve the handling of
projects' configuration.&lt;/p&gt;
&lt;p&gt;We hope you'll be as excited as us by all these changes!&lt;/p&gt;</content><id>https://tarides.com/blog/2021-01-26-recent-and-upcoming-changes-to-merlin</id><title type="text">Recent and upcoming changes to Merlin</title><updated>2021-01-26T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2020-12-14-tarides-sponsors-the-oxbridge-women-in-computer-science-conference-2020" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;The &lt;a href=&quot;https://oxbridgewomenincs8.wixsite.com/2020&quot;&gt;Oxbridge Women in Computer Science
conference&lt;/a&gt; is an annual one-day
event hosted by the Universities of Oxford and Cambridge (UK). The
conference is free and open to everyone from any discipline, regardless of
gender identity. Its purpose is to spotlight the successes of women within
computer science and strengthen the network of women in computer science
within a supportive and friendly environment.&lt;/p&gt;
&lt;p&gt;This year, the conference was organised by the University of Cambridge and was
held virtually on December 7th.&lt;/p&gt;
&lt;p&gt;Tarides is very glad to sponsor this event as we strongly believe that diversity
and inclusive culture is a key factor in building a competitive and innovative
company. Our employees come from 8 different countries and are 1&amp;frasl;3 women.
Tarides promotes transparency, openness and autonomy, creating a work atmosphere
auspicious for employees to strive in their work, to solve novel, impactful and
technical challenges. By working on open-source projects, a collaboration is
possible with worldwide experts from both academia and industry, encouraging
continuous training and education; in this context, it is very important to have
teams with diverse backgrounds and experience.&lt;/p&gt;
&lt;p&gt;The underrepresentation of women in tech, and particularly in computer science,
is not a new problem and gender equality remains a major issue in the corporate
world. By celebrating female computer scientists, as during the Oxbridge Women
in Computer Science Conference, it will hopefully encourage more women to pursue
their interests and careers in the tech field. Head
&lt;a href=&quot;https://tarides.com/company/&quot;&gt;here&lt;/a&gt; to see our currently-open positions.&lt;/p&gt;
&lt;p&gt;For the event, we made a short video to experience a day in the life of a
software engineer:&lt;/p&gt;
&lt;div style=&quot;position: relative; width: 100%; height: 0; padding-bottom: 56.25%&quot;&gt;
  &lt;iframe style=&quot;position: absolute; width: 100%; height: 100%; left: 0; right: 0&quot; src=&quot;https://www.youtube-nocookie.com/embed/5qK8elKNxKI&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;allowfullscreen&quot;&gt;&lt;/iframe&gt;
&lt;/div&gt;</content><id>https://tarides.com/blog/2020-12-14-tarides-sponsors-the-oxbridge-women-in-computer-science-conference-2020</id><title type="text">Tarides sponsors the Oxbridge Women in Computer Science Conference 2020</title><updated>2020-12-14T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2020-09-24-building-portable-user-interfaces-with-nottui-and-lwd" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;At Tarides, we build many tools and writing UI is usually a tedious task. In this post we will see how to write functional UIs in OCaml using the &lt;code&gt;Nottui&lt;/code&gt; &amp;amp; &lt;code&gt;Lwd&lt;/code&gt; libraries.&lt;/p&gt;
&lt;p&gt;These libraries were developed for &lt;a href=&quot;https://github.com/ocurrent/citty&quot;&gt;Citty&lt;/a&gt;, a frontend to the &lt;a href=&quot;https://github.com/ocurrent/ocaml-ci&quot;&gt;Continuous Integration service&lt;/a&gt; of OCaml Labs.&lt;/p&gt;
&lt;div&gt;
  &lt;video controls=&quot;controls&quot; width=&quot;100%&quot;&gt;
    &lt;source src=&quot;./nottui-citty.mp4&quot; type=&quot;video/mp4&quot;&gt;&lt;/source&gt;
    &lt;source src=&quot;./nottui-citty.webm&quot; type=&quot;video/webm;codecs=vp9&quot;&gt;&lt;/source&gt;
  &lt;/video&gt;
&lt;/div&gt;
&lt;p&gt;In this recording, you can see the lists of repositories, branches and jobs monitored by the CI service, as well as the result of job execution. Most of the logic is asynchronous, with all the contents being received from the network in a non-blocking way.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Nottui&lt;/code&gt; extends &lt;a href=&quot;https://github.com/pqwy/notty&quot;&gt;Notty&lt;/a&gt;, a library for declaring terminal images, to better suit the needs of UIs. &lt;code&gt;Lwd&lt;/code&gt; (Lightweight Document) exposes a simple form of reactive computation (values that evolve over time). It can be thought of as an alternative to the DOM, suitable for building interactive documents.
They are used in tandem: &lt;code&gt;Nottui&lt;/code&gt; for rendering the UI and &lt;code&gt;Lwd&lt;/code&gt; for making it interactive.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#nottui--notty-with-layout-and-events&quot; aria-label=&quot;nottui  notty with layout and events permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Nottui = Notty with layout and events&lt;/h2&gt;
&lt;p&gt;Notty exposes a nice way to display images in a terminal. A Notty image is matrix of characters with optional styling attributes (tweaking foreground and background colors, using &lt;strong&gt;bold&lt;/strong&gt; glyphs...).&lt;/p&gt;
&lt;p&gt;These images are pure values and can be composed (concatenated, cropped, ...) very efficiently, making them very convenient to manipulate in a functional way.&lt;/p&gt;
&lt;p&gt;However these images are inert: their contents are fixed and their only purpose is to be displayed. Nottui reuses Notty images and exposes essentially the same interface but it adds two features: layout &amp;amp; event dispatch. UI elements now adapt to the space available and can react to keyboard and mouse actions.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Layout DSL&lt;/strong&gt;. Specifying a layout is done using &amp;quot;stretchable&amp;quot; dimensions, a concept loosely borrowed from TeX. Each UI element has a fixed size (expressed as a number of columns and rows) and a stretchable size (possibly empty). The stretchable part is interpreted as a strength that is used to determine how to share the space available among all UI elements.&lt;/p&gt;
&lt;p&gt;This is a simple system amenable to an efficient implementation while being powerful enough to express common layout patterns.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Event dispatch&lt;/strong&gt;. Reacting to mouse and keyboard events is better done using local behaviors, specific to an element. In Nottui, images are augmented with handlers for common actions. There is also a global notion of focus to determine which element should consume input events.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#interactivity-with-lwd&quot; aria-label=&quot;interactivity with lwd permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Interactivity with Lwd&lt;/h2&gt;
&lt;p&gt;Nottui's additions are nice for resizing and attaching behaviors to images, but they are still static objects. In practice, user interfaces are very dynamic: parts can be independently updated to display new information.&lt;/p&gt;
&lt;p&gt;This interactivity layer is brought by Lwd and is developed separately from the core UI library. It is built around a central type, &lt;code&gt;'a Lwd.t&lt;/code&gt;, that represents a value of type &lt;code&gt;'a&lt;/code&gt; that can change over time.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Lwd.t&lt;/code&gt; is an &lt;a href=&quot;https://en.wikipedia.org/wiki/Applicative_functor&quot;&gt;applicative functor&lt;/a&gt; (and even a monad), making it a highly composable abstraction.&lt;/p&gt;
&lt;p&gt;Primitive changes are introduced by &lt;code&gt;Lwd.var&lt;/code&gt;, which are OCaml references with an extra operation &lt;code&gt;val get : 'a Lwd.var -&amp;gt; 'a Lwd.t&lt;/code&gt;. This operation turns a variable into a &lt;em&gt;changing value&lt;/em&gt; that changes whenever the variable is set.&lt;/p&gt;
&lt;p&gt;In practice this leads to a mostly declarative style of programming interactive documents (as opposed to the DOM that is deeply mutable). Most of the code is just function applications without spooky action at a distance! However, it is possible to opt-out of this pure style by introducing an &lt;code&gt;Lwd.var&lt;/code&gt;, on a case-by-case basis.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#and-much-more&quot; aria-label=&quot;and much more permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;And much more...&lt;/h2&gt;
&lt;p&gt;A few extra libraries are provided to target more specific problems.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Lwd_table&lt;/code&gt; and &lt;code&gt;Lwd_seq&lt;/code&gt; are two datastructures to manipulate dynamic collections. &lt;code&gt;Nottui_pretty&lt;/code&gt; is an interactive pretty printing library that supports arbitrary Nottui layouts and widgets. Finally &lt;code&gt;Tyxml_lwd&lt;/code&gt; is a strongly-typed abstraction of the DOM driven by Lwd.&lt;/p&gt;
&lt;p&gt;Version 0.1 has just been released on OPAM.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#getting-started&quot; aria-label=&quot;getting started permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Getting started!&lt;/h2&gt;
&lt;p&gt;Here is a small example to start using the library. First, install the Nottui library:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ opam &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; nottui&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we can play in the top-level. We will start with a simple button that counts the number of clicks:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;$&lt;/span&gt; utop
&lt;span class=&quot;token punctuation&quot;&gt;#&lt;/span&gt; &lt;span class=&quot;token directive property&quot;&gt;#require&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;nottui&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;#&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; Nottui&lt;span class=&quot;token punctuation&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;#&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; W &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Nottui_widgets&lt;span class=&quot;token punctuation&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;(* State for holding the number of clicks *)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;#&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; vcount &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Lwd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;var &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;(* Image of the button parametrized by the number of clicks *)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;#&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; button count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    W&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;button &lt;span class=&quot;token label property&quot;&gt;~attr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;Notty&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;bg green &lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; fg black&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Printf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sprintf &lt;span class=&quot;token string&quot;&gt;&amp;quot;Clicked %d times!&amp;quot;&lt;/span&gt; count&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; Lwd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;set vcount &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;(* Run the UI! *)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;#&lt;/span&gt; Ui_loop&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Lwd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;map button &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Lwd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get vcount&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; to quit the example, you can press Ctrl-Q or Esc.&lt;/p&gt;
&lt;p&gt;We will improve the example and turn it into a mini cookie clicker game.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;(* Achievements to unlock in the cookie clicker *)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;#&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; badges &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;15&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;Cursor&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;Grandma&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;150&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;Farm&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;300&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;Mine&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;(* List the achievements unlocked by the player *)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;#&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; unlocked_ui count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;(* Filter the achievements *)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; predicate &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; text&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; count &lt;span class=&quot;token operator&quot;&gt;&amp;gt;=&lt;/span&gt; target
      &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; Some &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;W&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printf &lt;span class=&quot;token string&quot;&gt;&amp;quot;% 4d: %s&amp;quot;&lt;/span&gt; target text&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; None
    &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;(* Concatenate the UI elements vertically *)&lt;/span&gt;
    Ui&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;vcat &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;List&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;filter_map predicate badges&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;(* Display the next achievement to reach *)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;#&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; next_ui count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; predicate &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; target &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; ciybt &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; List&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;find_opt predicate badges &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Some &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
      W&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printf &lt;span class=&quot;token label property&quot;&gt;~attr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;Notty&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;st bold&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;% 4d: ???&amp;quot;&lt;/span&gt; target
    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; None &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; Ui&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;empty&lt;span class=&quot;token punctuation&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;(* Let's make use of the fancy let-operators recently added to OCaml *)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;#&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; Lwd_infix&lt;span class=&quot;token punctuation&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;#&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; ui &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;$&lt;/span&gt; count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Lwd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get vcount &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
    Ui&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;vcat &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;button count&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; unlocked_ui count&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; next_ui count&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;(* Launch the game! *)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;#&lt;/span&gt; Ui_loop&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run ui&lt;span class=&quot;token punctuation&quot;&gt;;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div&gt;
  &lt;video controls=&quot;controls&quot;&gt;
    &lt;source src=&quot;./nottui-cookie-clicker.mp4&quot; type=&quot;video/mp4&quot;&gt;&lt;/source&gt;
    &lt;source src=&quot;./nottui-cookie-clicker.webm&quot; type=&quot;video/webm;codecs=vp9&quot;&gt;&lt;/source&gt;
  &lt;/video&gt;
&lt;/div&gt;
&lt;p&gt;Et voil&amp;agrave;! We hope you enjoy experimenting with &lt;code&gt;Nottui&lt;/code&gt; and &lt;code&gt;Lwd&lt;/code&gt;. Check out the &lt;a href=&quot;https://github.com/let-def/lwd/tree/master/lib/nottui&quot;&gt;Nottui page&lt;/a&gt; for more examples, and watch our recent presentation of these libraries at the 2020 ML Workshop here:&lt;/p&gt;
&lt;div style=&quot;position: relative; width: 100%; height: 0; padding-bottom: 56.25%&quot;&gt;
  &lt;iframe style=&quot;position: absolute; width: 100%; height: 100%; left: 0; right: 0&quot; src=&quot;https://www.youtube-nocookie.com/embed/w7jc35kgBZE&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;allowfullscreen&quot;&gt;
  &lt;/iframe&gt;
&lt;/div&gt;</content><id>https://tarides.com/blog/2020-09-24-building-portable-user-interfaces-with-nottui-and-lwd</id><title type="text">Building portable user interfaces with Nottui and Lwd</title><updated>2020-09-24T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2020-09-17-tarides-is-now-a-sponsor-of-the-ocaml-software-foundation" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Tarides is pleased to provide support for the &lt;a href=&quot;https://ocaml-sf.org&quot;&gt;OCaml Software
Foundation&lt;/a&gt;, a non-profit foundation hosted by
the Inria Foundation. The OCaml Software Foundation's mission is to
promote the OCaml programming language and its ecosystem by
supporting the growth of a diverse and international community of
OCaml users.&lt;/p&gt;
&lt;p&gt;Tarides develops secure-by-design solutions in which OCaml's memory and
type-safety guarantees play a major role. Hence, most of the software
development that is done at Tarides is in OCaml: for instance,
&lt;a href=&quot;https://mirage.io&quot;&gt;MirageOS&lt;/a&gt;, a library operating system that
constructs unikernels for secure, high-performance network
applications; and &lt;a href=&quot;https://irmin.org&quot;&gt;Irmin&lt;/a&gt;, a library for building
mergeable, branchable distributed data stores, with built-in
snapshotting and support for a wide variety of storage backends.&lt;/p&gt;
&lt;p&gt;Tarides is also very involved in the OCaml compiler development and
OCaml developer tooling ecosystem: as active maintainers of the &lt;a href=&quot;https://www.youtube.com/watch?v=E8T_4zqWmq8&amp;amp;list=PLKO_ZowsIOu5fHjRj0ua7_QWE_L789K_f&amp;amp;ab_channel=ocaml2020&quot;&gt;OCaml
platform&lt;/a&gt;, Tarides is involved with most of the major
OCaml developer tools, including &lt;a href=&quot;https://github.com/ocaml/ocaml&quot;&gt;opam&lt;/a&gt;, &lt;a href=&quot;https://github.com/ocaml/dune&quot;&gt;dune&lt;/a&gt; and &lt;a href=&quot;https://github.com/ocaml/merlin&quot;&gt;merlin&lt;/a&gt;.&lt;/p&gt;</content><id>https://tarides.com/blog/2020-09-17-tarides-is-now-a-sponsor-of-the-ocaml-software-foundation</id><title type="text">Tarides is now a sponsor of the OCaml Software Foundation</title><updated>2020-09-17T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2020-09-08-irmin-september-2020-update" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;This post will survey the latest design decisions and performance improvements
made to &lt;code&gt;irmin-pack&lt;/code&gt;, the &lt;a href=&quot;https://irmin.org/&quot;&gt;Irmin&lt;/a&gt; storage backend used by
&lt;a href=&quot;https://tezos.gitlab.io/&quot;&gt;Tezos&lt;/a&gt;. Tezos is an open-source blockchain technology,
written in OCaml, which uses many libraries from the MirageOS ecosystem. For
more context on the design of &lt;code&gt;irmin-pack&lt;/code&gt; and how it is optimised for the Tezos
use-case, you can check out our &lt;a href=&quot;https://tarides.com/blog/2020-09-01-introducing-irmin-pack&quot;&gt;previous blog post&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This post showcases the improvements to &lt;code&gt;irmin-pack&lt;/code&gt; since its initial
deployment on Tezos:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://tarides.com/feed.xml#faster-read-only-store-instances&quot;&gt;Faster read-only store instances&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://tarides.com/feed.xml#better-flushing-for-the-read-write-instance&quot;&gt;Improved automatic flushing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://tarides.com/feed.xml#faster-serialisation-for-irmintype&quot;&gt;Staging generic serialisation operations&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://tarides.com/feed.xml#more-control-over-indexmerge&quot;&gt;More control over &lt;code&gt;Index.merge&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://tarides.com/feed.xml#clearing-stores&quot;&gt;Clearing stores&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#faster-read-only-store-instances&quot; aria-label=&quot;faster read only store instances permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Faster read-only store instances&lt;/h2&gt;
&lt;p&gt;The Tezos use-case of Irmin requires both &lt;em&gt;read-only&lt;/em&gt; and &lt;em&gt;read-write&lt;/em&gt;
store handles, with multiple readers and a single writer all accessing the same
Irmin store concurrently. These store handles are held by different processes
(with disjoint memory spaces) so the instances must use files on disk to
synchronise, ensuring that the readers never miss updates from the writer. The
writer instance automatically flushes its internal buffers to disk at regular
intervals, allowing the readers to regularly pick up &lt;code&gt;replace&lt;/code&gt; calls.&lt;/p&gt;
&lt;p&gt;Until recently, each time a reader looked for a value &amp;ndash; be it a commit, a node,
or a blob &amp;ndash; it first checked if the writer had flushed new contents to disk. This
ensured that the readers always see the latest changes from the writer. However,
if the writer isn't actively modifying the regions being read, the readers make
one unnecessary system call per &lt;code&gt;find&lt;/code&gt;. The higher the rate of reads, the more
time is lost to these synchronisation points. This is particularly problematic
in two use-cases:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Taking snapshots of the store&lt;/strong&gt;. Tezos supports &lt;a href=&quot;https://tezos.gitlab.io/user/snapshots.html&quot;&gt;exporting portable
snapshots&lt;/a&gt; of the store data. Since this operation only reads
&lt;em&gt;historic&lt;/em&gt; data in the store (traversing backwards from a given block hash),
it's never necessary to synchronise with the writer.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Bulk writes&lt;/strong&gt;. It's sometimes necessary for the writer to dump lots of new
data to disk at once (for instance, when adding a commit to the history). In
these cases, any readers will repeatedly synchronise with the disk even though
they don't need to do so until the bulk operation is complete. More on this in
the coming months!&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To better support these use-cases, we dropped the requirement for readers to
maintain strict consistency with the writer instance. Instead, readers can call
an explicit &lt;code&gt;sync&lt;/code&gt; function only when they &lt;em&gt;need&lt;/em&gt; to see the latest concurrent
updates from the writer instance.&lt;/p&gt;
&lt;p&gt;In our benchmarks, there is a clear speed-up for &lt;code&gt;find&lt;/code&gt; operations from readers:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[RO] Find in random order with implicit syncs
        Total time: 67.276527
        Operations per second: 148640.253086
        Mbytes per second: 6.378948
        Read amplification in syscalls: 3.919739
        Read amplification in bytes: 63.943734

[RO] Find in random order with only one call to sync
        Total time: 40.817458
        Operations per second: 244993.208543
        Mbytes per second: 10.513968
        Read amplification in syscalls: 0.919588
        Read amplification in bytes: 63.258072&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Not only it is faster, we can see also that fewer system calls are used in the
&lt;code&gt;Read amplification in syscalls&lt;/code&gt; column. The benchmarks consists of reading
10,000,000 entries of 45 bytes each.&lt;/p&gt;
&lt;p&gt;Relevant PRs: &lt;a href=&quot;https://github.com/mirage/irmin/pull/1008&quot;&gt;irmin #1008&lt;/a&gt;,
&lt;a href=&quot;https://github.com/mirage/index/pull/175&quot;&gt;index #175&lt;/a&gt;,
&lt;a href=&quot;https://github.com/mirage/index/pull/198&quot;&gt;index #198&lt;/a&gt; and
&lt;a href=&quot;https://github.com/mirage/index/pull/203&quot;&gt;index #203&lt;/a&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#better-flushing-for-the-read-write-instance&quot; aria-label=&quot;better flushing for the read write instance permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Better flushing for the read-write instance&lt;/h2&gt;
&lt;p&gt;Irmin-pack uses an &lt;a href=&quot;https://github.com/mirage/index/&quot;&gt;index&lt;/a&gt; to speed up &lt;code&gt;find&lt;/code&gt;
calls: a &lt;code&gt;pack&lt;/code&gt; file is used to store pairs of &lt;code&gt;(key, value)&lt;/code&gt; and an &lt;code&gt;index&lt;/code&gt;
records the address in pack where a &lt;code&gt;key&lt;/code&gt; is stored. A read-write instance has
to write both the &lt;code&gt;index&lt;/code&gt; and the &lt;code&gt;pack&lt;/code&gt; file, for a read-only instance to find
a value. Moreover, the order in which the data is flushed to disk for the two
files is important: the address for the pair &lt;code&gt;(key, value)&lt;/code&gt; cannot be written
before the pair itself. Otherwise the read-only instance can read an address for
a non existing &lt;code&gt;(key, value)&lt;/code&gt; pair. But both &lt;code&gt;pack&lt;/code&gt; and &lt;code&gt;index&lt;/code&gt; have internal
buffers that accumulate data, in order to reduce the number of system calls, and
both decide arbitrarily when to flush those buffers to disk.&lt;/p&gt;
&lt;p&gt;We introduce a &lt;code&gt;flush_callback&lt;/code&gt; argument in &lt;code&gt;index&lt;/code&gt;, which registers a callback
for whenever the index decides to flush. &lt;code&gt;irmin-pack&lt;/code&gt; uses this callback to flush
its pack file, resolving the issue of the dangling address.&lt;/p&gt;
&lt;p&gt;Relevant PRs: &lt;a href=&quot;https://github.com/mirage/index/pull/189&quot;&gt;index #189&lt;/a&gt;,
&lt;a href=&quot;https://github.com/mirage/index/pull/216&quot;&gt;index #216&lt;/a&gt;,
&lt;a href=&quot;https://github.com/mirage/irmin/pull/1051&quot;&gt;irmin #1051&lt;/a&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#faster-serialisation-for-irmintype&quot; aria-label=&quot;faster serialisation for irmintype permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Faster serialisation for &lt;code&gt;Irmin.Type&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;Irmin uses a library of &lt;a href=&quot;http://ocamllabs.io/iocamljs/generic_programming.html&quot;&gt;&lt;em&gt;generic&lt;/em&gt;&lt;/a&gt; operations: functions
that take a runtime representation of a type and derive some operation on that
type. These are used in many places to automatically derive encoders and
decoders for our types, which are then used to move data to and from disk. For
instance:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; decode &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; string &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;(** [decode t] is the binary decoder of values represented by [t]. *)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;(** Read an integer from a binary-encoded file. *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; int_of_file &lt;span class=&quot;token label property&quot;&gt;~path&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; open_in_bin path &lt;span class=&quot;token operator&quot;&gt;|&amp;gt;&lt;/span&gt; input_line &lt;span class=&quot;token operator&quot;&gt;|&amp;gt;&lt;/span&gt; decode Irmin&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Type&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;int32&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The generic &lt;code&gt;decode&lt;/code&gt; takes a &lt;em&gt;representation&lt;/em&gt; of the type &lt;code&gt;int32&lt;/code&gt; and uses
this to select the right binary decoder. Unfortunately, we pay the cost of this
runtime specialisation &lt;em&gt;every time&lt;/em&gt; we call &lt;code&gt;int_of_file&lt;/code&gt;. If we're invoking
the decoder for a particular type very often &amp;ndash; such as when serialising store
values &amp;ndash; it's more efficient to specialise &lt;code&gt;decode&lt;/code&gt; once:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;(** Specialised binary decoder for integers. *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; decode_int32 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; decode Irmin&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Type&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;int32

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; int_of_file_fast &lt;span class=&quot;token label property&quot;&gt;~path&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; open_in_bin path &lt;span class=&quot;token operator&quot;&gt;|&amp;gt;&lt;/span&gt; input_line &lt;span class=&quot;token operator&quot;&gt;|&amp;gt;&lt;/span&gt; decode_int32 contents&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The question then becomes: how can we change &lt;code&gt;decode&lt;/code&gt; to encourage it to be
used in this more-efficient way? We can add a type wrapper &amp;ndash; called &lt;code&gt;staged&lt;/code&gt; &amp;ndash;
to prevent the user from passing two arguments to &lt;code&gt;decode&lt;/code&gt; at once:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Staged &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;sig&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt; t
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt;   stage &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt;   &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt; t
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; unstage &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; decode &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;string &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; Staged&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t
&lt;span class=&quot;token comment&quot;&gt;(** [decode t] needs to be explicitly unstaged before being used. *)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By forcing the user to add a &lt;code&gt;Staged.unstage&lt;/code&gt; type coercion when using this
function, we're encouraging them to hoist such operations out of their
hot-loops:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;(** The slow implementation no longer type-checks: *)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; int_of_file &lt;span class=&quot;token label property&quot;&gt;~path&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; open_in_bin path &lt;span class=&quot;token operator&quot;&gt;|&amp;gt;&lt;/span&gt; input_line &lt;span class=&quot;token operator&quot;&gt;|&amp;gt;&lt;/span&gt; decode Irmin&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Type&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;int32
&lt;span class=&quot;token comment&quot;&gt;(* Error: This expression has type (string -&amp;gt; 'a) Staged.t
 *        but an expression was expected of type string -&amp;gt; 'a *)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;(* Instead, we know to pull [Staged.t] values out of hot-loops: *)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; decode_int32 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Staged&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;unstage &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;decode Irmin&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Type&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;int32&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; int_of_file_fast &lt;span class=&quot;token label property&quot;&gt;~path&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; open_in_bin path &lt;span class=&quot;token operator&quot;&gt;|&amp;gt;&lt;/span&gt; input_line &lt;span class=&quot;token operator&quot;&gt;|&amp;gt;&lt;/span&gt; decode_int32 contents&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We made similar changes to the performance-critical generic functions in
&lt;a href=&quot;https://mirage.github.io/irmin/irmin/Irmin/Type/index.html&quot;&gt;&lt;code&gt;Irmin.Type&lt;/code&gt;&lt;/a&gt;, and observed significant performance improvements.
We also added benchmarks for serialising various types.&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
  &lt;img src=&quot;https://tarides.com/staged-type.svg&quot; style=&quot;height: 550px; max-width: 100%&quot;/&gt;
&lt;/div&gt;
&lt;p&gt;Relevant PRs: &lt;a href=&quot;https://github.com/mirage/irmin/pull/1030&quot;&gt;irmin #1030&lt;/a&gt; and
&lt;a href=&quot;https://github.com/mirage/irmin/pull/1028&quot;&gt;irmin #1028&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There are other interesting factors at play, such as altering &lt;code&gt;decode&lt;/code&gt; to
increase the efficiency of the specialised decoders; we leave this for a future
blog post.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#more-control-over-indexmerge&quot; aria-label=&quot;more control over indexmerge permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;More control over &lt;code&gt;Index.merge&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;index regularly does a maintenance operation, called &lt;code&gt;merge&lt;/code&gt;, to ensure fast
look-ups while having a small memory imprint. This operation is concurrent with
the most of other functions, it is however not concurrent with itself: a second
merge needs to wait for a previous one to finish. When writing big chunks of
data very often, &lt;code&gt;merge&lt;/code&gt; operations become blocking. To help measuring and
detecting a blocking &lt;code&gt;merge&lt;/code&gt;, we added in the &lt;code&gt;index&lt;/code&gt; API calls to check whether
a merge is ongoing, and to time it.&lt;/p&gt;
&lt;p&gt;We mentioned that &lt;code&gt;merge&lt;/code&gt; is concurrent with most of the other function in
&lt;code&gt;index&lt;/code&gt;. One notable exception was &lt;code&gt;close&lt;/code&gt;, which had to wait for any ongoing
&lt;code&gt;merge&lt;/code&gt; to finish, before closing the index. Now &lt;code&gt;close&lt;/code&gt; interrupts an ongoing
merge, but still leaves the index in a clean state.&lt;/p&gt;
&lt;p&gt;Relevant PRs: &lt;a href=&quot;https://github.com/mirage/index/pull/185&quot;&gt;index #185&lt;/a&gt;,
&lt;a href=&quot;https://github.com/mirage/irmin/pull/1049&quot;&gt;irmin #1049&lt;/a&gt; and
&lt;a href=&quot;https://github.com/mirage/index/pull/215&quot;&gt;index #215&lt;/a&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#clearing-stores&quot; aria-label=&quot;clearing stores permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Clearing stores&lt;/h2&gt;
&lt;p&gt;Another feature we recently added is the possibility to &lt;code&gt;clear&lt;/code&gt; the store. It is
implemented by removing the old files on disk and opening fresh ones. However
in &lt;code&gt;irmin-pack&lt;/code&gt;, the read-only instance has to detect that a clear occurred. To
do this, we add a &lt;code&gt;generation&lt;/code&gt; in the header of the files used by an
&lt;code&gt;irmin-pack&lt;/code&gt; store, which is increased by the clear operation. A generation
change signals to the read-only instance that it needs to close the file and
open it again, to be able to read the latest values.&lt;/p&gt;
&lt;p&gt;As the header of the files on disk changed with the addition of the clear
operation, the &lt;code&gt;irmin-pack&lt;/code&gt; stores created previous to this change are no longer
supported. We added a migration function for stores created with the previous
version (version 1) to the new version (version 2) of the store. You can call
this migration function as follows:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt; &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; open_store &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    Store&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Repo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;v config
  &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  Lwt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;catch open_store &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Irmin_pack&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Unsupported_version &lt;span class=&quot;token variant symbol&quot;&gt;`V1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
          Logs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;app &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; l &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; l &lt;span class=&quot;token string&quot;&gt;&amp;quot;migrating store to version 2&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          Store&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;migrate config &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          Logs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;app &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; l &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; l &lt;span class=&quot;token string&quot;&gt;&amp;quot;migration ended, opening store&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          open_store &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; exn &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
          Lwt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fail exn&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Relevant PRs: &lt;a href=&quot;https://github.com/mirage/index/pull/211&quot;&gt;index #211&lt;/a&gt;,
&lt;a href=&quot;https://github.com/mirage/irmin/pull/1047&quot;&gt;irmin #1047&lt;/a&gt;,
&lt;a href=&quot;https://github.com/mirage/irmin/pull/1070&quot;&gt;irmin #1070&lt;/a&gt; and
&lt;a href=&quot;https://github.com/mirage/irmin/pull/1071&quot;&gt;irmin #1071&lt;/a&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;We hope you've enjoyed this discussion of our recent work. &lt;a href=&quot;https://twitter.com/tarides_&quot;&gt;Stay
tuned&lt;/a&gt; for our next Tezos / MirageOS development update! Thanks
to our commercial customers, users and open-source contributors for making this
work possible.&lt;/p&gt;</content><id>https://tarides.com/blog/2020-09-08-irmin-september-2020-update</id><title type="text">Irmin: September 2020 update</title><updated>2020-09-08T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2020-09-01-introducing-irmin-pack" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;&lt;code&gt;irmin-pack&lt;/code&gt; is an Irmin &lt;a href=&quot;https://irmin.org/tutorial/backend&quot;&gt;storage backend&lt;/a&gt;
that we developed over the last year specifically to meet the
&lt;a href=&quot;https://tezos.gitlab.io/&quot;&gt;Tezos&lt;/a&gt; use-case. Tezos nodes were initially using an
LMDB-based backend for their storage, which after only a year of activity led to
&lt;code&gt;250 GB&lt;/code&gt; disk space usage, with a monthly growth of &lt;code&gt;25 GB&lt;/code&gt;. Our goal was to
dramatically reduce this disk space usage.&lt;/p&gt;
&lt;p&gt;Part of the &lt;a href=&quot;https://tarides.com/blog/2019-11-21-irmin-v2&quot;&gt;Irmin.2.0.0 release&lt;/a&gt;
and still under active development, it has been successfully integrated as the
storage layer of Tezos nodes and has been running in production for the last ten
months with great results. It reduces disk usage by a factor of 10, while still
ensuring similar performance and consistency guarantees in a memory-constrained
and concurrent environment.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;irmin-pack&lt;/code&gt; was presented along with Irmin v2 at the OCaml workshop 2020; you
can watch the presentation here:&lt;/p&gt;
&lt;div style=&quot;position: relative; width: 100%; height: 0; padding-bottom: 56.25%&quot;&gt;
  &lt;iframe style=&quot;position: absolute; width: 100%; height: 100%; left: 0; right: 0&quot; src=&quot;https://www.youtube-nocookie.com/embed/v1lfMUM332w&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;allowfullscreen&quot;&gt;
  &lt;/iframe&gt;
&lt;/div&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#general-structure&quot; aria-label=&quot;general structure permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;General structure&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;irmin-pack&lt;/code&gt; exposes functors that allow the user to provide arbitrary low-level
modules for handling I/O, and provides a fast key-value store interface composed
of three components:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The &lt;code&gt;pack&lt;/code&gt; is used to store the data contained in the Irmin store, as blobs.&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;dict&lt;/code&gt; stores the paths where these blobs should live.&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;index&lt;/code&gt; keeps track of the blobs that are present in the repository by
containing location information in the &lt;code&gt;pack&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Each of these use both on-disk storage for persistence and concurrence and
various in-memory caches for speed.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#storing-the-data-in-the-pack-file&quot; aria-label=&quot;storing the data in the pack file permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Storing the data in the &lt;code&gt;pack&lt;/code&gt; file&lt;/h3&gt;
&lt;p&gt;The &lt;code&gt;pack&lt;/code&gt; contains most of the data stored in this Irmin backend. It is an
append-only file containing the serialized data stored in the Irmin repository.
All three Irmin stores (see our &lt;a href=&quot;https://irmin.org/tutorial/architecture&quot;&gt;architecture
page&lt;/a&gt; in the tutorial to learn more)
are contained in this single file.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Content&lt;/code&gt; and &lt;code&gt;Commit&lt;/code&gt; serialization is straightforward through
&lt;a href=&quot;https://docs.mirage.io/irmin/Irmin/Type/index.html&quot;&gt;&lt;code&gt;Irmin.Type&lt;/code&gt;&lt;/a&gt;. They are written along with their length (to allow
correct reading) and hash (to enable integrity checks). The hash is used to
resolve internal links inside the pack when nodes are written.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/65f80d5690bb49cd0ead891e2e7346c8/f989d/pack.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 16.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMACSfAAAknwAFlKNyIAAAAxElEQVR42hXD2U6DQABAUf7/i0xcEh9caAVBqAYLDAzKPk6BgdBico0nOZYpckyv6UbNaVHo5YfeKApV0YwlnWnoTE071VSnhm9doeaedjihF8W6Dmznict55PdisNT1FYe7Bx7jAFfu2QsbV/rceK8EtYcrHXapTdj6PMch96GDk79w6/nY8ROq92mlQ5Xt2EyCNR/eqD5iPuucTCWI/n/Gu5RILRB9StolFFoQlSlBHnFsI3xxJG4iZvPFOpWYQbKtLX982NrkDApgDQAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/65f80d5690bb49cd0ead891e2e7346c8/c5bb3/pack.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;The pack file&quot; title=&quot;&quot; srcset=&quot;/static/65f80d5690bb49cd0ead891e2e7346c8/04472/pack.png 170w,
/static/65f80d5690bb49cd0ead891e2e7346c8/9f933/pack.png 340w,
/static/65f80d5690bb49cd0ead891e2e7346c8/c5bb3/pack.png 680w,
/static/65f80d5690bb49cd0ead891e2e7346c8/b12f7/pack.png 1020w,
/static/65f80d5690bb49cd0ead891e2e7346c8/b5a09/pack.png 1360w,
/static/65f80d5690bb49cd0ead891e2e7346c8/f989d/pack.png 5206w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#optimizing-large-nodes&quot; aria-label=&quot;optimizing large nodes permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Optimizing large nodes&lt;/h4&gt;
&lt;p&gt;Serializing nodes is not as simple as contents. In fact, nodes might contain an
arbitrarily large number of children, and serializing them as a long list of
references might harm performance, as that means loading and writing a large
amount of data for each modification, no matter how small this modification
might be. Similarly, browsing the tree means reading large blocks of data, even
though only one child is needed.&lt;/p&gt;
&lt;p&gt;For this reason, we implemented a &lt;a href=&quot;https://en.wikipedia.org/wiki/Radix_tree&quot;&gt;Patricia Tree&lt;/a&gt; representation of
internal nodes that allows us to split the child list into smaller parts that
can be accessed and modified independently, while still being quickly available
when needed. This reduces duplication of tree data in the Irmin store and
improves disk access times.&lt;/p&gt;
&lt;p&gt;Of course, we provide a custom hashing mechanism, so that hashing the nodes
using this partitioning is still backwards-compatible for users who rely on hash
information regardless of whether the node is split or not.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#optimizing-internal-references&quot; aria-label=&quot;optimizing internal references permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Optimizing internal references&lt;/h4&gt;
&lt;p&gt;In the Git model, all data are content-addressable (i.e. data are always
referenced by their hash). This naturally lends to indexing data by hashes on
the disk itself (i.e. the links from &lt;code&gt;commits&lt;/code&gt; to &lt;code&gt;nodes&lt;/code&gt; and from &lt;code&gt;nodes&lt;/code&gt; to
&lt;code&gt;nodes&lt;/code&gt; or &lt;code&gt;contents&lt;/code&gt; are realized by hash).&lt;/p&gt;
&lt;p&gt;We did not comply to this approach in &lt;code&gt;irmin-pack&lt;/code&gt;, for at least two reasons:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Referencing by hash does not allow fast recovery of the children, since
there is no way to find the relevant blob directly in the &lt;code&gt;pack&lt;/code&gt; by providing
the hash. We will go into the details of this later in this post.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;While hashes are being used as simple objects, their size is not negligible.
The default hashing function in Irmin is BLAKE2B, which provides 32-byte
digests.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Instead, our internal links in the &lt;code&gt;pack&lt;/code&gt; file are concretized by the offsets &amp;ndash;
&lt;code&gt;int64&lt;/code&gt; integers &amp;ndash; of the children instead of their hash. Provided that the
trees are always written bottom-up (so that children already exist in the &lt;code&gt;pack&lt;/code&gt;
when their parents are written), this solves both issues above. The data handled
by the backend is always immutable, and the file is append-only, ensuring that
the links can never be broken.&lt;/p&gt;
&lt;p&gt;Of course, that encoding does not break the content-addressable property: one
can always retrieve an arbitrary piece of data through its hash, but it allows
internal links to avoid that indirection.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#deduplicating-the-path-names-through-the-dict&quot; aria-label=&quot;deduplicating the path names through the dict permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Deduplicating the path names through the &lt;code&gt;dict&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;In fact, the most common operations when using &lt;code&gt;irmin-pack&lt;/code&gt; consist of modifying
the tree's leaves rather then its shape. This is similar to the way most of us
use Git: modifying the contents of files is very frequent, while renaming or
adding new files is rather rare. Even still, when writing a &lt;code&gt;node&lt;/code&gt; in a new
commit, that node must contain the path names of its children, which end up
being duplicated a large number of times.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;dict&lt;/code&gt; is used for deduplication of path names so that the &lt;code&gt;pack&lt;/code&gt; file can
uniquely reference them using shorter identifiers. It is composed of an
in-memory bidirectional hash table, allowing to query from path to identifier
when serializing and referencing, and from identifier to path when deserializing
and dereferencing.&lt;/p&gt;
&lt;p&gt;To ensure persistence of the data across multiple runs and in case of crashes,
the small size of the &lt;code&gt;dict&lt;/code&gt; &amp;ndash; less than &lt;code&gt;15 Mb&lt;/code&gt; in the Tezos use-case &amp;ndash; allows
us to write the bindings to a write-only, append-only file that is fully read
and loaded on start-up.&lt;/p&gt;
&lt;p&gt;We guarantee that the &lt;code&gt;dict&lt;/code&gt; memory usage is bounded by providing a &lt;code&gt;capacity&lt;/code&gt;
parameter. Adding a binding is guarded by this capacity, and will be inlined in
the &lt;code&gt;pack&lt;/code&gt; file in case this limit has been reached. This scenario does not
happen during normal use of &lt;code&gt;irmin-pack&lt;/code&gt;, but prevents attacks that would make
the memory grow in an unbounded way.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/cec17f425cdf458a385babbac24c0c04/f7171/dict.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 46.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMACSfAAAknwAFlKNyIAAAByklEQVR42m2Q627aQBCFef8nqkL+UEIaDPiCMZcmBHzDlAQCGHvt3bW/CCetUrUjjc7RnJkzo2kFz88oIVCyoFQFUpcNlrr84PoL/9SvqbWk0hqtFVWlqbRqeOtw10WaFtHcwN25TJMx7sbE246ZJA7jxGL2a8IksXG/8MNxgbz4FOcVp9efDaosohXdfCO5vcXrt+k93mP5I3qLLg+PP7CCEXfzDsaTgR1adGcdjGUfMxhyOHq8hBaLSYfVoscuMkFGtN7uvpP3+6zce8zYxIlGWMGAcWThxjZ2OMKJbYbBQ1OfbFys6Go4o7r4iNOS426KOD1RiYiWulzQWYYsMmpqXtOEtDghK0kuM05izyHbsTmuGxQqY5fGiDJDa41SsvndFWVZ0uIzruJiviC9pAh1oVA5WZEilaSu64+eSiFk3ix6y1+bA67ab/0afwypFZvApWPP8bYuVmiw3U+p85gy9RHnNXURsEliup6HkwyZJg7p8Qkq9R9DNCIPaQ88RmuLwcpgf56BDKhLv0m0TxSvaQ9tRqsh49BE5I/NbP2voSLdL7kxPKzQZOD3SV7G1NkamS4pz0sQzwTBirbpYEUDnHBAepz9deE7HPGfVfCYxccAAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/cec17f425cdf458a385babbac24c0c04/c5bb3/dict.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;The dict&quot; title=&quot;&quot; srcset=&quot;/static/cec17f425cdf458a385babbac24c0c04/04472/dict.png 170w,
/static/cec17f425cdf458a385babbac24c0c04/9f933/dict.png 340w,
/static/cec17f425cdf458a385babbac24c0c04/c5bb3/dict.png 680w,
/static/cec17f425cdf458a385babbac24c0c04/b12f7/dict.png 1020w,
/static/cec17f425cdf458a385babbac24c0c04/b5a09/dict.png 1360w,
/static/cec17f425cdf458a385babbac24c0c04/f7171/dict.png 3456w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#retrieve-the-data-in-the-pack-by-indexing&quot; aria-label=&quot;retrieve the data in the pack by indexing permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Retrieve the data in the &lt;code&gt;pack&lt;/code&gt; by indexing&lt;/h3&gt;
&lt;p&gt;Since the &lt;code&gt;pack&lt;/code&gt; file is append-only, naively reading its data would require a
linear search through the whole file for each lookup. Instead, we provide an
index that maps hashes of data blocks to their location in the &lt;code&gt;pack&lt;/code&gt; file,
along with their length. This module allows quick recovery of the values queried
by hash.&lt;/p&gt;
&lt;p&gt;It provides a simple key-value interface, that actually hides the most complex
part of &lt;code&gt;irmin-pack&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t
&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; v &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; readonly&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;bool &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;string &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; t

&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; find    &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; Key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; Value&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t
&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; replace &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; Key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; Value&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; unit
&lt;span class=&quot;token comment&quot;&gt;(* ... *)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It has lead most of our efforts in the development of &lt;code&gt;irmin-pack&lt;/code&gt; and is now
available as a separate library, wisely named &lt;code&gt;index,&lt;/code&gt; that you can checkout on
GitHub under &lt;a href=&quot;https://github.com/mirage/index/&quot;&gt;mirage/index&lt;/a&gt; and via &lt;code&gt;opam&lt;/code&gt; as
the &lt;code&gt;index&lt;/code&gt; and &lt;code&gt;index-unix&lt;/code&gt; packages.&lt;/p&gt;
&lt;p&gt;When &lt;code&gt;index&lt;/code&gt; is used inside &lt;code&gt;irmin-pack&lt;/code&gt;, the keys are the hashes of the data
stored in the backend, and the values are the &lt;code&gt;(offset, length)&lt;/code&gt; pair that
indicates the location in the &lt;code&gt;pack&lt;/code&gt; file. From now on in this post, we will
stick to the &lt;code&gt;index&lt;/code&gt; abstraction: &lt;code&gt;key&lt;/code&gt; and &lt;code&gt;value&lt;/code&gt; will refer to the keys and
values as viewed by the &lt;code&gt;index&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Our index is split into two major parts. The &lt;code&gt;log&lt;/code&gt; is relatively small, and most
importantly, bounded; it contains the recently-added bindings. The &lt;code&gt;data&lt;/code&gt; is
much larger, and contains older bindings.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;log&lt;/code&gt; part consists of a hash table associating keys to values. In order to
ensure concurrent access, and to be able to recover on a crash, we also maintain
a write-only, append-only file with the same contents, such that both always
contain exactly the same data at any time.&lt;/p&gt;
&lt;p&gt;When a new key-value binding is added index, the value is simply serialized
along with its key and added to the &lt;code&gt;log&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;An obvious caveat of this approach is that the in-memory representation of the
&lt;code&gt;log&lt;/code&gt; (the hashtable) is unbounded. It also grows a lot, as the Tezos node
stores more that 400 million objects. Our memory constraint obviously does not
allow such unbounded structures. This is where the &lt;code&gt;data&lt;/code&gt; part comes in.&lt;/p&gt;
&lt;p&gt;When the &lt;code&gt;log&lt;/code&gt; size reaches a &amp;ndash; customizable &amp;ndash; threshold, its bindings are
flushed into a &lt;code&gt;data&lt;/code&gt; component, that may already contain flushed data from
former &lt;code&gt;log&lt;/code&gt; overloads. We call this operation a &lt;em&gt;merge&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/7663e5dd55a9fa612393be5ae1952bf5/e9c53/merges.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 28.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAC4jAAAuIwF4pT92AAABOElEQVR42n2RW2+bQBBG+f8/q47dgoNqO059C3dc2GUJhtT1wi4+lYnUt/aTjmY0M+dpnOi0Y58cOKucoimQTUl7qbg0kvYi0VrzyP1+x1o71f/Fib4/4WYebrhgHszZZkvqYkMeetTllkpVGDtie80hWPEmDmRNSFIHpHVI+v5JXJ9QvwTOOYtIZYq8SEQrqVpJ/S5QqqRSBTetMdZSNzXrzMPPXPz028Rzupjw06+48YxQHXH8xGOdPLMTG/byhV35wg+x4bVcsxdbtLkx9IZSiUlyoy948Yxl/MQq91jnS1bZEj9ZEKs3nGmZzD+PJ2E2CY/eTxd0v1usGbGjQXycKdqcqAoQ3U/sOHBnZDA9erhhrMEJqyOhOhH95chjdixeCcSB6+2K7gfaruOju9L3FmPGfz7lD0L+u/4GU3CHAAAAAElFTkSuQmCC'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/7663e5dd55a9fa612393be5ae1952bf5/c5bb3/merges.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Merging the index&quot; title=&quot;&quot; srcset=&quot;/static/7663e5dd55a9fa612393be5ae1952bf5/04472/merges.png 170w,
/static/7663e5dd55a9fa612393be5ae1952bf5/9f933/merges.png 340w,
/static/7663e5dd55a9fa612393be5ae1952bf5/c5bb3/merges.png 680w,
/static/7663e5dd55a9fa612393be5ae1952bf5/b12f7/merges.png 1020w,
/static/7663e5dd55a9fa612393be5ae1952bf5/b5a09/merges.png 1360w,
/static/7663e5dd55a9fa612393be5ae1952bf5/e9c53/merges.png 7470w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The important invariant maintained by the &lt;code&gt;merge&lt;/code&gt; operation is that the &lt;code&gt;data&lt;/code&gt;
file must remain sorted by the hash of the bindings. This will enable a fast
recovery of the data.&lt;/p&gt;
&lt;p&gt;During this operation, both the &lt;code&gt;log&lt;/code&gt; and the former &lt;code&gt;data&lt;/code&gt; are read in sorted
order &amp;ndash; &lt;code&gt;data&lt;/code&gt; is already sorted, and &lt;code&gt;log&lt;/code&gt; is small thus easy to sort in
memory &amp;ndash; and merged into a &lt;code&gt;merging_data&lt;/code&gt; file. This file is atomically renamed
at the end of the operation to replace the older &lt;code&gt;data&lt;/code&gt; while still ensuring
correct concurrent accesses.&lt;/p&gt;
&lt;p&gt;This operation obviously needs to re-write the whole index, so its execution
is very expensive. For this reason, it is performed by a separate thread in the
background to still allow regular use of the index and be transparent to the
user.&lt;/p&gt;
&lt;p&gt;In the meantime, a &lt;code&gt;log_async&lt;/code&gt; &amp;ndash; similar to &lt;code&gt;log&lt;/code&gt;, with a file and a hash table
&amp;ndash; is used to hold new bindings and ensure the data being merged and the new data
are correctly separated. At the end of the merge, the &lt;code&gt;log_async&lt;/code&gt; becomes the
new &lt;code&gt;log&lt;/code&gt; and is cleared to be ready for the next merge.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#recovering-the-data&quot; aria-label=&quot;recovering the data permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Recovering the data&lt;/h4&gt;
&lt;p&gt;This design allows us a fast lookup of the data present in the index. Whenever
&lt;code&gt;find&lt;/code&gt; or &lt;code&gt;mem&lt;/code&gt; is called, we first look into the &lt;code&gt;log&lt;/code&gt;, which is simply a call
to the corresponding &lt;code&gt;Hashtbl&lt;/code&gt; function, since this data is contained in memory.
If the data is not found in the &lt;code&gt;log&lt;/code&gt;, the &lt;code&gt;data&lt;/code&gt; file will be browsed. This
means access to recent values is generally faster, because it does not require
any access to the disk.&lt;/p&gt;
&lt;p&gt;Searching in the &lt;code&gt;data&lt;/code&gt; file is made efficient by the invariant that we kept
during the &lt;code&gt;merge&lt;/code&gt;: the file is sorted by hash. The search algorithm consists in
an interpolation search, which is permitted by the even distribution of the
hashes that we store. The theoretical complexity of the interpolation search is
&lt;code&gt;O(log (log n))&lt;/code&gt;, which is generally better than a binary search, provided that
the computation of the interpolant is cheaper than reads, which is the case
here.&lt;/p&gt;
&lt;p&gt;This approach allows us to find the data using approximately 5-6 reading steps
in the file, which is good, but still a source of slowdowns. For this reason, we
use a fan-out module on top of the interpolation search, able to tell us the
exact page in which a given key is located, in constant time, for an additional
space cost of &lt;code&gt;~100 Mb&lt;/code&gt;. We use this to find the correct page of the disk, then
run the interpolation search in that page only. That approach allows us to find
the correct value with a single read in the &lt;code&gt;data&lt;/code&gt; file.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;This new backend is now used byt the Tezos nodes in production, and manages to
reduce the storage size from &lt;code&gt;250 Gb&lt;/code&gt; down to &lt;code&gt;25 Gb&lt;/code&gt;, with a monthly growth
rate of &lt;code&gt;2 Gb&lt;/code&gt; , achieving a tenfold reduction.&lt;/p&gt;
&lt;p&gt;In the meantime, it provides and single writer, multiple readers access pattern
that enables bakers and clients to connect to the same storage while it is operated.&lt;/p&gt;
&lt;p&gt;On the memory side, all our components are memory bounded, and the bound is
generally customizable, the largest source of memory usage being the &lt;code&gt;log&lt;/code&gt; part
of the &lt;code&gt;index&lt;/code&gt;. While it can be reduced to fit in &lt;code&gt;1 Gb&lt;/code&gt; of memory and run on
small VPS or Raspberry Pi, one can easily set a higher memory limit on a more
powerful machine, and achieve even better time performance.&lt;/p&gt;</content><id>https://tarides.com/blog/2020-09-01-introducing-irmin-pack</id><title type="text">Introducing irmin-pack</title><updated>2020-09-01T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2020-08-03-fuzzing-ocamlformat-with-afl-and-crowbar" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;&lt;a href=&quot;https://lcamtuf.coredump.cx/afl/&quot;&gt;AFL&lt;/a&gt; (and fuzzing in general) is often used
to find bugs in low-level code like parsers, but it also works very well to find
bugs in high level code, provided the right ingredients. We applied this
technique to feed random programs to OCamlFormat and found many formatting bugs.&lt;/p&gt;
&lt;p&gt;OCamlFormat is a tool to format source code. To do so, it parses the source code
to an Abstract Syntax Tree (AST) and then applies formatting rules to the AST.&lt;/p&gt;
&lt;p&gt;It can be tricky to correctly format the output. For example, say we want to
format &lt;code&gt;(a+b)*c&lt;/code&gt;. The corresponding AST will look like &lt;code&gt;Apply(&amp;quot;*&amp;quot;, Apply (&amp;quot;+&amp;quot;, Var &amp;quot;a&amp;quot;, Var &amp;quot;b&amp;quot;), Var &amp;quot;c&amp;quot;)&lt;/code&gt;. A naive formatter would look like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;rec&lt;/span&gt; format &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Var s &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; s
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Apply &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;op&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
      Printf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sprintf &lt;span class=&quot;token string&quot;&gt;&amp;quot;%s %s %s&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;format e1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; op &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;format e2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;But this is not correct, as it will print &lt;code&gt;(a+b)*c&lt;/code&gt; as &lt;code&gt;a+b*c&lt;/code&gt;, which is a
different program. In this particular case, the common solution would be to
track the relative precedence of the expressions and to emit only necessary
parentheses.&lt;/p&gt;
&lt;p&gt;OCamlFormat has similar cases. To make sure we do not change a program when
formatting it, there is an extra check at the end to parse the output and
compare the output AST with the input AST. This ensures that, in case of bugs,
OCamlFormat exits with an error rather than changing the meaning of the input
program.&lt;/p&gt;
&lt;p&gt;When we consider the whole OCaml language, the rules are complex and it is
difficult to make sure that we are correctly handling all programs. There are
two main failure modes: either we put too many parentheses, and the program does
not look good, or we do not put enough, and the AST changes (and OCamlFormat
exits with an error). We need a way to make sure that the latter does not
happen. Tests work to some extent, but some edge cases happen only when a
certain combination of language features is used. Because of this combinatorial
explosion, it is impossible to get good coverage using tests only.&lt;/p&gt;
&lt;p&gt;Fortunately there is a technique we can use to automatically explore the program
space: fuzzing. For a primer on using this technique on OCaml programs, one can
refer to &lt;a href=&quot;https://tarides.com/blog/2019-09-04-an-introduction-to-fuzzing-ocaml-with-afl-crowbar-and-bun&quot;&gt;this article&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;To make this work we need two elements: a random program generator, and a
property to check. Here, we are interested in programs that are valid (in the
sense that they parse correctly) but do not format correctly. We can use the
OCamlFormat internals to do the following:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;try to parse input: in case of a parse error, just reject this input as&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;invalid.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;otherwise, with have a valid program. try to format it. If this happens with&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;no error at all, reject this input as well.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;otherwise, it means that the AST changed, comments moved, or something&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;similar, in a valid program. This is what we are after.&lt;/p&gt;
&lt;p&gt;Generating random programs is a bit more difficult. We can feed random strings
to AFL, but even with a corpus of existing valid code it will generate many
invalid programs. We are not interested in these for this project, we would
rather start from valid programs.&lt;/p&gt;
&lt;p&gt;A good way to do that is to use Crowbar to directly generate AST values. Thanks
to &lt;a href=&quot;https://github.com/yomimono/ppx_deriving_crowbar&quot;&gt;&lt;code&gt;ppx_deriving_crowbar&lt;/code&gt;&lt;/a&gt; and &lt;a href=&quot;https://github.com/ocaml-ppx/ppx_import&quot;&gt;&lt;code&gt;ppx_import&lt;/code&gt;&lt;/a&gt;
it is possible to generate random values for an external type like
&lt;code&gt;Parsetree.structure&lt;/code&gt; (the contents of &lt;code&gt;.ml&lt;/code&gt; files). Even more fortunately
&lt;a href=&quot;https://github.com/yomimono/ocaml-test-omp/blob/d086037027537ba4e23ce027766187979c85aa3d/test/parsetree_405.ml&quot;&gt;somebody already did the work&lt;/a&gt;. Thanks, Mindy!&lt;/p&gt;
&lt;p&gt;This approach works really well: it generates 5k-10k programs per second, which
is very good performance (AFL starts complaining below 100/s).&lt;/p&gt;
&lt;p&gt;Quickly, AFL was able to find crashes related to attributes. These are &amp;quot;labels&amp;quot;
attached to various nodes of the AST. For example the expression &lt;code&gt;(x || y) [@a]&lt;/code&gt;
(logical or between &lt;code&gt;x&lt;/code&gt; and &lt;code&gt;y&lt;/code&gt;, attach attribute &lt;code&gt;a&lt;/code&gt; to the &amp;quot;or&amp;quot; expression)
would get formatted as &lt;code&gt;x || y [@a]&lt;/code&gt; (attribute &lt;code&gt;a&lt;/code&gt; is attached to the &lt;code&gt;y&lt;/code&gt;
variable). Once again, there is a check in place in OCamlFormat to make sure
that it does not save the file in this case, but it would exit with an error.&lt;/p&gt;
&lt;p&gt;After the fuzzer has run for a bit longer, it found crashes where comments would
jump around in expressions like &lt;code&gt;f (*a*) (*bb*) x&lt;/code&gt;. Wait, what? We never told
the program generator how to generate comments. Inspecting the intermediate AST,
the part in the middle is actually an integer literal with value &lt;code&gt;&amp;quot;(*a*) (*bb*)&amp;quot;&lt;/code&gt; (integer literals are represented as strings so that &lt;a href=&quot;https://github.com/Drup/Zarith-ppx&quot;&gt;a third party
library could add literals for arbitrary precision numbers&lt;/a&gt; for
example).&lt;/p&gt;
&lt;p&gt;AFL comes with a program called &lt;code&gt;afl-tmin&lt;/code&gt; that is used to minimize a crash. It
will try to find a smaller example of a program that crashes OCamlFormat. It
works well even with Crowbar in between. For example it is able to turn &lt;code&gt;(new aaaaaa &amp;amp; [0;0;0;0])[@aaaaaaaaaa]&lt;/code&gt; into &lt;code&gt;(0&amp;amp;0)[@a]&lt;/code&gt; (neither AFL nor OCamlFormat
knows about types, so they can operate on nonsensical programs. Finding a
well-typed version of a crash is usually not very difficult, but it has to be
done manually).&lt;/p&gt;
&lt;p&gt;In total, letting AFL run overnight on a single core (that is relatively short
in terms of fuzzing) caused 453 crashes. After minimization and deduplication,
this corresponded to &lt;a href=&quot;https://github.com/ocaml-ppx/ocamlformat/issues?q=label:fuzz&quot;&gt;about 30 unique issues&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Most of them are related to attributes that OCamlFormat did not try to include
in the output, or where it forgot to add parentheses. Fortunately, there are
safeguards in OCamlFormat: since it checks that the formatting preserves the AST
structure, it will exit with an error instead of outputting a different program.&lt;/p&gt;
&lt;p&gt;Once again, fuzzing has proved itself as a powerful technique to find actual
bugs (including high-level ones). A possible approach for a next iteration is to
try to detect more problems during formatting, such as finding cases where lines
are longer than allowed. It is also possible to extend the random program
generator so that it tries to generate comments, and let OCamlFormat check that
they are all laid out correctly in the output. We look forward to employing
fuzzing more extensively for OCamlFormat development in future.&lt;/p&gt;</content><id>https://tarides.com/blog/2020-08-03-fuzzing-ocamlformat-with-afl-and-crowbar</id><title type="text">Fuzzing OCamlFormat with AFL and Crowbar</title><updated>2020-08-03T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2020-04-20-the-future-of-tezos-on-mirageos" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;We are very glad to announce that Tarides has been awarded two new grants from
the Tezos Foundation.&lt;/p&gt;
&lt;p&gt;Thanks to these new grants, Tarides will continue to work on the integration
between Tezos and MirageOS. We believe that the secure deployment of blockchains
is still a major challenge today, and that deploying Tezos as a unikernel will
have a big impact in term of safety and security. It will be a key
differentiator that will separate Tezos from other blockchains.&lt;/p&gt;
&lt;p&gt;The Tezos codebase is written in OCaml and is currently using more than 100
external packages, among which one third comes from the MirageOS project.
However, it still heavily depends on non-compatible Unix libraries. Making the
Tezos codebase fully compatible with MirageOS will help Tezos with: distribution
and packaging, portability, secure deployment and operational safety.&lt;/p&gt;
&lt;p&gt;We&amp;rsquo;ll regularly publish development progress updates, so stay tuned!&lt;/p&gt;</content><id>https://tarides.com/blog/2020-04-20-the-future-of-tezos-on-mirageos</id><title type="text">The future of Tezos on MirageOS</title><updated>2020-04-20T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2019-12-11-tarides-wins-the-fic-2020-startup-award" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;We are very excited to announce that Tarides has &lt;a href=&quot;https://www.forum-fic.com/en/home/price/the-fic-start-up-award.htm&quot;&gt;won an
award&lt;/a&gt;
from the International Cybersecurity Forum (FIC 2020).&lt;/p&gt;
&lt;p&gt;Organized every year in Lille (France), the International
Cybersecurity Forum has become the leading European event on
cybersecurity and digital trust. Its main goal is to foster reflection
and exchanges within the European cybersecurity ecosystem.&lt;/p&gt;
&lt;p&gt;We are very happy to have won the &amp;quot;Coup de Coeur&amp;quot; Prize, which will
bring great visibility to our technological innovations. It is also an
opportunity for us to meet experts in the cybersecurity sector and to
consider additional use-cases for our work. We would like to thank the
&lt;a href=&quot;https://ceis.eu/&quot;&gt;CEIS&lt;/a&gt; for organising the event and the members of
the jury for commending &lt;a href=&quot;https://mirage.io&quot;&gt;MirageOS&lt;/a&gt; and
&lt;a href=&quot;https://tarides.com/blog/2019-07-05-i-lab-2019&quot;&gt;OSMOSE&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The next FIC will be held on the 28th, 29th and 30th of January
2020 in Lille. For more details about the FIC and to register, visit
&lt;a href=&quot;https://www.forum-fic.com/en/home.htm&quot;&gt;their website&lt;/a&gt;.&lt;/p&gt;
&lt;br/&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/dc5973af18f70eb3d969d8aa1c8dfae6/9c311/FIC2020.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 47.64705882352941%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAME/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgAB/9oADAMBAAIQAxAAAAHfTStgsL//xAAaEAACAgMAAAAAAAAAAAAAAAABAgAQERIh/9oACAEBAAEFAg2pRi0z2//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/AVf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAbEAACAQUAAAAAAAAAAAAAAAAAARESICExkf/aAAgBAQAGPwKhN8E5wbs//8QAHBAAAgICAwAAAAAAAAAAAAAAAREAIRBBYbHh/9oACAEBAAE/IdZlWXcApvx5CbKmQKE//9oADAMBAAIAAwAAABBr/wD/xAAYEQACAwAAAAAAAAAAAAAAAAAAEQExUf/aAAgBAwEBPxBS7Ew//8QAFhEBAQEAAAAAAAAAAAAAAAAAABEB/9oACAECAQE/ELiP/8QAHBABAQACAgMAAAAAAAAAAAAAAREAITGxQWGB/9oACAEBAAE/EAN5gjIxWw3eem4KGWdMF5ZqN1DOJ8yFkJDvAJAaz//Z'); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/dc5973af18f70eb3d969d8aa1c8dfae6/7bf67/FIC2020.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;FIC2020 Startup Award Winners&quot; title=&quot;&quot; srcset=&quot;/static/dc5973af18f70eb3d969d8aa1c8dfae6/651be/FIC2020.jpg 170w,
/static/dc5973af18f70eb3d969d8aa1c8dfae6/d30a3/FIC2020.jpg 340w,
/static/dc5973af18f70eb3d969d8aa1c8dfae6/7bf67/FIC2020.jpg 680w,
/static/dc5973af18f70eb3d969d8aa1c8dfae6/9c311/FIC2020.jpg 838w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;</content><id>https://tarides.com/blog/2019-12-11-tarides-wins-the-fic-2020-startup-award</id><title type="text">Tarides wins the FIC 2020 startup award</title><updated>2019-12-11T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2019-12-04-mirageos-talk-at-the-paris-open-source-summit" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;We are thrilled to have been selected by the &lt;a href=&quot;https://www.opensourcesummit.paris&quot;&gt;Paris Open Source Summit&lt;/a&gt;
committee to talk about &amp;ldquo;Secure-by-design IoT applications using MirageOS&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;The Paris Open Source Summit is an annual event where you can connect to
open-source communities and learn from tech leaders, project committers and
CTOs about the latest technical solutions, innovative uses and societal
challenges of open digital technology.&lt;/p&gt;
&lt;p&gt;Thomas Gazagnaire, Tarides CEO/CTO, will explain what makes MirageOS a good
framework to build IoT applications and how we can use embedded devices running
on ARMv8, ESP32 or RISC-V to run secure and end-to-end open-source
infrastructure services such as VPN proxies and email servers. He will also
highlight how this infrastructure will be used to form the basis of OSMOSE: a
secure, distributed and privacy-preserving platform to write user-centric IoT
applications.&lt;/p&gt;
&lt;p&gt;MirageOS is a library operating system (using the MIT license) which enables the
construction of unikernels: specialized services where the runtime binary
contains only the necessary code for execution and no more. Unikernels have a
drastically smaller attack surface than service deployments in traditional
operating systems and could lead to 1000x less code for the full application
stack. Moreover, as MirageOS is written in a memory safe language (OCaml), a
full class of bugs related to memory corruption &amp;ndash; representing &lt;a href=&quot;https://msrc-blog.microsoft.com/2019/07/16/a-proactive-approach-to-more-secure-code/&quot;&gt;70% of the
released CVEs&lt;/a&gt; in classic operating systems written in C &amp;ndash;
can no longer appear. These two properties combined (and more!) allow MirageOS
to build &amp;ldquo;secure-by-design&amp;rdquo; applications where everything &amp;ndash; from the high-level
business logic to the low-level device drivers &amp;ndash; has been designed to be as
secure as possible.&lt;/p&gt;
&lt;p&gt;To learn more about the project, attend the Paris Open Source Summit! The talk
will take place during the '&lt;a href=&quot;https://www.opensourcesummit.paris/EMBEDDED+&amp;amp;+IOT_168_5745.html&quot;&gt;Embedded &amp;amp; IOT&lt;/a&gt;' section
at 14:50 &amp;ndash; 15:20 on December 10th, 2019.&lt;/p&gt;
&lt;br/&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/7826ecb5d3f2934a405f25446b1eb1d8/72e01/poss_2019.jpg&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAUCA//EABUBAQEAAAAAAAAAAAAAAAAAAAID/9oADAMBAAIQAxAAAAHXRSUpasQ//8QAGRAAAwEBAQAAAAAAAAAAAAAAAQISAAMR/9oACAEBAAEFArGAtXMHmoqR6EXf/8QAGxEAAgIDAQAAAAAAAAAAAAAAAQIAAxIhkfD/2gAIAQMBAT8BepKmBWYVHZHuT//EABgRAAMBAQAAAAAAAAAAAAAAAAABAhEh/9oACAECAQE/AVTpdNpH/8QAGhAAAwEAAwAAAAAAAAAAAAAAAAERITEykf/aAAgBAQAGPwK6VKshwhYjqvD/xAAaEAACAwEBAAAAAAAAAAAAAAAAAREhMVGR/9oACAEBAAE/IfEFsiGIRLpwM2y4JMWXBlWL/9oADAMBAAIAAwAAABDo3//EABkRAQEAAwEAAAAAAAAAAAAAAAERADFhQf/aAAgBAwEBPxAoW9fJJoxbRXpj/8QAGBEBAQADAAAAAAAAAAAAAAAAAQARkfD/2gAIAQIBAT8QSECYHt3/xAAcEAEAAgMAAwAAAAAAAAAAAAABABExQVEhYYH/2gAIAQEAAT8QaCtGmPD87FDUWmlMMGKgFM67CAg6EGgGoOy0qfYn/9k='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/7826ecb5d3f2934a405f25446b1eb1d8/7bf67/poss_2019.jpg&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Thomas at the Paris Open Source Summit&quot; title=&quot;&quot; srcset=&quot;/static/7826ecb5d3f2934a405f25446b1eb1d8/651be/poss_2019.jpg 170w,
/static/7826ecb5d3f2934a405f25446b1eb1d8/d30a3/poss_2019.jpg 340w,
/static/7826ecb5d3f2934a405f25446b1eb1d8/7bf67/poss_2019.jpg 680w,
/static/7826ecb5d3f2934a405f25446b1eb1d8/990cb/poss_2019.jpg 1020w,
/static/7826ecb5d3f2934a405f25446b1eb1d8/72e01/poss_2019.jpg 1024w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;</content><id>https://tarides.com/blog/2019-12-04-mirageos-talk-at-the-paris-open-source-summit</id><title type="text">MirageOS talk at the Paris Open Source Summit</title><updated>2019-12-04T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2019-11-27-introducing-the-graphql-api-for-irmin-2-0" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;With the release of Irmin 2.0.0, we are happy to announce a new package - &lt;code&gt;irmin-graphql&lt;/code&gt;, which can be used to serve data from Irmin over HTTP. This blog post will give you some examples to help you get started, there is also &lt;a href=&quot;https://irmin.org/tutorial/graphql&quot;&gt;a section in the &lt;code&gt;irmin-tutorial&lt;/code&gt;&lt;/a&gt; with similar information. To avoid writing the same thing twice, this post will cover the basics of getting started, plus a few interesting ideas for queries.&lt;/p&gt;
&lt;p&gt;Getting the &lt;code&gt;irmin-graphql&lt;/code&gt; server running from the command-line is easy:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ irmin graphql &lt;span class=&quot;token parameter variable&quot;&gt;--root&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/tmp/irmin&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;where &lt;code&gt;/tmp/irmin&lt;/code&gt; is the actual path to your repository. This will start the server on &lt;code&gt;localhost:8080&lt;/code&gt;, but it's possible to customize this using the &lt;code&gt;--address&lt;/code&gt; and &lt;code&gt;--port&lt;/code&gt; flags.&lt;/p&gt;
&lt;p&gt;The new GraphQL API has been added to address some of the shortcomings that have been identified with the old HTTP API, as well as enable a number of new features and capabilities.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#graphql&quot; aria-label=&quot;graphql permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GraphQL&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://graphql.org/&quot;&gt;GraphQL&lt;/a&gt; is a query language for exposing data as a graph via an API, typically using HTTP as a transport. The centerpiece of a GraphQL API is the &lt;em&gt;schema&lt;/em&gt;, which describes the graph in terms of types and relationships between these types. The schema is accessible by the consumer, and acts as a contract between the API and the consumer, by clearly defining all API operations and fully assigning types to all interactions.&lt;/p&gt;
&lt;p&gt;Viewing Irmin data as a graph turns out to be a natural and useful model. Concepts such as branches and commits fit in nicely, and the stored application data is organized as a tree. Such highly hierarchical data can be challenging to interact with using REST, but is easy to represent and navigate with GraphQL.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 74.11764705882352%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC/0lEQVR42p1TW0gUURget/USXsJULMkULYzsJSLrQenNMKhee4mgh8DwQpo92MM8CLqpeUnddTXc1E3yQoZkQgqLXdREEVnTdF1113Fmd3bu67o6Ozt/jClk+aB+8POfw3fOx/9//zkIsh9QVKWkyPqm1Kha3dPwl9q80MqG3Kga3bPoKm3G9hmAAOQgAICABwZDiLI+pTVo4tp7ILnZKKY0G6W4N50Q29DyXuFMJpP6wKKIXh+opNDyupKIxjaIf9Xsu6BtkU40GCCsor7rUBXOzX0Ln5iZOTs1MJBY0vcp8/a73tybxs68TIOx8E7Xh/zC/qEsp9mcjNF0PAAc269FFQCoFxYWgpU9ieO3pqcmpkdHvn7nadK05XJ+XJub6fe6HP1bNPkZAHQU5epfsFjGBYAY5c4VpSMU/d8CFEVVBQWPog0oGgIAgbsVFL0oCtdo0DO7Hu9w6uGq4tNdKBq0R0QQnOkMQ+gFga7meVJnW5nvZRhcA+AMo2niHscRTS6XvYkglo0s69CyLF6AAqgia/T1iTW6mdgq3XBkdeNgdLV+KLKqKRXx+90aAACWJXzYqkX2eGiQpHVJFD1pkrTep3Ck0y4R+LIfYBP80rptEMOiYl53YAlt3ZDW0eu/1N4jx7Z2Q3xr912EYdaKRZEHB7G8ZVv55aMoDFgWX+d5LIVlibcKh2GLos027xPcLuA4h3lkZOQ4UlrbHlTRMBVWqR0LLq8bCyir/YGU1V5GCIII5ThnstfLJQFAktfLJTMMnqDYwXH2kxznPAfg3eZ4njyP43gMyHLEvNVS9mVionHUbG6cslh0P5eWmgWGuYEcBrAzRVmWI+xW62Pr7GyOeXLy+eqy9QntcBRQFHV9d2rqvWFS//2k/gmV8ksonri2IQrpZvP4/dXVxSxGIDN4Hos6bIWqP1bgV71e1rexwQBJ2mWBd/qU4bndrtIjChJpoihIm5scrGGLMsvg24IeD1V2JA8BiFCWxR663USOKHLZHg+TzTBr+RSFX/wNk1gtiBvj8qMAAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/77be7ca8c9940e693b03660d2d5cee01/c5bb3/git-data-model.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Git data model&quot; title=&quot;&quot; srcset=&quot;/static/77be7ca8c9940e693b03660d2d5cee01/04472/git-data-model.png 170w,
/static/77be7ca8c9940e693b03660d2d5cee01/9f933/git-data-model.png 340w,
/static/77be7ca8c9940e693b03660d2d5cee01/c5bb3/git-data-model.png 680w,
/static/77be7ca8c9940e693b03660d2d5cee01/5a190/git-data-model.png 800w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
    &lt;/span&gt;
(image from &lt;a href=&quot;https://git-scm.com/book/en/v2/Git-Internals-Git-Objects&quot;&gt;Pro Git&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;As a consumer of an API, one of the biggest initial challenges is understanding what operations are exposed and how to use them. Conversely, as a developer of an API, keeping documentation up-to-date is challenging and time consuming. Though no substitute for more free-form documentation, a GraphQL schema provides an excellent base line for understanding a GraphQL API that is guaranteed to be accurate and up-to-date. This issue is definitely true of the old Irmin HTTP API, which was hard to approach for newcomers due to lack of documentation.&lt;/p&gt;
&lt;p&gt;Being able to inspect the schema of a GraphQL API enables powerful tooling. A great example of this is &lt;a href=&quot;https://tarides.com/graphiql&quot;&gt;GraphiQL&lt;/a&gt;, which is a browser-based IDE for GraphQL queries. GraphiQL can serve both as an interactive API explorer and query designer with intelligent autocompletion, formatting and more.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/19632cbb13504bb32d6d6d285ec1f542/82e86/graphiql.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 48.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABY0lEQVR42nWS646bMBBGef9HrJQfKzUbQsD4fodTeVJF2aqx9GELw+EMnulyufB9/eZ2u71yv9/Ztu2VdV1/ZNyzLuJD4TgOtDG01qi1Mu3GEVOm905rXTbGOoSIWjaMtrL2PryitUGpnXXdSCkKaLwz4JN2iXm1cB6S8zwZI+fM9tD8+loYH82lEkuW2TqPUgq17yLwPqZxcbHgrKEXQ+/PB1LKpJyZleP3XYllcJEYswCdc7Ta4Wj0ljhaESEB1tpwRtNr5K8gpRRCSAJelMUZj581XntKLcx75HqdSfqLVozkPBrTqHsAx/yijZIHMCbJogxOe/xinsBSWG1GrQstrvQaJGI4fuj5BvoI3D3uthNMIOVCbZ1aDo6W6NXTW3wCh9kA/gt9Bz72UXLAL5pgn8D/ScihfNp4B67aSslhs8SYiDl/Bj4eD+Z5ljYIYfSZl1hrfxoqh593OelPhqOx/wB+kgk4NHMdHgAAAABJRU5ErkJggg=='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/19632cbb13504bb32d6d6d285ec1f542/c5bb3/graphiql.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;GraphiQL&quot; title=&quot;&quot; srcset=&quot;/static/19632cbb13504bb32d6d6d285ec1f542/04472/graphiql.png 170w,
/static/19632cbb13504bb32d6d6d285ec1f542/9f933/graphiql.png 340w,
/static/19632cbb13504bb32d6d6d285ec1f542/c5bb3/graphiql.png 680w,
/static/19632cbb13504bb32d6d6d285ec1f542/b12f7/graphiql.png 1020w,
/static/19632cbb13504bb32d6d6d285ec1f542/b5a09/graphiql.png 1360w,
/static/19632cbb13504bb32d6d6d285ec1f542/82e86/graphiql.png 1978w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The combination of introspection and a strongly typed schema also allows creating smart clients using code generation. This is already a quite wide-spread idea with &lt;a href=&quot;https://tarides.com/apollo-swift&quot;&gt;Apollo for iOS&lt;/a&gt;, &lt;a href=&quot;https://tarides.com/apollo-java&quot;&gt;Apollo for Android&lt;/a&gt; or &lt;a href=&quot;https://tarides.com/graphql_ppx&quot;&gt;&lt;code&gt;graphql_ppx&lt;/code&gt;&lt;/a&gt; for OCaml/Reason. Though generic GraphQL client libraries will do a fine job interacting with the Irmin GraphQL API, these highlighted libraries will offer excellent ergonomics and type-safety out of the box.&lt;/p&gt;
&lt;p&gt;One of the problems that GraphQL set out to solve is that of over- and underfetching. When designing REST API response payloads, there is always a tension between including too little data, which will require clients to make more network requests, and including too much data, which wastes resources for both client and server (serialization, network transfer, deserialization, etc).&lt;br/&gt;
The existing low-level Irmin HTTP API is a perfect example of this. Fetching the contents of a particular file on the master branch requires at least 4 HTTP requests (fetch the branch, fetch the commit, fetch the tree, fetch the blob), i.e. massive underfetching. By comparison, this is something easily solved with a single request to the new GraphQL API. More generally, the GraphQL API allows you to fetch &lt;em&gt;exactly&lt;/em&gt; the data you need in a single request without making one-off endpoints.&lt;/p&gt;
&lt;p&gt;For the curious, here's the GraphQL query to fetch the contents of &lt;code&gt;README.md&lt;/code&gt; from the branch &lt;code&gt;master&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;graphql&quot;&gt;&lt;pre class=&quot;language-graphql&quot;&gt;&lt;code class=&quot;language-graphql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token object&quot;&gt;master&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token object&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property-query&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;README.md&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The response will look something like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&amp;quot;data&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&amp;quot;master&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&amp;quot;tree&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&amp;quot;get&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;The contents of README.md&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The GraphQL API is not limited to only reading data, you can also write data to your Irmin store. Here's a simple example that will set the key &lt;code&gt;README.md&lt;/code&gt; to &lt;code&gt;&amp;quot;foo&amp;quot;&lt;/code&gt;, and return the hash of that commit:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;graphql&quot;&gt;&lt;pre class=&quot;language-graphql&quot;&gt;&lt;code class=&quot;language-graphql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;mutation&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property-query property-mutation&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;README.md&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;hash&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By default, GraphQL allows you to do multiple operations in a single query, so you get bulk operations for free. Here's a more complex example that modifies two different branches, &lt;code&gt;branch-a&lt;/code&gt; and &lt;code&gt;branch-b&lt;/code&gt;, and then merges &lt;code&gt;branch-b&lt;/code&gt; into &lt;code&gt;branch-a&lt;/code&gt; &lt;em&gt;all in a single query&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;graphql&quot;&gt;&lt;pre class=&quot;language-graphql&quot;&gt;&lt;code class=&quot;language-graphql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;mutation&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token attr-name&quot;&gt;branch_a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token property-query&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;branch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;branch-a&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;bar&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;hash&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token attr-name&quot;&gt;branch_b&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token property-query&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;branch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;branch-a&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;baz&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;qux&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;hash&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token property-query&quot;&gt;merge_with_branch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;branch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;branch-b&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;branch-a&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;hash&lt;/span&gt;
    &lt;span class=&quot;token object&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token object&quot;&gt;list_contents_recursively&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;key&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;value&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here's what the response might look like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&amp;quot;data&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&amp;quot;branch_a&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&amp;quot;hash&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;0a1313ae9dfe1d4339aee946dd76b383e02949b6&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&amp;quot;branch_b&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&amp;quot;hash&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;28855c277671ccc180c81058a28d3254f17d2f7b&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&amp;quot;merge_with_branch&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&amp;quot;hash&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;7b17437a16a858816d2710a94ccaa1b9c3506d1f&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&amp;quot;tree&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&amp;quot;list_contents_recursively&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&amp;quot;key&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;/foo&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&amp;quot;value&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;bar&amp;quot;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&amp;quot;key&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;/baz&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&amp;quot;value&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;qux&amp;quot;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Overall, the new GraphQL API operates at a much higher level than the old HTTP API, and offers a number of complex operations that were tricky to accomplish before.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#customizable&quot; aria-label=&quot;customizable permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Customizable&lt;/h1&gt;
&lt;p&gt;With GraphQL, all request and response data is fully described by the schema. Because Irmin allows the user to have custom content types, this leaves the question of what type to assign to such values. By default, the GraphQL API will expose all values as strings, i.e. the serialized version of the data that your application stores. This works quite well when Irmin is used as a simple key-value store, but it can be very inconvenient scheme when storing more complex values. As an example, consider storing contacts (name, email, phone, tags, etc) in your Irmin store, where values have the following type:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;(* Custom content type: a contact *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; contact &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  name &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  email &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;(* ... *)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Fetching such a value will by default be returned to the client as the JSON encoded representation. Assume we're storing a contact under the key &lt;code&gt;john-doe&lt;/code&gt;, which we fetch with the following query:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;graphql&quot;&gt;&lt;pre class=&quot;language-graphql&quot;&gt;&lt;code class=&quot;language-graphql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token object&quot;&gt;master&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token object&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property-query&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;john-doe&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The response would then look something like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&amp;quot;master&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&amp;quot;tree&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&amp;quot;get&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;{\&amp;quot;name\&amp;quot;:\&amp;quot;John Doe\&amp;quot;, \&amp;quot;email\&amp;quot;: \&amp;quot;john.doe@gmail.com/&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ...&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&amp;quot;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The client will have to parse this JSON string and cannot choose to only fetch parts of the value (say, only the email). Optimally we would want the client to get a structured response such as the following:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&amp;quot;master&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&amp;quot;tree&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&amp;quot;get&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;John Doe&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&amp;quot;email&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;john.doe@gmail.com&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        ...
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To achieve this, the new GraphQL API allows providing an &amp;quot;output type&amp;quot; and an &amp;quot;input type&amp;quot; for most of the configurable types in your store (&lt;code&gt;contents&lt;/code&gt;, &lt;code&gt;key&lt;/code&gt;, &lt;code&gt;metadata&lt;/code&gt;, &lt;code&gt;hash&lt;/code&gt;, &lt;code&gt;branch&lt;/code&gt;). The output type specifies how data is presented to the client, while the input type controls how data can be provided by the client. Let's take a closer look at specifying a custom output type.&lt;/p&gt;
&lt;p&gt;Essentially you have to construct a value of type &lt;code&gt;(unit, 'a option) Graphql_lwt.Schema.typ&lt;/code&gt; (from the &lt;a href=&quot;https://tarides.com/ocaml-graphql-server&quot;&gt;&lt;code&gt;graphql-lwt&lt;/code&gt;&lt;/a&gt; package), assuming your content type is &lt;code&gt;'a&lt;/code&gt;. We could construct a GraphQL object type for our example content type &lt;code&gt;contact&lt;/code&gt; as follows:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;(* (unit, contact option) Graphql_lwt.Schema.typ *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; contact_schema_typ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Graphql_lwt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;obj &lt;span class=&quot;token string&quot;&gt;&amp;quot;Contact&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;token label property&quot;&gt;~fields&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    field &lt;span class=&quot;token string&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;token label property&quot;&gt;~typ&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;non_null string&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token label property&quot;&gt;~args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token label property&quot;&gt;~resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; contact &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
        contact&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;(* ... more fields *)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To use the custom type, you need to instantiate the functor &lt;code&gt;Irmin_unix.Graphql.Server.Make_ext&lt;/code&gt; (assuming you're deploying to a Unix target) with an Irmin store (type &lt;code&gt;Irmin.S&lt;/code&gt;) and a custom types module (type &lt;code&gt;Irmin_graphql.Server.CUSTOM_TYPES&lt;/code&gt;). This requires a bit of plumbing:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;(* Instantiate the Irmin functor somehow *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; S &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Irmin&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;S &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; contents &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; contact &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;(* ... *)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;(* Custom GraphQL presentation module *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Custom_types &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;(* Construct default GraphQL types *)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Defaults &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Irmin_graphql&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Default_types &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;(* Use the default types for most things *)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Defaults&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Key
  &lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Metadata &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Defaults&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Metadata
  &lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Hash &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Defaults&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Hash
  &lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Branch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Defaults&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Branch

  &lt;span class=&quot;token comment&quot;&gt;(* Use custom output type for contents *)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Contents &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;include&lt;/span&gt; Defaults&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Contents
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; schema_typ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; contact_schema_typ
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Remote &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; remote &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Some s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;remote
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; GQL &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Irmin_unix&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Graphql&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Make_ext &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Remote&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Custom_types&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;With this in hand, we can now query specifically for the email of &lt;code&gt;john-doe&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;graphql&quot;&gt;&lt;pre class=&quot;language-graphql&quot;&gt;&lt;code class=&quot;language-graphql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token object&quot;&gt;master&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token object&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property-query&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;john-doe&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;email&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;... and get a nicely structured JSON response back:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&amp;quot;master&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&amp;quot;tree&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&amp;quot;get&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&amp;quot;email&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;john.doe@gmail.com&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The custom types is very powerful and opens up for transforming or enriching the data at query time, e.g. geocoding the address of a contact, or checking an on-line status.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#watches&quot; aria-label=&quot;watches permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Watches&lt;/h1&gt;
&lt;p&gt;A core feature of Irmin is the ability to &lt;em&gt;watch&lt;/em&gt; for changes to the underlying data store in real-time. &lt;code&gt;irmin-graphql&lt;/code&gt; takes advantage of GraphQL subscriptions to expose Irmin watches. Subscriptions are a relative recent addition to the GraphQL spec (&lt;a href=&quot;https://tarides.com/graphql-spec-june-2018&quot;&gt;June 2018&lt;/a&gt;), which allows clients to &lt;em&gt;subscribe&lt;/em&gt; to changes. These changes are pushed to the client over a suitable transport mechanism, e.g. websockets, Server-Sent Events, or a chunked HTTP response, as a regular GraphQL response.&lt;/p&gt;
&lt;p&gt;As an example, the following query watches for all changes and returns the new hash:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;graphql&quot;&gt;&lt;pre class=&quot;language-graphql&quot;&gt;&lt;code class=&quot;language-graphql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;subscription&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token object&quot;&gt;watch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token object&quot;&gt;commit&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;hash&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For every change, a message like the following will be sent:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&amp;quot;watch&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&amp;quot;commit&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&amp;quot;hash&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;c01a59bacc16d89e9cdd344a969f494bb2698d8f&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Under the hood, subscriptions in &lt;code&gt;irmin-graphql&lt;/code&gt; are implemented using Irmin watches, but this is opaque to the client -- this will work with any GraphQL spec compliant client!&lt;/p&gt;
&lt;p&gt;Here's a video, which hows how the GraphQL response changes live as the Irmin store is being manipulated:&lt;/p&gt;
&lt;p&gt;&lt;video controls=&quot;controls&quot; width=&quot;680&quot;&gt;&lt;source src=&quot;/blog/2019-11-27-introducing-irmin-graphql/irmin-subscriptions.mp4&quot; type=&quot;video/mp4&quot;&gt;&lt;/source&gt;&lt;/video&gt;&lt;/p&gt;
&lt;p&gt;Note that the current implementation only supports websockets with more transport options coming soon.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#wrap-up&quot; aria-label=&quot;wrap up permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Wrap-up&lt;/h1&gt;
&lt;p&gt;Irmin 2.0 ships with a powerful new GraphQL API, that makes it much easier to interact with Irmin over the network. This makes Irmin available for many more languages and contexts, not just applications using OCaml (or Javascript). The new API operates at a much high level than the old API, and offers advanced features such as &amp;quot;bring your own GraphQL types&amp;quot;, and watching for changes via GraphQL subscriptions.&lt;/p&gt;
&lt;p&gt;We're looking forward to seeing what you'll build with it!&lt;/p&gt;</content><id>https://tarides.com/blog/2019-11-27-introducing-the-graphql-api-for-irmin-2-0</id><title type="text">Introducing the GraphQL API for Irmin 2.0</title><updated>2019-11-27T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2019-11-21-irmin-v2" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;We are pleased to announce &lt;a href=&quot;https://github.com/mirage/irmin/releases&quot;&gt;Irmin
2.0.0&lt;/a&gt;, a major release of the
Git-like distributed branching and storage substrate that underpins
&lt;a href=&quot;https://mirage.io&quot;&gt;MirageOS&lt;/a&gt;.  We began the release process for all the
components that make up Irmin &lt;a href=&quot;https://tarides.com/blog/2019-05-13-on-the-road-to-irmin-v2&quot;&gt;back in May
2019&lt;/a&gt;, and there
have been close to 1000 commits since Irmin 1.4.0 released back in June 2018. To
celebrate this milestone, we have a new logo and opened a dedicated website:
&lt;a href=&quot;https://irmin.org&quot;&gt;irmin.org&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Our focus this year has been on ensuring the production success of our
early adopters -- such as the
&lt;a href=&quot;https://gitlab.com/tezos/tezos/tree/master/src/lib_storage&quot;&gt;Tezos&lt;/a&gt; blockchain
and the &lt;a href=&quot;https://github.com/moby/datakit&quot;&gt;Datakit 9P&lt;/a&gt;
stack -- as well as spawning new research projects into the practical
application of distributed and mergeable data stores.  We are also
very pleased to welcome several new maintainers into the Mirage
project for their contributions to Irmin, namely
&lt;a href=&quot;https://github.com/icristescu&quot;&gt;Ioana Cristescu&lt;/a&gt;,
&lt;a href=&quot;https://github.com/CraigFe&quot;&gt;Craig Ferguson&lt;/a&gt;,
&lt;a href=&quot;https://github.com/andreas&quot;&gt;Andreas Garnaes&lt;/a&gt;,
&lt;a href=&quot;https://github.com/pascutto&quot;&gt;Cl&amp;eacute;ment Pascutto&lt;/a&gt; and
&lt;a href=&quot;https://github.com/zshipko&quot;&gt;Zach Shipko&lt;/a&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#new-major-features&quot; aria-label=&quot;new major features permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;New Major Features&lt;/h2&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#new-cli&quot; aria-label=&quot;new cli permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;New CLI&lt;/h3&gt;
&lt;p&gt;While Irmin is normally used as a library, it is obviously useful to
be able to interact with a data store from a shell.  The &lt;code&gt;irmin-unix&lt;/code&gt;
opam package now provides an &lt;code&gt;irmin&lt;/code&gt; binary that is configured via a
Yaml file and can perform queries and mutations against a Git store.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;root: .&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; irmin.yml
$ irmin init
$ irmin &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; foo/bar &lt;span class=&quot;token string&quot;&gt;&amp;quot;testing 123&amp;quot;&lt;/span&gt;
$ irmin get foo/bar&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Try &lt;code&gt;irmin --help&lt;/code&gt; to see all the commands and options available.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#tezos-and-irmin-pack&quot; aria-label=&quot;tezos and irmin pack permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Tezos and irmin-pack&lt;/h3&gt;
&lt;p&gt;Another big user of Irmin is the &lt;a href=&quot;https://tezos.com&quot;&gt;Tezos blockchain&lt;/a&gt;,
and we have been optimising the persistent space usage of Irmin as their
network grows.  Because Tezos doesn&amp;rsquo;t require full Git format support,
we created a hybrid backend that grabs the best bits of Git (e.g. the
packfile mechanism) and engineered a domain-specific backend tailored
for Tezos usage. Crucially, because of the way Irmin is split into
clean libraries and OCaml modules, we only had to modify a small part
of the codebase and could also reuse elements of our
&lt;a href=&quot;https://github.com/mirage/ocaml-git&quot;&gt;OCaml-git&lt;/a&gt; codebase as well.&lt;/p&gt;
&lt;p&gt;The &lt;a href=&quot;https://github.com/mirage/irmin/pull/615&quot;&gt;irmin-pack backend&lt;/a&gt; is available
for &lt;a href=&quot;https://github.com/mirage/irmin/pull/888&quot;&gt;use in the CLI&lt;/a&gt; and provides a
significant improvement in disk usage.  There is a corresponding &lt;a href=&quot;https://gitlab.com/tezos/tezos/merge_requests/1268&quot;&gt;Tezos merge
request&lt;/a&gt; using the Irmin
2.0 code that has been integrated downstream and will become available via
their release process in due course.&lt;/p&gt;
&lt;p&gt;As part of this development process, we also released an efficient multi-level
index implementation (imaginatively dubbed
&lt;a href=&quot;https://github.com/mirage/index&quot;&gt;index&lt;/a&gt; in opam). Our implementation takes an
arbitrary IO implementation and user-supplied content types and supplies a
standard key-value interface for persistent storage. Index provides instance
sharing by default, so each OCaml runtime shares a common singleton instance.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#irmin-graphql-and-browser-irmin&quot; aria-label=&quot;irmin graphql and browser irmin permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Irmin-GraphQL and &amp;ldquo;browser Irmin&amp;rdquo;&lt;/h3&gt;
&lt;p&gt;Another new area of huge interest to us is
&lt;a href=&quot;https://graphql.org&quot;&gt;GraphQL&lt;/a&gt; in order to provide frontends with a rich
query language for Irmin-hosted applications.  Irmin 2.0 includes a
built-in GraphQL server so you can &lt;a href=&quot;https://twitter.com/cuvius/status/1017136581755457539&quot;&gt;manipulate your Git repo via
GraphQL&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If you are interested in (for example) compiling elements of Irmin to
JavaScript or wasm, for usage in frontends, then the Irmin 2.0 release
makes it significantly easier to support this architecture.  We&amp;rsquo;ve
already seen some exploratory efforts &lt;a href=&quot;https://github.com/mirage/irmin/issues/681&quot;&gt;report issues&lt;/a&gt;
when doing this, and we&amp;rsquo;ve had it working ourselves in &lt;a href=&quot;http://roscidus.com/blog/blog/2015/04/28/cuekeeper-gitting-things-done-in-the-browser/&quot;&gt;Irmin 1.0 Cuekeeper&lt;/a&gt;
so we are excited by the potential power of applications built using
this model.  If you have ideas/questions, please get in touch on the
&lt;a href=&quot;https://github.com/mirage/irmin/issues&quot;&gt;issue tracker&lt;/a&gt; with your
usecase.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#wodan&quot; aria-label=&quot;wodan permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Wodan&lt;/h3&gt;
&lt;p&gt;Irmin&amp;rsquo;s storage layer is also well abstracted, so backends other than
a Unix filesystem or Git are supported.  Irmin can run in highly
diverse and OS-free environments, and so we began engineering the
&lt;a href=&quot;https://github.com/mirage/wodan&quot;&gt;Wodan filesystem&lt;/a&gt; as a
domain-specific filesystem designed for MirageOS, Irmin and modern
flash drives.  See &lt;a href=&quot;https://g2p.github.io/research/wodan.pdf&quot;&gt;the OCaml Workshop 2017 abstract on
it&lt;/a&gt; for more design
rationale.&lt;/p&gt;
&lt;p&gt;As part of the Irmin 2.0 release, Wodan is also being prepared for a
release, and you can find &lt;a href=&quot;https://github.com/mirage/wodan/tree/master/src/wodan-irmin&quot;&gt;Irmin 2.0
support&lt;/a&gt;
in the source.  If you&amp;rsquo;d like a standalone block-device based
persistence environment for Irmin, please try this out.  This is the
preferred backend for using Irmin storage in a unikernel.&lt;/p&gt;
&lt;p&gt;###&amp;nbsp;Versioned CalDAV&lt;/p&gt;
&lt;p&gt;An application pulling all these pieces together is being developed
by our friends at &lt;a href=&quot;https://robur.io/About%20Us/Team&quot;&gt;Robur&lt;/a&gt;: an Irmin-based
&lt;a href=&quot;https://github.com/roburio/caldav&quot;&gt;CalDAV calendaring server&lt;/a&gt;
that even hosts its DNS server using a versioned Irmin store.  We'll
blog more about this as the components get released and stabilised, but
the unikernel enthusiasts among you may want to browse the
&lt;a href=&quot;https://github.com/roburio/unikernels/tree/future&quot;&gt;Robur unikernels future branch&lt;/a&gt;
to see how they are deploying them today.&lt;/p&gt;
&lt;p&gt;A huge thank you to all our commercial customers, end users and open-source
developers who have contributed their time, expertise and
financial support to help us achieve our goal of delivering a modern
storage stack in the spirit of Git.  Our next steps for Irmin are to
continue to increase the performance and optimise the storage,
and to build more end-to-end applications using the application core
on top of MirageOS.&lt;/p&gt;</content><id>https://tarides.com/blog/2019-11-21-irmin-v2</id><title type="text">Irmin v2</title><updated>2019-11-21T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2019-09-25-mr-mime-parse-and-generate-emails" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;We're glad to announce the first release of &lt;a href=&quot;https://github.com/mirage/mrmime.git&quot;&gt;&lt;code&gt;mrmime&lt;/code&gt;&lt;/a&gt;, a parser and a
generator of emails. This library provides an &lt;em&gt;OCaml way&lt;/em&gt; to analyze and craft
an email. The eventual goal is to build an entire &lt;em&gt;unikernel-compatible&lt;/em&gt; stack
for email (such as SMTP or IMAP).&lt;/p&gt;
&lt;p&gt;In this article, we will show what is currently possible with &lt;code&gt;mrmime&lt;/code&gt; and
present a few of the useful libraries that we developed along the way.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#an-email-parser&quot; aria-label=&quot;an email parser permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;An email parser&lt;/h2&gt;
&lt;p&gt;Some years ago, Romain gave &lt;a href=&quot;https://www.youtube.com/watch?v=kQkRsNEo25k&quot;&gt;a talk&lt;/a&gt; about what an email really &lt;em&gt;is&lt;/em&gt;.
Behind the human-comprehensible format (or &lt;em&gt;rich-document&lt;/em&gt; as we said a
long time ago), there are several details of emails which complicate the process of
analyzing them (and can be prone to security lapses). These details are mostly described
by three RFCs:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://tools.ietf.org/html/rfc822&quot;&gt;RFC822&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://tools.ietf.org/html/rfc2822&quot;&gt;RFC2822&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://tools.ietf.org/html/rfc5322&quot;&gt;RFC5322&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Even though they are cross-compatible, providing full legacy email parsing is an
archaeological exercise: each RFC retains support for the older design decisions
(which were not recognized as bad or ugly in 1970 when they were first standardized).&lt;/p&gt;
&lt;p&gt;The latest email-related RFC (RFC5322) tried to fix the issue and provide a better
&lt;a href=&quot;https://tools.ietf.org/html/rfc5234&quot;&gt;formal specification&lt;/a&gt; of the email format &amp;ndash; but of course, it comes with plenty of
&lt;em&gt;obsolete&lt;/em&gt; rules which need to be implemented. In the standard, you find
both the current grammar rule and its obsolete equivalent.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#an-extended-email-parser&quot; aria-label=&quot;an extended email parser permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;An extended email parser&lt;/h3&gt;
&lt;p&gt;Even if the email format can defined by &amp;quot;only&amp;quot; 3 RFCs, you will
miss email internationalization (&lt;a href=&quot;https://tools.ietf.org/html/rfc6532&quot;&gt;RFC6532&lt;/a&gt;), the MIME format
(&lt;a href=&quot;https://tools.ietf.org/html/rfc2045&quot;&gt;RFC2045&lt;/a&gt;, &lt;a href=&quot;https://tools.ietf.org/html/rfc2046&quot;&gt;RFC2046&lt;/a&gt;, &lt;a href=&quot;https://tools.ietf.org/html/rfc2047&quot;&gt;RFC2047&lt;/a&gt;,
&lt;a href=&quot;https://tools.ietf.org/html/rfc2049&quot;&gt;RFC2049&lt;/a&gt;), or certain details needed to be interoperable with SMTP
(&lt;a href=&quot;https://tools.ietf.org/html/rfc5321&quot;&gt;RFC5321&lt;/a&gt;). There are still more RFCs which add extra features
to the email format such as S/MIME or the Content-Disposition field.&lt;/p&gt;
&lt;p&gt;Given this complexity, we took the most general RFCs and tried to provide an easy way to deal
with them. The main difficulty is the &lt;em&gt;multipart&lt;/em&gt; parser, which deals with email
attachments (anyone who has tried to make an HTTP 1.1 parser knows about this).&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#a-realistic-email-parser&quot; aria-label=&quot;a realistic email parser permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A realistic email parser&lt;/h3&gt;
&lt;p&gt;Respecting the rules described by RFCs is not enough to be able to analyze any
email from the real world: existing email generators can, and do, produce
&lt;em&gt;non-compliant&lt;/em&gt; email. We stress-tested &lt;code&gt;mrmime&lt;/code&gt; by feeding it a batch of 2
billion emails taken from the wild, to see if it could parse everything (even if
it does not produce the expected result). Whenever we noticed a recurring
formatting mistake, we updated the details of the &lt;a href=&quot;https://tools.ietf.org/html/rfc5234&quot;&gt;ABNF&lt;/a&gt; to enable
&lt;code&gt;mrmime&lt;/code&gt; to parse it anyway.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#a-parser-usable-by-others&quot; aria-label=&quot;a parser usable by others permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A parser usable by others&lt;/h3&gt;
&lt;p&gt;One demonstration of the usability of &lt;code&gt;mrmime&lt;/code&gt; is &lt;a href=&quot;https://github.com/dinosaure/ocaml-dkim.git&quot;&gt;&lt;code&gt;ocaml-dkim&lt;/code&gt;&lt;/a&gt;, which wants to
extract a specific field from your mail and then verify that the hash and signature
are as expected.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ocaml-dkim&lt;/code&gt; is used by the latest implementation of &lt;a href=&quot;https://github.com/mirage/ocaml-dns.git&quot;&gt;&lt;code&gt;ocaml-dns&lt;/code&gt;&lt;/a&gt; to request
public keys in order to verify email.&lt;/p&gt;
&lt;p&gt;The most important question about &lt;code&gt;ocaml-dkim&lt;/code&gt; is: is it able to
verify your email in one pass? Indeed, currently some implementations of DKIM
need 2 passes to verify your email (one to extract the DKIM signature, the other
to digest some fields and bodies). We focused on verifying in a &lt;em&gt;single&lt;/em&gt; pass in
order to provide a unikernel SMTP &lt;em&gt;relay&lt;/em&gt; with no need to store your email between
verification passes.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#an-email-generator&quot; aria-label=&quot;an email generator permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;An email generator&lt;/h2&gt;
&lt;p&gt;OCaml is a good language for making little DSLs for specialized use-cases. In this
case, we took advantage of OCaml to allow the user to easily craft an email from
nothing.&lt;/p&gt;
&lt;p&gt;The idea is to build an OCaml value describing the desired email header, and
then let the Mr. MIME generator transform this into a stream of characters that
can be consumed by, for example, an SMTP implementation. The description step
is quite simple:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token directive property&quot;&gt;#require&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;mrmime&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;token directive property&quot;&gt;#require&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;ptime.clock.os&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; Mrmime

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; romain_calascibetta &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; Mailbox &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  Local&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; w &lt;span class=&quot;token string&quot;&gt;&amp;quot;romain&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; w &lt;span class=&quot;token string&quot;&gt;&amp;quot;calascibetta&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt; Domain&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;domain&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; a &lt;span class=&quot;token string&quot;&gt;&amp;quot;gmail&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; a &lt;span class=&quot;token string&quot;&gt;&amp;quot;com&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; john_doe &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; Mailbox &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  Local&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; w &lt;span class=&quot;token string&quot;&gt;&amp;quot;john&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt; Domain&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;domain&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; a &lt;span class=&quot;token string&quot;&gt;&amp;quot;doe&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; a &lt;span class=&quot;token string&quot;&gt;&amp;quot;org&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&amp;gt;&lt;/span&gt; with_name Phrase&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; w &lt;span class=&quot;token string&quot;&gt;&amp;quot;John&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; w &lt;span class=&quot;token string&quot;&gt;&amp;quot;D.&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; now &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; Date &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  of_ptime &lt;span class=&quot;token label property&quot;&gt;~zone&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;Zone&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;GMT &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Ptime_clock&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; subject &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  Unstructured&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; v &lt;span class=&quot;token string&quot;&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; sp &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; v &lt;span class=&quot;token string&quot;&gt;&amp;quot;Simple&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; sp &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; v &lt;span class=&quot;token string&quot;&gt;&amp;quot;Mail&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; header &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; Header &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  Field&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Subject &lt;span class=&quot;token operator&quot;&gt;$&lt;/span&gt; subject&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; Field&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Sender &lt;span class=&quot;token operator&quot;&gt;$&lt;/span&gt; romain_calascibetta&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; Field&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;To &lt;span class=&quot;token operator&quot;&gt;$&lt;/span&gt; Address&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; mailbox john_doe &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; Field&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Date &lt;span class=&quot;token operator&quot;&gt;$&lt;/span&gt; now &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; empty

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; stream &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Header&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to_stream header

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;rec&lt;/span&gt; go &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; stream &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Some buf &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; print_string buf&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; go &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; None &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  go &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This code produces the following header:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Date: 2 Aug 2019 14:10:10 GMT
To: John &amp;quot;D.&amp;quot; &amp;lt;john@doe.org&amp;gt;
Sender: romain.calascibetta@gmail.com
Subject: A Simple Mail&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#78-character-rule&quot; aria-label=&quot;78 character rule permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;78-character rule&lt;/h3&gt;
&lt;p&gt;One aspect about email and SMTP is about some historical rules of how to
generate them. One of them is about the limitation of bytes per line. Indeed, a
generator of mail should emit at most 80 bytes per line - and, of course, it
should emits entirely the email line per line.&lt;/p&gt;
&lt;p&gt;So &lt;code&gt;mrmime&lt;/code&gt; has his own encoder which tries to wrap your mail into this limit.
It was mostly inspired by &lt;a href=&quot;https://github.com/inhabitedtype/faraday&quot;&gt;Faraday&lt;/a&gt; and &lt;a href=&quot;https://caml.inria.fr/pub/docs/manual-ocaml/libref/Format.html&quot;&gt;Format&lt;/a&gt; powered with
GADT to easily describe how to encode/generate parts of an email.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#a-multipart-email-generator&quot; aria-label=&quot;a multipart email generator permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A multipart email generator&lt;/h3&gt;
&lt;p&gt;Of course, the main point about email is to be able to generate a multipart
email - just to be able to send file attachments. And, of course, a deep work
was done about that to make parts, compose them into specific &lt;code&gt;Content-Type&lt;/code&gt;
fields and merge them into one email.&lt;/p&gt;
&lt;p&gt;Eventually, you can easily make a stream from it, which respects rules (78 bytes
per line, stream line per line) and use it directly into an SMTP implementation.&lt;/p&gt;
&lt;p&gt;This is what we did with the project &lt;a href=&quot;https://github.com/dinosaure/facteur&quot;&gt;&lt;code&gt;facteur&lt;/code&gt;&lt;/a&gt;. It's a little
command-line tool to send with file attachement mails in pure OCaml - but it
works only on an UNIX operating system for instance.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#behind-the-forest&quot; aria-label=&quot;behind the forest permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Behind the forest&lt;/h2&gt;
&lt;p&gt;Even if you are able to parse and generate an email, more work is needed to get the expected results.&lt;/p&gt;
&lt;p&gt;Indeed, email is a exchange unit between people and the biggest deal on that is
to find a common way to ensure a understable communication each others. About
that, encoding is probably the most important piece and when a French person wants
to communicate with a &lt;em&gt;latin1&lt;/em&gt; encoding, an American person can still use ASCII.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#rosetta&quot; aria-label=&quot;rosetta permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Rosetta&lt;/h3&gt;
&lt;p&gt;So about this problem, the choice was made to unify any contents to UTF-8 as the
most general encoding of the world. So, we did some libraries which map an encoding flow
to Unicode code-point, and we use &lt;code&gt;uutf&lt;/code&gt; (thanks to &lt;a href=&quot;https://github.com/dbuenzli&quot;&gt;dbuenzli&lt;/a&gt;) to normalize it to UTF-8.&lt;/p&gt;
&lt;p&gt;The main goal is to avoid a headache to the user about that and even if
contents of the mail is encoded with &lt;em&gt;latin1&lt;/em&gt; we ensure to translate it
correctly (and according RFCs) to UTF-8.&lt;/p&gt;
&lt;p&gt;This project is &lt;a href=&quot;https://github.com/mirage/rosetta&quot;&gt;&lt;code&gt;rosetta&lt;/code&gt;&lt;/a&gt; and it comes with:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/mirage/uuuu&quot;&gt;&lt;code&gt;uuuu&lt;/code&gt;&lt;/a&gt; for ISO-8859 encoding&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/mirage/coin&quot;&gt;&lt;code&gt;coin&lt;/code&gt;&lt;/a&gt; for KOI8-{R,U} encoding&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/mirage/yuscii&quot;&gt;&lt;code&gt;yuscii&lt;/code&gt;&lt;/a&gt; for UTF-7 encoding&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#pecu-and-base64&quot; aria-label=&quot;pecu and base64 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Pecu and Base64&lt;/h3&gt;
&lt;p&gt;Then, bodies can be encoded in some ways, 2 precisely (if we took the main
standard):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A base64 encoding, used to store your file&lt;/li&gt;
&lt;li&gt;A quoted-printable encoding&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So, about the &lt;code&gt;base64&lt;/code&gt; package, it comes with a sub-package &lt;code&gt;base64.rfc2045&lt;/code&gt;
which respects the special case to encode a body according RFC2045 and SMTP
limitation.&lt;/p&gt;
&lt;p&gt;Then, &lt;code&gt;pecu&lt;/code&gt; was made to encode and decode &lt;em&gt;quoted-printable&lt;/em&gt; contents. It was
tested and fuzzed of course like any others MirageOS's libraries.&lt;/p&gt;
&lt;p&gt;These libraries are needed for an other historical reason which is: bytes used
to store mail should use only 7 bits instead of 8 bits. This is the purpose of
the base64 and the &lt;em&gt;quoted-printable&lt;/em&gt; encoding which uses only 127 possibilities
of a byte. Again, this limitation comes with SMTP protocol.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;mrmime&lt;/code&gt; is tackling the difficult task to parse and generate emails according to 50 years of usability, several RFCs and legacy rules.
So, it
still is an experimental project. We reach the first version of it because we
are currently able to parse many mails and then generate them correctly.&lt;/p&gt;
&lt;p&gt;Of course, a &lt;em&gt;bug&lt;/em&gt; (a malformed mail, a server which does not respect standards
or a bad use of our API) can appear easily where we did not test everything. But
we have the feeling it was the time to release it and let people to use
it.&lt;/p&gt;
&lt;p&gt;The best feedback about &lt;code&gt;mrmime&lt;/code&gt; and the best improvement is yours. So don't be
afraid to use it and start to hack your emails with it.&lt;/p&gt;</content><id>https://tarides.com/blog/2019-09-25-mr-mime-parse-and-generate-emails</id><title type="text">Mr. MIME - Parse and generate emails</title><updated>2019-09-25T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2019-09-13-decompress-experiences-with-ocaml-optimization" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;In our &lt;a href=&quot;https://tarides.com/blog/2019-08-26-decompress-the-new-decompress-api.html&quot;&gt;first article&lt;/a&gt; we mostly discussed
the API design of &lt;code&gt;decompress&lt;/code&gt; and did not talk too much about the issue of
optimizing performance. In this second article, we will relate our experiences
of optimizing &lt;code&gt;decompress&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;As you might suspect, &lt;code&gt;decompress&lt;/code&gt; needs to be optimized a lot. It was used by
several projects as an underlying layer of some formats (like Git), so it can be
a real bottleneck in those projects. Of course, we start with a footgun by using
a garbage-collected language; comparing the performance of &lt;code&gt;decompress&lt;/code&gt; with a C
implementation (like &lt;a href=&quot;https://zlib.net/&quot;&gt;zlib&lt;/a&gt; or &lt;a href=&quot;https://github.com/richgel999/miniz&quot;&gt;miniz&lt;/a&gt;) is obviously not very fair.&lt;/p&gt;
&lt;p&gt;However, using something like &lt;code&gt;decompress&lt;/code&gt; instead of C implementations can be
very interesting for many purposes, especially when thinking about &lt;em&gt;unikernels&lt;/em&gt;.
As we said in the previous article, we can take the advantage of the &lt;em&gt;runtime&lt;/em&gt;
and the type-system to provide something &lt;em&gt;safer&lt;/em&gt; (of course, it's not really
true since zlib has received several security audits).&lt;/p&gt;
&lt;p&gt;The main idea in this article is not to give snippets to copy/paste into your
codebase but to explain some behaviors of the compiler / runtime and hopefully
give you some ideas about how to optimize your own code. We'll discuss the
following optimizations:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;specialization&lt;/li&gt;
&lt;li&gt;inlining&lt;/li&gt;
&lt;li&gt;untagged integers&lt;/li&gt;
&lt;li&gt;exceptions&lt;/li&gt;
&lt;li&gt;unrolling&lt;/li&gt;
&lt;li&gt;hot-loop&lt;/li&gt;
&lt;li&gt;caml_modify&lt;/li&gt;
&lt;li&gt;representation sizes&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#cautionary-advice&quot; aria-label=&quot;cautionary advice permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Cautionary advice&lt;/h3&gt;
&lt;p&gt;Before we begin discussing optimization, keep this rule in mind:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Only perform optimization at the &lt;strong&gt;end&lt;/strong&gt; of the development process.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;An optimization pass
can change your code significantly, so you need to keep a state of your project
that can be trusted. This state will provide a comparison point for both
benchmarks and behaviors. In other words, your stable implementation will be the
oracle for your benchmarks. If you start with nothing, you'll achieve
arbitrarily-good performance at the cost of arbitrary behavior!&lt;/p&gt;
&lt;p&gt;We optimized &lt;code&gt;decompress&lt;/code&gt; because we are using it in bigger projects for a long
time (2 years). So we have an oracle (even if &lt;code&gt;zlib&lt;/code&gt; can act as an oracle in
this special case).&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#specialization&quot; aria-label=&quot;specialization permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Specialization&lt;/h2&gt;
&lt;p&gt;One of the biggest specializations in &lt;code&gt;decompress&lt;/code&gt; is regarding the &lt;code&gt;min&lt;/code&gt;
function. If you don't know, in OCaml &lt;code&gt;min&lt;/code&gt; is polymorphic; you can compare
anything. So you probably have some concerns about how &lt;code&gt;min&lt;/code&gt; is implemented?&lt;/p&gt;
&lt;p&gt;You are right to be concerned: if you examine the details, &lt;code&gt;min&lt;/code&gt; calls the C
function &lt;code&gt;do_compare_val&lt;/code&gt;, which traverses your structure and does a comparison
according the run-time representation of your structure. Of course, for integers, it
should be only a &lt;code&gt;cmpq&lt;/code&gt; assembly instruction. However, some simple code like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; min &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;will produce this CMM and assembly code:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;(let x/1002 (app{main.ml:1,8-15} &amp;quot;camlStdlib__min_1028&amp;quot; 1 3 val)
   ...)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nasm&quot;&gt;&lt;pre class=&quot;language-nasm&quot;&gt;&lt;code class=&quot;language-nasm&quot;&gt;&lt;span class=&quot;token label function&quot;&gt;.L101:&lt;/span&gt;
        movq    &lt;span class=&quot;token number&quot;&gt;$3&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rbx&lt;/span&gt;
        movq    &lt;span class=&quot;token number&quot;&gt;$1&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rax&lt;/span&gt;
        call    camlStdlib__min_1028@PLT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that &lt;em&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Lambda_calculus#Beta_reduction&quot;&gt;beta-reduction&lt;/a&gt;&lt;/em&gt;, &lt;em&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Inline_expansion&quot;&gt;inlining&lt;/a&gt;&lt;/em&gt; and
specialization were not done in this code. OCaml does not optimize your code
very much &amp;ndash; the good point is predictability of the produced assembly output.&lt;/p&gt;
&lt;p&gt;If you help the compiler a little bit with:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;external&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; int &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; bool &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;%lessequal&amp;quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; min a b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;=&lt;/span&gt; b &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; a &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; b &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@@&lt;/span&gt;inline&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; min &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We have:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;(function{main.ml:2,8-43} camlMain__min_1003 (a/1004: val b/1005: val)
 (if (&amp;lt;= a/1004 b/1005) a/1004 b/1005))

(function camlMain__entry ()
 (let x/1006 1 (store val(root-init) (+a &amp;quot;camlMain&amp;quot; 8) 1)) 1a)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nasm&quot;&gt;&lt;pre class=&quot;language-nasm&quot;&gt;&lt;code class=&quot;language-nasm&quot;&gt;&lt;span class=&quot;token label function&quot;&gt;.L101:&lt;/span&gt;
        cmpq    &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rbx&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rax&lt;/span&gt;
        jg      .L100
        ret&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So we have all optimizations, in this produced code, &lt;code&gt;x&lt;/code&gt; was evaluated as &lt;code&gt;0&lt;/code&gt;
(&lt;code&gt;let x/... (store ... 1)&lt;/code&gt;) (beta-reduction and inlining) and &lt;code&gt;min&lt;/code&gt; was
specialized to accept only integers &amp;ndash; so we are able to emit &lt;code&gt;cmpq&lt;/code&gt;.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#results&quot; aria-label=&quot;results permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Results&lt;/h3&gt;
&lt;p&gt;With specialization, we won 10 Mb/s on decompression, where &lt;code&gt;min&lt;/code&gt; is used
in several places. We completely avoid an indirection and a call to the slow
&lt;code&gt;do_compare_val&lt;/code&gt; function.&lt;/p&gt;
&lt;p&gt;This kind of specialization is already done by &lt;a href=&quot;https://caml.inria.fr/pub/docs/manual-ocaml/flambda.html&quot;&gt;&lt;code&gt;flambda&lt;/code&gt;&lt;/a&gt;, however, we
currently use OCaml 4.07.1. So we decided to this kind of optimization by
ourselves.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#inlining&quot; aria-label=&quot;inlining permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Inlining&lt;/h2&gt;
&lt;p&gt;In the first example, we showed code with the &lt;code&gt;[@@inline]&lt;/code&gt; keyword which is
useful to force the compiler to inline a little function. We will go outside the
OCaml world and study C code (gcc 5.4.0) to really understand
&lt;em&gt;inlining&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;In fact, inlining is not necessarily the best optimization. Consider the
following (nonsensical) C program:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;lt;time.h&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;ifdef&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;HIDE_ALIGNEMENT&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;__attribute__&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;noinline&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; noclone&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;hide&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; p&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; p&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; ac&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;av&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;s &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;calloc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  s &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hide&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;memset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token char&quot;&gt;'B'&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token class-name&quot;&gt;clock_t&lt;/span&gt; start &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;clock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1280000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    s&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token char&quot;&gt;'A'&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token class-name&quot;&gt;clock_t&lt;/span&gt; end &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;clock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;%lld\n&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;end&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;start&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We will compile this code with &lt;code&gt;-O2&lt;/code&gt; (the second level of optimization in C),
once with &lt;code&gt;-DHIDE_ALIGNEMENT&lt;/code&gt; and once without. The assembly emitted differs:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nasm&quot;&gt;&lt;pre class=&quot;language-nasm&quot;&gt;&lt;code class=&quot;language-nasm&quot;&gt;&lt;span class=&quot;token label function&quot;&gt;.L3:&lt;/span&gt;
	movq	&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rbp&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rdi&lt;/span&gt;
	call	strlen
	subl	&lt;span class=&quot;token number&quot;&gt;$1&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;ebx&lt;/span&gt;
	movb	&lt;span class=&quot;token number&quot;&gt;$65&lt;/span&gt;, &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;(&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rbp&lt;/span&gt;,&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rax&lt;/span&gt;)
	jne	.L3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nasm&quot;&gt;&lt;pre class=&quot;language-nasm&quot;&gt;&lt;code class=&quot;language-nasm&quot;&gt;&lt;span class=&quot;token label function&quot;&gt;.L3:&lt;/span&gt;
	movl	(&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rdx&lt;/span&gt;), &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;ecx&lt;/span&gt;
	addq	&lt;span class=&quot;token number&quot;&gt;$4&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rdx&lt;/span&gt;
	leal	&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;16843009&lt;/span&gt;(&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rcx&lt;/span&gt;), &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;eax&lt;/span&gt;
	notl	&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;ecx&lt;/span&gt;
	andl	&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;ecx&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;eax&lt;/span&gt;
	andl	&lt;span class=&quot;token operator&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2139062144&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;eax&lt;/span&gt;
	je	.L3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In the first output (with &lt;code&gt;-DHIDE_ALIGNEMENT&lt;/code&gt;), the optimization pass
decides to disable inlining of &lt;code&gt;strlen&lt;/code&gt;; in the second output (without
&lt;code&gt;-DHIDEAlIGNEMENT&lt;/code&gt;), it decides to inline &lt;code&gt;strlen&lt;/code&gt; (and do some other clever
optimizations). The reason behind this complex behavior from the compiler is
clearly described &lt;a href=&quot;https://stackoverflow.com/a/55589634&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;But what we want to say is that inlining is &lt;strong&gt;not&lt;/strong&gt; an automatic optimization;
it might act as a &lt;em&gt;pessimization&lt;/em&gt;. This is the goal of &lt;code&gt;flambda&lt;/code&gt;: do the right
optimization under the right context. If you are really curious about what &lt;code&gt;gcc&lt;/code&gt;
does and why, even if it's very interesting, the reverse engineering of the
optimization process and which information is relevant about the choice to
optimize or not is deep, long and surely too complicated.&lt;/p&gt;
&lt;p&gt;A non-spontaneous optimization is to annotate some parts of your code with
&lt;code&gt;[@@inline never]&lt;/code&gt; &amp;ndash; so, explicitly say to the compiler to not inline the
function. This constraint is to help the compiler to generate a smaller code
which will have more chance to fit under the processor cache.&lt;/p&gt;
&lt;p&gt;For all of these reasons, &lt;code&gt;[@@inline]&lt;/code&gt; should be used sparingly and an oracle to
compare performances if you inline or not this or this function is necessary to
avoid a &lt;em&gt;pessimization&lt;/em&gt;.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#in-decompress&quot; aria-label=&quot;in decompress permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;In &lt;code&gt;decompress&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;Inlining in &lt;code&gt;decompress&lt;/code&gt; was done on small functions which need to allocate
to return a value. If we inline them, we can take the opportunity to store
returned value in registers (of course, it depends how many registers are free).&lt;/p&gt;
&lt;p&gt;As we said, the goal of the inflator is to translate a bit sequence to a byte.
The largest bit sequence possible according to RFC 1951 has length 15. So, when
we process an inputs flow, we eat it 15 bits per 15 bits. For each packet, we
want to recognize an existing associated bit sequence and then, binded values
will be the real length of the bit sequence and the byte:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; find &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; bits&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;int &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; len&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; byte&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So for each call to this function, we need to allocate a record/tuple. It's
why we choose to inline this function. &lt;code&gt;min&lt;/code&gt; was inlined too and some other
small functions. But as we said, the situation is complex; where we think that
&lt;em&gt;inlining&lt;/em&gt; can help us, it's not systematically true.&lt;/p&gt;
&lt;p&gt;NOTE: we can recognize bits sequence with, at most, 15 bits because a
&lt;a href=&quot;https://zlib.net/feldspar.html&quot;&gt;Huffman coding&lt;/a&gt; is &lt;a href=&quot;https://en.wikipedia.org/wiki/Prefix_code&quot;&gt;prefix-free&lt;/a&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#untagged-integers&quot; aria-label=&quot;untagged integers permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Untagged integers&lt;/h2&gt;
&lt;p&gt;When reading assembly, the integer &lt;code&gt;0&lt;/code&gt; is written as &lt;code&gt;$1&lt;/code&gt;.
It's because of the &lt;a href=&quot;https://blog.janestreet.com/what-is-gained-and-lost-with-63-bit-integers/&quot;&gt;GC bit&lt;/a&gt; needed to differentiate a pointer
and an unboxed integer. This is why, in OCaml, we talk about a 31-bits integer
or a 63-bits integer (depending on your architecture).&lt;/p&gt;
&lt;p&gt;We will not try to start a debate about this arbitrary choice on the
representation of an integer in OCaml. However, we can talk about some
operations which can have an impact on performances.&lt;/p&gt;
&lt;p&gt;The biggest example is about the &lt;code&gt;mod&lt;/code&gt; operation. Between OCaml and C, &lt;code&gt;%&lt;/code&gt; or
&lt;code&gt;mod&lt;/code&gt; should be the same:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; f a b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;mod&lt;/span&gt; b&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The output assembly is:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nasm&quot;&gt;&lt;pre class=&quot;language-nasm&quot;&gt;&lt;code class=&quot;language-nasm&quot;&gt;&lt;span class=&quot;token label function&quot;&gt;.L105:&lt;/span&gt;
        movq    &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rdi&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rcx&lt;/span&gt;
        sarq    &lt;span class=&quot;token number&quot;&gt;$1&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rcx&lt;/span&gt;     &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
        movq    (&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rsp&lt;/span&gt;), &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rax&lt;/span&gt;
        sarq    &lt;span class=&quot;token number&quot;&gt;$1&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rax&lt;/span&gt;     &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
        testq   &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rcx&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rcx&lt;/span&gt;   &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
        je      .L107
        cqto
        idivq   &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rcx&lt;/span&gt;         &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; b
        jmp     .L106
&lt;span class=&quot;token label function&quot;&gt;.L107:&lt;/span&gt;
        movq    caml_backtrace_pos@GOTPCREL(&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;rip), &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rax&lt;/span&gt;
        xorq    &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rbx&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rbx&lt;/span&gt;
        movl    &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;ebx&lt;/span&gt;, (&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rax&lt;/span&gt;)
        movq    caml_exn_Division_by_zero@GOTPCREL(&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;rip), &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rax&lt;/span&gt;
        call    caml_raise_exn@PLT
&lt;span class=&quot;token label function&quot;&gt;.L106:&lt;/span&gt;
        salq    &lt;span class=&quot;token number&quot;&gt;$1&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rdx&lt;/span&gt;     &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
        incq    &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rdx&lt;/span&gt;         &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
        movq    &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rbx&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rax&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;where idiomatically the same C code produce:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nasm&quot;&gt;&lt;pre class=&quot;language-nasm&quot;&gt;&lt;code class=&quot;language-nasm&quot;&gt;&lt;span class=&quot;token label function&quot;&gt;.L2:&lt;/span&gt;
        movl    &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;(&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rbp&lt;/span&gt;), &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;eax&lt;/span&gt;
        cltd
        idivl   &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;(&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rbp&lt;/span&gt;)
        movl    &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;edx&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;(&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rbp&lt;/span&gt;)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Of course, we can notice firstly the exception in OCaml (&lt;code&gt;Divided_by_zero&lt;/code&gt;) -
which is pretty good because it protects us against an interrupt from assembly
(and keep the trace). Then, we need to &lt;em&gt;untag&lt;/em&gt; &lt;code&gt;a&lt;/code&gt; and &lt;code&gt;b&lt;/code&gt; with &lt;code&gt;sarq&lt;/code&gt; assembly
operation. We do, as the C code, &lt;code&gt;idiv&lt;/code&gt; and then we must &lt;em&gt;retag&lt;/em&gt; returned value
&lt;code&gt;x&lt;/code&gt; with &lt;code&gt;salq&lt;/code&gt; and &lt;code&gt;incq&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;So in some parts, it should be more interesting to use &lt;code&gt;Nativeint&lt;/code&gt;. However, by
default, a &lt;code&gt;nativeint&lt;/code&gt; is boxed. &lt;em&gt;boxed&lt;/em&gt; means that the value is allocated in
the OCaml heap alongside a header.&lt;/p&gt;
&lt;p&gt;Of course, this is not what we want so, if our &lt;code&gt;nativeint ref&lt;/code&gt; (to have
side-effect, like &lt;code&gt;x&lt;/code&gt;) stay inside a function and then, you return the real
value with the deref &lt;code&gt;!&lt;/code&gt; operator, OCaml, by a good planet alignment, can
directly use registers and real integers. So it should be possible to avoid
these needed conversions.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#readability-versus-performance&quot; aria-label=&quot;readability versus performance permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Readability versus performance&lt;/h3&gt;
&lt;p&gt;We use this optimization only in few parts of the code. In fact, switch
between &lt;code&gt;int&lt;/code&gt; and &lt;code&gt;nativeint&lt;/code&gt; is little bit noisy:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;hold &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; Nativeint&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;logor &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;hold Nativeint&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;shift_left &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;of_int &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;unsafe_get_uint8 d&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;i_pos&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;bits&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In the end, we only gained 0.5Mb/s of inflation rate, so it's not worthwhile
to do systematically this optimization. Especially that the gain is not very
big. But this case show a more troubling problem: loss of readability.&lt;/p&gt;
&lt;p&gt;In fact, we can optimize more and more a code (OCaml or C) but we lost, step by
step, readability. You should be afraid by the implementation of &lt;code&gt;strlen&lt;/code&gt; for
example. In the end, the loss of readability makes it harder to understand the purpose
of the code, leading to errors whenever some other person (or you in 10 years time)
tries to make a change.&lt;/p&gt;
&lt;p&gt;And we think that this kind of optimization is not the way of OCaml in general
where we prefer to produce an understandable and abstracted code than a cryptic
and super fast one.&lt;/p&gt;
&lt;p&gt;Again, &lt;code&gt;flambda&lt;/code&gt; wants to fix this problem and let the compiler to do this
optimization. The goal is to be able to write a fast code without any pain.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#exceptions&quot; aria-label=&quot;exceptions permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Exceptions&lt;/h2&gt;
&lt;p&gt;If you remember our &lt;a href=&quot;https://tarides.com/blog/2019-02-08-release-of-base64.html&quot;&gt;article&lt;/a&gt; about the release of &lt;code&gt;base64&lt;/code&gt;, we talked a
bit about exceptions and used them as a &lt;em&gt;jump&lt;/em&gt;. In fact, it's pretty
common for an OCaml developer to break the control-flow with an exception.
Behind this common design/optimization, it's about calling convention.&lt;/p&gt;
&lt;p&gt;Indeed, choose the &lt;em&gt;jump&lt;/em&gt; word to describe OCaml exception is not the best where
we don't use &lt;code&gt;setjmp&lt;/code&gt;/&lt;code&gt;longjmp&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;In the details, when you start a code with a &lt;code&gt;try .. with&lt;/code&gt;, OCaml saves a &lt;em&gt;trap&lt;/em&gt;
in the stack which contains information about the &lt;code&gt;with&lt;/code&gt;, the catcher. Then,
when you &lt;code&gt;raise&lt;/code&gt;, you &lt;em&gt;jump&lt;/em&gt; directly to this trap and can just discard several
stack frames (and, by this way, you did not check each return codes).&lt;/p&gt;
&lt;p&gt;In several places and mostly in the &lt;em&gt;hot-loop&lt;/em&gt;, we use this &lt;em&gt;pattern&lt;/em&gt;. However,
it completely breaks the control flow and can be error-prone.&lt;/p&gt;
&lt;p&gt;To limit errors and because this pattern is usual, we prefer to use a &lt;em&gt;local&lt;/em&gt;
exception which will be used only inside the function. By this way, we enforce
the fact that exception should not (and can not) be caught by something else
than inside the function.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;exception&lt;/span&gt; Break &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;

    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;max &lt;span class=&quot;token operator&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; bl_count&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;max&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; raise_notrace Break
        &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; decr max &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Break &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This code above produce this assembly code:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nasm&quot;&gt;&lt;pre class=&quot;language-nasm&quot;&gt;&lt;code class=&quot;language-nasm&quot;&gt;&lt;span class=&quot;token label function&quot;&gt;.L105:&lt;/span&gt;
        pushq   &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;r14&lt;/span&gt;
        movq    &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rsp&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;r14&lt;/span&gt;
&lt;span class=&quot;token label function&quot;&gt;.L103:&lt;/span&gt;
        cmpq    &lt;span class=&quot;token number&quot;&gt;$3&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rdi&lt;/span&gt;              &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; while &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;max &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
        jl      .L102
        movq    &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;(&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rbx&lt;/span&gt;,&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rdi&lt;/span&gt;,&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;), &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rsi&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; bl_count,(&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;max)
        cmpq    &lt;span class=&quot;token number&quot;&gt;$1&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rsi&lt;/span&gt;              &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; bl_count.(&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;max) &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
        je      .L104
        movq    &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;r14&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rsp&lt;/span&gt;
        popq    &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;r14&lt;/span&gt;
        ret                           &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; raise_notrace Break
&lt;span class=&quot;token label function&quot;&gt;.L104:&lt;/span&gt;
        addq    &lt;span class=&quot;token operator&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rdi&lt;/span&gt;             &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; decr max
        movq    &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rdi&lt;/span&gt;, &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;(&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rsp&lt;/span&gt;)
        jmp     .L103&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Where the &lt;code&gt;ret&lt;/code&gt; is the &lt;code&gt;raise_notrace Break&lt;/code&gt;. A &lt;code&gt;raise_notrace&lt;/code&gt; is needed,
otherwise, you will see:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nasm&quot;&gt;&lt;pre class=&quot;language-nasm&quot;&gt;&lt;code class=&quot;language-nasm&quot;&gt;        movq    caml_backtrace_pos@GOTPCREL(&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;rip), &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rbx&lt;/span&gt;
        xorq    &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rdi&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rdi&lt;/span&gt;
        movl    &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;edi&lt;/span&gt;, (&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rbx&lt;/span&gt;)
        call    caml_raise_exn@PLT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Instead the &lt;code&gt;ret&lt;/code&gt; assembly code. Indeed, in this case, we need to store where we
raised the exception.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#unrolling&quot; aria-label=&quot;unrolling permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Unrolling&lt;/h2&gt;
&lt;p&gt;When we showed the optimization done by &lt;code&gt;gcc&lt;/code&gt; when the string is aligned, &lt;code&gt;gcc&lt;/code&gt;
did another optimization. Instead of setting the string byte per byte, it decides to
update it 4 bytes per 4 bytes.&lt;/p&gt;
&lt;p&gt;This kind of this optimization is an &lt;em&gt;unroll&lt;/em&gt; and we did it in &lt;code&gt;decompress&lt;/code&gt;.
Indeed, when we reach the &lt;em&gt;copy&lt;/em&gt; &lt;em&gt;opcode&lt;/em&gt; emitted by the &lt;a href=&quot;https://en.wikipedia.org/wiki/LZ77_and_LZ78&quot;&gt;lz77&lt;/a&gt;
compressor, we want to &lt;em&gt;blit&lt;/em&gt; &lt;em&gt;length&lt;/em&gt; byte(s) from a source to the outputs
flow. It can appear that this &lt;code&gt;memcpy&lt;/code&gt; can be optimized to copy 4 bytes per 4
bytes &amp;ndash; 4 bytes is generally a good idea where it's the size of an &lt;code&gt;int32&lt;/code&gt; and
should fit under any architectures.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; blit src src_off dst dst_off &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; dst_off &amp;ndash; src_off &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; slow_blit src src_off dst dst_off
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; len0 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; len &lt;span class=&quot;token operator&quot;&gt;land&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; len1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; len &lt;span class=&quot;token operator&quot;&gt;asr&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;to&lt;/span&gt; len1 &amp;ndash; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; v &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; unsafe_get_uint32 src &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;src_off &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
      unsafe_set_uint32 dst &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dst_off &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; v &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;to&lt;/span&gt; len0 &amp;ndash; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; len1 &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; i &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; v &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; unsafe_get_uint8 src &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;src_off &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
      unsafe_set_uint8 dst &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dst_off &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; v &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In this code, at the beginning, we copy 4 bytes per 4 bytes and if &lt;code&gt;len&lt;/code&gt; is not
a multiple of 4, we start the &lt;em&gt;trailing&lt;/em&gt; loop to copy byte per byte then. In
this context, OCaml can &lt;em&gt;unbox&lt;/em&gt; &lt;code&gt;int32&lt;/code&gt; and use registers. So this function does
not deal with the heap, and by this way, with the garbage collector.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#results-1&quot; aria-label=&quot;results 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Results&lt;/h3&gt;
&lt;p&gt;In the end, we gained an extra 10Mb/s of inflation rate. The &lt;code&gt;blit&lt;/code&gt; function is the
most important function when it comes to inflating the window to an output flow.
As the specialization on the &lt;code&gt;min&lt;/code&gt; function, this is one of the biggest optimization on
&lt;code&gt;decompress&lt;/code&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#hot-loop&quot; aria-label=&quot;hot loop permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;em&gt;hot-loop&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;A common design about decompression (but we can find it on hash implementation
too), is the &lt;em&gt;hot-loop&lt;/em&gt;. An &lt;em&gt;hot-loop&lt;/em&gt; is mainly a loop on the most common
operation in your process. In the context of &lt;code&gt;decompress&lt;/code&gt;, the &lt;em&gt;hot-loop&lt;/em&gt; is
about a repeated translation from bits-sequence to byte(s) from the inputs flow
to the outputs flow and the window.&lt;/p&gt;
&lt;p&gt;The main idea behind the &lt;em&gt;hot-loop&lt;/em&gt; is to initialize all information needed for
the translation before to start the &lt;em&gt;hot-loop&lt;/em&gt;. Then, it's mostly an imperative
loop with a &lt;em&gt;pattern-matching&lt;/em&gt; which corresponds to the current state of the
global computation.&lt;/p&gt;
&lt;p&gt;In OCaml, we can take this opportunity to use &lt;code&gt;int ref&lt;/code&gt; (or &lt;code&gt;nativeint ref&lt;/code&gt;), and then, they will be translated into registers (which is the fastest
area to store something).&lt;/p&gt;
&lt;p&gt;Another deal inside the &lt;em&gt;hot-loop&lt;/em&gt; is to avoid any allocation &amp;ndash; and it's why we
talk about &lt;code&gt;int&lt;/code&gt; or &lt;code&gt;nativeint&lt;/code&gt;. Indeed, a more complex structure like an option
will add a blocker to the garbage collection (a call to &lt;code&gt;caml_call_gc&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Of course, this kind of design is completely wrong if we think in a functional
way. However, this is the (biggest?) advantage of OCaml: hide this ugly/hacky
part inside a functional interface.&lt;/p&gt;
&lt;p&gt;In the API, we talked about a state which represents the &lt;em&gt;inflation&lt;/em&gt; (or the
&lt;em&gt;deflation&lt;/em&gt;). At the beginning, the goal is to store into some references
essentials values like the position into the inputs flow, bits available,
dictionary, etc. Then, we launch the &lt;em&gt;hot-loop&lt;/em&gt; and only at the end, we update the state.&lt;/p&gt;
&lt;p&gt;So we keep the optimal design about &lt;em&gt;inflation&lt;/em&gt; and the functional way outside
the &lt;em&gt;hot-loop&lt;/em&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#caml_modify&quot; aria-label=&quot;caml_modify permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;caml_modify&lt;/h2&gt;
&lt;p&gt;One issue that we need to consider is the call to &lt;code&gt;caml_modify&lt;/code&gt;. In
fact, for a complex data-structure like an &lt;code&gt;int array&lt;/code&gt; or a &lt;code&gt;int option&lt;/code&gt; (so,
other than an integer or a boolean or an &lt;em&gt;immediate&lt;/em&gt; value), values can move to the
major heap.&lt;/p&gt;
&lt;p&gt;In this context, &lt;code&gt;caml_modify&lt;/code&gt; is used to assign a new value into your mutable
block. It is a bit slower than a simple assignment but needed to
ensure pointer correspondence between minor heap and major heap.&lt;/p&gt;
&lt;p&gt;With this OCaml code for example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;mutable&lt;/span&gt; v &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int option &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; f t v &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;v &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; v&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We produce this assembly:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nasm&quot;&gt;&lt;pre class=&quot;language-nasm&quot;&gt;&lt;code class=&quot;language-nasm&quot;&gt;&lt;span class=&quot;token label function&quot;&gt;camlExample__f_1004:&lt;/span&gt;
        subq    &lt;span class=&quot;token number&quot;&gt;$8&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rsp&lt;/span&gt;
        movq    &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rax&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rdi&lt;/span&gt;
        movq    &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rbx&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rsi&lt;/span&gt;
        call    caml_modify@PLT
        movq    &lt;span class=&quot;token number&quot;&gt;$1&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rax&lt;/span&gt;
        addq    &lt;span class=&quot;token number&quot;&gt;$8&lt;/span&gt;, &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token register variable&quot;&gt;rsp&lt;/span&gt;
        ret&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Where we see the call to &lt;code&gt;caml_modify&lt;/code&gt; which will be take care about the
assignment of &lt;code&gt;v&lt;/code&gt; into &lt;code&gt;t.v&lt;/code&gt;. This call is needed mostly because the type of &lt;code&gt;t.v&lt;/code&gt; is not an &lt;em&gt;immediate&lt;/em&gt; value like an integer. So, for many values in the
&lt;em&gt;inflator&lt;/em&gt; and the &lt;em&gt;deflator&lt;/em&gt;, we mostly use integers.&lt;/p&gt;
&lt;p&gt;Of course, at some points, we use &lt;code&gt;int array&lt;/code&gt; and set them at some specific
points of the &lt;em&gt;inflator&lt;/em&gt; &amp;ndash; where we inflated the dictionary. However, the impact
of &lt;code&gt;caml_modify&lt;/code&gt; is not very clear where it is commonly pretty fast.&lt;/p&gt;
&lt;p&gt;Sometimes, however, it can be a real bottleneck in your computation and
this depends on how long your values live in the heap. A little program (which is
not very reproducible) can show that:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;init &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;int_of_string Sys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;argv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; Random&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;int &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; pr fmt &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Format&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printf fmt

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t0 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;mutable&lt;/span&gt; v &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int option &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; v &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int option &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; f0 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t0 &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; t0&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;to&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length t &amp;ndash; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; v &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; t0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
             &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Some &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; v
             &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; None&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; Some i
             &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; None&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; None &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
     t0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;v &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; v
  &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; t0

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; f1 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t1 &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; t1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; t1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ref t1 &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;to&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length t &amp;ndash; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; v &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;t1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
             &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Some &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; v
             &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; None&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; Some i
             &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; None&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; None &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
     t1 &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; v &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;t1

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; t0 &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; t0 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; v&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; None &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; t1 &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; t1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; v&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; None &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; time0 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Unix&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;gettimeofday &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  ignore &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;f0 t0&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; time1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Unix&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;gettimeofday &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  ignore &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;f1 t1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; time2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Unix&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;gettimeofday &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;

  pr &lt;span class=&quot;token string&quot;&gt;&amp;quot;f0: %f ns\n%!&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;time1 &lt;span class=&quot;token operator&quot;&gt;-.&lt;/span&gt; time0&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  pr &lt;span class=&quot;token string&quot;&gt;&amp;quot;f1: %f ns\n%!&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;time2 &lt;span class=&quot;token operator&quot;&gt;-.&lt;/span&gt; time1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In our bare-metal server, if you launch the program with 1000, the &lt;code&gt;f0&lt;/code&gt;
computation, even if it has &lt;code&gt;caml_modify&lt;/code&gt; will be the fastest. However, if you
launch the program with 1000000000, &lt;code&gt;f1&lt;/code&gt; will be the fastest.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ ./a.out &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;
f0: &lt;span class=&quot;token number&quot;&gt;0.000006&lt;/span&gt; ns
f1: &lt;span class=&quot;token number&quot;&gt;0.000015&lt;/span&gt; ns
$ ./a.out &lt;span class=&quot;token number&quot;&gt;1000000000&lt;/span&gt;
f0: &lt;span class=&quot;token number&quot;&gt;7.931782&lt;/span&gt; ns
f1: &lt;span class=&quot;token number&quot;&gt;5.719370&lt;/span&gt; ns&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#about-decompress&quot; aria-label=&quot;about decompress permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;About &lt;code&gt;decompress&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;At the beginning, our choice was made to have, as @dbuenzli does, mutable
structure to represent state. Then, @yallop did a big patch to update it to an
immutable state and we won 9Mb/s on &lt;em&gt;inflation&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;However, the new version is more focused on the &lt;em&gt;hot-loop&lt;/em&gt; and it is 3
times faster than before.&lt;/p&gt;
&lt;p&gt;As we said, the deal about &lt;code&gt;caml_modify&lt;/code&gt; is not clear and depends a lot about
how long your data lives in the heap and how many times you want to update it.
If we localize &lt;code&gt;caml_modify&lt;/code&gt; only on few places, it should be fine. But it still
is one of the most complex question about (macro?) optimization.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#smaller-representation&quot; aria-label=&quot;smaller representation permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Smaller representation&lt;/h2&gt;
&lt;p&gt;We've discussed the impact that integer types can have on the use of immediate
values. More generally, the choice of type to represent your values can have
significant performance implications.&lt;/p&gt;
&lt;p&gt;For example, a dictionary which associates a bits-sequence (an integer) to the
length of it &lt;strong&gt;AND&lt;/strong&gt; the byte, it can be represented by a: &lt;code&gt;(int * int) array&lt;/code&gt;, or
more idiomatically &lt;code&gt;{ len: int; byte: int; } array&lt;/code&gt; (which is structurally the
same).&lt;/p&gt;
&lt;p&gt;However, that means an allocation for each bytes to represent every bytes.
Extraction of it will need an allocation if &lt;code&gt;find : bits:int -&amp;gt; { len: int; byte: int; }&lt;/code&gt; is not inlined as we said. And about memory, the array can be
really &lt;em&gt;heavy&lt;/em&gt; in your heap.&lt;/p&gt;
&lt;p&gt;At this point, we used &lt;code&gt;spacetime&lt;/code&gt; to show how many blocks we allocated for a
common &lt;em&gt;inflation&lt;/em&gt; and we saw that we allocate a lot. The choice was made to use
a smaller representation. Where &lt;code&gt;len&lt;/code&gt; can not be upper than 15 according RFC 1951
and when byte can represent only 256 possibilities (and should fit under one
byte), we can decide to merge them into one integer (which can have, at least,
31 bits).&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; static_literal_tree &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator-like-punctuation punctuation&quot;&gt;[|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;140&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;76&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token operator-like-punctuation punctuation&quot;&gt;|]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; static_literal_tree &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;map &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;len&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; byte&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;len &lt;span class=&quot;token operator&quot;&gt;lsl&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;lor&lt;/span&gt; byte&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; static_literal_tree&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In the code above, we just translate the static dictionary (for a STATIC DEFLATE
block) to a smaller representation where &lt;code&gt;len&lt;/code&gt; will be the left part of the
integer and &lt;code&gt;byte&lt;/code&gt; will be the right part. Of course, it's depends on what you
want to store.&lt;/p&gt;
&lt;p&gt;Another point is readability. &lt;a href=&quot;https://github.com/mirage/ocaml-cstruct#ppx&quot;&gt;&lt;code&gt;cstruct-ppx&lt;/code&gt;&lt;/a&gt; and
&lt;a href=&quot;https://bitbucket.org/thanatonauts/bitstring/src&quot;&gt;&lt;code&gt;bitstring&lt;/code&gt;&lt;/a&gt; can help you but &lt;code&gt;decompress&lt;/code&gt;
wants to depend only on OCaml.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;We conclude with some closing advice about optimising your OCaml programs:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Optimization is specific to your task&lt;/strong&gt;. The points highlighted in this
article may not fit your particular problem, but they are intended to give you
ideas. Our optimizations were only possible because we completely assimilated
the ideas of &lt;code&gt;zlib&lt;/code&gt; and had a clear vision of what we really needed to
optimize (like &lt;code&gt;blit&lt;/code&gt;).
&lt;br/&gt;&lt;br/&gt;
As your first project, this article can not help you a lot to optimize your
code where it's mostly about &lt;em&gt;micro&lt;/em&gt;-optimization under a specific context
(&lt;em&gt;hot-loop&lt;/em&gt;). But it helps you to understand what is really done by the
compiler &amp;ndash; which is still really interesting.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Optimise only with respect to an oracle&lt;/strong&gt;. All optimizations were done
because we did a comparison point between the old implementation of
&lt;code&gt;decompress&lt;/code&gt; and &lt;code&gt;zlib&lt;/code&gt; as oracles. Optimizations can change the semantics of your
code and you should systematically take care at any step about expected
behaviors. So it's a long run.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use the predictability of the OCaml compiler to your advantage&lt;/strong&gt;. For sure,
the compiler does not optimize a lot your code &amp;ndash; but it sill produce realistic
programs if we think about performance. For many cases, &lt;strong&gt;you don't need&lt;/strong&gt; to
optimize your OCaml code. And the good point is about expected behavior.
&lt;br/&gt;&lt;br/&gt;
The mind-link between the OCaml and the assembly exists (much more than the C
and the assembly sometimes where we let the C compiler to optimize the code).
The cool fact is to keep a mental-model about what is going on on your code
easily without to be afraid by what the compiler can produce. And, in some
critical parts like &lt;a href=&quot;https://github.com/mirage/eqaf&quot;&gt;eqaf&lt;/a&gt;, it's really needed.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We have not discussed benchmarking, which is another hard issue: who should you
compare with? where? how? For example, a global comparison between &lt;code&gt;zlib&lt;/code&gt; and
&lt;code&gt;decompress&lt;/code&gt; is not very relevant in many ways &amp;ndash; especially because of the
garbage collector. This could be another article!&lt;/p&gt;
&lt;p&gt;Finally, all of these optimizations should be done by &lt;code&gt;flambda&lt;/code&gt;; the difference
between compiling &lt;code&gt;decompress&lt;/code&gt; with or without &lt;code&gt;flambda&lt;/code&gt; is not very big. We
optimized &lt;code&gt;decompress&lt;/code&gt; by hand mostly to keep compatibility with OCaml (since
&lt;code&gt;flambda&lt;/code&gt; needs another switch) and, in this way, to gain an understanding of
&lt;code&gt;flambda&lt;/code&gt; optimizations so that we can use it effectively!&lt;/p&gt;</content><id>https://tarides.com/blog/2019-09-13-decompress-experiences-with-ocaml-optimization</id><title type="text">Decompress: Experiences with OCaml optimization</title><updated>2019-09-13T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2019-09-04-an-introduction-to-fuzzing-ocaml-with-afl-crowbar-and-bun" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;&lt;a href=&quot;http://lcamtuf.coredump.cx/afl/&quot;&gt;American Fuzzy Lop&lt;/a&gt; or AFL is a &lt;em&gt;fuzzer&lt;/em&gt;: a program that tries to find bugs in
other programs by sending them various auto-generated inputs. This article covers the
basics of AFL and shows an example of fuzzing a parser written in OCaml. It also introduces two
extensions: the &lt;a href=&quot;https://github.com/stedolan/crowbar/&quot;&gt;Crowbar&lt;/a&gt; library which can be used to fuzz any kind of OCaml program or
function and the &lt;a href=&quot;https://github.com/yomimono/ocaml-bun/&quot;&gt;Bun&lt;/a&gt; tool for integrating fuzzing into your CI.&lt;/p&gt;
&lt;p&gt;All of the examples given in this article are available on GitHub at
&lt;a href=&quot;https://github.com/NathanReb/ocaml-afl-examples&quot;&gt;ocaml-afl-examples&lt;/a&gt;. The &lt;code&gt;README&lt;/code&gt; contains all the information you need to understand,
build and fuzz them yourself.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#what-is-afl&quot; aria-label=&quot;what is afl permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What is AFL?&lt;/h2&gt;
&lt;p&gt;AFL actually isn't &lt;em&gt;just&lt;/em&gt; a fuzzer but a set of tools. What makes it so good is that it doesn't just
blindly send random input to your program hoping for it to crash; it inspects the execution paths
of the program and uses that information to figure out which mutations to apply to the previous
inputs to trigger new execution paths. This approach allows for much more efficient and reliable
fuzzing (as it will try to maximize coverage) but requires the binaries to be instrumented so the
execution can be monitored.&lt;/p&gt;
&lt;p&gt;AFL provides wrappers for the common C compilers that you can use to produce the instrumented
binaries along with the CLI fuzzing client: &lt;code&gt;afl-fuzz&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;afl-fuzz&lt;/code&gt; is straight-forward to use. It takes an input directory containing a few initial valid
inputs to your program, an output directory and the instrumented binary. It will then repeatedly
mutate the inputs and feed them to the program, registering the ones that lead to crashes or
hangs in the output directory.&lt;/p&gt;
&lt;p&gt;Because it works in such a way, it makes it very easy to fuzz a parser.&lt;/p&gt;
&lt;p&gt;To fuzz a &lt;code&gt;parse.exe&lt;/code&gt; binary, that takes a file as its first command-line argument and parses it,
you can invoke &lt;code&gt;afl-fuzz&lt;/code&gt; in the following way:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ afl-fuzz -i inputs/ -o findings/ /path/to/parse.exe @@&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;findings/&lt;/code&gt; directory is where &lt;code&gt;afl-fuzz&lt;/code&gt; will write the crashes it finds, it will create it
for you if it doesn't exist.
The &lt;code&gt;inputs/&lt;/code&gt; directory contains one or more valid input files for your
program. By valid we mean &amp;quot;that don't crash your program&amp;quot;.
Finally the &lt;code&gt;@@&lt;/code&gt; part tells &lt;code&gt;afl-fuzz&lt;/code&gt; where on the command line the input file should be passed to
your program, in our case, as the first argument.&lt;/p&gt;
&lt;p&gt;Note that it is possible to supply &lt;code&gt;afl-fuzz&lt;/code&gt; with more detail about how to invoke your program. If
you need to pass it command-line options for instance, you can run it as:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ afl-fuzz -i inputs/ -o findings/ -- /path/to/parse.exe --option=value @@&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you wish to fuzz a program that takes its input from standard input, you can also do that by removing the
&lt;code&gt;@@&lt;/code&gt; from the &lt;code&gt;afl-fuzz&lt;/code&gt; invocation.&lt;/p&gt;
&lt;p&gt;Once &lt;code&gt;afl-fuzz&lt;/code&gt; starts, it will draw a fancy looking table on the standard output to keep you
updated about its progress. From there, you'll mostly be interested in is the top right
corner which contains the number of crashes and hangs it has found so far:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &quot;&gt;
      &lt;a href=&quot;https://tarides.com/static/893fd2c3d0dfbb1c576fd016b6963e96/f2793/afl_example_output.png&quot; class=&quot;gatsby-resp-image-link&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 63.52941176470588%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACPElEQVR42l2T63LjKBSEkWTdkIRAiItwbGfixDu77/9+3xY4nsrujwYKHbpOdx8JIQT/h7WCEATbJth3gdoaxLYjtg7hBMIIRPWsrb7x5301DIh5pp4m6nWlaTvmqWOaWqTskLJllB3dNNGOHc3Y0IwnKqWol4VqWRByommaAjFIidIaHwI+RhaleHz9xbZZUnojpTPeB1KM7NtWutBtx9/e8xUCH85xnxbMMFJlwkxmQ2CPkS2EQni73dj3nZQSSinkNNFnjCOirtm6jt9q4Z/N8NtoPvse3bZPwtkYVIyY8xl1HIXQ7TshBNZ1Lf60w4B0jjVE9PWNuV842kgcHO/jG/MwUzU1bdsi1L4zp4ROiTkE1LoSYyyEXddR1zXTPLOmxHo+sx0H8jjQxuF8xO2RKftffxNu1hKOA+sc2hi+Pj+xxhTSJRsuRHkQUiJdLph9R+uVa/B8HhGVQ81JV9UzFGMtNhseI2rbePv1izFLrWvqqirFUkq8cwXOORYpScbw8J6odanJHZ5OJ8SwLKgsJ0ZG54gfH2zXK3sOytpC8JKUOzhl9D1zVnC7MXpP23XlW5GcH13OZ5y16HXl634nes/9fud6vZa97/v/DP7Q95yPg7DvbFozfMsuHeZUj+MoY6K15vF4EGLk/f2deZ4Lijc/CPPd5XLBeY8xBu/9HwXilY61toSQu8oycyh5Bl/+/MQ4js/5lBKjDSEGpJVPwry8Cl/n12+UJbzOP1F9h5X3TNoPPZWqyv2/lckrPdm16L8AAAAASUVORK5CYII='); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img src=&quot;https://tarides.com/static/893fd2c3d0dfbb1c576fd016b6963e96/c5bb3/afl_example_output.png&quot; class=&quot;gatsby-resp-image-image&quot; alt=&quot;Example output from afl-fuzz&quot; title=&quot;&quot; srcset=&quot;/static/893fd2c3d0dfbb1c576fd016b6963e96/04472/afl_example_output.png 170w,
/static/893fd2c3d0dfbb1c576fd016b6963e96/9f933/afl_example_output.png 340w,
/static/893fd2c3d0dfbb1c576fd016b6963e96/c5bb3/afl_example_output.png 680w,
/static/893fd2c3d0dfbb1c576fd016b6963e96/f2793/afl_example_output.png 743w&quot; sizes=&quot;(max-width: 680px) 100vw, 680px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;You might need to change some of your CPU settings to achieve better performance while fuzzing.
&lt;code&gt;afl-fuzz&lt;/code&gt;'s output will tell you if that's the case and guide you through the steps required to
make that happen.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#using-afl-to-fuzz-an-ocaml-parser&quot; aria-label=&quot;using afl to fuzz an ocaml parser permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Using AFL to fuzz an OCaml parser&lt;/h2&gt;
&lt;p&gt;First of all, if you want to fuzz an OCaml program with AFL you'll need to produce an instrumented
binary. &lt;code&gt;afl-fuzz&lt;/code&gt; has an option to work with regular binaries but you'd lose a lot of what makes it
efficient. To instrument your binary you can simply install a &lt;code&gt;+afl&lt;/code&gt; opam switch and build your
executable from there. AFL compiler variants are available from OCaml &lt;code&gt;4.05.0&lt;/code&gt; onwards. To install such
a switch you can run:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ opam switch create fuzzing-switch 4.07.1+afl&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If your program already parses the standard input or a file given to it via the command line, you
can simply build the executable from your &lt;code&gt;+afl&lt;/code&gt; switch and adapt the above examples. If it doesn't,
it's still easy to fuzz any parsing function.&lt;/p&gt;
&lt;p&gt;Imagine we have a &lt;code&gt;simple-parser&lt;/code&gt; library which exposes the following &lt;code&gt;parse_int&lt;/code&gt; function:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; parse_int&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;int&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator-like-punctuation punctuation&quot;&gt;[&amp;gt;&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Msg&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;of&lt;/span&gt; string&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; result
&lt;span class=&quot;token comment&quot;&gt;(** Parse the given string as an int or return [Error (`Msg _)].
    Does not raise, usually... *)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We want to use AFL to make sure our function is robust and won't crash when receiving unexpected
inputs. As you can see the function returns a result and isn't supposed to raise exceptions. We want
to make sure that's true.&lt;/p&gt;
&lt;p&gt;To find crashes, AFL traps the signals sent by your program. That means that it will consider
uncaught OCaml exceptions as crashes. That's good because it makes it really simple to write a
&lt;code&gt;fuzz_me.ml&lt;/code&gt; executable that fits what &lt;code&gt;afl-fuzz&lt;/code&gt; expects:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; file &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Sys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;argv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; ic &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; open_in file &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; length &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; in_channel_length ic &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; content &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; really_input_string ic length &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  close_in ic&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  ignore &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Simple_parser&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parse_int content&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We have to provide example inputs to AFL so we can write a &lt;code&gt;valid&lt;/code&gt; file to the &lt;code&gt;inputs/&lt;/code&gt; directory
containing &lt;code&gt;123&lt;/code&gt; and an &lt;code&gt;invalid&lt;/code&gt; file containing &lt;code&gt;not an int&lt;/code&gt;. Both should parse without crashing
and make good starting point for AFL as they should trigger different execution paths.&lt;/p&gt;
&lt;p&gt;Because we want to make sure AFL does find crashes we can try to hide a bug in our function:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; parse_int s &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; List&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;init &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token char&quot;&gt;'a'&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token char&quot;&gt;'b'&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token char&quot;&gt;'c'&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; failwith &lt;span class=&quot;token string&quot;&gt;&amp;quot;secret crash&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; int_of_string_opt s &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; None &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; Error &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variant symbol&quot;&gt;`Msg&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Printf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sprintf &lt;span class=&quot;token string&quot;&gt;&amp;quot;Not an int: %S&amp;quot;&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Some i &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; Ok i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we just have to build our native binary from the right switch and let &lt;code&gt;afl-fuzz&lt;/code&gt; do the rest:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ afl-fuzz -i inputs/ -o findings/ ./fuzz_me.exe @@&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It should find that the &lt;code&gt;abc&lt;/code&gt; input leads to a crash rather quickly. Once it does, you'll see it in
the top right corner of its output as shown in the picture from the previous section.&lt;/p&gt;
&lt;p&gt;At this point you can interrupt &lt;code&gt;afl-fuzz&lt;/code&gt; and have a look at the content of the &lt;code&gt;findings/crashes&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; findings/crashes/
id:000000,sig:06,src:000111,op:havoc,rep:16  README.txt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see it contains a &lt;code&gt;README.txt&lt;/code&gt; which will give you some details about the &lt;code&gt;afl-fuzz&lt;/code&gt;
invocation used to find the crashes and how to reproduce them in the folder and a file of the form
&lt;code&gt;id:...,sig:...,src:...,op:...,rep:...&lt;/code&gt; per crash it found. Here there's just one:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; findings/crashes/id:000000,sig:06,src:000111,op:havoc,rep:16
abc&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As expected it contains our special input that triggers our secret crash. We can rerun the program
with that input ourselves to make sure it does trigger it:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ ./fuzz_me.exe findings/crashes/id:000000,sig:06,src:000111,op:havoc,rep:16
Fatal error: exception Failure&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;secret crash&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;No surprise here, it does trigger our uncaught exception and crashes shamefully.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#using-crowbar-and-afl-for-property-based-testing&quot; aria-label=&quot;using crowbar and afl for property based testing permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Using Crowbar and AFL for property-based testing&lt;/h2&gt;
&lt;p&gt;This works well but only being able to fuzz parsers is quite a limitation. That's where &lt;a href=&quot;https://github.com/stedolan/crowbar/&quot;&gt;Crowbar&lt;/a&gt;
comes into play.&lt;/p&gt;
&lt;p&gt;Crowbar is a property-based testing framework. It's much like Haskell's &lt;a href=&quot;http://hackage.haskell.org/package/QuickCheck&quot;&gt;QuickCheck&lt;/a&gt;.
To test a given function, you define how its arguments are shaped, a set of properties the result
should satisfy and it will make sure they hold with any combinations of randomly generated
arguments.
Let's clarify that with an example.&lt;/p&gt;
&lt;p&gt;I wrote a library called &lt;code&gt;Awesome_list&lt;/code&gt; and I want to test its &lt;code&gt;sort&lt;/code&gt; function:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; sort&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int list &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; int list
&lt;span class=&quot;token comment&quot;&gt;(** Sorts the given list of integers. Result list is sorted in increasing
    order, most of the time... *)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I want to make sure it really works so I'm going to use Crowbar to generate a whole lot of
lists of integers and verify that when I sort them with &lt;code&gt;Awesome_list.sort&lt;/code&gt; the result is, well...
sorted.&lt;/p&gt;
&lt;p&gt;We'll write our tests in a &lt;code&gt;fuzz_me.ml&lt;/code&gt; file.
First we need to tell Crowbar how to generate arguments for our function. It exposes some
combinators to help you do that:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; int_list &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Crowbar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;list &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;range &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here we're telling Crowbar to generate lists of any size, containing integers ranging from 0
to 10. Crowbar also exposes more complex and custom generator combinators so don't worry,
you can use it to build more complex arguments.&lt;/p&gt;
&lt;p&gt;Now we need to define our property. Once again it's pretty simple, we just want the output to be
sorted:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; is_sorted l &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;rec&lt;/span&gt; is_sorted &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; hd&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hd'&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; tl&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; hd &lt;span class=&quot;token operator&quot;&gt;&amp;lt;=&lt;/span&gt; hd' &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; is_sorted tl
  &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  Crowbar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;check &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;is_sorted l&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;All that's left to do now is to register our test:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  Crowbar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;add_test &lt;span class=&quot;token label property&quot;&gt;~name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;Awesome_list.sort&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;int_list&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; l &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; is_sorted &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Awesome_list&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sort l&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and to compile that &lt;code&gt;fuzz_me.ml&lt;/code&gt; file to a binary. Crowbar will take care of the magic.&lt;/p&gt;
&lt;p&gt;We can run that binary in &amp;quot;Quickcheck&amp;quot; mode where it will either try a certain amount of random
inputs or keep trying until one of the properties breaks depending on the command-line options
we pass it.
What we're interested in here is its less common &amp;quot;AFL&amp;quot; mode. Crowbar made it so our executable
can be used with &lt;code&gt;afl-fuzz&lt;/code&gt; just like that:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ afl-fuzz &lt;span class=&quot;token parameter variable&quot;&gt;-i&lt;/span&gt; inputs &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; findings -- ./fuzz_me.exe @@&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;What will happen then is that our &lt;code&gt;fuzz_me.exe&lt;/code&gt; binary will read the inputs provided by &lt;code&gt;afl-fuzz&lt;/code&gt;
and use it to determine which test to run and how to generate the arguments to pass to our function.
If the properties are satisfied, the binary will exit normally; if they aren't, it will make sure
that &lt;code&gt;afl-fuzz&lt;/code&gt; interprets that as a crash by raising an exception.&lt;/p&gt;
&lt;p&gt;A nice side-effect of Crowbar's approach is that &lt;code&gt;afl-fuzz&lt;/code&gt; will still be able to pick up
crashes. For instance, if we implement &lt;code&gt;Awesome_list.sort&lt;/code&gt; as:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; sort &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; failwith &lt;span class=&quot;token string&quot;&gt;&amp;quot;secret crash&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; l &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; List&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sort Pervasives&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;compare l&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and use AFL and Crowbar to fuzz-test our function, it will find two crashes: one for the input
&lt;code&gt;[1; 2; 3]&lt;/code&gt; which triggers a crash and one for &lt;code&gt;[4; 5; 6]&lt;/code&gt; for which the &lt;code&gt;is_sorted&lt;/code&gt;
property won't hold.&lt;/p&gt;
&lt;p&gt;The content of the input files found by &lt;code&gt;afl-fuzz&lt;/code&gt; itself won't be of much help as it needs to be
interpreted by Crowbar to build the arguments that were passed to the function to trigger the bug.
We can invoke the &lt;code&gt;fuzz_me.exe&lt;/code&gt; binary ourselves on one of the files in &lt;code&gt;findings/crashes&lt;/code&gt;
and the Crowbar binary will replay the test and give us some more helpful information about what
exactly is going on:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ ./fuzz_me.exe findings/crashes/id&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;:000000&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;,sig&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;:06&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;,src&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;:000011&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;,op&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;:flip1&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;,pos&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;:5 
Awesome_list.sort: &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
Awesome_list.sort: FAIL

When given the input:

    &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    
the &lt;span class=&quot;token builtin class-name&quot;&gt;test&lt;/span&gt; threw an exception:

    Failure&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;secret crash&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    Raised at &lt;span class=&quot;token function&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;stdlib.ml&amp;quot;&lt;/span&gt;, line &lt;span class=&quot;token number&quot;&gt;33&lt;/span&gt;, characters &lt;span class=&quot;token number&quot;&gt;17&lt;/span&gt;-33
    Called from &lt;span class=&quot;token function&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;awesome-list/fuzz/fuzz_me.ml&amp;quot;&lt;/span&gt;, line &lt;span class=&quot;token number&quot;&gt;11&lt;/span&gt;, characters &lt;span class=&quot;token number&quot;&gt;78&lt;/span&gt;-99
    Called from &lt;span class=&quot;token function&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;src/crowbar.ml&amp;quot;&lt;/span&gt;, line &lt;span class=&quot;token number&quot;&gt;264&lt;/span&gt;, characters &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;-19
    
Fatal error: exception Crowbar.TestFailure
$ ./fuzz_me.exe findings/crashes/id&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;:000001&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;,sig&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;:06&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;,src&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;:000027&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;,op&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;:arith16&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;,pos&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;:5&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;,val&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;:+7 
Awesome_list.sort: &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
Awesome_list.sort: FAIL

When given the input:

    &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    
the &lt;span class=&quot;token builtin class-name&quot;&gt;test&lt;/span&gt; failed:

    check &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
    
Fatal error: exception Crowbar.TestFailure&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can see the actual inputs as well as distinguish the one that broke the invariant from the one
that triggered a crash.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#using-bun-to-run-fuzz-testing-in-ci&quot; aria-label=&quot;using bun to run fuzz testing in ci permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Using &lt;code&gt;bun&lt;/code&gt; to run fuzz testing in CI&lt;/h2&gt;
&lt;p&gt;While AFL and Crowbar provide no guarantees they can give you confidence that your implementation
is not broken. Now that you know how to use them, a natural follow-up is to want to run fuzz tests
in your CI to enforce that level of confidence.&lt;/p&gt;
&lt;p&gt;Problem is, AFL isn't very CI friendly. First it has this refreshing output that isn't going to look
great on your travis builds output and it doesn't tell you much besides that it could or couldn't find
crashes or invariant infrigements&lt;/p&gt;
&lt;p&gt;Hopefully, like most problems, this one has a solution:
&lt;a href=&quot;https://github.com/yomimono/ocaml-bun/&quot;&gt;&lt;code&gt;bun&lt;/code&gt;&lt;/a&gt;.
&lt;code&gt;bun&lt;/code&gt; is a CLI wrapper around &lt;code&gt;afl-fuzz&lt;/code&gt;, written in OCaml, that helps you get the best out of AFL
effortlessly. It mostly does two things:&lt;/p&gt;
&lt;p&gt;The first is that it will run several &lt;code&gt;afl-fuzz&lt;/code&gt; processes in parallel
(one per core by default). &lt;code&gt;afl-fuzz&lt;/code&gt; starts with a bunch of deterministic steps. In my experience,
using parallel processes during this phase rarely proved very useful as they tend to find the same
bugs or slight variations of those bugs. It only achieves its full potential in the second phase of
fuzzing.&lt;/p&gt;
&lt;p&gt;The second thing, which is the one we're the most interested in, is that &lt;code&gt;bun&lt;/code&gt; provides a useful
and CI-friendly summary of what's going on with all the fuzzing processes so far. When one of them
finds a crash, it will stop all processes and pretty-print all of the bug-triggering inputs to help
you reproduce and debug them locally. See an example &lt;code&gt;bun&lt;/code&gt; output after a crash was found:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Crashes found! Take a look; copy/paste to save for reproduction:
1432	echo JXJpaWl0IA== | base64 -d &amp;gt; crash_0.$(date -u +%s)
1433	echo NXJhkV8QAA== | base64 -d &amp;gt; crash_1.$(date -u +%s)
1434	echo J3Jh//9qdGFiYmkg | base64 -d &amp;gt; crash_2.$(date -u +%s)
1435	09:35.32:[ERROR]All fuzzers finished, but some crashes were found!&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Using &lt;code&gt;bun&lt;/code&gt; is very similar to using &lt;code&gt;afl-fuzz&lt;/code&gt;. Going back to our first parser example, we can
fuzz it with &lt;code&gt;bun&lt;/code&gt; like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ bun --input inputs/ --output findings/ /path/to/parse.exe&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You'll note that you don't need to provide the &lt;code&gt;@@&lt;/code&gt; anymore. &lt;code&gt;bun&lt;/code&gt; assumes that it should pass the
input as the first argument of your to-be-fuzzed binary.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;bun&lt;/code&gt; also comes with an alternative &lt;code&gt;no-kill&lt;/code&gt; mode which lets all the fuzzers run indefinitely
instead of terminating them whenever a crash is discovered. It will regularly keep you updated on
the number of crashes discovered so far and when terminated will pretty-print each of them just like
it does in regular mode.&lt;/p&gt;
&lt;p&gt;This mode can be convenient if you suspect your implementation may contain a lot of bugs and
you don't want to go through the whole process of fuzz testing it to only find a single bug.&lt;/p&gt;
&lt;p&gt;You can use it in CI by running &lt;code&gt;bun --no-kill&lt;/code&gt; via &lt;code&gt;timeout&lt;/code&gt;. For instance:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;timeout --preserve-status 60m bun --no-kill --input inputs --output findings ./fuzz_me.exe&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;will fuzz &lt;code&gt;fuzz_me.exe&lt;/code&gt; for an hour no matter what happens. When &lt;code&gt;timeout&lt;/code&gt; terminates &lt;code&gt;bun&lt;/code&gt;, it will
provide you with a handful of bugs to fix!&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#final-words&quot; aria-label=&quot;final words permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Final words&lt;/h2&gt;
&lt;p&gt;I really want to encourage you to use those tools and fuzzing in general.
Crowbar and &lt;code&gt;bun&lt;/code&gt; are fairly new so you will probably encounter bugs or find that it lacks a feature
you want but combined with AFL they make for very nice tools to effectively test
critical components of your OCaml code base or infrastructure and detect newly-introduced bugs.
They are already used accross the MirageOS ecosystem where it has been used to fuzz the TCP/IP stack
&lt;a href=&quot;https://github.com/mirage/mirage-tcpip&quot;&gt;mirage-tcpip&lt;/a&gt; and the DHCP implementation &lt;a href=&quot;https://github.com/mirage/charrua&quot;&gt;charrua&lt;/a&gt; thanks to
&lt;a href=&quot;https://github.com/yomimono/somerandompacket&quot;&gt;somerandompacket&lt;/a&gt;.
You can consult Crowbar's &lt;a href=&quot;https://github.com/stedolan/crowbar/issues/2&quot;&gt;hall of fame&lt;/a&gt; to find out about bugs uncovered by this
approach.&lt;/p&gt;
&lt;p&gt;I also encourage anyone interested to join us in using this promising toolchain, report those bugs,
contribute those extra features and help the community build more robust software.&lt;/p&gt;
&lt;p&gt;Finally if you wish to learn more about how to efficienly use fuzzing for testing I recommend the
excellent &lt;a href=&quot;https://blog.regehr.org/archives/1687&quot;&gt;Write Fuzzable Code&lt;/a&gt; article by John Regehr.&lt;/p&gt;</content><id>https://tarides.com/blog/2019-09-04-an-introduction-to-fuzzing-ocaml-with-afl-crowbar-and-bun</id><title type="text">An introduction to fuzzing OCaml with AFL, Crowbar and Bun</title><updated>2019-09-04T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2019-08-26-decompress-the-new-decompress-api" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;&lt;a href=&quot;https://tools.ietf.org/html/rfc1951&quot;&gt;RFC 1951&lt;/a&gt; is one of the most used standards. Indeed,
when you launch your Linux kernel, it inflates itself according &lt;a href=&quot;https://zlib.net/&quot;&gt;zlib&lt;/a&gt;
standard, a superset of RFC 1951. Being a widely-used standard, we decided to
produce an OCaml implementation. In the process, we learned many lessons about
developing OCaml where we would normally use C. So, we are glad to present
&lt;a href=&quot;https://github.com/mirage/decompress&quot;&gt;&lt;code&gt;decompress&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;One of the many users of RFC 1951 is &lt;a href=&quot;https://git-scm.com/&quot;&gt;Git&lt;/a&gt;, which uses it to pack data
objects into a &lt;a href=&quot;https://git-scm.com/book/en/v2/Git-Internals-Packfiles&quot;&gt;PACK file&lt;/a&gt;. At the request of &lt;a href=&quot;https://github.com/samoht&quot;&gt;@samoht&lt;/a&gt;,
&lt;code&gt;decompress&lt;/code&gt; appeared some years ago as a Mirage-compatible replacement for zlib
to be used for compiling a &lt;a href=&quot;https://mirage.io/&quot;&gt;MirageOS&lt;/a&gt; unikernel with
&lt;a href=&quot;https://github.com/mirage/ocaml-git/&quot;&gt;ocaml-git&lt;/a&gt;. Today, this little project passes a major release with
substantial improvements in several domains.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;decompress&lt;/code&gt; provides an API for inflating and deflating &lt;em&gt;flows&lt;/em&gt;&lt;code&gt;[1]&lt;/code&gt;. The main
goal is to provide a &lt;em&gt;platform-agnostic&lt;/em&gt; library: one which may be compiled on
any platform, including JavaScript. We surely cannot be faster than C
implementations like &lt;a href=&quot;https://github.com/facebook/zstd&quot;&gt;zstd&lt;/a&gt; or &lt;a href=&quot;https://github.com/lz4/lz4&quot;&gt;lz4&lt;/a&gt;, but we can play some
optimisation tricks to help bridge the gap. Additionally, OCaml can protect the
user against lot of bugs via the type-system &lt;em&gt;and&lt;/em&gt; the runtime too (e.g. using
array bounds checking). &lt;a href=&quot;https://github.com/mirleft/ocaml-tls&quot;&gt;&lt;code&gt;ocaml-tls&lt;/code&gt;&lt;/a&gt; was implemented partly in
response to the famous &lt;a href=&quot;https://en.wikipedia.org/wiki/Heartbleed&quot;&gt;failure&lt;/a&gt; of &lt;code&gt;openssl&lt;/code&gt;; a vulnerability
which could not exist in OCaml.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[1]&lt;/code&gt;: A &lt;em&gt;flow&lt;/em&gt;, in MirageOS land, is an abstraction which wants to receive
and/or transmit something under a standard. So it's usual to say a &lt;em&gt;TLS-flow&lt;/em&gt;
for example.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#api-design&quot; aria-label=&quot;api design permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;API design&lt;/h2&gt;
&lt;p&gt;The API should be the most difficult part of designing a library - it reveals
what we can do and how we should do it. In this way, an API should:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;constrain the user to avoid security issues&lt;/strong&gt;; too much freedom can be a bad&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;thing. As an example, consider the &lt;code&gt;Hashtbl.create&lt;/code&gt; function, which allows the
user to pass &lt;code&gt;~random:false&lt;/code&gt; to select a fixed hash function. The resulting
hashtable suffers deterministic key collisions, which can be exploited by an
attacker.
&lt;br/&gt;&lt;br/&gt;
An example of good security-awareness in API design can be seen in
&lt;a href=&quot;https://github.com/mirage/digestif&quot;&gt;digestif&lt;/a&gt;, which provided an &lt;code&gt;unsafe_compare&lt;/code&gt; instead of the common
&lt;code&gt;compare&lt;/code&gt; function (before &lt;code&gt;eqaf.0.5&lt;/code&gt;). In this way, it enforced the user to
create an alias of it if they want to use a hash in a &lt;code&gt;Map&lt;/code&gt; &amp;ndash; however, by this
action, they should know that they are not protected against a timing-attack.&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;&lt;strong&gt;allow some degrees of freedom to fit within many environments&lt;/strong&gt;; a&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;constrained API cannot support a hostile context. For example, when compiling
to an &lt;a href=&quot;https://mirage.io/blog/2018-esp32-booting&quot;&gt;ESP32&lt;/a&gt; target, even small details such as the length of a stream
input buffer must be user-definable. When deploying to a server, memory
consumption should be deterministic.
&lt;br/&gt;&lt;br/&gt;
Of course, this is made difficult when too much freedom will enable misuse of
the API &amp;ndash; an example is &lt;a href=&quot;https://github.com/ocaml/dune&quot;&gt;dune&lt;/a&gt; which wants consciously to limit the user
about what they can do with it.&lt;/p&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;&lt;strong&gt;imply an optimal design of how to use it&lt;/strong&gt;. Possibilities should serve the
user, but these can make the API harder to understand; this is why
documentation is important. Your API should tell your users how it wants to
be treated.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#a-dbuenzli-api&quot; aria-label=&quot;a dbuenzli api permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A dbuenzli API&lt;/h3&gt;
&lt;p&gt;From our experiences with protocol/format, one design stands out: the
&lt;em&gt;&lt;a href=&quot;https://github.com/dbuenzli/&quot;&gt;dbuenzli&lt;/a&gt; API&lt;/em&gt;. If you look into some famous libraries in the OCaml
eco-system, you probably know &lt;a href=&quot;https://github.com/dbuenzli/uutf&quot;&gt;uutf&lt;/a&gt;, &lt;a href=&quot;https://github.com/dbuenzli/jsonm&quot;&gt;jsonm&lt;/a&gt; or &lt;a href=&quot;https://github.com/dbuenzli/xmlm&quot;&gt;xmlm&lt;/a&gt;. All
of these libraries provide the same API for computing a Unicode/JSON/XML flow &amp;ndash;
of course, the details are not the same.&lt;/p&gt;
&lt;p&gt;From a MirageOS perspective, even if they use the &lt;code&gt;in_channel&lt;/code&gt;/&lt;code&gt;out_channel&lt;/code&gt;
abstraction rather than a &lt;a href=&quot;https://github.com/mirage/mirage-flow&quot;&gt;Mirage flow&lt;/a&gt;, these libraries
are system-agnostic since they let the user to choose input and output buffers.
Most importantly, they don't use the standard OCaml &lt;code&gt;Unix&lt;/code&gt; module, which cannot
be used in a unikernel.&lt;/p&gt;
&lt;p&gt;The APIs are pretty consistent and try to do their &lt;em&gt;best-effort&lt;/em&gt;&lt;code&gt;[2]&lt;/code&gt; of
decoding. The design has a type &lt;em&gt;state&lt;/em&gt; which represents the current system
status; the user passes this to &lt;code&gt;decode&lt;/code&gt;/&lt;code&gt;encode&lt;/code&gt; to carry out the processing.
Of course, these functions have a side-effect on the state internally, but
this is hidden from the user. One advantage of including states in a design is
that the underlying implementation is very amenable to compiler optimisations (e.g.
tail-call optimisation). Internally, of course, we have a &lt;em&gt;porcelain&lt;/em&gt;&lt;code&gt;[3]&lt;/code&gt;
implementation where any details can have an rational explanation.&lt;/p&gt;
&lt;p&gt;In the beginning, &lt;code&gt;decompress&lt;/code&gt; wanted to follow the same interface without the
mutability (a choice about performances) and it did. Then, the hard test was to
use it in a bigger project; in this case, &lt;a href=&quot;https://github.com/mirage/ocaml-git/&quot;&gt;ocaml-git&lt;/a&gt;. An iterative
process was used to determine what was really needed, what we should not provide
(like special cases) and what we should provide to reach an uniform API that is
not too difficult to understand.&lt;/p&gt;
&lt;p&gt;From this experience, we finalised the initial &lt;code&gt;decompress&lt;/code&gt; API and it did not
change significantly for 4 versions (2 years).&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[2]&lt;/code&gt;: &lt;em&gt;best-effort&lt;/em&gt; means an user control on the error branch where we don't
leak exception (or more generally, any interrupts)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[3]&lt;/code&gt;: &lt;em&gt;porcelain&lt;/em&gt; means implicit invariants held in the mind of the programmer
(or the assertions/comments).&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-new-decompress-api&quot; aria-label=&quot;the new decompress api permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The new &lt;code&gt;decompress&lt;/code&gt; API&lt;/h2&gt;
&lt;p&gt;The new &lt;code&gt;decompress&lt;/code&gt; keeps the same inflation logic, but drastically changes the
deflator to make the &lt;em&gt;flush&lt;/em&gt; operation clearer. For many purposes, people don't
want to hand-craft their compressed flows &amp;ndash; they just want
&lt;code&gt;of_string&lt;/code&gt;/&lt;code&gt;to_string&lt;/code&gt; functions. However, in some contexts (like a PNG
encoder/decoder), the user should be able to play with &lt;code&gt;decompress&lt;/code&gt; in detail
(OpenPGP needs this too in &lt;a href=&quot;https://tools.ietf.org/html/rfc4880&quot;&gt;RFC 4880&lt;/a&gt;).&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-zlib-format&quot; aria-label=&quot;the zlib format permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Zlib format&lt;/h3&gt;
&lt;p&gt;Both &lt;code&gt;decompress&lt;/code&gt; and zlib use &lt;em&gt;&lt;a href=&quot;https://zlib.net/feldspar.html&quot;&gt;Huffman coding&lt;/a&gt;&lt;/em&gt;, an algorithm
for building a dictionary of variable-length codewords for a given set of
symbols (in this case, bytes). The most common byte is assigned the shortest bit
sequence; less common bytes are assigned longer codewords. Using this
dictionary, we just translate each byte into its codeword and we should achieve
a good compression ratio. Of course, there are other details, such as the fact
that all Huffman codes are &lt;a href=&quot;https://en.wikipedia.org/wiki/Prefix_code&quot;&gt;prefix-free&lt;/a&gt;. The compression can be
taken further with the &lt;a href=&quot;https://en.wikipedia.org/wiki/LZ77_and_LZ78&quot;&gt;LZ77&lt;/a&gt; algorithm.&lt;/p&gt;
&lt;p&gt;The &lt;em&gt;&lt;a href=&quot;https://zlib.net/&quot;&gt;zlib&lt;/a&gt;&lt;/em&gt; format, a superset of the &lt;a href=&quot;https://tools.ietf.org/html/rfc1951&quot;&gt;RFC 1951&lt;/a&gt; format, is easy
to understand. We will only consider the RFC 1951 format, since zlib adds only
minor details (such as checksums). It consists of several blocks: DEFLATE
blocks, each with a little header, and the contents. There are 3 kinds of
DEFLATE blocks:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a FLAT block; no compression, just a &lt;em&gt;blit&lt;/em&gt; from inputs to the current block.&lt;/li&gt;
&lt;li&gt;a FIXED block; compressed using a pre-computed Huffman code.&lt;/li&gt;
&lt;li&gt;a DYNAMIC block; compressed using a user-specified Huffman code.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The FIXED block uses a Huffman dictionary that is computed when the OCaml runtime
is initialised. DYNAMIC blocks use dictionaries specified by the user, and so
these must be transmitted alongside the data (&lt;em&gt;after being compressed with
another Huffman code!&lt;/em&gt;). The inflator decompresses this DYNAMIC dictionary and uses
it to do the &lt;em&gt;reverse&lt;/em&gt; translation from bit sequences to bytes.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#inflator&quot; aria-label=&quot;inflator permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Inflator&lt;/h3&gt;
&lt;p&gt;The design of the inflator did not change a lot from the last version of
&lt;code&gt;decompress&lt;/code&gt;. Indeed, it's about to take an input, compute it and return an
output like a flow. Of course, the error case can be reached.&lt;/p&gt;
&lt;p&gt;So the API is pretty-easy:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; decode &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; decoder &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Await&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Flush&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`End&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Malformed&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;of&lt;/span&gt; string &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see, we have 4 cases: one which expects more inputs (&lt;code&gt;Await&lt;/code&gt;), the
second which asks to the user to flush internal buffer (&lt;code&gt;Flush&lt;/code&gt;), the &lt;code&gt;End&lt;/code&gt; case
when we reach the end of the flow and the &lt;code&gt;Malformed&lt;/code&gt; case when we encounter an
error.&lt;/p&gt;
&lt;p&gt;For each case, the user can do several operations. Of course, about the &lt;code&gt;Await&lt;/code&gt;
case, they can refill the contents with an other inputs buffer with:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; src &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; decoder &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; bigstring &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; off&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;int &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; len&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;int &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; unit&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This function provides the decoder a new input with &lt;code&gt;len&lt;/code&gt; bytes to read
starting at &lt;code&gt;off&lt;/code&gt; in the given &lt;code&gt;bigstring&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;In the &lt;code&gt;Flush&lt;/code&gt; case, the user wants some information like how many bytes are
available in the current output buffer. Then, we should provide an action to
&lt;em&gt;flush&lt;/em&gt; this output buffer. In the end, this output buffer should be given by
the user (how many bytes they want to allocate to store outputs flow).&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; src &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Channel&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;of&lt;/span&gt; in_channel &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Manual&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`String&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;of&lt;/span&gt; string &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; dst_rem &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; decoder &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; int
&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; flush &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; decoder &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; unit
&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; decoder &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; src &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; o&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;bigstring &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; w&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;bigstring &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; decoder&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The last function, &lt;code&gt;decoder&lt;/code&gt;, is the most interesting. It lets the user, at the
beginning, choose the context in which they want to inflate inputs. So they
choose:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;src&lt;/code&gt;, where come from inputs flow&lt;/li&gt;
&lt;li&gt;&lt;code&gt;o&lt;/code&gt;, output buffer&lt;/li&gt;
&lt;li&gt;&lt;code&gt;w&lt;/code&gt;, window buffer&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;o&lt;/code&gt; will be used to store inflated outputs, &lt;code&gt;dst_rem&lt;/code&gt; will give to us how many
bytes inflator stored in &lt;code&gt;o&lt;/code&gt; and &lt;code&gt;flush&lt;/code&gt; will just set &lt;code&gt;decoder&lt;/code&gt; to be able to
recompute the flow.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;w&lt;/code&gt; is needed for &lt;a href=&quot;https://en.wikipedia.org/wiki/LZ77_and_LZ78&quot;&gt;lz77&lt;/a&gt; compression. However, as we said, we let
the user give us this intermediate buffer. The idea behind that is to let the
user prepare an &lt;em&gt;inflation&lt;/em&gt;. For example, in &lt;a href=&quot;https://github.com/mirage/ocaml-git/&quot;&gt;ocaml-git&lt;/a&gt;, instead of
allocating &lt;code&gt;w&lt;/code&gt; systematically when we want to decompress a Git object, we
allocate &lt;code&gt;w&lt;/code&gt; one time per threads and all are able to use it and &lt;strong&gt;re-use&lt;/strong&gt; it.
In this way, we avoid systematic allocations (and allocate only once time) which
can have a serious impact about performances.&lt;/p&gt;
&lt;p&gt;The design is pretty close to one idea, a &lt;em&gt;description&lt;/em&gt; step by the &lt;code&gt;decoder&lt;/code&gt;
function and a real computation loop with the &lt;code&gt;decode&lt;/code&gt; function. The idea is to
prepare the inflation with some information (like &lt;code&gt;w&lt;/code&gt; and &lt;code&gt;o&lt;/code&gt;) before the main
(and the most expensive) computation. Internally we do that too (but it's mostly
about a macro-optimization).&lt;/p&gt;
&lt;p&gt;It's the purpose of OCaml in general, be able to have a powerful way to describe
something (with constraints). In our case, we are very limited to what we need
to describe. But, in others libraries like &lt;a href=&quot;https://github.com/inhabitedtype/angstrom&quot;&gt;angstrom&lt;/a&gt;, the description
step is huge (describe the parser according to the BNF) and then, we use it to
the main computation, in the case of angstrom, the parsing (another
example is [cmdliner][cmdliner]).&lt;/p&gt;
&lt;p&gt;This is why &lt;code&gt;decoder&lt;/code&gt; can be considered as the main function where &lt;code&gt;decode&lt;/code&gt; can
be wrapped under a stream.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#deflator&quot; aria-label=&quot;deflator permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Deflator&lt;/h3&gt;
&lt;p&gt;The deflator is a new (complex) deal. Indeed, behind it we have two concepts:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the encoder (according to RFC 1951)&lt;/li&gt;
&lt;li&gt;the compressor&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For this new version of &lt;code&gt;decompress&lt;/code&gt;, we decide to separate these concepts where
one question leads all: how to put my compression algorithm? (instead to use
&lt;a href=&quot;https://en.wikipedia.org/wiki/LZ77_and_LZ78&quot;&gt;LZ77&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;In fact, if you are interested in compression, several algorithms exist and, in
some context, it's preferable to use &lt;a href=&quot;https://en.wikipedia.org/wiki/Lempel%E2%80%93Ziv%E2%80%93Markov_chain_algorithm&quot;&gt;lzwa&lt;/a&gt; for example or rabin's
fingerprint (with &lt;a href=&quot;https://github.com/mirage/duff&quot;&gt;duff&lt;/a&gt;), etc.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#functor&quot; aria-label=&quot;functor permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Functor&lt;/h4&gt;
&lt;p&gt;The first idea was to provide a &lt;em&gt;functor&lt;/em&gt; which expects an implementation of the
compression algorithm. However, the indirection of a functor comes with (big)
performance cost. Consider the following functor example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; S &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;sig&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; add &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; t
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; one &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; t
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; Make &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; S&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; succ x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; S&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;add x S&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;one &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;include&lt;/span&gt; Make &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; int
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; add a b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; b
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; one &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; f x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; succ x&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Currently, with OCaml 4.07.1, the &lt;code&gt;f&lt;/code&gt; function will be a &lt;code&gt;caml_apply2&lt;/code&gt;. We might
wish for a simple &lt;a href=&quot;https://en.wikipedia.org/wiki/Inline_expansion&quot;&gt;&lt;em&gt;inlining&lt;/em&gt;&lt;/a&gt; optimisation, allowing &lt;code&gt;f&lt;/code&gt; to become an
&lt;code&gt;addq&lt;/code&gt; instruction (indeed, &lt;a href=&quot;https://caml.inria.fr/pub/docs/manual-ocaml/flambda.html&quot;&gt;&lt;code&gt;flambda&lt;/code&gt;&lt;/a&gt; does this), but optimizing
functors is hard. As we learned from &lt;a href=&quot;https://github.com/chambart&quot;&gt;Pierre Chambart&lt;/a&gt;, it is possible
for the OCaml compiler to optimize functors directly, but this requires
respecting several constraints that are difficult to respect in practice.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#split-encoder-and-compressor&quot; aria-label=&quot;split encoder and compressor permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Split encoder and compressor&lt;/h4&gt;
&lt;p&gt;So, the choice was done to made the encoder which respects RFC 1951 and the
compressor under some constraints. However, this is not what &lt;a href=&quot;https://zlib.net/&quot;&gt;zlib&lt;/a&gt; did
and, by this way, we decided to provide a new design/API which did not follow,
in first instance, zlib (or some others implementations like
&lt;a href=&quot;https://github.com/richgel999/miniz&quot;&gt;miniz&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;To be fair, the choice from zlib and miniz comes from the first
point about API and the context where they are used. The main problem is the
shared queue between the encoder and the compressor. In C code, it can be hard
for the user to deal with it (where they are liable for buffer overflows).&lt;/p&gt;
&lt;p&gt;In OCaml and for &lt;code&gt;decompress&lt;/code&gt;, the shared queue can be well-abstracted and API
can ensure assumptions (like bounds checking).&lt;/p&gt;
&lt;p&gt;Even if this design is much more complex than before, coverage tests are better
where we can separately test the encoder and the compressor. It breaks down the
initial black-box where compression was intrinsec with encoding &amp;ndash; which was
error-prone. Indeed, &lt;code&gt;decompress&lt;/code&gt; had a bug about generation of
Huffman codes but we never reached it because the (bad)
compressor was not able to produce something (a specific lengh with a specific
distance) to get it.&lt;/p&gt;
&lt;p&gt;NOTE: you have just read the main reason for the new version of &lt;code&gt;decompress&lt;/code&gt;!&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-compressor&quot; aria-label=&quot;the compressor permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The compressor&lt;/h4&gt;
&lt;p&gt;The compressor is the most easy part. The goal is to produce from an inputs
flow, an outputs flow which is an other (more compacted) representation. This
representation consists to:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A &lt;em&gt;literal&lt;/em&gt;, the byte as is&lt;/li&gt;
&lt;li&gt;A &lt;em&gt;copy&lt;/em&gt; code with an &lt;em&gt;offset&lt;/em&gt; and a &lt;em&gt;length&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The last one say to copy &lt;em&gt;length&lt;/em&gt; byte(s) from &lt;em&gt;offset&lt;/em&gt;. For example, &lt;code&gt;aaaa&lt;/code&gt; can
be compressed as &lt;code&gt;[ Literal 'a'; Copy (offset:1, len:3) ]&lt;/code&gt;. By this way, instead
to have 4 bytes, we have only 2 elements which will be compressed then by an
&lt;a href=&quot;https://zlib.net/feldspar.html&quot;&gt;Huffman coding&lt;/a&gt;. This is the main idea of the &lt;a href=&quot;https://en.wikipedia.org/wiki/LZ77_and_LZ78&quot;&gt;lz77&lt;/a&gt;
compression.&lt;/p&gt;
&lt;p&gt;However, the compressor should need to deal with the encoder. An easy interface,
&lt;em&gt;&amp;agrave; la &lt;a href=&quot;https://github.com/dbuenzli/uutf&quot;&gt;uutf&lt;/a&gt;&lt;/em&gt; should be:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; compress &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; state &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Literal&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;of&lt;/span&gt; char &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Copy&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;int &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; int&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`End&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Await&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;But as I said, we need to feed a queue instead.&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;At this point, the purpose of the queue is not clear and not really explained.
The signature above still is a valid and understandable design. Then, we can
imagine passing &lt;code&gt;Literal&lt;/code&gt; and &lt;code&gt;Copy&lt;/code&gt; directly to the encoder. However, we should
(for performance purpose) use a delaying tactic between the compressor and the
deflator[^4].&lt;/p&gt;
&lt;p&gt;Behind this idea, it's to be able to implement an &lt;em&gt;hot-loop&lt;/em&gt; on the encoder
which will iter inside the shared queue and &lt;em&gt;transmit&lt;/em&gt;/&lt;em&gt;encode&lt;/em&gt; contents
directly to the outputs buffer.&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;So, when we make a new &lt;code&gt;state&lt;/code&gt;, we let the user supply their queue:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;val state : src -&amp;gt; w:bistring -&amp;gt; q:queue -&amp;gt; state
val compress : state -&amp;gt; [ `Flush | `Await | `End ]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;Flush&lt;/code&gt; case appears when the queue is full. Then, we refind the &lt;code&gt;w&lt;/code&gt; window
buffer which is needed to produce the &lt;code&gt;Copy&lt;/code&gt; code. A &lt;em&gt;copy code&lt;/em&gt; is limited
according RFC 1951 where &lt;em&gt;offset&lt;/em&gt; can not be upper than the length of the window
(commonly 32ko). &lt;em&gt;length&lt;/em&gt; is limited too to &lt;code&gt;258&lt;/code&gt; (an arbitrary choice).&lt;/p&gt;
&lt;p&gt;Of course, about the &lt;code&gt;Await&lt;/code&gt; case, the compressor comes with a &lt;code&gt;src&lt;/code&gt; function as
the inflator. Then, we added some accessors, &lt;code&gt;literals&lt;/code&gt; and &lt;code&gt;distances&lt;/code&gt;. The
compressor does not build the &lt;a href=&quot;https://zlib.net/feldspar.html&quot;&gt;Huffman coding&lt;/a&gt; which needs
frequencies, so we need firstly to keep counters about that inside the state and
a way to get them (and pass them to the encoder).&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[4]&lt;/code&gt;: About that, you should be interesting by the reason of &lt;a href=&quot;https://www.reddit.com/r/unix/comments/6gxduc/how_is_gnu_yes_so_fast/&quot;&gt;why GNU yes is so
fast&lt;/a&gt; where the secret is just about buffering.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-encoder&quot; aria-label=&quot;the encoder permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The encoder&lt;/h4&gt;
&lt;p&gt;Finally, we can talk about the encoder which will take the shared queue filled
by the compressor and provide an RFC 1951 compliant output flow.&lt;/p&gt;
&lt;p&gt;However, we need to consider a special &lt;em&gt;detail&lt;/em&gt;. When we want to make a
DYNAMIC block from frequencies and then encode the inputs flow, we can reach a
case where the shared queue contains an &lt;em&gt;opcode&lt;/em&gt; (a &lt;em&gt;literal&lt;/em&gt; or a &lt;em&gt;copy&lt;/em&gt;) which
does not appear in our dictionary.&lt;/p&gt;
&lt;p&gt;In fact, if we want to encode &lt;code&gt;[ Literal 'a'; Literal 'b' ]&lt;/code&gt;, we will not try to
make a dictionary which will contains the 256 possibilities of a byte but we
will only make a dictionary from frequencies which contains only &lt;code&gt;'a'&lt;/code&gt; and
&lt;code&gt;'b'&lt;/code&gt;. By this way, we can reach a case where the queue contains an &lt;em&gt;opcode&lt;/em&gt;
(like &lt;code&gt;Literal 'c'&lt;/code&gt;) which can not be encoded by the &lt;em&gt;pre-determined&lt;/em&gt;
Huffman coding &amp;ndash; remember, the DYNAMIC block &lt;strong&gt;starts&lt;/strong&gt; with
the dictionary.&lt;/p&gt;
&lt;p&gt;Another point is about inputs. The encoder expects, of course, contents from
the shared queue but it wants from the user the way to encode contents: which
block we want to emit. So it has two entries:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the shared queue&lt;/li&gt;
&lt;li&gt;an &lt;em&gt;user-entry&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So for many real tests, we decided to provide this kind of API:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; dst &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Channel&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;of&lt;/span&gt; out_channel &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Buffer&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;of&lt;/span&gt; Buffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Manual&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; encoder &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dst &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; q&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;queue &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; encoder
&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; encode &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; encoder &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Block&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;of&lt;/span&gt; block &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Flush&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Await&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Ok&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Partial&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Block&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; dst &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; encoder &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; bigstring &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; off&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;int &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; len&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;int &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; unit&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As expected, we take the shared queue to make a new encoder. Then, we let the
user to specify which kind of block they want to encode by the &lt;code&gt;Block&lt;/code&gt;
operation.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;Flush&lt;/code&gt; operation tries to encode all elements present inside the shared
queue according to the current block and feed the outputs buffer. From it, the
encoder can returns some values:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Ok&lt;/code&gt; and the encoder encoded all &lt;em&gt;opcode&lt;/em&gt; from the shared queue&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Partial&lt;/code&gt;, the outputs buffer is not enough to encode all &lt;em&gt;opcode&lt;/em&gt;, the user
should flush it and give to us a new empty buffer with &lt;code&gt;dst&lt;/code&gt;. Then, they must
continue with the &lt;code&gt;Await&lt;/code&gt; operation.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Block&lt;/code&gt;, the encoder reachs an &lt;em&gt;opcode&lt;/em&gt; which can not be encoded with the
current block (the current dictionary). Then, the user must continue with a new
&lt;code&gt;Block&lt;/code&gt; operation.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The hard part is about the &lt;em&gt;ping-pong&lt;/em&gt; game between the user and the encoder
where a &lt;code&gt;Block&lt;/code&gt; expects a &lt;code&gt;Block&lt;/code&gt; response from the user and a &lt;code&gt;Partial&lt;/code&gt; expects
an &lt;code&gt;Await&lt;/code&gt; response. But this design reveals something higher about zlib
this time: the &lt;em&gt;flush&lt;/em&gt; mode.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-flush-mode&quot; aria-label=&quot;the flush mode permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The &lt;em&gt;flush&lt;/em&gt; mode&lt;/h4&gt;
&lt;p&gt;Firstly, we talk about &lt;em&gt;mode&lt;/em&gt; because zlib does not allow the user to
decide what they want to do when we reach a &lt;code&gt;Block&lt;/code&gt; or a &lt;code&gt;Ok&lt;/code&gt; case. So, it
defines some &lt;a href=&quot;https://www.bolet.org/~pornin/deflate-flush.html&quot;&gt;under-specified &lt;em&gt;modes&lt;/em&gt;&lt;/a&gt; to apply a policy of what
to do in this case.&lt;/p&gt;
&lt;p&gt;In &lt;code&gt;decompress&lt;/code&gt;, we followed the same design and see that it may be not a good
idea where the logic is not very clear and the user wants may be an another
behavior. It was like a &lt;em&gt;black-box&lt;/em&gt; with a &lt;em&gt;black-magic&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Because we decided to split encoder and compressor, the idea of the &lt;em&gt;flush mode&lt;/em&gt;
does not exists anymore where the user explicitly needs to give to the encoder
what they want (make a new block? which block? keep frequencies?). So we broke
the &lt;em&gt;black-box&lt;/em&gt;. But, as we said, it was possible mostly because we can abstract
safely the shared queue between the compressor and the encoder.&lt;/p&gt;
&lt;p&gt;OCaml is an expressive language and we can really talk about a queue where, in
C, it will be just an other &lt;em&gt;array&lt;/em&gt;. As we said, the deal is about performance,
but now, we allow the user the possibility to write their code in this corner-case
which is when they reachs &lt;code&gt;Block&lt;/code&gt;. Behaviors depends only on them.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#apis-in-general&quot; aria-label=&quot;apis in general permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;APIs in general&lt;/h2&gt;
&lt;p&gt;The biggest challenge of building a library is defining the API - you must
strike a compromise between allowing the user the flexibility to express their
use-case and constraining the user to avoid API misuse. If at all possible,
provide an &lt;em&gt;intuitive&lt;/em&gt; API: force the user not to need to think about security
issues, memory consumption or performance.&lt;/p&gt;
&lt;p&gt;Avoid making your API so expressive that it becomes unusable, but beware that
this sets hard limits on your users: the current &lt;code&gt;decompress&lt;/code&gt; API can be used to
build &lt;code&gt;of_string&lt;/code&gt; / &lt;code&gt;to_string&lt;/code&gt; functions, but the opposite is not true - you
definitely cannot build a stream API from &lt;code&gt;of_string&lt;/code&gt; / &lt;code&gt;to_string&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The best advice when designing a library is to keep in mind what you &lt;strong&gt;really&lt;/strong&gt;
want and let the other details fall into place gradually. It is very important
to work in an iterative loop of repeatedly trying to use your library; only this
can highlight bad design, corner-cases and details.&lt;/p&gt;
&lt;p&gt;Finally, use and re-use it on your tests (important!) and inside higher-level
projects to give you interesting questions about your design. The last version
of &lt;code&gt;decompress&lt;/code&gt; was not used in &lt;a href=&quot;https://github.com/mirage/ocaml-git/&quot;&gt;ocaml-git&lt;/a&gt; mostly because the flush
mode was unclear.&lt;/p&gt;</content><id>https://tarides.com/blog/2019-08-26-decompress-the-new-decompress-api</id><title type="text">Decompress: The New Decompress API</title><updated>2019-08-26T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2019-07-05-i-lab-2019" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;We are thrilled to announce that Tarides is laureate of the 21st
edition of the &lt;a href=&quot;http://www.enseignementsup-recherche.gouv.fr/cid5745/le-concours-i-lab-2019-un-tremplin-pour-les-entrepreneurs-de-la-deep-tech.html&quot;&gt;i-Lab innovation contest&lt;/a&gt;
for its innovative technological solution: &lt;strong&gt;OSMOSE&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Organized by the French Ministry of Higher Education, Research and
Innovation in partnership with Bpifrance, the objective of this
competition is to identify and support innovative technology-based
projects. This year, over 700 applications have been registered and 75
projects rewarded. The jury was composed of fifty experts (business
leaders, researchers, former laureate, start-uppers, engineers,
consultants, investors) and was chaired by Ludovic Le Moan, CEO of
Sigfox.&lt;/p&gt;
&lt;p&gt;The OSMOSE solution is a software infrastructure platform to deploy
secure and distributed IoT applications, using low-resource
constraints and providing low-latency performance. This platform is
built upon innovative and open-source projects (in particular MirageOS
and Irmin) which were started at the University of Cambridge, over 10
years ago, where the founders of Tarides met. Tarides uses unikernel
technologies and applies the research done in programming languages to
real-world systems to build safe and performant applications
specialized to their runtime environment.&lt;/p&gt;
&lt;p&gt;If you are interested by the project, contact us:
&lt;a href=&quot;mailto:contact@tarides.com&quot;&gt;contact@tarides.com&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Or &lt;a href=&quot;http://gazagnaire.org/pub/2019.02-osmose.pdf&quot;&gt;check our position paper&lt;/a&gt;
to learn more about it.&lt;/p&gt;</content><id>https://tarides.com/blog/2019-07-05-i-lab-2019</id><title type="text">i-Lab 2019</title><updated>2019-07-05T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2019-06-27-release-of-ocamlformat-0-10" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;We are pleased to announce the release of OCamlFormat 0.10 (available on opam).&lt;/p&gt;
&lt;p&gt;There have been numerous changes since the last release, so here is a comprehensive list of the new features and breaking changes to help the transition from OCamlFormat 0.9.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ocamlformat-0.10&lt;/code&gt; now works on the 4.08 AST, although the formatting should not differ greatly from the one of &lt;code&gt;ocamlformat-0.9&lt;/code&gt; in this regard.
Please note that it is necessary to build &lt;code&gt;ocamlformat&lt;/code&gt; with 4.08 to be able to parse new features like &lt;code&gt;let*&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Upgrading from &lt;code&gt;ocamlformat-0.9&lt;/code&gt; requires to install the following dependencies:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ocaml-migrate-parsetree &amp;gt;= 1.3.1 (upgrade)&lt;/li&gt;
&lt;li&gt;uuseg &amp;gt;= 10.0.0 (new)&lt;/li&gt;
&lt;li&gt;uutf &amp;gt;= 1.0.1 (upgrade)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This release focuses on preserving the style of the original source and on handling more &lt;code&gt;ocp-indent&lt;/code&gt; options.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#style-preservation&quot; aria-label=&quot;style preservation permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Style preservation&lt;/h2&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#expression-grouping&quot; aria-label=&quot;expression grouping permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Expression grouping&lt;/h3&gt;
&lt;p&gt;The new option &lt;code&gt;exp-grouping&lt;/code&gt; has been added to preserve the keywords &lt;code&gt;begin&lt;/code&gt;/&lt;code&gt;end&lt;/code&gt; that are used to delimit expressions instead of parentheses. &lt;code&gt;exp-grouping=parens&lt;/code&gt; always uses parentheses to delimit expressions. &lt;code&gt;exp-grouping=preserve&lt;/code&gt; preserves the original grouping syntax (parentheses or &lt;code&gt;begin&lt;/code&gt;/&lt;code&gt;end&lt;/code&gt;).&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#horizontal-alignment&quot; aria-label=&quot;horizontal alignment permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Horizontal alignment&lt;/h3&gt;
&lt;p&gt;Horizontal alignment is something that users often use to make pattern-matching or type declarations easier to read, and it is a feature that has been requested many times. Three new options have been added to horizontally align the lines.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;align-cases&lt;/code&gt; horizontally aligns the match/try cases:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; fooooooooooo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; foooooooooooooooooooooooo &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Bfooooooooooooooooo &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; foooooooooooo
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; C &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; d&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;      &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; fooooooooooooooooooo
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt;                   &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; fooooooooooooooooooo&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;align-constructors-decl&lt;/code&gt; horizontally aligns type declarations:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;of&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; b
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;     &lt;span class=&quot;token keyword&quot;&gt;of&lt;/span&gt; looooooooooooooooooooooooooooooooooooooong_break&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;align-variants-decl&lt;/code&gt; horizontally aligns variants type declarations:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Foooooooo&lt;/span&gt;      &lt;span class=&quot;token keyword&quot;&gt;of&lt;/span&gt; int
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token variant symbol&quot;&gt;`Fooooooooooooo&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;of&lt;/span&gt; int &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#preserve-blank-lines-in-sequences&quot; aria-label=&quot;preserve blank lines in sequences permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Preserve blank lines in sequences&lt;/h3&gt;
&lt;p&gt;The new option &lt;code&gt;sequence-blank-line&lt;/code&gt; decides whether a blank line is preserved between expressions of a sequence. &lt;code&gt;sequence-blank-line=compact&lt;/code&gt; will not keep any blank line between expressions of a sequence, this is still the default behavior. &lt;code&gt;sequence-blank-line=preserve&lt;/code&gt; will keep a blank line between two expressions of a sequence if the input contains at least one.&lt;/p&gt;
&lt;p&gt;This option can help preserving the readability of the code in this situation:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; foo x y &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  do_some_setup y &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  important_function x&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#supporting-more-ocp-indent-options&quot; aria-label=&quot;supporting more ocp indent options permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Supporting more &lt;code&gt;ocp-indent&lt;/code&gt; options&lt;/h2&gt;
&lt;p&gt;The long term goal of &lt;code&gt;ocamlformat&lt;/code&gt; is to handle every &lt;code&gt;ocp-indent&lt;/code&gt; option, this release got closer to this goal as the following &lt;code&gt;ocp-indent&lt;/code&gt; options are now supported by &lt;code&gt;ocamlformat&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;max_indent&lt;/li&gt;
&lt;li&gt;with&lt;/li&gt;
&lt;li&gt;strict_with&lt;/li&gt;
&lt;li&gt;ppx_stritem_ext&lt;/li&gt;
&lt;li&gt;base&lt;/li&gt;
&lt;li&gt;in&lt;/li&gt;
&lt;li&gt;type&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#offset-added-to-a-new-line&quot; aria-label=&quot;offset added to a new line permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Offset added to a new line&lt;/h3&gt;
&lt;p&gt;The new option &lt;code&gt;max-indent&lt;/code&gt; sets the maximum offset (number of columns) added to a new line in addition to the offset of the previous line. If this offset is set to 2 columns, then each new line can only be indented by 2 columns more in addition to the previous line, for example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  fooooo
  &lt;span class=&quot;token operator&quot;&gt;|&amp;gt;&lt;/span&gt; List&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;iter &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;$&lt;/span&gt; y &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
    fooooooooooo x&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This option is equivalent to the &lt;code&gt;max_indent&lt;/code&gt; option of &lt;code&gt;ocp-indent&lt;/code&gt;, and it will be set if &lt;code&gt;max_indent&lt;/code&gt; is set in an &lt;code&gt;.ocp-indent&lt;/code&gt; configuration file.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#indentation-of-pattern-matching-cases&quot; aria-label=&quot;indentation of pattern matching cases permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Indentation of pattern matching cases&lt;/h3&gt;
&lt;p&gt;The new options &lt;code&gt;funtion-indent&lt;/code&gt; and &lt;code&gt;match-indent&lt;/code&gt; respectively decide the indentation of function cases and the indentation of match/try cases.
These options are equivalent to the &lt;code&gt;with&lt;/code&gt; option of &lt;code&gt;ocp-indent&lt;/code&gt;, and they will be set if &lt;code&gt;with&lt;/code&gt; is set in an &lt;code&gt;ocp-indent&lt;/code&gt; configuration file.
If the indentation is set to 4 columns, cases are formatted like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; foooooooo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; fooooooooooooooooooooooo &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; foooooooooooooooooooooooooo

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; foooooooo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; fooooooooooooooooooooooo &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; fooooooooooooooooooooooo &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; foooooooooooooooooooooooooo&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The new options &lt;code&gt;function-indent-nested&lt;/code&gt; and &lt;code&gt;match-indent-nested&lt;/code&gt; respectively decide whether the &lt;code&gt;function-indent&lt;/code&gt; and the &lt;code&gt;match-indent&lt;/code&gt; parameters should be applied even when in a sub-block. If these options are set to &lt;code&gt;never&lt;/code&gt;, it only applies &lt;code&gt;function-indent&lt;/code&gt; or &lt;code&gt;match-indent&lt;/code&gt; if the function or match block starts a line. If these options are set to &lt;code&gt;always&lt;/code&gt;, then the indent parameters are always applied. The &lt;code&gt;auto&lt;/code&gt; value applies the indentation parameter when seen fit.&lt;/p&gt;
&lt;p&gt;These options are equivalent to the &lt;code&gt;strict_with&lt;/code&gt; option of &lt;code&gt;ocp-indent&lt;/code&gt;, and they will be set if &lt;code&gt;strict_with&lt;/code&gt; is set in an &lt;code&gt;ocp-indent&lt;/code&gt; configuration file.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#indentation-inside-extension-nodes&quot; aria-label=&quot;indentation inside extension nodes permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Indentation inside extension nodes&lt;/h3&gt;
&lt;p&gt;The new option &lt;code&gt;extension-indent&lt;/code&gt; sets the indentation of items (that are not at structure level) inside extension nodes.
The new option &lt;code&gt;stritem-extension-indent&lt;/code&gt; sets the indentation of structure items inside extension nodes. This option is equivalent to the &lt;code&gt;ppx_stritem_ext&lt;/code&gt; option of &lt;code&gt;ocp-indent&lt;/code&gt;, and it will be set if &lt;code&gt;ppx_stritem_ext&lt;/code&gt; is set in an &lt;code&gt;.ocp-indent&lt;/code&gt; configuration file.&lt;/p&gt;
&lt;p&gt;For example if &lt;code&gt;extension-indent&lt;/code&gt; is set to 5 and &lt;code&gt;stritem-extension-indent&lt;/code&gt; is set to 3:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; foo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;foooooooooo
       fooooooooooooooooooooooooooo foooooooooooooooooooooooooooooooooo
         foooooooooooooooooooooooooooo&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@@&lt;/span&gt;foooooooooo
       fooooooooooooooooooooooooooo foooooooooooooooooooooooooooooooooo
         foooooooooooooooooooooooooooo&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@@@&lt;/span&gt;foooooooooo
   fooooooooooooooooooooooooooo foooooooooooooooooooooooooooooooooo
     foooooooooooooooooooooooooooo&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#let-binding-indentation&quot; aria-label=&quot;let binding indentation permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Let-binding indentation&lt;/h3&gt;
&lt;p&gt;The new option &lt;code&gt;let-binding-indent&lt;/code&gt; sets the indentation of let binding expressions if they do not fit on a single line. This option is equivalent to the &lt;code&gt;base&lt;/code&gt; option of &lt;code&gt;ocp-indent&lt;/code&gt;.
The new option &lt;code&gt;indent-after-in&lt;/code&gt; sets the indentation after &lt;code&gt;let ... in&lt;/code&gt;, unless followed by another &lt;code&gt;let&lt;/code&gt;. This option is equivalent to the &lt;code&gt;in&lt;/code&gt; option of &lt;code&gt;ocp-indent&lt;/code&gt;.
The new option &lt;code&gt;type-decl-indent&lt;/code&gt; sets the indentation of type declarations if they do not fit on a single line. This option is equivalent to the &lt;code&gt;type&lt;/code&gt; option of &lt;code&gt;ocp-indent&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;These options will be set if their &lt;code&gt;ocp-indent&lt;/code&gt; counterparts are set in an &lt;code&gt;.ocp-indent&lt;/code&gt; configuration file.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#miscellaneous-features&quot; aria-label=&quot;miscellaneous features permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Miscellaneous features&lt;/h2&gt;
&lt;p&gt;This release also brings some new options, new values for existing features, or corrects erroneous behaviours.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#indicate-multiline-delimiters&quot; aria-label=&quot;indicate multiline delimiters permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Indicate multiline delimiters&lt;/h3&gt;
&lt;p&gt;The former &lt;code&gt;indicate-multiline-delimiters&lt;/code&gt; boolean option is now a 3-valued option:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;indicate-multiline-delimiters=space&lt;/code&gt; (was equivalent to &lt;code&gt;true&lt;/code&gt;) prints a space inside the delimiter to indicate the matching one is on a different line.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;indicate-multiline-delimiters=no&lt;/code&gt; (was equivalent to &lt;code&gt;false&lt;/code&gt;) doesn't do anything special to indicate the closing delimiter.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;indicate-multiline-delimiters=closing-on-separate-line&lt;/code&gt; is the new feature of this option, it makes sure that the closing delimiter is on its own line.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;On this example we can see the closing parenthesis delimiting the nested pattern-matchings are on their own line and are aligned with the matching opening parenthesis:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; v &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
   &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; None &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; None
   &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Some x &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
       &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; x &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
       &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; None &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; None
       &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Some x &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
           &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; x &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
           &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; None &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; None
           &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Some x &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; x
           &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#formatting-of-literal-strings&quot; aria-label=&quot;formatting of literal strings permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Formatting of literal strings&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;break-string-literals=newlines&lt;/code&gt; now takes into account pretty-printing commands like &lt;code&gt;@,&lt;/code&gt;, &lt;code&gt;@;&lt;/code&gt; and &lt;code&gt;@\n&lt;/code&gt; to produce more readable strings. A new value for this option has been added, &lt;code&gt;break-string-literals=newlines-and-wrap&lt;/code&gt;, to break lines at newlines delimiters (including pretty-printing commands) and also wrap the string literals at the margin.&lt;/p&gt;
&lt;p&gt;Here is how &lt;code&gt;break-string-literals=newlines-and-wrap&lt;/code&gt; formats a string:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; fooooooooooo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&amp;quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod \
   tempor incididunt ut labore et dolore magna aliqua.@;\
   Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi \
   ut aliquip ex ea commodo consequat.@;\
   Duis aute irure dolor in reprehenderit in voluptate velit esse cillum \
   dolore eu fugiat nulla pariatur.@;\
   Excepteur sint occaecat cupidatat non proident, sunt in culpa qui \
   officia deserunt mollit anim id est laborum.&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Warning:&lt;/strong&gt; the &lt;code&gt;break-string-literals&lt;/code&gt; will likely be removed in the next release and the default behavior would be &lt;code&gt;newlines-and-wrap&lt;/code&gt;.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#break-before-the-in-keyword&quot; aria-label=&quot;break before the in keyword permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Break before the &lt;code&gt;in&lt;/code&gt; keyword&lt;/h3&gt;
&lt;p&gt;The new option &lt;code&gt;break-before-in&lt;/code&gt; has been added to decide whether the line should break before the &lt;code&gt;in&lt;/code&gt; keyword of a &lt;code&gt;let&lt;/code&gt; binding. &lt;code&gt;break-before-in=fit-or-vertical&lt;/code&gt; will always break the line before the &lt;code&gt;in&lt;/code&gt; keyword if the whole &lt;code&gt;let&lt;/code&gt; binding does not fit on a single line, it is still the default behavior. &lt;code&gt;break-before-in=auto&lt;/code&gt; will only break the line if the &lt;code&gt;in&lt;/code&gt; keyword does not fit on the previous line.&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; short &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; this is short &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; fooo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;this is very long&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; but &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;the &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; keyword can fit&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; on the same line &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  foooooo&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#indentation-of-nested-pattern-matching&quot; aria-label=&quot;indentation of nested pattern matching permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Indentation of nested pattern-matching&lt;/h3&gt;
&lt;p&gt;The new option &lt;code&gt;nested-match&lt;/code&gt; defines the style of pattern-matchings nested in the last case of another pattern-matching. &lt;code&gt;nested-match=wrap&lt;/code&gt; wraps the nested pattern-matching with parentheses and adds indentation, this is still the default behavior. &lt;code&gt;nested-match=align&lt;/code&gt; vertically aligns the nested pattern-matching under the encompassing pattern-matching, for example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; v &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; None &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; None
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Some x &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; x &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; None &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; None
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Some x &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; x&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The new option &lt;code&gt;cases-matching-exp-indent&lt;/code&gt; decides the indentation of cases right-hand sides which are &lt;code&gt;match&lt;/code&gt; or &lt;code&gt;try&lt;/code&gt; expressions. &lt;code&gt;cases-matching-exp-indent=compact&lt;/code&gt; forces an indentation of 2, unless &lt;code&gt;nested-match&lt;/code&gt; is set to &lt;code&gt;align&lt;/code&gt; and this is the last case of the pattern matching. &lt;code&gt;compact&lt;/code&gt; is the default behavior. &lt;code&gt;cases-matching-exp-indent=normal&lt;/code&gt; indents as it would any other expression.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#whitelist-of-files-to-format&quot; aria-label=&quot;whitelist of files to format permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Whitelist of files to format&lt;/h3&gt;
&lt;p&gt;A new kind of configuration files is now handled by &lt;code&gt;ocamlformat&lt;/code&gt;: &lt;code&gt;.ocamlformat-enable&lt;/code&gt; files.
If the &lt;code&gt;disable&lt;/code&gt; option is set, an &lt;code&gt;.ocamlformat-enable&lt;/code&gt; file can list the files that &lt;code&gt;ocamlformat&lt;/code&gt; should format even when the &lt;code&gt;disable&lt;/code&gt; option is set. Each line in an &lt;code&gt;.ocamlformat-enable&lt;/code&gt; file specifies a filename relative to the directory containing the &lt;code&gt;.ocamlformat-enable&lt;/code&gt; file.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;.ocamlformat-enable&lt;/code&gt; files are using the same syntax as the &lt;code&gt;.ocamlformat-ignore&lt;/code&gt; files: lines starting with &lt;code&gt;#&lt;/code&gt; are ignored and can be used as comments.&lt;/p&gt;
&lt;p&gt;These new configuration files do not contradict the existing &lt;code&gt;.ocamlformat-ignore&lt;/code&gt; files, as &lt;code&gt;.ocamlformat-enable&lt;/code&gt; are only considered when &lt;code&gt;disable&lt;/code&gt; is set, and &lt;code&gt;.ocamlformat-ignore&lt;/code&gt; are only considered when &lt;code&gt;disable&lt;/code&gt; is not set.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#disable-outside-detected-project&quot; aria-label=&quot;disable outside detected project permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Disable outside detected project&lt;/h3&gt;
&lt;p&gt;The &lt;code&gt;disable-outside-detected-project&lt;/code&gt; option is now set by default.&lt;/p&gt;
&lt;p&gt;When the option &lt;code&gt;--enable-outside-detected-project&lt;/code&gt; is not set, &lt;code&gt;.ocamlformat&lt;/code&gt; files outside of the project (including the one in &lt;code&gt;XDG_CONFIG_HOME&lt;/code&gt;) are not read. The project root of an input file is taken to be the nearest ancestor directory that contains a .git or .hg or dune-project file. If no config file is found, formatting is disabled.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#space-around-collection-expressions&quot; aria-label=&quot;space around collection expressions permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Space around collection-expressions&lt;/h3&gt;
&lt;p&gt;The former option &lt;code&gt;space-around-collection-expressions&lt;/code&gt; that was deciding whether a space should be added inside the delimiters of collection expressions (lists, arrays, records, variants) has been replaced by 4 new options: &lt;code&gt;space-around-arrays&lt;/code&gt;, &lt;code&gt;space-around-lists&lt;/code&gt;, &lt;code&gt;space-around-records&lt;/code&gt; and &lt;code&gt;space-around-variants&lt;/code&gt;, to allow a finer grain customization.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fit-or-vertical-mode-for-pattern-matching&quot; aria-label=&quot;fit or vertical mode for pattern matching permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Fit-or-vertical mode for pattern matching&lt;/h3&gt;
&lt;p&gt;The &lt;code&gt;break-cases&lt;/code&gt; option that decides the shape of pattern matching has a new value &lt;code&gt;fit-or-vertical&lt;/code&gt;. &lt;code&gt;break-cases=fit-or-vertical&lt;/code&gt; tries to fit all or-patterns on the same line, otherwise breaks each or-pattern (they are wrapped in other modes).
For example if this set of or-patterns does not fit on a single line, we get the following output:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; ffffff &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; foooooooooooo &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Aaaaaaaaaaaaaaaaa
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Bbbbbbbbbbbbbbbbb
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Ccccccccccccccccc
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Ddddddddddddddddd
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Eeeeeeeeeeeeeeeee &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; foooooooooooooooooooo
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Fffffffffffffffff &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; fooooooooooooooooo&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#kr-style-for-if-then-else&quot; aria-label=&quot;kr style for if then else permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;K&amp;amp;R style for if-then-else&lt;/h3&gt;
&lt;p&gt;The &lt;code&gt;if-then-else&lt;/code&gt; option now has a new value &lt;code&gt;k-r&lt;/code&gt; that uses parentheses (when necessary) to reproduce a formatting close to the K&amp;amp;R style. For example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; b &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    something loooooooooooooooooooooooooooooooong enough to_trigger a break &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    this is more
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; b1 &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    something loooooooooooooooooooooooooooooooong enough to_trigger a break &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    this is more
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
    e&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#breaking-changes&quot; aria-label=&quot;breaking changes permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Breaking changes&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;the &lt;code&gt;indicate-multiline-delimiters&lt;/code&gt; option is no longer a boolean option but now has 3 values: &lt;code&gt;space&lt;/code&gt;, &lt;code&gt;no&lt;/code&gt; and &lt;code&gt;closing-on-separate-line&lt;/code&gt; that are detailed in this patch note.&lt;/li&gt;
&lt;li&gt;the &lt;code&gt;disable-outside-detected-project&lt;/code&gt; option is now set by default.&lt;/li&gt;
&lt;li&gt;the &lt;code&gt;default&lt;/code&gt; preset profile has been removed (it was equivalent to the &lt;code&gt;ocamlformat&lt;/code&gt; profile with &lt;code&gt;break-cases=fit&lt;/code&gt;).&lt;/li&gt;
&lt;li&gt;the &lt;code&gt;space-around-collection-expressions&lt;/code&gt; option has been replaced by 4 new options: &lt;code&gt;space-around-arrays&lt;/code&gt;, &lt;code&gt;space-around-lists&lt;/code&gt;, &lt;code&gt;space-around-records&lt;/code&gt; and &lt;code&gt;space-around-variants&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#whats-next&quot; aria-label=&quot;whats next permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What's next?&lt;/h2&gt;
&lt;p&gt;We strongly encourage our users to try out the &lt;code&gt;conventional&lt;/code&gt; preset profile, as we plan to make it the default profile in a future release. This profile's purpose is to reproduce the most commonly encountered styles, and it may be more pleasing to the eye than the current default options.&lt;/p&gt;
&lt;p&gt;As stated previously, the &lt;code&gt;break-string-literals&lt;/code&gt; will likely be removed in the next release and the default behavior would be &lt;code&gt;newlines-and-wrap&lt;/code&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#credits&quot; aria-label=&quot;credits permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Credits&lt;/h2&gt;
&lt;p&gt;This release also contains many other changes and bug fixes that we cannot detail here.&lt;/p&gt;
&lt;p&gt;We would like to thank our maintainers and contributors for this release: Jules Aguillon, Josh Berdine, Hugo Heuzard, Guillaume Petiot and Thomas Refis, and especially our industrial users Jane Street, Ahrefs and Nomadic Labs that made this work possible by funding this project and providing helpful contributions and feedback.&lt;/p&gt;
&lt;p&gt;We would be happy to provide support for more customers, please contact us at &lt;a href=&quot;mailto:contact@tarides.com&quot;&gt;contact@tarides.com&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;If you wish to get involved with OCamlFormat development or file an issue, please read the &lt;a href=&quot;https://github.com/ocaml-ppx/ocamlformat/blob/master/CONTRIBUTING.md&quot;&gt;contributing guide&lt;/a&gt;, any contribution is welcomed.&lt;/p&gt;</content><id>https://tarides.com/blog/2019-06-27-release-of-ocamlformat-0-10</id><title type="text">Release of OCamlFormat 0.10</title><updated>2019-06-27T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2019-05-13-on-the-road-to-irmin-v2" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Over the past few months, we have been heavily engaged in release
engineering the &lt;a href=&quot;https://github.com/mirage/irmin/issues/658&quot;&gt;Irmin 2.0 release&lt;/a&gt;,
which covers multiple years of work on all of its constituent
elements. We first began Irmin in late 2013 to act as a
&lt;a href=&quot;https://mirage.io/blog/introducing-irmin&quot;&gt;Git-like distributed and branchable storage substrate&lt;/a&gt;
that would let us escape the &lt;a href=&quot;https://www.cl.cam.ac.uk/~pes20/SOSP15-paper102-submitted.pdf&quot;&gt;perils of POSIX filesystems&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The Irmin libraries provide snapshotting, branching and merging
operations over storage and can communicate via Git both on-disk and
remotely. Irmin today therefore consists of many discrete OCaml
libraries that compose together to form a set of &lt;a href=&quot;https://blog.acolyer.org/2015/01/14/mergeable-persistent-data-structures/&quot;&gt;mergeable data structures&lt;/a&gt;
that can be used in MirageOS unikernels and normal OCaml daemons such
as &lt;a href=&quot;http://tezos.com&quot;&gt;Tezos&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In this blog post, we wanted to explain some of the release
engineering ongoing, and to highlight some areas where we could use
help from the community to test out pieces (and hopefully find your
own uses in your own infrastructure for it).  The overall effort is
tracked in &lt;a href=&quot;https://github.com/mirage/irmin/issues/658&quot;&gt;mirage/irmin#658&lt;/a&gt;, so
feel free to comment on there as well.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#ocaml-git&quot; aria-label=&quot;ocaml git permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ocaml-git&lt;/h3&gt;
&lt;p&gt;Irmin is parameterised over the exact communication mechanisms it uses
between nodes, both as an on-disk format and also the remoting
protocol.  The most important concrete implementation is Git, which
has turned into the world&amp;rsquo;s most popular version control system.  In
order to seamlessly integrate with Irmin, we embarked on an effort to
build a complete re-implementation of
&lt;a href=&quot;https://github.com/mirage/ocaml-git&quot;&gt;Git from scratch in pure OCaml&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;You can read &lt;a href=&quot;https://tarides.com/blog/2018-10-19-ocaml-git-2-0.html&quot;&gt;details of the git 2.0 release&lt;/a&gt;
on this blog, but from a release engineering perspective we have steadily
been fixing corner cases in this implementation.  The development
ocaml-git trees feature &lt;a href=&quot;https://github.com/mirage/ocaml-git/pull/348&quot;&gt;fixes to https+git&lt;/a&gt;,
for &lt;a href=&quot;https://github.com/mirage/ocaml-git/pull/351&quot;&gt;listing remotes&lt;/a&gt;, supporting
&lt;a href=&quot;https://github.com/mirage/ocaml-git/pull/341&quot;&gt;authenticated URIs&lt;/a&gt; and
more.&lt;/p&gt;
&lt;p&gt;These fixes are possible because users tried end-to-end usecases that
found these corner cases, so we&amp;rsquo;d really like to see more.  For
example, our friends at &lt;a href=&quot;https://robur.io&quot;&gt;Robur&lt;/a&gt; have submitted fixes
from their integration of it into their upcoming &lt;a href=&quot;https://github.com/roburio/caldav&quot;&gt;CalDAV engine&lt;/a&gt;.
The Mirage &lt;a href=&quot;https://github.com/Engil/Canopy&quot;&gt;canopy&lt;/a&gt; blog engine can now also
push/pull reliably from pure MirageOS unikernels between nodes, which
is a huge step.&lt;/p&gt;
&lt;p&gt;If you get a chance to try ocaml-git in your infrastructure, please
let us know how you get along as we prepare a release of the git
libraries with all these fixes (which will be used in Irmin 2.0).&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#wodan&quot; aria-label=&quot;wodan permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Wodan&lt;/h3&gt;
&lt;p&gt;Irmin&amp;rsquo;s storage layer is also well abstracted, so backends other than
a Unix filesystem or Git are supported.  Irmin can run in highly
diverse and OS-free environments, and so we began engineering the
&lt;a href=&quot;https://github.com/mirage/wodan&quot;&gt;Wodan filesystem&lt;/a&gt; as a
domain-specific filesystem designed for MirageOS, Irmin and modern
flash drives.  See &lt;a href=&quot;https://g2p.github.io/research/wodan.pdf&quot;&gt;the OCaml Workshop 2017 abstract on
it&lt;/a&gt; for more design
rationale)&lt;/p&gt;
&lt;p&gt;As part of the Irmin 2.0 release, Wodan is also being prepared for a
release, and you can find &lt;a href=&quot;https://github.com/mirage/wodan/tree/master/src/wodan-irmin&quot;&gt;Irmin 2.0
support&lt;/a&gt;
in the source.  If you&amp;rsquo;d like a standalone block-device based
persistence environment for Irmin, please try this out.  This is the
preferred backend for using Irmin storage in a unikernel.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#tezos-and-irmin-pack&quot; aria-label=&quot;tezos and irmin pack permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Tezos and irmin-pack&lt;/h3&gt;
&lt;p&gt;Another big user of Irmin is the &lt;a href=&quot;https://tezos.com&quot;&gt;Tezos blockchain&lt;/a&gt;,
and we have been optimising the persistent space usage of Irmin as their
network grows.  Because Tezos doesn&amp;rsquo;t require full Git format support,
we created a hybrid backend that grabs the best bits of Git (e.g. the
packfile mechanism) and engineered a domain-specific backend tailored
for Tezos usage. Crucially, because of the way Irmin is split into
clean libraries and OCaml modules, we only had to modify a small part
of the codebase and could also re-use elements of the Git 2.0
engineering effort we described above.&lt;/p&gt;
&lt;p&gt;The &lt;a href=&quot;https://github.com/mirage/irmin/pull/615&quot;&gt;irmin-pack backend&lt;/a&gt; is
currently being reviewed and integrated ahead of Irmin 2.0 to provide
a significant improvement in disk usage -- more information to come soon.
There is a corresponding &lt;a href=&quot;https://gitlab.com/samoht/tezos/tree/snapshot-irmin-pack&quot;&gt;Tezos branch&lt;/a&gt;
using the Irmin 2.0 code that will be integrated downstream in Tezos
once we complete the Irmin 2.0 tests.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#irmin-graphql-and-browser-irmin&quot; aria-label=&quot;irmin graphql and browser irmin permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Irmin-GraphQL and &amp;ldquo;browser Irmin&amp;rdquo;&lt;/h3&gt;
&lt;p&gt;Another new area of huge interest to us is
&lt;a href=&quot;https://graphql.org&quot;&gt;GraphQL&lt;/a&gt; in order to provide frontends a rich
query language for Irmin hosted applications.  Irmin 2.0 includes a
builtin GraphQL server so you can &lt;a href=&quot;https://twitter.com/cuvius/status/1017136581755457539&quot;&gt;manipulate your Git repo via
GraphQL&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If you are interested in (for example) compiling elements of Irmin to
JavaScript or wasm, for usage in frontends, then the Irmin 2.0 release
makes it significantly easier to support this architecture.  We&amp;rsquo;ve
already seen some exploratory efforts &lt;a href=&quot;https://github.com/mirage/irmin/issues/681&quot;&gt;report issues&lt;/a&gt;
when doing this, and we&amp;rsquo;ve had it working ourselves in &lt;a href=&quot;http://roscidus.com/blog/blog/2015/04/28/cuekeeper-gitting-things-done-in-the-browser/&quot;&gt;Irmin 1.0 Cuekeeper&lt;/a&gt;
so we are excited by the potential power of applications built using
this model.  If you have ideas/questions, please get in touch on the
&lt;a href=&quot;https://github.com/mirage/irmin/issues&quot;&gt;issue tracker&lt;/a&gt; with your
usecase.&lt;/p&gt;
&lt;p&gt;This post is just the precursor to the Irmin 2.0 release, so expect to
hear more about it in the coming weeks and months.  This is primarily
a call for help from early adopters interested in helping the project
out.  All of our code is liberally licensed open source, and so this
is a good time to tie together end-to-end usecases and help ensure we
don&amp;rsquo;t make any decisions in Irmin 2.0 that go counter to some product
you&amp;rsquo;d like to build. That&amp;rsquo;s only possible with your feedback, so
either get in touch via the &lt;a href=&quot;https://github.com/mirage/irmin/issues&quot;&gt;issue tracker&lt;/a&gt;, on
&lt;a href=&quot;https://discuss.ocaml.org&quot;&gt;discuss.ocaml.org&lt;/a&gt; via the &lt;code&gt;mirageos&lt;/code&gt; tag,
or just &lt;a href=&quot;mailto:mirageos-devel@lists.xenproject.org&quot;&gt;email us&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;A huge thank you to all our commercial customers, end users and open
source developers who have contributed their time, expertise and
financial support to help us achieve our goal of delivering a modern
storage stack in the spirit of Git. We look forward to getting Irmin
2.0 into your hands very soon!&lt;/p&gt;</content><id>https://tarides.com/blog/2019-05-13-on-the-road-to-irmin-v2</id><title type="text">On the road to Irmin v2</title><updated>2019-05-13T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2019-05-09-an-introduction-to-ocaml-ppx-ecosystem" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;These last few months, I spent some time writing new OCaml PPX rewriters or contributing to existing
ones. It's a really fun experience. Toying around with the AST taught me a lot about a language I
thought I knew really well. Turns out I actually had no idea what I was doing all these years.&lt;/p&gt;
&lt;p&gt;All jokes aside, I was surprised that the most helpful tricks I learned while writing PPX rewriters
weren't properly documented. There already exist a few very good introduction articles on the
subject, like that
&lt;a href=&quot;https://whitequark.org/blog/2014/04/16/a-guide-to-extension-points-in-ocaml/&quot;&gt;2014's article from Whitequark&lt;/a&gt;,
this &lt;a href=&quot;http://rgrinberg.com/posts/extensions-points-update-1/&quot;&gt;more recent one from Rudi Grinberg&lt;/a&gt;
or even &lt;a href=&quot;https://victor.darvariu.me/jekyll/update/2018/06/19/ppx-tutorial.html&quot;&gt;this last one from Victor Darvariu&lt;/a&gt;
I only discovered after I actually started writing my own. I still felt like they were slightly
outdated or weren't answering all the questions I had when I started playing with PPX and writing my
first rewriters.&lt;/p&gt;
&lt;p&gt;I decided to share my PPX adventures in the hope that it can help others familiarize with this bit
of the OCaml ecosystem and eventually write their first rewriters. The scope of this article is not to
cover every single detail about the PPX internals but just to give a gentle introduction to
beginners to help them get settled. That also means I might omit things that I don't think are worth
mentioning or that might confuse the targetted audience but feel free to comment if you believe
this article missed an important point.&lt;/p&gt;
&lt;p&gt;It's worth mentioning that a lot of the nice tricks mentioned in these lines were given to me by a
wonderful human being called &amp;Eacute;tienne Millon, thanks &amp;Eacute;tienne!&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#what-is-a-ppx&quot; aria-label=&quot;what is a ppx permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What is a PPX?&lt;/h2&gt;
&lt;p&gt;PPX rewriters or PPX-es are preprocessors that are applied to your code before passing it on to the
compiler. They don't operate on your code directly but on the Abstract Syntax Tree or AST resulting
from its parsing. That means that they can only be applied to syntactically correct OCaml code. You
can think of them as functions that take an AST and return a new AST.&lt;/p&gt;
&lt;p&gt;That means that in theory you can do a lot of things with a PPX, including pretty bad and cryptic
things. You could for example replace every instance of &lt;code&gt;true&lt;/code&gt; by &lt;code&gt;false&lt;/code&gt;, swap the branches of any
&lt;code&gt;if-then-else&lt;/code&gt; or randomize the order of every pattern-matching case.
Obviously that's not the kind of behaviour that we want as it would make it impossible to
understand the code since it would be so far from the actual AST the compiler would get.
In practice PPX-es have a well defined scope and only transform parts you explicitly annotated.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#understanding-the-ocaml-ast&quot; aria-label=&quot;understanding the ocaml ast permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Understanding the OCaml AST&lt;/h3&gt;
&lt;p&gt;First things first, what is an AST. An AST is an abstract representation of your code. As the name
suggests it has a tree-like structure where the root describes your entire file. It has children for
each bits such as a function declaration or a type definition, each of them having their own
children, for example for the function name, its argument and its body and that goes on until you
reach a leaf such as a literal &lt;code&gt;1&lt;/code&gt;, &lt;code&gt;&amp;quot;abc&amp;quot;&lt;/code&gt; or a variable for instance.
In the case of OCaml it's a set of recursive types allowing us to represent OCaml code as an OCaml
value. This value is what the parser passes to the compiler so it can type check and compile it to
native or byte code.
Those types are defined in OCaml's &lt;code&gt;Parsetree&lt;/code&gt; module. The entry points there are the &lt;code&gt;structure&lt;/code&gt;
type which describes the content of an &lt;code&gt;.ml&lt;/code&gt; file and the &lt;code&gt;signature&lt;/code&gt; type which describes the
content of an &lt;code&gt;.mli&lt;/code&gt; file.&lt;/p&gt;
&lt;p&gt;As mentionned above, a PPX can be seen as a function that transforms an AST. Writing a PPX thus
requires you to understand the AST, both to interpret the one you'll get as input and
to produce the right one as output. This is probably the trickiest part as unless you've already
worked on the OCaml compiler or written a PPX rewriter, that will probably be the first time you two
meet. Chances are also high that'll be a pretty bad first date and you will need some to time
to get to know each other.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;Parsetree&lt;/code&gt; module &lt;a href=&quot;https://caml.inria.fr/pub/docs/manual-ocaml/compilerlibref/Parsetree.html&quot;&gt;documentation&lt;/a&gt;,
is a good place to start. The above mentioned &lt;code&gt;structure&lt;/code&gt; and &lt;code&gt;signature&lt;/code&gt; types are at the root of
the AST but some other useful types to look at at first are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;expression&lt;/code&gt; which describes anything in OCaml that evaluates to a value, the right hand side of a
&lt;code&gt;let&lt;/code&gt; binding for instance.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pattern&lt;/code&gt; which is what you use to deconstruct an OCaml value, the left hand side of a &lt;code&gt;let&lt;/code&gt;
binding or a pattern-matching case for example.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;core_type&lt;/code&gt; which describes type expressions ie what you would find on the right hand side of a
value description in a &lt;code&gt;.mli&lt;/code&gt;, ie &lt;code&gt;val f : &amp;lt;what_goes_there&amp;gt;&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;structure_item&lt;/code&gt; and &lt;code&gt;signature_item&lt;/code&gt; which describe the top level AST nodes you can find in a
&lt;code&gt;structure&lt;/code&gt; or &lt;code&gt;signature&lt;/code&gt; such as type definitions, value or module declarations.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Thing is, it's a bit a rough and there's no detailed explanation about how a specific bit of code is
represented, just type definitions. Most of the time, the type, field, and variant names are
self-explanatory but it can get harder with some of the more advanced language features.
It turns out there are plenty of comments that are really helpful in the actual &lt;code&gt;parsetree.mli&lt;/code&gt; file
and that aren't part of the generated documentation. You can find them on
&lt;a href=&quot;https://github.com/ocaml/ocaml/blob/trunk/parsing/parsetree.mli&quot;&gt;github&lt;/a&gt; but I personally prefer to
have it opened in a VIM tab when I work on a PPX so I usually open
&lt;code&gt;~/.opam/&amp;lt;current_working_switch&amp;gt;/lib/ocaml/compiler-libs/parsetree.mli&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This works well while exploring but you might also want a more straightforward approach to
discovering what the AST representation is for some specific OCaml code. The
&lt;a href=&quot;https://github.com/ocaml-ppx/ppx_tools&quot;&gt;&lt;code&gt;ppx_tools&lt;/code&gt;&lt;/a&gt; opam package comes with a &lt;code&gt;dumpast&lt;/code&gt; binary
that pretty prints the AST for any given piece of valid OCaml code. You can install it using opam:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$opam install ppx_tools&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and then run it using &lt;code&gt;ocamlfind&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ocamlfind ppx_tools/dumpast some_file.ml&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can use it on &lt;code&gt;.ml&lt;/code&gt; and &lt;code&gt;.mli&lt;/code&gt; files or to quickly get the AST for an expression with the &lt;code&gt;-e&lt;/code&gt;
option:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ocamlfind ppx_tools/dumpast -e &amp;quot;1 + 1&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Similarly, you can use the &lt;code&gt;-t&lt;/code&gt; or &lt;code&gt;-p&lt;/code&gt; options to respectively pretty print ASTs from type
expressions or patterns.&lt;/p&gt;
&lt;p&gt;Using &lt;code&gt;dumpast&lt;/code&gt; to get both the ASTs of a piece of code using your future PPX and the resulting
preprocessed code is a good way to start and will help you figure out what are the steps required to
get there.&lt;/p&gt;
&lt;p&gt;Note that you can use the compiler or &lt;code&gt;utop&lt;/code&gt; have a similar feature with the &lt;code&gt;-dparsetree&lt;/code&gt; flag.
Running &lt;code&gt;ocamlc/ocamlopt -dparsetree file.ml&lt;/code&gt; will pretty print the AST of the given file while
running &lt;code&gt;utop -dparsetree&lt;/code&gt; will pretty print the AST of the evaluated code alongside it's
evaluation.
I tend to prefer the pretty printed AST from &lt;code&gt;dumpast&lt;/code&gt; but any of these tools will prove helpful
in understanding the AST representation of a given piece of OCaml code.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#language-extensions-interpreted-by-ppx-es&quot; aria-label=&quot;language extensions interpreted by ppx es permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Language extensions interpreted by PPX-es&lt;/h3&gt;
&lt;p&gt;OCaml 4.02 introduced syntax extensions meant to be used by external tools such as PPX-es. Knowing
their syntax and meaning is important to understand how most of the existing rewriters
work because they usually look for those language extensions in the AST to know which part of it
they need to modify.&lt;/p&gt;
&lt;p&gt;The two language extensions we're interested in here are extension nodes and attributes. They are
defined in detail in the OCaml manual (see the
&lt;a href=&quot;https://caml.inria.fr/pub/docs/manual-ocaml/attributes.html&quot;&gt;attributes&lt;/a&gt; and
&lt;a href=&quot;https://caml.inria.fr/pub/docs/manual-ocaml/extensionnodes.html&quot;&gt;extension nodes&lt;/a&gt; sections) but I'll
try to give a good summary here.&lt;/p&gt;
&lt;p&gt;Extension nodes are used in place of expressions, module expressions, patterns, type expressions or
module type expressions. Their syntax is &lt;code&gt;[%extension_name payload]&lt;/code&gt;. We'll come back to the payload
part a little later.
You can also find extension nodes at the top level of modules or module signatures with the syntax
&lt;code&gt;[%%extension_name payload]&lt;/code&gt;.
Hopefully the following cheatsheet can help you remember the basics of how and where you can use
them:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; a &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int
  &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; b &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;ext pl&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;ext pl&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;ext pl&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%%&lt;/span&gt;ext pl&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Because extension nodes stand where regular AST nodes should, the compiler won't accept them and
will give you an &lt;code&gt;Uninterpreted extension&lt;/code&gt; error. Extension nodes have to be expanded by a PPX for
your code to compile.&lt;/p&gt;
&lt;p&gt;Attributes are slightly different although their syntax is very close to extensions. Attributes
are attached to existing AST nodes instead of replacing them. That means that they don't necessarily
need to be transformed and the compiler will ignore unknown attributes by default.
They can come with a payload just like extensions and use &lt;code&gt;@&lt;/code&gt; instead of &lt;code&gt;%&lt;/code&gt;. The number of &lt;code&gt;@&lt;/code&gt;
preceding the attribute name specifies which kind of node they are attached to:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;attr pl&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;some string&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@@&lt;/span&gt;attr pl&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@@@&lt;/span&gt;attr pl&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In the first example, the attribute is attached to the expression &lt;code&gt;12&lt;/code&gt; while in the second example
it is attached to the whole &lt;code&gt;let b = &amp;quot;some string&amp;quot;&lt;/code&gt; value binding. The third one is of a slightly
different nature as it is a floating attribute. It's not attached to anything per-se and just ends
up in the AST as a structure item.
Because there is a wide variety of nodes to which you can attach attributes, I won't go too far into
details here but a good rule of thumb is that you use &lt;code&gt;@@&lt;/code&gt; attributes when you want them attached to
structure or signature items, for anything deeper within the AST structure such as patterns,
expressions or core types, use the single &lt;code&gt;@&lt;/code&gt; syntax. Looking at the &lt;code&gt;Parsetree&lt;/code&gt; documentation can
help you figure out where you can find attributes.&lt;/p&gt;
&lt;p&gt;Now let's talk about those payloads I mentioned earlier. You can think of them as &amp;quot;arguments&amp;quot; to
the extension points and attributes. You can pass different kinds of arguments and the syntax varies
for each of them:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;ext expr_or_str_item&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; 
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;ext&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; type_expr_or_sig_item&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; c &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;ext&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; pattern&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As suggested in the examples, you can pass expressions or structure items using a space character,
type expressions or signature items (anything you'd find at the top level of a module signature)
using a &lt;code&gt;:&lt;/code&gt; or a pattern using a &lt;code&gt;?&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Attributes' payload use the same syntax:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token char&quot;&gt;'a'&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;attr expr_or_str_item&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token char&quot;&gt;'b'&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;attr&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; type_expr_or_sig_item&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token char&quot;&gt;'a'&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;attr&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; pattern&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Some PPX-es rely on other language extensions such as the suffix character you can attach to &lt;code&gt;int&lt;/code&gt;
and &lt;code&gt;float&lt;/code&gt; literals (&lt;code&gt;10z&lt;/code&gt; could be used by a PPX to turn it into &lt;code&gt;Z.of_string &amp;quot;10&amp;quot;&lt;/code&gt; for instance)
or quoted strings with a specific identifier (&lt;code&gt;{ppx_name|some quoted string|ppx_name}&lt;/code&gt; can be used
if you want your PPX to operate on arbitrary strings and not only syntactically correct OCaml) but
attributes and extensions are the most commonly used ones.&lt;/p&gt;
&lt;p&gt;Attributes and extension points can be expressed using an infix syntax. The attribute version is
barely used but some forms of the infix syntax for extension points are used by popular PPX-es and
it is likely you will encounter some of the following:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; infix_let_extension &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;ext x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; infix_match_extension &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;ext y &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; infix_try_extension &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;ext f z &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;which are syntactic sugar for:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; infix_let_extension &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;ext &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; infix_match_extension &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;ext &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; y &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; infix_try_extension &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;ext &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; f z &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;A good example of a PPX making heavy use of these if
&lt;a href=&quot;http://ocsigen.org/lwt/4.1.0/api/Ppx_lwt&quot;&gt;&lt;code&gt;lwt_ppx&lt;/code&gt;&lt;/a&gt;. The OCaml manual also contains more examples
of the infix syntax in the Attributes and Extension points sections mentioned above.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-two-main-kind-of-ppx-es&quot; aria-label=&quot;the two main kind of ppx es permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The two main kind of PPX-es&lt;/h3&gt;
&lt;p&gt;There is a wide variety of PPX rewriters but the ones you'll probably see the most are Extensions and
Derivers.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#extensions&quot; aria-label=&quot;extensions permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Extensions&lt;/h4&gt;
&lt;p&gt;Extensions will rewrite tagged parts of the AST, usually extension nodes of the form
&lt;code&gt;[%&amp;lt;extension_name&amp;gt; payload]&lt;/code&gt;. They will replace them with a different AST node of the same nature ie
if the extension point was located where an expression should be, the rewriter will produce an
expression. Good examples of extensions are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/rgrinberg/ppx_getenv2&quot;&gt;&lt;code&gt;ppx_getenv2&lt;/code&gt;&lt;/a&gt; which replaces &lt;code&gt;[%getenv SOME_VAR]&lt;/code&gt; with
the value of the environment variable &lt;code&gt;SOME_VAR&lt;/code&gt; at compile time.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/NathanReb/ppx_yojson&quot;&gt;&lt;code&gt;ppx_yojson&lt;/code&gt;&lt;/a&gt; which allows you to write &lt;code&gt;Yojson&lt;/code&gt; values
using OCaml syntax to mimic actual json. For instance you'd use &lt;code&gt;[%yojson {a = None; b = 1}]&lt;/code&gt; to
represent &lt;code&gt;{&amp;quot;a&amp;quot;: null, &amp;quot;b&amp;quot;: 1}&lt;/code&gt; instead of the &lt;code&gt;Yojson&lt;/code&gt;'s notation:
&lt;code&gt;Assoc [(&amp;quot;a&amp;quot;, Null); (&amp;quot;b&amp;quot;, Int 1)]&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#derivers&quot; aria-label=&quot;derivers permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Derivers&lt;/h4&gt;
&lt;p&gt;Derivers or deriving plugins will &amp;quot;insert&amp;quot; new nodes derived from type definitions annotated with a
&lt;code&gt;[@@deriving &amp;lt;deriver_name&amp;gt;]&lt;/code&gt; attribute. They have various applications but are particularly useful
to derive functions that are tedious and error prone to write by hand such as comparison functions,
pretty printers or serializers. It's really convenient as you don't have to update those functions
every time you update your type definitions. They were inspired by Haskell Type classes. Good
examples of derivers are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml-ppx/ppx_deriving&quot;&gt;&lt;code&gt;ppx_deriving&lt;/code&gt;&lt;/a&gt; itself comes with a bunch of deriving
plugins such as &lt;code&gt;eq&lt;/code&gt;, &lt;code&gt;ord&lt;/code&gt; or &lt;code&gt;show&lt;/code&gt; which respectively derives, as you might have guessed,
equality, comparison and pretty-printing functions.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ocaml-ppx/ppx_deriving_yojson&quot;&gt;&lt;code&gt;ppx_deriving_yojson&lt;/code&gt;&lt;/a&gt; which derives JSON
serializers and deserializers.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/janestreet/ppx_sexp_conv&quot;&gt;&lt;code&gt;ppx_sexp_conv&lt;/code&gt;&lt;/a&gt; which derives s-expressions
converters.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Derivers often let you attach attributes to specify how some parts of the AST should be handled. For
example when using &lt;code&gt;ppx_deriving_yojson&lt;/code&gt; you can use &lt;code&gt;[@default some_val]&lt;/code&gt; to make a field of an
object optional:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int
  &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;default &lt;span class=&quot;token string&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@@&lt;/span&gt;deriving of_yojson&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;will derive a deserializer that will convert the JSON value &lt;code&gt;{&amp;quot;a&amp;quot;: 1}&lt;/code&gt; to the OCaml
&lt;code&gt;{a = 1; b = &amp;quot;&amp;quot;}&lt;/code&gt;&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#how-to-write-a-ppx-using-ppxlib&quot; aria-label=&quot;how to write a ppx using ppxlib permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;How to write a PPX using &lt;code&gt;ppxlib&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;Historically there was a few libraries used by PPX rewriter authors to write their PPX-es, including
&lt;code&gt;ppx_tools&lt;/code&gt; and &lt;code&gt;ppx_deriving&lt;/code&gt; but as the eco-system evolved, &lt;code&gt;ppxlib&lt;/code&gt; emerged and is now the most
up-to-date and maintained library to write and handle PPX-es. It wraps the features of those
libraries in a single one.
I encourage you to use &lt;code&gt;ppxlib&lt;/code&gt; to write new PPX-es as it is also easier to make various rewriters
work together if they are all registered through &lt;code&gt;ppxlib&lt;/code&gt; and the PPX ecosystem would gain from
being unified around a single PPX library and driver.&lt;/p&gt;
&lt;p&gt;It is also a great library and has some really powerful features to help you write your extensions
and derivers.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#writing-an-extension&quot; aria-label=&quot;writing an extension permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Writing an extension&lt;/h3&gt;
&lt;p&gt;The entry point of &lt;code&gt;ppxlib&lt;/code&gt; for extensions is &lt;code&gt;Ppxlib.Extension.declare&lt;/code&gt;. You have to use that
function to build an &lt;code&gt;Extension.t&lt;/code&gt;, from which you can then build a &lt;code&gt;Context_free.Rule.t&lt;/code&gt; before
registering your transformation so it's actually applied.&lt;/p&gt;
&lt;p&gt;The typical &lt;code&gt;my_ppx_extension.ml&lt;/code&gt; will look like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; Ppxlib

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; extension &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  Extension&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;declare
    &lt;span class=&quot;token string&quot;&gt;&amp;quot;my_extension&amp;quot;&lt;/span&gt;
    some_context
    some_pattern
    expand_function

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; rule &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Context_free&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Rule&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;extension extension

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  Driver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;register_transformation &lt;span class=&quot;token label property&quot;&gt;~rules&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;rule&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;my_transformation&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To compile it as PPX rewriter you'll need to put the following in your dune file:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;(library
 (public_name my_ppx)
 (kind ppx_rewriter)
 (libraries ppxlib))&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now let's go back a little and look at the important part:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; extension &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  Extension&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;declare
    &lt;span class=&quot;token string&quot;&gt;&amp;quot;my_extension&amp;quot;&lt;/span&gt;
    some_context
    some_pattern
    expand_function&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here &lt;code&gt;&amp;quot;my_extension&amp;quot;&lt;/code&gt; is the name of your extension and that define how you're going to invoke it
in your extension point. In other words, to use this extension in our code we'll use a
&lt;code&gt;[%my_extension ...]&lt;/code&gt; extension point.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;some_context&lt;/code&gt; is a &lt;code&gt;Ppxlib.Extension.Context.t&lt;/code&gt; and describes where this extension can be found in
the AST, ie can you use &lt;code&gt;[%my_extension ...]&lt;/code&gt; as an expression, a pattern, a core type. The
&lt;code&gt;Ppxlib.Extension.Context&lt;/code&gt; module defines a constant for each possible extension context which you
can pass as &lt;code&gt;some_context&lt;/code&gt;.
This obviously means that it also describes the type of AST node to which it must be converted and
this property is actually enforced by the &lt;code&gt;some_pattern&lt;/code&gt; argument. But we'll come back to that
later.&lt;/p&gt;
&lt;p&gt;Finally &lt;code&gt;expand_function&lt;/code&gt; is our actual extension implementation, which basically takes the payload,
a &lt;code&gt;loc&lt;/code&gt; argument which contains the location of the expanded extension point, a &lt;code&gt;path&lt;/code&gt; argument
which is the fully qualified path to the expanded node (eg. &lt;code&gt;&amp;quot;file.ml.A.B&amp;quot;&lt;/code&gt;) and returns the
generated code to replace the extension with.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#ast_pattern&quot; aria-label=&quot;ast_pattern permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Ast_pattern&lt;/h4&gt;
&lt;p&gt;Now let's get back to that &lt;code&gt;some_pattern&lt;/code&gt; argument.&lt;/p&gt;
&lt;p&gt;This is one of the trickiest parts of &lt;code&gt;ppxlib&lt;/code&gt; to understand but it's also one its most
powerful features. The type for &lt;code&gt;Ast_pattern&lt;/code&gt; is defined as &lt;code&gt;('a, 'b, 'c) t&lt;/code&gt; where &lt;code&gt;'a&lt;/code&gt; is
the type of AST nodes that are matched, &lt;code&gt;'b&lt;/code&gt; is the type of the values you're extracting from the
node as a function type and &lt;code&gt;'c&lt;/code&gt; is the return type of that last function. This sounded really
confusing to me at first and I'm guessing it might do to some of you too so let's give it a bit of
context.&lt;/p&gt;
&lt;p&gt;Let's look at the type of &lt;code&gt;Extension.declare&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; declare &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  string &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;token type-variable function&quot;&gt;'context&lt;/span&gt; Context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;payload&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; Ast_pattern&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;loc&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;Location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;string &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
  t&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here, the expected pattern first type parameter is &lt;code&gt;payload&lt;/code&gt; which means we want a pattern that
matches &lt;code&gt;payload&lt;/code&gt; AST nodes. That makes perfect sense since it is used to describe what your
extension's payload should look like and what to do with it.
The last type parameter is &lt;code&gt;'context&lt;/code&gt; which again seems logical. As I mentioned earlier our
&lt;code&gt;expand_function&lt;/code&gt; should return the same kind of node as the one where the extension was found.
Now what about &lt;code&gt;'a&lt;/code&gt;. As you can see, it describes what comes after the base &lt;code&gt;loc&lt;/code&gt; and &lt;code&gt;path&lt;/code&gt;
parameters of our &lt;code&gt;expand_function&lt;/code&gt;. From the pattern point of view, &lt;code&gt;'a&lt;/code&gt; describes the parts of the
matched AST node we wish to extract for later consumption, here by our expander.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Ast_pattern&lt;/code&gt; contains a whole bunch of combinators to let you describe what your pattern should match
and a specific &lt;code&gt;__&lt;/code&gt; pattern that you must use to capture the various parts of the matched nodes.
&lt;code&gt;__&lt;/code&gt; has type &lt;code&gt;('a, 'a -&amp;gt; 'b, 'b) Ast_pattern.t&lt;/code&gt; which means that whenever it's used it changes the
type of consumer function in the returned pattern.&lt;/p&gt;
&lt;p&gt;Let's consider a few examples to try wrapping our heads around this. Say I want to write an
extension that takes an expression as a payload and I want to pass this expression to my expander so
I can generate code based on its value. I can declare the extension like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; extension &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  Extension&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;declare
    &lt;span class=&quot;token string&quot;&gt;&amp;quot;my_extension&amp;quot;&lt;/span&gt;
    Extension&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;expression
    Ast_pattern&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;single_expr_payload __&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    expand_function&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In this example, &lt;code&gt;Extension.Context.expression&lt;/code&gt; has type &lt;code&gt;expression Extension.Context.t&lt;/code&gt;, the
pattern has type &lt;code&gt;(payload, expression -&amp;gt; expression, expression) Ast_pattern.t&lt;/code&gt;. The pattern says we
want to allow a single expression in the payload and capture it. If we decompose it a bit, we can
see that &lt;code&gt;single_expr_payload&lt;/code&gt; has type
&lt;code&gt;(expression, 'a, 'b) Ast_pattern.t -&amp;gt; (payload, 'a, 'b) Ast_pattern.t&lt;/code&gt; and is passed &lt;code&gt;__&lt;/code&gt; which
makes it a &lt;code&gt;(expression, expression -&amp;gt; 'b, 'b) Ast_pattern.t&lt;/code&gt; and that's exactly what we want here
as our expander will have type &lt;code&gt;loc: Location.t -&amp;gt; path: string -&amp;gt; expression -&amp;gt; expression&lt;/code&gt;!&lt;/p&gt;
&lt;p&gt;It works similarly to &lt;code&gt;Scanf.scanf&lt;/code&gt; when you think about it. Changing the pattern changes the type of the
consumer function the same way changing the format string does for &lt;code&gt;Scanf&lt;/code&gt; functions.&lt;/p&gt;
&lt;p&gt;This was a bit easy since we had a custom combinator just for that purpose so let's take a few more
complex examples. Now say we want to only allow pairs of integer and string constants expressions in
our payload. Instead of just capturing any expression and dealing with the error cases in the
&lt;code&gt;expand_function&lt;/code&gt; we can let &lt;code&gt;Ast_pattern&lt;/code&gt; deal with that and pass an &lt;code&gt;int&lt;/code&gt; and &lt;code&gt;string&lt;/code&gt; along to
our expander:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;Ast_pattern&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;single_expr_payload &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pexp_tuple &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;eint __&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;^::&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;estring __&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;^::&lt;/span&gt;nil&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This one's a bit more elaborate but the idea is the same, we use &lt;code&gt;__&lt;/code&gt; to capture the int and string
from the expression and use combinators to specify that the payload should be made of a pair and
that gives us a: &lt;code&gt;(payload, int -&amp;gt; string -&amp;gt; 'a, 'a) Ast_pattern.t&lt;/code&gt; which should be used with a
&lt;code&gt;loc: Location.t -&amp;gt; path: string -&amp;gt; int -&amp;gt; string -&amp;gt; expression&lt;/code&gt; expander.&lt;/p&gt;
&lt;p&gt;We can also specify that our extension should take something else than an expression as a payload,
say a pattern with no &lt;code&gt;when&lt;/code&gt; clause so that it's applied as &lt;code&gt;[%my_ext? some_pattern_payload]&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;Ast_pattern&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ppat __ none&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;or no payload at all and it should just be invoked as &lt;code&gt;[%my_ext]&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;Ast_pattern&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pstr nil&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You should play with &lt;code&gt;Ast_pattern&lt;/code&gt; a bit if you need to express complex patterns as I think it's
the only way to get the hang of it.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#writing-a-deriver&quot; aria-label=&quot;writing a deriver permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Writing a deriver&lt;/h3&gt;
&lt;p&gt;Registering a deriver is slightly different from registering an extension but in the end it remains
relatively simple and you will still have to provide the actual implementation in the form of an
&lt;code&gt;expand&lt;/code&gt; function.&lt;/p&gt;
&lt;p&gt;The typical &lt;code&gt;my_ppx_deriver.ml&lt;/code&gt; will look like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; Ppxlib

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; str_type_decl_generator &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  Deriving&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Generator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;make_no_arg
    &lt;span class=&quot;token label property&quot;&gt;~attributes&lt;/span&gt;
    expand_str

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; sig_type_decl_generator &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  Deriving&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Generator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;make_no_arg
    &lt;span class=&quot;token label property&quot;&gt;~attributes&lt;/span&gt;
    expand_sig

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; my_deriver &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  Deriving&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;add
    &lt;span class=&quot;token label property&quot;&gt;~str_type_decl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;str_type_decl_generator
    &lt;span class=&quot;token label property&quot;&gt;~sig_type_decl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;sig_type_decl_generator
    &lt;span class=&quot;token string&quot;&gt;&amp;quot;my_deriver&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Which you'll need to compile with the following &lt;code&gt;library&lt;/code&gt; stanza:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;(library
 (public_name my_ppx)
 (kind ppx_deriver)
 (libraries ppxlib))&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;Deriving.add&lt;/code&gt; function is declared as:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; add
  &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;  &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;str_type_decl&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;structure&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; rec_flag &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; type_declaration list&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; Generator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t
  &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;str_type_ext &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;structure&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; type_extension                  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; Generator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t
  &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;str_exception&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;structure&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; extension_constructor           &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; Generator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t
  &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;sig_type_decl&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;signature&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; rec_flag &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; type_declaration list&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; Generator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t
  &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;sig_type_ext &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;signature&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; type_extension                  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; Generator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t
  &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;sig_exception&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;signature&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; extension_constructor           &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; Generator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t
  &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;extension&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;loc&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;Location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;string &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; core_type &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; expression&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; string
  &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; t&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It takes a mandatory string argument, here &lt;code&gt;&amp;quot;my_deriver&amp;quot;&lt;/code&gt;, which defines how
user are going to invoke your deriver. In this case we'd need to add a &lt;code&gt;[@@deriving my_deriver]&lt;/code&gt; to
a type declaration in a structure or a signature to use it.
Then there's just one optional argument per kind of node to which you can attach a &lt;code&gt;[@@deriving ...]&lt;/code&gt;
attribute. &lt;code&gt;type_decl&lt;/code&gt; correspond to &lt;code&gt;type = ...&lt;/code&gt;, &lt;code&gt;type_ext&lt;/code&gt; to &lt;code&gt;type += ...&lt;/code&gt; and &lt;code&gt;exception&lt;/code&gt; to
&lt;code&gt;exception My_exc of ...&lt;/code&gt;.
You need to provide generators for the ones you wish your deriver to handle, &lt;code&gt;ppxlib&lt;/code&gt;
will make sure users get a compile error if they try to use it elsewhere.
We can ignore the &lt;code&gt;extension&lt;/code&gt; as it's just here for compatibility with &lt;code&gt;ppx_deriving&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now let's take a look at &lt;code&gt;Generator&lt;/code&gt;. Its type is defined as &lt;code&gt;('output_ast, 'input_ast) t&lt;/code&gt; where
&lt;code&gt;'input_ast&lt;/code&gt; is the type of the node to which the &lt;code&gt;[@@deriving ...]&lt;/code&gt; is attached and &lt;code&gt;'output_ast&lt;/code&gt;
the type of the nodes it should produce, ie either a &lt;code&gt;structure&lt;/code&gt; or a &lt;code&gt;signature&lt;/code&gt;. The type of a
generator depends on the expand function it's built from when you use the smart constructor
&lt;code&gt;make_no_arg&lt;/code&gt; meaning the expand function should have type
&lt;code&gt;loc: Location.t -&amp;gt; path: string -&amp;gt; 'input_ast -&amp;gt; 'output_ast&lt;/code&gt;. This function is the actual
implementation of your deriver and will generate the list of &lt;code&gt;structure_item&lt;/code&gt; or &lt;code&gt;signature_item&lt;/code&gt;
from the type declaration.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#compatibility-with-ppx_import&quot; aria-label=&quot;compatibility with ppx_import permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Compatibility with &lt;code&gt;ppx_import&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ocaml-ppx/ppx_import&quot;&gt;&lt;code&gt;ppx_import&lt;/code&gt;&lt;/a&gt; is a PPX rewriter that lets you import type
definitions and spares you the need to copy and update them every time they change upstream. The
main reason why you would want to do that is because you need to derive values from those types
using a deriver thus the importance of ensuring your deriving plugin is compatible.&lt;/p&gt;
&lt;p&gt;Let's take an example to illustrate how &lt;code&gt;ppx_import&lt;/code&gt; is used. I'm using a library called &lt;code&gt;blob&lt;/code&gt;
which exposes a type &lt;code&gt;Blob.t&lt;/code&gt;. For some reason I need to be able to serialize and deserialize
&lt;code&gt;Blob.t&lt;/code&gt; values to JSON. I'd like to use a deriver to do that as I don't want to maintain that code
myself. Imagine &lt;code&gt;Blob.t&lt;/code&gt; is defined as:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string
  &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; length &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int
  &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; id &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Without &lt;code&gt;ppx_import&lt;/code&gt; I would define somewhere a &lt;code&gt;serializable_blob&lt;/code&gt; type as follows:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; serializable_blob &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Blob&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string
  &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; length &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int
  &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; id &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@@&lt;/span&gt;deriving yojson&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That works well especially because the type definition is simple but I don't really care about
having it here, what I really want is just the &lt;code&gt;to_yojson&lt;/code&gt; and &lt;code&gt;of_yojson&lt;/code&gt; functions. Also now, if
the type definition changes, I have to update it here manually. Maintaining many such imports can be
tedious and duplicates a lot of code unnecessarily.&lt;/p&gt;
&lt;p&gt;What I can do instead, thanks to &lt;code&gt;ppx_import&lt;/code&gt; is to write it like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; serializable_blob &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;import&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Blob&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@@&lt;/span&gt;deriving yojson&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;which will ultimately be expanded into the above using &lt;code&gt;Blob&lt;/code&gt;'s definition of the type &lt;code&gt;t&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now &lt;code&gt;ppx_import&lt;/code&gt; works a bit differently from regular PPX rewriters as it needs a bit more information
than just the AST. We don't need to understand how it works but what it means is that if your
deriving plugin is used with &lt;code&gt;ppx_import&lt;/code&gt;, it will be called twice:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A first time with &lt;code&gt;ocamldep&lt;/code&gt;. This is required to determine the dependencies of a module in terms
of other OCaml modules. PPX-es need to be applied here to find out about dependencies they may
introduce.&lt;/li&gt;
&lt;li&gt;A second time before actually compiling the code.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The issue here is that during the &lt;code&gt;ocamldep&lt;/code&gt; pass, &lt;code&gt;ppx_import&lt;/code&gt; doesn't have the information it
needs to import the type definition yet so it can't copy it and it expands:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; u &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;import A&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;into:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; u &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Only during the second pass will it actually expand it to the copied type definition.&lt;/p&gt;
&lt;p&gt;This may be a concern if your deriving plugin can't apply to abstract types because you will
probably raise an error when encountering one, meaning the first phase will fail and the whole
compilation will fail without giving your rewriter a chance to derive anything from the copied
type definition.&lt;/p&gt;
&lt;p&gt;The right way to deal with this is to have different a behaviour in the context of &lt;code&gt;ocamldep&lt;/code&gt;.
In this case you can ignore such type declaration or eventually, if you know you are going to
inject new dependencies in your generated code, to create dummy values referencing them and just
behave normally in any other context.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ppxlib&lt;/code&gt; versions &lt;code&gt;0.6.0&lt;/code&gt; and higher allow you to do so through the &lt;code&gt;Deriving.Generator.V2&lt;/code&gt; API
which passes an abstract &lt;code&gt;ctxt&lt;/code&gt; value to your &lt;code&gt;expand&lt;/code&gt; function instead of a &lt;code&gt;loc&lt;/code&gt; and a &lt;code&gt;path&lt;/code&gt;.
You can tell whether it is the &lt;code&gt;ocamldep&lt;/code&gt; pass from within the &lt;code&gt;expand&lt;/code&gt; function like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; Ppxlib

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; expand &lt;span class=&quot;token label property&quot;&gt;~ctxt&lt;/span&gt; input_ast &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; omp_config &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Expansion_context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Deriver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;omp_config ctxt &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; is_ocamldep_pass &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;equal &lt;span class=&quot;token string&quot;&gt;&amp;quot;ocamldep&amp;quot;&lt;/span&gt; omp_config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Migrate_parsetree&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Driver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tool_name &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#deriver-attributes&quot; aria-label=&quot;deriver attributes permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Deriver attributes&lt;/h4&gt;
&lt;p&gt;You'll have noted the &lt;code&gt;attributes&lt;/code&gt; parameter in the examples. It's an optional parameter that lets
you define which attributes your deriver allows the user to attach to various bits of the type,
type extension or exception declaration it is applied to.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ppxlib&lt;/code&gt; comes with a &lt;code&gt;Attribute&lt;/code&gt; module that lets you to properly declare the attributes you want
to allow and make sure they are properly used: correctly spelled, placed and with the right
payload attached. This is especially useful since attributes are by default ignored by the compiler
meaning without &lt;code&gt;ppxlib&lt;/code&gt;'s care, plugin users wouldn't get any errors if they misused an attribute
and it might take them a while to figure out they got it wrong and the generated code wasn't
impacted as they hoped.
The &lt;code&gt;Attribute&lt;/code&gt; module offers another great feature: &lt;code&gt;Attribute.t&lt;/code&gt; values can be used to extract the
attribute payload from an AST node if it is present. That will spare you the need for
inspecting attributes yourself which can prove quite tedious.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Ppxlib.Attribute.t&lt;/code&gt; is defined as &lt;code&gt;('context, 'payload) t&lt;/code&gt; where &lt;code&gt;'context&lt;/code&gt; describes to which node
the attribute can be attached and &lt;code&gt;'payload&lt;/code&gt;, the type of its payload.
To build such an attribute you must use &lt;code&gt;Ppxlib.Attribute.declare&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; declare
  &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;  string
  &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt; Context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t
  &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;payload&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'b&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'c&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; Ast_pattern&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t
  &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'b&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'c&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; t&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let's try to declare the &lt;code&gt;default&lt;/code&gt; argument from &lt;code&gt;ppx_deriving_yojson&lt;/code&gt; I mentioned earlier.&lt;/p&gt;
&lt;p&gt;The first &lt;code&gt;string&lt;/code&gt; argument is the attribute name. &lt;code&gt;ppxlib&lt;/code&gt; support namespaces for the attributes so
that users can avoid conflicting attributes between various derivers applied to the same type
definitions. For instance here we could use &lt;code&gt;&amp;quot;default&amp;quot;&lt;/code&gt;. It can prove helpful to use more qualified
name such as &lt;code&gt;&amp;quot;ppx_deriving_yojson.of_yojson.default&amp;quot;&lt;/code&gt;. That means that our attribute can be used as
&lt;code&gt;[@@default ...]&lt;/code&gt;, &lt;code&gt;[@@of_yojson.default ...]&lt;/code&gt; or &lt;code&gt;[@@ppx_deriving.of_yojson.default ...]&lt;/code&gt;.
Now if another deriver uses a &lt;code&gt;[@@default ...]&lt;/code&gt;, users can apply both derivers and provide different
&lt;code&gt;default&lt;/code&gt; values to the different derivers by writing:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; a &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int
  &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; b &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;make&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;default &lt;span class=&quot;token string&quot;&gt;&amp;quot;abc&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;of_yojson&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;default &lt;span class=&quot;token string&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@@&lt;/span&gt;deriving make&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;of_yojson&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The context argument works very similarly to the one in &lt;code&gt;Extension.declare&lt;/code&gt;. Here we want the
attribute to be attached to record field declarations so we'll use
&lt;code&gt;Attribute.Context.label_declaration&lt;/code&gt; which has type &lt;code&gt;label_declaration Attribute.Context.t&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The pattern argument is an &lt;code&gt;Ast_pattern.t&lt;/code&gt;. Now that we know how to work with those this is pretty
easy. Here we need to accept any expression as a payload since we should be able to apply the
&lt;code&gt;default&lt;/code&gt; attribute to any field, regardless of its type and we want to extract that expression from
the payload so we can use it in our deserializer so let's use
&lt;code&gt;Ast_pattern.(single_expr_payload __)&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Finally the last &lt;code&gt;'b&lt;/code&gt; argument has the same type as the pattern consumer function. We can use it to
transform what we extracted using the previous &lt;code&gt;Ast_pattern&lt;/code&gt; but in this case we just want to
keep the expression as we got it so we'll just use the identity function here.&lt;/p&gt;
&lt;p&gt;We end up with the following:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; default_attribute &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  Attribute&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;declare
    &lt;span class=&quot;token string&quot;&gt;&amp;quot;ppx_deriving_yojson.of_yojson.default&amp;quot;&lt;/span&gt;
    Attribute&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;label_declaration
    Ast_pattern&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;single_expr_payload __&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; expr &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; expr&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and that gives us a &lt;code&gt;(label_declaration, expression) Attribute.t&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;You can then use it to collect the attribute payload from a label_declaration:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;Attribute&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get default_attribute label_decl&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;which will return &lt;code&gt;Some expr&lt;/code&gt; if the attribute was attached to &lt;code&gt;label_decl&lt;/code&gt; or &lt;code&gt;None&lt;/code&gt; otherwise.&lt;/p&gt;
&lt;p&gt;Because of their polymorphic nature, attributes need to be packed, ie to be wrapped with a variant
to hide the type parameter, so if you want to pass it to &lt;code&gt;Generator.make_no_arg&lt;/code&gt; you'll have to do
it like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; attributes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Attribute&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;T default_attribute&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#writing-your-expand-functions&quot; aria-label=&quot;writing your expand functions permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Writing your expand functions&lt;/h3&gt;
&lt;p&gt;In the two last sections I mentioned &lt;code&gt;expand&lt;/code&gt; functions that would contain the actual &lt;code&gt;deriver&lt;/code&gt; or
&lt;code&gt;extension&lt;/code&gt; implementation but didn't actually said anything about how to write those. It will
depend a lot on the purpose of your PPX rewriter and what you're trying to achieve.&lt;/p&gt;
&lt;p&gt;Before writing your PPX you should clearly specify what it should be applied to and what code it
should produce. That will help you declaring the right deriving or extension rewriter and from there
you'll know the type of the &lt;code&gt;expand&lt;/code&gt; functions you have to write which should help.&lt;/p&gt;
&lt;p&gt;A good way to proceed is to use the &lt;code&gt;dumpast&lt;/code&gt; tool to pretty print the AST fragments of both the
input of your expander and the output, ie the code it should generate. To take a concrete example,
say you want to write a deriving plugin that generates an &lt;code&gt;equal&lt;/code&gt; function from a type definition.
You can start by running &lt;code&gt;dumpast&lt;/code&gt; on the following file:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; some_record &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; a &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int64
  &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; b &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; equal_some_record r r' &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Int64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;equal r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;a r'&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;a &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;equal r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;b r'&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;b&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That will give you the AST representation of a record type definition and the equal function you
want to write so you can figure out how to deconstruct your expander's input to be able to generate
the right output.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ppxlib&lt;/code&gt; exposes smart constructors in &lt;code&gt;Ppxlib.Ast_builder.Default&lt;/code&gt; to help you build AST fragments
without having to care too much attributes and such fields as well as some convenience constructors
to keep your code concise and readable.&lt;/p&gt;
&lt;p&gt;Another convenience tool &lt;code&gt;ppxlib&lt;/code&gt; exposes to help you build AST fragments is &lt;code&gt;metaquot&lt;/code&gt;. I recently
wrote a bit of documentation about it
&lt;a href=&quot;https://ppxlib.readthedocs.io/en/latest/ppx-for-plugin-authors.html#metaquot&quot;&gt;here&lt;/a&gt; which you
should take a look at but to sum it up &lt;code&gt;metaquot&lt;/code&gt; is a PPX extension allowing you to write AST nodes
using the OCaml syntax they describe instead of the AST types.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#handling-code-locations-in-a-ppx-rewriter&quot; aria-label=&quot;handling code locations in a ppx rewriter permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Handling code locations in a PPX rewriter&lt;/h4&gt;
&lt;p&gt;When building AST fragments you should keep in mind that you have to set their &lt;code&gt;location&lt;/code&gt;. Locations
are part of the AST values that describes the position of the corresponding node in your source
file, including the file name and the line number and offset of both the beginning and the end the
code bit they represent.&lt;/p&gt;
&lt;p&gt;Because your code was generated after the file was parsed, it doesn't have a location so you need to
set it yourself. One could think that it doesn't matter and we could use a dummy location but
locations are used by the compiler to properly report errors and that's why a PPX rewriter should care
about how it locates the generated code as it will help the end user to understand whether the error
comes from their code or generated code and how to eventually fix it.&lt;/p&gt;
&lt;p&gt;Both &lt;code&gt;Ast_builder&lt;/code&gt; and &lt;code&gt;metaquot&lt;/code&gt; expect a location. The first explicitly takes it as a labelled
&lt;code&gt;loc&lt;/code&gt; argument while the second relies on a &lt;code&gt;loc&lt;/code&gt; value being available in the scope. It is
important to set those with care as errors in the generated code doesn't necessarily mean that your
rewriter is bugged. There are valid cases where your rewriter functioned as intended but the generated
code triggers an error. PPX-es often work on the assumption that some values are available in the
scope, if the user doesn't properly provide those it's their responsibility to fix the error. To
help them do so, it is important to properly locate the generated code to guide them as much as
possible.&lt;/p&gt;
&lt;p&gt;When writing extensions, using the whole extension point location for the generated code makes
perfect sense as that's where the code will sit. That's fairly easy as this what &lt;code&gt;ppxlib&lt;/code&gt; passes
to the expand function through the &lt;code&gt;loc&lt;/code&gt; labelled argument. For deriving plugins it's a bit different
as the generated code doesn't replace an existing part of the parsed AST but generate a new one to insert.
Currently &lt;code&gt;ppxlib&lt;/code&gt; gives you the &lt;code&gt;loc&lt;/code&gt; of the whole type declaration, extension or exception
declaration your deriving plugin is applied to. Ideally it would be nice to be able to locate the
generated code on the plugin name in the &lt;code&gt;deriving&lt;/code&gt; attribute payload, ie here:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[@@deriving my_plugin,another_plugin]
            ^^^^^^^^^&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I'm currently working on making that location available to the &lt;code&gt;expand&lt;/code&gt; function. In the meantime,
you should choose a convention. I personally locate all the generated code on the
type declaration. Some choose to locate the generated code on the part of the input AST they're
handling when generating it.&lt;/p&gt;
&lt;h4 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#reporting-errors-to-your-rewriter-users&quot; aria-label=&quot;reporting errors to your rewriter users permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reporting errors to your rewriter users&lt;/h4&gt;
&lt;p&gt;You won't always be able to handle all the AST nodes passed to your expand functions, either because the
end user misused your rewriter or because there are some cases you simply can't deal with.&lt;/p&gt;
&lt;p&gt;In those cases you can report the error to the user with &lt;code&gt;Ppxlib.Location.raise_errorf&lt;/code&gt;. It works
similarly to &lt;code&gt;printf&lt;/code&gt; and you can build your error message from a format string and extra
arguments. It will then raise an exception which will be caught and reported by the compiler.
A good practice is to prefix the error message with the name of your rewriter to help users understand
what's going on, especially with deriving plugin as they might use several of them on the same type
declaration.&lt;/p&gt;
&lt;p&gt;Another point to take care of here is, again, locations. &lt;code&gt;raise_errorf&lt;/code&gt; takes a labelled &lt;code&gt;loc&lt;/code&gt;
arguments. It is used so that your error is reported as any compiler error. Having good locations in
those error messages is just as important as sending clear error messages. Keep in mind that both
the errors you report yourself or errors coming from your generated code will be highlighted by
merlin so when properly set they make it much easier to work with your PPX rewriter.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#testing-your-ppx&quot; aria-label=&quot;testing your ppx permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Testing your PPX&lt;/h3&gt;
&lt;p&gt;Just as most pieces of code do, a PPX deserves to be tested and it has become easier over the years to
test rewriters.&lt;/p&gt;
&lt;p&gt;I personally tend to write as many unit test as possible for my PPX-es internal libraries. I try to
extract helper functions that can easily be unit-tested but I can't test it all that way.
Testing the &lt;code&gt;ast -&amp;gt; ast&lt;/code&gt; functions would be tedious as &lt;code&gt;ppxlib&lt;/code&gt; and &lt;code&gt;ocaml-migrate-parsetree&lt;/code&gt;
don't provide comparison and pretty printing functions that you can use with &lt;code&gt;alcotest&lt;/code&gt; or &lt;code&gt;oUnit&lt;/code&gt;.
That means you'd have to import the AST types and derive them on your own. That would make a lot
of boiler plate and even if those functions were exposed, writing such tests would be really
tedious. There's a lot of things to take into account. How are you going to build the input AST values
for instance?  If you use &lt;code&gt;metaquot&lt;/code&gt;, every node will share the same loc, making it hard to test
that your errors are properly located. If you don't, you will end up with insanely long and
unreadable test code or fixtures.
While that would allow extremely accurate testing for the generated code and errors, it will almost
certainly make your test code unmaintainable, at least given the current tooling.&lt;/p&gt;
&lt;p&gt;Don't panic, there is a very good and simple alternative. &lt;code&gt;ppxlib&lt;/code&gt; makes it very easy to build a
binary that will parse OCaml code, preprocess the AST with your rewriter and spit it out, formatted as
code again.&lt;/p&gt;
&lt;p&gt;You just have to write the following &lt;code&gt;pp.ml&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Ppxlib&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Driver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;standalone &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and build the binary with the following &lt;code&gt;dune&lt;/code&gt; stanza, assuming your rewriter is called
&lt;code&gt;my_ppx_rewriter&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;(executable
 (name pp)
 (modules pp)
 (libraries my_ppx_rewriter ppxlib))&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Because we're humans and the OCaml syntax is meant for us to write and read, it makes for much better
test input/output. You can now write your test input in a regular &lt;code&gt;.ml&lt;/code&gt; file, use the &lt;code&gt;pp.exe&lt;/code&gt;
binary to &amp;quot;apply&amp;quot; your preprocessor to it and compare the output with another &lt;code&gt;.ml&lt;/code&gt; file containing
the code you expect it to generate. This kind of test pattern is really well supported by &lt;code&gt;dune&lt;/code&gt;
thanks to the &lt;code&gt;diff&lt;/code&gt; user action.&lt;/p&gt;
&lt;p&gt;I usually have the following files in a &lt;code&gt;rewriter&lt;/code&gt;/&lt;code&gt;deriver&lt;/code&gt; folder within my test directory:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;test/rewriter/
&amp;#9500;&amp;#9472;&amp;#9472; dune
&amp;#9500;&amp;#9472;&amp;#9472; test.expected.ml
&amp;#9500;&amp;#9472;&amp;#9472; pp.ml
&amp;#9492;&amp;#9472;&amp;#9472; test.ml&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Where &lt;code&gt;pp.ml&lt;/code&gt; is used to produce the rewriter binary, &lt;code&gt;test.ml&lt;/code&gt; contains the input OCaml code and
&lt;code&gt;test.expected.ml&lt;/code&gt; the result of preprocessing &lt;code&gt;test.ml&lt;/code&gt;. The dune file content is generally similar
to this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;(executable
 (name pp)
 (modules pp)
 (libraries my_ppx_rewriter ppxlib))

(rule
 (targets test.actual.ml)
 (deps (:pp pp.exe) (:input test.ml))
 (action (run ./%{pp} -deriving-keep-w32 both --impl %{input} -o %{targets})))

(alias
 (name runtest)
 (action (diff test.expected.ml test.actual.ml)))

(test
  (name test)
  (modules test)
  (preprocess (pps my_ppx_rewriter)))&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The first stanza is the one I already introduced above and specifies how to build the rewriter binary.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;rule&lt;/code&gt; stanza that comes after that indicates to &lt;code&gt;dune&lt;/code&gt; how to produce the actual test output by
applying the rewriter binary to &lt;code&gt;test.ml&lt;/code&gt;. You probably noticed the &lt;code&gt;-deriving-keep-w32 both&lt;/code&gt; CLI
option passed to &lt;code&gt;pp.exe&lt;/code&gt;. By default, &lt;code&gt;ppxlib&lt;/code&gt; will generate values or add attributes so that your
generated code doesn't trigger a &amp;quot;Unused value&amp;quot; warning. This is useful in real life situation but
here it will just pollute the test output and make it harder to read so we disable that feature.&lt;/p&gt;
&lt;p&gt;The following &lt;code&gt;alias&lt;/code&gt; stanza is where all the magic happens. Running &lt;code&gt;dune runtest&lt;/code&gt; will now
generate &lt;code&gt;test.actual.ml&lt;/code&gt; and compare it to &lt;code&gt;test.expected.ml&lt;/code&gt;. It will not only do that but show
you how they differ from each other in a diff format. You can then automatically update
&lt;code&gt;test.expected.ml&lt;/code&gt; if you're happy with the results by running &lt;code&gt;dune promote&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Finally the last &lt;code&gt;test&lt;/code&gt; stanza is there to ensure that the generated code compiles without type
errors.&lt;/p&gt;
&lt;p&gt;This makes a very convenient test setup to write your PPX-es TDD style. You can start by writing an
identity PPX, that will just return its input AST as it is. Then you add some OCaml code using your
soon to be PPX in &lt;code&gt;test.ml&lt;/code&gt; and run &lt;code&gt;dune runtest --auto-promote&lt;/code&gt; to prefill &lt;code&gt;test.expected.ml&lt;/code&gt;.
From there you can start implementing your rewriter and run &lt;code&gt;dune runtest&lt;/code&gt; to check on your progress
and update the expected result with &lt;code&gt;dune promote&lt;/code&gt;.
Going pure TDD by writing the test works but it's tricky cause you'd have to format your code the
same way &lt;code&gt;pp.exe&lt;/code&gt; will format the AST. It would be great to be able to specify how to format
the generated &lt;code&gt;test.actual.ml&lt;/code&gt; so that this approach would be more viable and the diff more
readable. Being able to use ocamlformat with a very diff friendly configuration would be great
there. &lt;code&gt;pp.exe&lt;/code&gt; seems to offer CLI options to change the code style such as &lt;code&gt;-styler&lt;/code&gt; but I haven't
had the chance to experiment with those yet.&lt;/p&gt;
&lt;p&gt;Now you can test successful rewriting this way but what about errors? There's a lot of value
ensuring you produce the right errors and on the right code location because that's the kind of
things you can get wrong when refactoring your rewriter code or when people try to contribute.
That isn't as likely to happen if your CI yells when you break the error reporting. So how do we do
that?&lt;/p&gt;
&lt;p&gt;Well pretty much the exact same way! We write a file with an erroneous invocation of our rewriter,
run &lt;code&gt;pp.exe&lt;/code&gt; on it and compare stderr with what we expect it to be.
There are two major differences here. First we want to collect the stderr output of the rewriter
binary instead of using it to generate a file. The second is that we cant write all of our test
cases in a single file since &lt;code&gt;pp.exe&lt;/code&gt; will stop at the first error. That means we need one &lt;code&gt;.ml&lt;/code&gt;
file per error test case.
Luckily for us, dune offers ways to do both.&lt;/p&gt;
&lt;p&gt;For every error test file we will want to add the following stanzas:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;(rule
  (targets test_error.actual)
  (deps (:pp pp.exe) (:input test_error.ml)) 
  (action
    (with-stderr-to
      %{targets}
      (bash &amp;quot;./%{pp} -no-color --impl %{input} || true&amp;quot;)
    )
  )
)

(alias
  (name runtest)
  (action (diff test_error.expected test_error.actual))
)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;but obviously we don't want to do that by hand every time we add a new test case so we're gonna need
a script to generate those stanzas and then include them into our &lt;code&gt;dune&lt;/code&gt; file using
&lt;code&gt;(include dune.inc)&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;To achieve that while keeping things as clean as possible I use the following directory structure:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;test/rewriter/
&amp;#9500;&amp;#9472;&amp;#9472; errors
&amp;#9474;   &amp;#9500;&amp;#9472;&amp;#9472; dune
&amp;#9474;   &amp;#9500;&amp;#9472;&amp;#9472; dune.inc
&amp;#9474;   &amp;#9500;&amp;#9472;&amp;#9472; gen_dune_rules.ml
&amp;#9474;   &amp;#9500;&amp;#9472;&amp;#9472; pp.ml
&amp;#9474;   &amp;#9500;&amp;#9472;&amp;#9472; test_some_error.expected
&amp;#9474;   &amp;#9500;&amp;#9472;&amp;#9472; test_some_error.ml
&amp;#9474;   &amp;#9500;&amp;#9472;&amp;#9472; test_some_other_error.expected
&amp;#9474;   &amp;#9492;&amp;#9472;&amp;#9472; test_some_other_error.ml
&amp;#9500;&amp;#9472;&amp;#9472; dune
&amp;#9500;&amp;#9472;&amp;#9472; test.expected.ml
&amp;#9500;&amp;#9472;&amp;#9472; pp.ml
&amp;#9492;&amp;#9472;&amp;#9472; test.ml&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Compared to our previous setup, we only added the new &lt;code&gt;errors&lt;/code&gt; folder. To keep things simple it has
its own &lt;code&gt;pp.ml&lt;/code&gt; copy but in the future I'd like to improve it a bit and be able to use the same
&lt;code&gt;pp.exe&lt;/code&gt; binary.&lt;/p&gt;
&lt;p&gt;The most important files here are &lt;code&gt;gen_dune_rules.ml&lt;/code&gt; and &lt;code&gt;dune.inc&lt;/code&gt;. The first is just a simple
OCaml script to generate the above stanzas for each test cases in the &lt;code&gt;errors&lt;/code&gt; directory. The second
is the file we'll include in the main &lt;code&gt;dune&lt;/code&gt;. It's also the file to which we'll write the generated
stanza.&lt;/p&gt;
&lt;p&gt;I personally use the following &lt;code&gt;gen_dune_rules.ml&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; output_stanzas filename &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; base &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Filename&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;remove_extension filename &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  Printf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printf
    &lt;span class=&quot;token string&quot;&gt;{|
(library
  (name %s)
  (modules %s)
  (preprocess (pps ppx_yojson))
)

(rule
  (targets %s.actual)
  (deps (:pp pp.exe) (:input %s.ml))
  (action
    (with-stderr-to
      %%{targets}
      (bash &amp;quot;./%%{pp} -no-color --impl %%{input} || true&amp;quot;)
    )
  )
)

(alias
  (name runtest)
  (action (diff %s.expected %s.actual))
)
|}&lt;/span&gt;
    base
    base
    base
    base
    base
    base

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; is_error_test &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;pp.ml&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;gen_dune_rules.ml&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; filename &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; Filename&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;check_suffix filename &lt;span class=&quot;token string&quot;&gt;&amp;quot;.ml&amp;quot;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  Sys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;readdir &lt;span class=&quot;token string&quot;&gt;&amp;quot;.&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&amp;gt;&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to_list
  &lt;span class=&quot;token operator&quot;&gt;|&amp;gt;&lt;/span&gt; List&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sort String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;compare
  &lt;span class=&quot;token operator&quot;&gt;|&amp;gt;&lt;/span&gt; List&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;filter is_error_test
  &lt;span class=&quot;token operator&quot;&gt;|&amp;gt;&lt;/span&gt; List&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;iter output_stanzas&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Nothing spectacular here, we just build the list of all the &lt;code&gt;.ml&lt;/code&gt; files in the directory except
&lt;code&gt;pp.ml&lt;/code&gt; and &lt;code&gt;gen_dune_rules.ml&lt;/code&gt; itself and then generate the right stanzas for each of them. You'll
note the extra &lt;code&gt;library&lt;/code&gt; stanza which I add to get dune to generate the right &lt;code&gt;.merlin&lt;/code&gt; so that I
can see the error highlights when I edit the files by hand.&lt;/p&gt;
&lt;p&gt;With that we're almost good, add the following to the &lt;code&gt;dune&lt;/code&gt; file and you're all set:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;(executable
  (name pp)
  (modules pp)
  (libraries
    ppx_yojson
    ppxlib
  )
)

(include dune.inc)

(executable
  (name gen_dune_rules)
  (modules gen_dune_rules)
)

(rule
  (targets dune.inc.gen)
  (deps
    (:gen gen_dune_rules.exe)
    (source_tree .)
  )
  (action
    (with-stdout-to
      %{targets}
      (run %{gen})
    ) 
  )
)

(alias
  (name runtest)
  (action (diff dune.inc dune.inc.gen))
)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The first stanza is here to specify how to build the rewriter binary, same as before, while the
second stanza just tells dune to include the content of &lt;code&gt;dune.inc&lt;/code&gt; within this &lt;code&gt;dune&lt;/code&gt; file.&lt;/p&gt;
&lt;p&gt;The interesting part comes next. As you can guess the &lt;code&gt;executable&lt;/code&gt; stanza builds our little OCaml
script into a &lt;code&gt;.exe&lt;/code&gt;. The &lt;code&gt;rule&lt;/code&gt; that comes after that specifies how to generate the new stanzas
by running &lt;code&gt;gen_dune_rules&lt;/code&gt; and capturing its standard output into a &lt;code&gt;dune.inc.gen&lt;/code&gt; file.
The last rule allows you to review the changes to the generated stanza and use promotion to accept
them. Once this is done, the new stanzas will be included to the &lt;code&gt;dune&lt;/code&gt; file and the test will be
run for every test cases.&lt;/p&gt;
&lt;p&gt;Adding a new test case is then pretty easy, you can simply run:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ touch test/rewriter/errors/some_explicit_test_case_name.{ml,expected} &amp;amp;&amp;amp; dune runtest --auto-promote&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That will create the new empty test case and update the &lt;code&gt;dune.inc&lt;/code&gt; with the corresponding rules.
From there you can proceed the same way as with the successful rewriting tests, update the &lt;code&gt;.ml&lt;/code&gt;,
run &lt;code&gt;dune runtest&lt;/code&gt; to take a sneak peek at the output and &lt;code&gt;dune promote&lt;/code&gt; once you're satisfied with
the result.&lt;/p&gt;
&lt;p&gt;I've been pretty happy with this setup so far although there's room for improvement. It would be
nice to avoid duplicating &lt;code&gt;pp.ml&lt;/code&gt; for errors testing. This also involves
quite a bit of boilerplate that I have to copy into all my PPX rewriters repositories every time.
Hopefully &lt;a href=&quot;https://github.com/ocaml/dune/issues/1855&quot;&gt;dune plugins&lt;/a&gt; should help with that and I
can't wait for a first version to be released so that I can write a plugin to make this test
pattern more accessible and easier to set up.&lt;/p&gt;</content><id>https://tarides.com/blog/2019-05-09-an-introduction-to-ocaml-ppx-ecosystem</id><title type="text">An introduction to OCaml PPX ecosystem</title><updated>2019-05-09T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2019-05-06-7th-mirageos-hack-retreat" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Let's talk sun, mint tea and OCaml: Yes, you got it, the &lt;a href=&quot;http://retreat.mirage.io&quot;&gt;MirageOS biennial retreat&lt;/a&gt; at Marrakesh!&lt;/p&gt;
&lt;p&gt;For the 7th iteration of the retreat, the majority of the Tarides team took part in the trip to the camels country.
This is a report about what we produced and enjoyed while there.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#charles-edouard-lecat&quot; aria-label=&quot;charles edouard lecat permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Charles-Edouard Lecat&lt;/h1&gt;
&lt;p&gt;That's it, my first MirageOS retreat is coming soon, let's jump in the plane and here I come. After a nice cab trip and an uncountable number of similar streets, I'm finally at the Riad which will host me for the next 5 days.&lt;/p&gt;
&lt;p&gt;It now begins the time to do what I came for: Code, Eat, Sleep and Repeat&lt;/p&gt;
&lt;p&gt;I mostly worked on &lt;a href=&quot;https://github.com/mirage/colombe&quot;&gt;Colombe&lt;/a&gt;, the OCaml implementation of the SMTP protocol for which I developed a simple client.
Except some delayed problems (like the integration of the MIME protocol, the TLS wrapping and some others), the client was working perfectly :)
Implementing it was actually really easy as the core of the SMTP protocol was done by @dinosaure who developed over time a really nice way of implementing this kind of API. And as I spend most of my time at Tarides working on his code, I feel really comfortable with it.&lt;/p&gt;
&lt;p&gt;One of the awesome thing about this retreat was the people who came: There was so many interesting people, doing various thing, so each time someone had an interrogation, you could almost be sure that someone could help you in a way or another.&lt;/p&gt;
&lt;p&gt;But sadly, as I arrived few days after everyone, and just before the week-end, the time flew away reaaaaaally fast, and I did not have the time to do some major code, but I'm already looking forward to the next retreat which, I am sure, will be even more fruitful and attract a lot of nice OCaml developers.&lt;/p&gt;
&lt;p&gt;Until then, I will just dream about the awesome food I ate there ;)&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#lucas-pluvinage&quot; aria-label=&quot;lucas pluvinage permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Lucas Pluvinage&lt;/h1&gt;
&lt;p&gt;Second Mirage retreat for me, and this time I had plans: make a small web game with Mirage hosted by an ESP32 device. I figured out that there was not canonical way to make an HTTP/Websocket server with Mirage and I didn't want to stick to a particular library.&lt;/p&gt;
&lt;p&gt;Instead, I took my time to develop &lt;code&gt;mirage-http&lt;/code&gt;, an abstraction of HTTP that can either have &lt;code&gt;cohttp&lt;/code&gt; or &lt;code&gt;httpaf&lt;/code&gt; as a backend. On top of that, I've build &lt;code&gt;mirage-websocket&lt;/code&gt; which is therefore an HTTP server-independant implementation of websockets (indeed this has a lot of redundancies with &lt;code&gt;ocaml-websocket&lt;/code&gt; but for now it's a proof of concept). While making all this I discussed with @anmonteiro who's the Webservers/protocols expert for Mirage ! However I didn't have the time to build something on top of that, but this is still something that I would like achieve at some point.&lt;/p&gt;
&lt;p&gt;I also became the &amp;quot;dune guy&amp;quot; as I'm &lt;a href=&quot;https://github.com/mirage/mirage/issues/969&quot;&gt;working on the Mirage/dune integration&lt;/a&gt;, and helped some people with their build system struggles.&lt;/p&gt;
&lt;p&gt;It was definitely a rich week, I've learnt a lot of things, enjoyed the sun, ate good food and contributed to the Mirage universe !&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#jules-aguillon&quot; aria-label=&quot;jules aguillon permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Jules Aguillon&lt;/h1&gt;
&lt;p&gt;This was my first retreat.
It was the occasion to meet OCaml developers from all over the world.
The food was great and the weather perfect.&lt;/p&gt;
&lt;p&gt;I submitted some PRs to the OCaml compiler !&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hint on type error on int literal &lt;a href=&quot;https://github.com/ocaml/ocaml/pull/2301&quot;&gt;PR #2301&lt;/a&gt;.
It's adding an hint when using &lt;code&gt;int&lt;/code&gt; literals instead of other number literals (eg. &lt;code&gt;3&lt;/code&gt; instead of &lt;code&gt;3.&lt;/code&gt; or &lt;code&gt;3L&lt;/code&gt;):&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Line 2, characters 20-21:
2 | let _ = Int32.add a 3
                        ^
Error: This expression has type int but an expression was expected of type
          int32
        Hint: Did you mean `3l'?&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Hint on type error on int operators &lt;a href=&quot;https://github.com/ocaml/ocaml/pull/2307&quot;&gt;PR #2307&lt;/a&gt;. Hint the user when using numerical operators for ints (eg. &lt;code&gt;+&lt;/code&gt;) on other kind of numbers (eg. &lt;code&gt;float&lt;/code&gt;, &lt;code&gt;int64&lt;/code&gt;, etc..). For example:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Line 8, characters 8-9:
8 | let _ = x + 1.
            ^
Error: This expression has type float but an expression was expected of type
          int
Line 8, characters 10-11:
8 | let _ = x + 1.
              ^
  Hint: Did you mean to use `+.'?&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Clean up int literal hint &lt;a href=&quot;https://github.com/ocaml/ocaml/pull/2313&quot;&gt;PR #2313&lt;/a&gt;. A little cleanup of the 2 previous PRs.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Hint when the expected type is wrapped in a ref &lt;a href=&quot;https://github.com/ocaml/ocaml/pull/2319&quot;&gt;PR #2319&lt;/a&gt;. An other PR adding an hint: When the user forgot to use the &lt;code&gt;!&lt;/code&gt; operator on &lt;code&gt;ref&lt;/code&gt; values:&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Line 2, characters 8-9:
2 | let b = a + 1
            ^
Error: This expression has type int ref
        but an expression was expected of type int
  Hint: This is a `ref', did you mean `!a'?&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The first 3 are merged now.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#gabriel-de-perthuis&quot; aria-label=&quot;gabriel de perthuis permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Gabriel de Perthuis&lt;/h1&gt;
&lt;p&gt;For this retreat my plan was to do something a little different and work on Solo5.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/mirage/wodan&quot;&gt;Wodan&lt;/a&gt;, the storage layer I'm working on,
needs two things from its backends which are not commonly implemented:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;support for discarding unused blocks (first implemented in mirage-block-unix), and&lt;/li&gt;
&lt;li&gt;support for barriers, which are ordering constraints between writes&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Solo5 provides relevant mirage backends, which are themselves provided by various
virtualised implementations.  Discard was added to most of those, at least those
that were common enough to be easily tested; we just added an &amp;quot;operation not supported&amp;quot;
error code for the other cases.&lt;/p&gt;
&lt;p&gt;The virtio implementation was interesting; recent additions to the spec allow discard
support, but few virtual machine managers actually implement that on the backend side.
I tried to integrate with the Chromium OS &amp;quot;crosvm&amp;quot; for that, and had a good time
figuring out how it found the bootloader entry point (turns out the cpu was happily
skipping past invalid instructions to find a slightly misaligned entry point), but
ran out of time to figure out the rest of the integration, which seemed to be more
complex that anticipated.  Because of this virtio discard support will be skipped over
for now.&lt;/p&gt;
&lt;p&gt;I also visited the souk, which was an interesting experience.
Turns out I'm bad at haggling, but I brought back interesting things anyway.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;We'd like to thank Hannes Mehnert who organized this retreat and all the attendees who contributed to make it fruitful and inspiring.
You want to take part in the next MirageOS retreat? Stay tuned &lt;a href=&quot;http://retreat.mirage.io&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</content><id>https://tarides.com/blog/2019-05-06-7th-mirageos-hack-retreat</id><title type="text">7th MirageOS hack retreat</title><updated>2019-05-06T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2019-04-10-dune-1-9-0" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Tarides is pleased to have contributed to the dune 1.9.0 release which
introduces the concept of library variants. Thanks to this update,
unikernels builds are becoming easier and faster in the MirageOS
universe! This also opens the door for a better cross-compilation
story, which will ease the addition of new MirageOS backends
(trustzone, ESP32, RISC-V, etc.)&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This post has also been posted to the
&lt;a href=&quot;https://dune.build/blog/dune-1-9-0/&quot;&gt;Dune blog&lt;/a&gt;.  See also the &lt;a href=&quot;https://discuss.ocaml.org/t/ann-dune-1-9-0/3646&quot;&gt;the discuss
forum&lt;/a&gt; for more
details.&lt;/em&gt;&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#dune-190&quot; aria-label=&quot;dune 190 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Dune 1.9.0&lt;/h1&gt;
&lt;p&gt;Changes include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Coloring in the watch mode (&lt;a href=&quot;https://github.com/ocaml/dune/pull/1956&quot;&gt;#1956&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$ dune init&lt;/code&gt; command to create or update project boilerplate (&lt;a href=&quot;https://github.com/ocaml/dune/pull/1448&quot;&gt;#1448&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Allow &amp;quot;.&amp;quot; in c_names and cxx_names (&lt;a href=&quot;https://github.com/ocaml/dune/pull/2036&quot;&gt;#2036&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Experimental Coq support&lt;/li&gt;
&lt;li&gt;Support for library variants and default implementations (&lt;a href=&quot;https://github.com/ocaml/dune/pull/1900&quot;&gt;#1900&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#variants&quot; aria-label=&quot;variants permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Variants&lt;/h1&gt;
&lt;p&gt;In dune 1.7.0, the concept of virtual library was introduced:
&lt;a href=&quot;https://dune.build/blog/virtual-libraries/&quot;&gt;https://dune.build/blog/virtual-libraries/&lt;/a&gt;. This feature allows to
mark some abstract library as virtual, and then have several
implementations for it. These implementations could be for multiple
targets (&lt;code&gt;unix&lt;/code&gt;, &lt;code&gt;xen&lt;/code&gt;, &lt;code&gt;js&lt;/code&gt;), using different algorithms, using C
code or not. However each implementation in a project dependency tree
had to be manually selected. Dune 1.9.0 introduces features for
automatic selection of implementations.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#library-variants&quot; aria-label=&quot;library variants permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Library variants&lt;/h2&gt;
&lt;p&gt;Variants is a tagging mechanism to select implementations on the final
linking step. There's not much to add to make your implementation use
variants. For example, you could decide to design a &lt;code&gt;bar_js&lt;/code&gt; library
which is the javascript implementation of &lt;code&gt;bar&lt;/code&gt;, a virtual
library. All you need to do is specificy a &lt;code&gt;js&lt;/code&gt; tag using the
&lt;code&gt;variant&lt;/code&gt; option.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;(library
 (name bar_js)
 (implements bar)
 (variant js)); &amp;lt;-- variant specification&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now any executable that depend on &lt;code&gt;bar&lt;/code&gt; can automatically select the
&lt;code&gt;bar_js&lt;/code&gt; library variant using the &lt;code&gt;variants&lt;/code&gt; option in the dune file.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;(executable
 (name foo)
 (libraries bar baz)
 (variants js)); &amp;lt;-- variants selection&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#common-variants&quot; aria-label=&quot;common variants permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Common variants&lt;/h2&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#language-selection&quot; aria-label=&quot;language selection permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Language selection&lt;/h3&gt;
&lt;p&gt;In your projects you might want to trade off speed for portability:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ocaml&lt;/code&gt;: pure OCaml&lt;/li&gt;
&lt;li&gt;&lt;code&gt;c&lt;/code&gt;: OCaml accelerated by C&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#javascript-backend&quot; aria-label=&quot;javascript backend permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;JavaScript backend&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;js&lt;/code&gt;: code aiming for a Node backend, using &lt;code&gt;Js_of_ocaml&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#mirage-backends&quot; aria-label=&quot;mirage backends permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Mirage backends&lt;/h2&gt;
&lt;p&gt;The Mirage project (&lt;a href=&quot;https://mirage.io/&quot;&gt;mirage.io&lt;/a&gt;) will make
extensive use of this feature in order to select the appropriate
dependencies according to the selected backend.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;unix&lt;/code&gt;: Unikernels as Unix applications, running on top of &lt;code&gt;mirage-unix&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;xen&lt;/code&gt;: Xen backend, on top of &lt;code&gt;mirage-xen&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;freestanding&lt;/code&gt;: Freestanding backend, on top of &lt;code&gt;mirage-solo5&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#default-implementation&quot; aria-label=&quot;default implementation permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Default implementation&lt;/h2&gt;
&lt;p&gt;To facilitate the transition from normal libraries into virtuals ones,
it's possible to specify an implementation that is selected by
default. This default implementation is selected if no implementation
is chosen after variant resolution.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;(library
 (name bar)
 (virtual_modules hello)
 (default_implementation bar_unix)); &amp;lt;-- default implementation selection&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#selection-mechanism&quot; aria-label=&quot;selection mechanism permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Selection mechanism&lt;/h2&gt;
&lt;p&gt;Implementation is done with respect to some priority rules:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;manual selection of an implementation overrides everything&lt;/li&gt;
&lt;li&gt;after that comes selection by variants&lt;/li&gt;
&lt;li&gt;finally unimplemented virtual libraries can select their default implementation&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Libraries may depend on specific implementations but this is not
recommended. In this case, several things can happen:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the implementation conflicts with a manually selected implementation: resolution fails.&lt;/li&gt;
&lt;li&gt;the implementation overrides variants and default implementations: a cycle check is done and this either resolves or fails.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Variant libraries and default implementations are fully &lt;a href=&quot;https://dune.readthedocs.io/en/latest/variants.html&quot;&gt;documented
here&lt;/a&gt;. This
feature improves the usability of virtual libraries.&lt;/p&gt;
&lt;p&gt;This
&lt;a href=&quot;https://github.com/dune-universe/mirage-entropy/commit/576d25d79e3117bba64355ae73597651cfd27631&quot;&gt;commit&lt;/a&gt;
shows the amount of changes needed to make a virtual library use
variants.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#coq-support&quot; aria-label=&quot;coq support permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Coq support&lt;/h1&gt;
&lt;p&gt;Dune now supports building Coq projects. To enable the experimental Coq
extension, add &lt;code&gt;(using coq 0.1)&lt;/code&gt; to your &lt;code&gt;dune-project&lt;/code&gt; file. Then,
you can use the &lt;code&gt;(coqlib ...)&lt;/code&gt; stanza to declare Coq libraries.&lt;/p&gt;
&lt;p&gt;A typical &lt;code&gt;dune&lt;/code&gt; file for a Coq project will look like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;(include_subdirs qualified) ; Use if your development is based on sub directories

(coqlib
  (name Equations)                  ; Name of wrapper module
  (public_name equations.Equations) ; Generate an .install file
  (synopsis &amp;quot;Equations Plugin&amp;quot;)     ; Synopsis
  (libraries equations.plugin)      ; ML dependencies (for plugins)
  (modules :standard \ IdDec)       ; modules to build
  (flags -w -notation-override))    ; coqc flags&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;See the &lt;a href=&quot;https://github.com/ocaml/dune/blob/1.9/doc/coq.rst&quot;&gt;documentation of the
extension&lt;/a&gt; for more
details.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#credits&quot; aria-label=&quot;credits permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Credits&lt;/h1&gt;
&lt;p&gt;This release also contains many other changes and bug fixes that can
be found on the &lt;a href=&quot;https://discuss.ocaml.org/t/ann-dune-1-9-0/3646&quot;&gt;discuss
announce&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Special thanks to dune maintainers and contributors for this release:
&lt;a href=&quot;https://github.com/rgrinberg&quot;&gt;@rgrinberg&lt;/a&gt;,
&lt;a href=&quot;https://github.com/emillon&quot;&gt;@emillon&lt;/a&gt;,
&lt;a href=&quot;https://github.com/shonfeder&quot;&gt;@shonfeder&lt;/a&gt;
and &lt;a href=&quot;https://github.com/ejgallego&quot;&gt;@ejgallego&lt;/a&gt;!&lt;/p&gt;</content><id>https://tarides.com/blog/2019-04-10-dune-1-9-0</id><title type="text">Dune 1.9.0</title><updated>2019-04-10T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2019-03-29-release-of-ocamlformat-0-9" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;We are pleased to announce the release of OCamlFormat (available on opam).
There have been numerous changes since the last release,
so here is a comprehensive list of the new features and breaking changes to help the transition from OCamlFormat 0.8.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#additional-dependencies&quot; aria-label=&quot;additional dependencies permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Additional dependencies&lt;/h1&gt;
&lt;p&gt;OCamlFormat now requires:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ocaml &amp;gt;= 4.06 (up from 4.04.1)&lt;/li&gt;
&lt;li&gt;dune &amp;gt;= 1.1.1&lt;/li&gt;
&lt;li&gt;octavius &amp;gt;= 1.2.0&lt;/li&gt;
&lt;li&gt;uutf&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;OCamlFormat_Reason now requires:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ocaml &amp;gt;= 4.06&lt;/li&gt;
&lt;li&gt;dune &amp;gt;= 1.1.1&lt;/li&gt;
&lt;li&gt;ocaml-migrate-parsetree &amp;gt;= 1.0.10 (up from 1.0.6)&lt;/li&gt;
&lt;li&gt;octavius &amp;gt;= 1.2.0&lt;/li&gt;
&lt;li&gt;uutf&lt;/li&gt;
&lt;li&gt;reason &amp;gt;= 3.2.0 (up from 1.13.4)&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#new-preset-profiles&quot; aria-label=&quot;new preset profiles permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;New preset profiles&lt;/h1&gt;
&lt;p&gt;The &lt;code&gt;ocamlformat&lt;/code&gt; profile aims to take advantage of the strengths of a parsetree-based auto-formatter,
and to limit the consequences of the weaknesses imposed by the current implementation.
This is a style which optimizes for what the formatter can do best, rather than to match the style of any existing code.
General guidelines that have directed the design include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Legibility, in the sense of making it as hard as possible for quick visual parsing to give the wrong interpretation,
is of highest priority;&lt;/li&gt;
&lt;li&gt;Whenever possible the high-level structure of the code should be obvious by looking only at the left margin,
in particular, it should not be necessary to visually jump from left to right hunting for critical keywords, tokens, etc;&lt;/li&gt;
&lt;li&gt;All else equal compact code is preferred as reading without scrolling is easier,
so indentation or white space is avoided unless it helps legibility;&lt;/li&gt;
&lt;li&gt;Attention has been given to making some syntactic gotchas visually obvious.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;ocamlformat&lt;/code&gt; is the new default profile.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;conventional&lt;/code&gt; profile aims to be as familiar and &amp;quot;conventional&amp;quot; appearing as the available options allow.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;default&lt;/code&gt; profile is &lt;code&gt;ocamlformat&lt;/code&gt; with &lt;code&gt;break-cases=fit&lt;/code&gt;.
&lt;code&gt;default&lt;/code&gt; is deprecated and will be removed in version 0.10.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#ocamlformat-diff-tool&quot; aria-label=&quot;ocamlformat diff tool permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;OCamlFormat diff tool&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;ocamlformat-diff&lt;/code&gt; is a tool that uses OCamlFormat to apply the same formatting to compared OCaml files,
so that the formatting differences between the two files are not displayed.
Note that &lt;code&gt;ocamlformat-diff&lt;/code&gt; comes in a separate opam package and is not included in the &lt;code&gt;ocamlformat&lt;/code&gt; package.&lt;/p&gt;
&lt;p&gt;The file comparison is then performed by any diff backend.&lt;/p&gt;
&lt;p&gt;The options' documentation is available through &lt;code&gt;ocamlformat-diff --help&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The option &lt;code&gt;--diff&lt;/code&gt; allows you to configure the diff command that is used to compare the formatted files.
The default value is the vanilla &lt;code&gt;diff&lt;/code&gt;, but you can also use &lt;code&gt;patdiff&lt;/code&gt; or any other similar comparison tool.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ocamlformat-diff&lt;/code&gt; can be integrated with &lt;code&gt;git diff&lt;/code&gt;,
as explained in the &lt;a href=&quot;https://github.com/ocaml-ppx/ocamlformat/blob/0.9/tools/ocamlformat-diff/README.md&quot;&gt;online documentation&lt;/a&gt;.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#formatting-docstrings&quot; aria-label=&quot;formatting docstrings permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Formatting docstrings&lt;/h1&gt;
&lt;p&gt;Previously, the docstrings &lt;code&gt;(** This is a docstring *)&lt;/code&gt; could only be formatted like regular comments,
a new option &lt;code&gt;--parse-docstrings&lt;/code&gt; has been added so that docstrings can be nicely formatted.&lt;/p&gt;
&lt;p&gt;Here is a small example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;(** {1 Printers and escapes used by Cmdliner module} *)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; subst_vars &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; subst&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;string &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; string option&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; Buffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; string &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; string
&lt;span class=&quot;token comment&quot;&gt;(** [subst b ~subst s], using [b], substitutes in [s] variables of the form
    &amp;quot;$(doc)&amp;quot; by their [subst] definition. This leaves escapes and markup
    directives $(markup,...) intact.
    @raise Invalid_argument in case of illegal syntax. *)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that this option is disabled by default and you have to set it manually by adding &lt;code&gt;--parse-docstrings&lt;/code&gt; to your command line
or &lt;code&gt;parse-docstrings=true&lt;/code&gt; to your &lt;code&gt;.ocamlformat&lt;/code&gt; file.
If you get the following error message:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Error: Formatting of (** ... *) is unstable (e.g. parses as a list or not depending on the margin), please tighten up this comment in the source or disable the formatting using the option --no-parse-docstrings.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It means the original docstring cannot be formatted (e.g. because it does not comply with the odoc syntax)
and you have to edit it or disable the formatting of docstrings.&lt;/p&gt;
&lt;p&gt;Of course if you think your docstring complies with the odoc syntax and there might be a bug in OCamlFormat,
&lt;a href=&quot;https://github.com/ocaml-ppx/ocamlformat/issues&quot;&gt;feel free to file an issue on github&lt;/a&gt;.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#print-the-configuration&quot; aria-label=&quot;print the configuration permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Print the configuration&lt;/h1&gt;
&lt;p&gt;The new &lt;code&gt;--print-config&lt;/code&gt; flag prints the configuration determined by the environment variable,
the configuration files, preset profiles and command line. Attributes are not considered.&lt;/p&gt;
&lt;p&gt;It provides the full list of options with the values they are set to, and the source of this value.
For example &lt;code&gt;ocamlformat --print-config&lt;/code&gt; prints:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;profile=ocamlformat (file .ocamlformat:1)
quiet=false (profile ocamlformat (file .ocamlformat:1))
max-iters=10 (profile ocamlformat (file .ocamlformat:1))
comment-check=true (profile ocamlformat (file .ocamlformat:1))
wrap-fun-args=true (profile ocamlformat (file .ocamlformat:1))
wrap-comments=true (file .ocamlformat:5)
type-decl=compact (profile ocamlformat (file .ocamlformat:1))
space-around-collection-expressions=false (profile ocamlformat (file .ocamlformat:1))
single-case=compact (profile ocamlformat (file .ocamlformat:1))
sequence-style=separator (profile ocamlformat (file .ocamlformat:1))
parse-docstrings=true (file .ocamlformat:4)
parens-tuple-patterns=multi-line-only (profile ocamlformat (file .ocamlformat:1))
parens-tuple=always (profile ocamlformat (file .ocamlformat:1))
parens-ite=false (profile ocamlformat (file .ocamlformat:1))
ocp-indent-compat=false (profile ocamlformat (file .ocamlformat:1))
module-item-spacing=sparse (profile ocamlformat (file .ocamlformat:1))
margin=77 (file .ocamlformat:3)
let-open=preserve (profile ocamlformat (file .ocamlformat:1))
let-binding-spacing=compact (profile ocamlformat (file .ocamlformat:1))
let-and=compact (profile ocamlformat (file .ocamlformat:1))
leading-nested-match-parens=false (profile ocamlformat (file .ocamlformat:1))
infix-precedence=indent (profile ocamlformat (file .ocamlformat:1))
indicate-nested-or-patterns=space (profile ocamlformat (file .ocamlformat:1))
indicate-multiline-delimiters=true (profile ocamlformat (file .ocamlformat:1))
if-then-else=compact (profile ocamlformat (file .ocamlformat:1))
field-space=tight (profile ocamlformat (file .ocamlformat:1))
extension-sugar=preserve (profile ocamlformat (file .ocamlformat:1))
escape-strings=preserve (profile ocamlformat (file .ocamlformat:1))
escape-chars=preserve (profile ocamlformat (file .ocamlformat:1))
doc-comments-tag-only=default (profile ocamlformat (file .ocamlformat:1))
doc-comments-padding=2 (profile ocamlformat (file .ocamlformat:1))
doc-comments=after (profile ocamlformat (file .ocamlformat:1))
disable=false (profile ocamlformat (file .ocamlformat:1))
cases-exp-indent=4 (profile ocamlformat (file .ocamlformat:1))
break-struct=force (profile ocamlformat (file .ocamlformat:1))
break-string-literals=wrap (profile ocamlformat (file .ocamlformat:1))
break-sequences=false (profile ocamlformat (file .ocamlformat:1))
break-separators=before (profile ocamlformat (file .ocamlformat:1))
break-infix-before-func=true (profile ocamlformat (file .ocamlformat:1))
break-infix=wrap (profile ocamlformat (file .ocamlformat:1))
break-fun-decl=wrap (profile ocamlformat (file .ocamlformat:1))
break-collection-expressions=fit-or-vertical (profile ocamlformat (file .ocamlformat:1))
break-cases=fit (file .ocamlformat:2)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If many input files are specified, only print the configuration for the first file.
If no input file is specified, print the configuration for the root directory if specified,
or for the current working directory otherwise.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#parentheses-around-if-then-else-branches&quot; aria-label=&quot;parentheses around if then else branches permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Parentheses around if-then-else branches&lt;/h1&gt;
&lt;p&gt;A new option &lt;code&gt;parens-ite&lt;/code&gt; has been added to decide whether to use parentheses
around if-then-else branches that spread across multiple lines.&lt;/p&gt;
&lt;p&gt;If this option is set, the following function:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;rec&lt;/span&gt; loop count a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; count &lt;span class=&quot;token operator&quot;&gt;&amp;gt;=&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;#&lt;/span&gt;len
  &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; a
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a' &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; f cur&lt;span class=&quot;token punctuation&quot;&gt;#&lt;/span&gt;get count a &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
    cur&lt;span class=&quot;token punctuation&quot;&gt;#&lt;/span&gt;incr &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    loop &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; a'&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;will be formatted as:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;rec&lt;/span&gt; loop count a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; count &lt;span class=&quot;token operator&quot;&gt;&amp;gt;=&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;#&lt;/span&gt;len
  &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; a
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a' &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; f cur&lt;span class=&quot;token punctuation&quot;&gt;#&lt;/span&gt;get count a &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
    cur&lt;span class=&quot;token punctuation&quot;&gt;#&lt;/span&gt;incr &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    loop &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; a' &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#parentheses-around-tuple-patterns&quot; aria-label=&quot;parentheses around tuple patterns permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Parentheses around tuple patterns&lt;/h1&gt;
&lt;p&gt;A new option &lt;code&gt;parens-tuple-patterns&lt;/code&gt; has been added, that mimics &lt;code&gt;parens-tuple&lt;/code&gt; but only applies to patterns,
whereas &lt;code&gt;parens-tuples&lt;/code&gt; only applies to expressions.
&lt;code&gt;parens-tuple-patterns=multi-line-only&lt;/code&gt; mode will try to skip parentheses for single-line tuple patterns,
this is the default value.
&lt;code&gt;parens-tuple-patterns=always&lt;/code&gt; always uses parentheses around tuples patterns.&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;(* with parens-tuple-patterns=always *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;(* with parens-tuple-patterns=multi-line-only *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#single-case-pattern-matching-expressions&quot; aria-label=&quot;single case pattern matching expressions permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Single-case pattern-matching expressions&lt;/h1&gt;
&lt;p&gt;The new option &lt;code&gt;single-case&lt;/code&gt; defines the style of pattern-matching expressions with only a single case.
&lt;code&gt;single-case=compact&lt;/code&gt; will try to format a single case on a single line, this is the default value.
&lt;code&gt;single-case=sparse&lt;/code&gt; will always break the line before a single case.&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;(* with single-case=compact *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; some_irrelevant_expression
&lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Undefined_recursive_module &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;(* with single-case=sparse *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; some_irrelevant_expression
&lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Undefined_recursive_module &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#space-around-collection-expressions&quot; aria-label=&quot;space around collection expressions permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Space around collection expressions&lt;/h1&gt;
&lt;p&gt;The new option &lt;code&gt;space-around-collection-expressions&lt;/code&gt; decides whether to add a space
inside the delimiters of collection expressions (lists, arrays, records).&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;(* by default *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; wkind &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;f &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt; tag &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt; kind&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; l &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;Nil&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; TCnoarg Thd&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;Cons&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; TCarg &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Ttl Thd&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tcons&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;(* with space-around-collection-expressions *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; wkind &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; f &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt; tag &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token type-variable function&quot;&gt;'a&lt;/span&gt; kind &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; l &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;Nil&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; TCnoarg Thd&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;Cons&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; TCarg &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Ttl Thd&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tcons&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#break-separators&quot; aria-label=&quot;break separators permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Break separators&lt;/h1&gt;
&lt;p&gt;The new option &lt;code&gt;break-separators&lt;/code&gt; decides whether to break before or after separators such as &lt;code&gt;;&lt;/code&gt; in list or record expressions,
&lt;code&gt;*&lt;/code&gt; in tuples or &lt;code&gt;-&amp;gt;&lt;/code&gt; in arrow types.
&lt;code&gt;break-separators=before&lt;/code&gt; breaks the expressions before the separator, this is the default value.
&lt;code&gt;break-separators=after&lt;/code&gt; breaks the expressions after the separator.
&lt;code&gt;break-separators=after-and-docked&lt;/code&gt; breaks the expressions after the separator and docks the brackets for records.&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;(* with break-separators=before *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foooooooooooooooooooooooo&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; foooooooooooooooooooooooooooooooooooooooo
  &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; fooooooooooooooooooooooooooooo&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; fooooooooooooooooooooooooooo &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;(* with break-separators=after *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foooooooooooooooooooooooo&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; foooooooooooooooooooooooooooooooooooooooo&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    fooooooooooooooooooooooooooooo&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; fooooooooooooooooooooooooooo &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;(* with break-separators=after-and-docked *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  foooooooooooooooooooooooo&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; foooooooooooooooooooooooooooooooooooooooo&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  fooooooooooooooooooooooooooooo&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; fooooooooooooooooooooooooooo
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#not-breaking-before-bindmap-operators&quot; aria-label=&quot;not breaking before bindmap operators permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Not breaking before bind/map operators&lt;/h1&gt;
&lt;p&gt;The new option &lt;code&gt;break-infix-before-func&lt;/code&gt; decides whether to break infix operators
whose right arguments are anonymous functions specially.
This option is set by default, if you disable it with &lt;code&gt;--no-break-infix-before-func&lt;/code&gt;,
it will not break before the operator so that the first line of the function appears docked at the end of line after the operator.&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;(* by default *)&lt;/span&gt;
f x
&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
g y
&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
f x &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; g y &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; f x &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; g y &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; y &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;(* with break-infix-before-func = false *)&lt;/span&gt;
f x &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
g y &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
f x &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; g y &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; f x &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; g y &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; y &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#break-toplevel-cases&quot; aria-label=&quot;break toplevel cases permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Break toplevel cases&lt;/h1&gt;
&lt;p&gt;There is a new value for the &lt;code&gt;break-cases&lt;/code&gt; option: &lt;code&gt;toplevel&lt;/code&gt;,
that forces top-level cases (i.e. not nested or-patterns) to break across lines,
otherwise breaks naturally at the margin.&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; f &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; g &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; H &lt;span class=&quot;token keyword&quot;&gt;when&lt;/span&gt; x y &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;gt;&lt;/span&gt; k &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; T &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; P &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; U &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; x g t h y u &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; x &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; E &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Z &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; P &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; M &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; y &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; O &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; P &lt;span class=&quot;token keyword&quot;&gt;when&lt;/span&gt; h x &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; A &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#number-of-spaces-before-docstrings&quot; aria-label=&quot;number of spaces before docstrings permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Number of spaces before docstrings&lt;/h1&gt;
&lt;p&gt;The new option &lt;code&gt;doc-comments-padding&lt;/code&gt; controls how many spaces are printed before doc comments in type declarations.
The default value is 2.&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;(* with doc-comments-padding = 2 *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int  &lt;span class=&quot;token comment&quot;&gt;(** a *)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int  &lt;span class=&quot;token comment&quot;&gt;(** b *)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;(* with doc-comments-padding = 1 *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int &lt;span class=&quot;token comment&quot;&gt;(** a *)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; int &lt;span class=&quot;token comment&quot;&gt;(** b *)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#ignore-files&quot; aria-label=&quot;ignore files permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Ignore files&lt;/h1&gt;
&lt;p&gt;An &lt;code&gt;.ocamlformat-ignore&lt;/code&gt; file specifies files that OCamlFormat should ignore.
Each line in an &lt;code&gt;.ocamlformat-ignore&lt;/code&gt; file specifies a filename relative to the directory containing the &lt;code&gt;.ocamlformat-ignore&lt;/code&gt; file.
Lines starting with &lt;code&gt;#&lt;/code&gt; are ignored and can be used as comments.&lt;/p&gt;
&lt;p&gt;Here is an example of such &lt;code&gt;.ocamlformat-ignore&lt;/code&gt; file:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;#This is a comment
dir2/ignore_1.ml&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#tag-only-docstrings&quot; aria-label=&quot;tag only docstrings permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Tag-only docstrings&lt;/h1&gt;
&lt;p&gt;The new option &lt;code&gt;doc-comments-tag-only&lt;/code&gt; controls the position of doc comments only containing tags.
&lt;code&gt;doc-comments-tag-only=default&lt;/code&gt; means no special treatment is done, this is the default value.
&lt;code&gt;doc-comments-tag-only=fit&lt;/code&gt; puts doc comments on the same line if it fits.&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;(* with doc-comments-tag-only = default *)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;(** @deprecated  *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; Module

&lt;span class=&quot;token comment&quot;&gt;(* with doc-comments-tag-only = fit *)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; Module &lt;span class=&quot;token comment&quot;&gt;(** @deprecated  *)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fit-or-vertical-mode-for-if-then-else&quot; aria-label=&quot;fit or vertical mode for if then else permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Fit or vertical mode for if-then-else&lt;/h1&gt;
&lt;p&gt;There is a new value for the option &lt;code&gt;if-then-else&lt;/code&gt;: &lt;code&gt;fit-or-vertical&lt;/code&gt;.
&lt;code&gt;fit-or-vertical&lt;/code&gt; vertically breaks all branches if they do not fit on a single line.
Compared to the &lt;code&gt;compact&lt;/code&gt; (default) value, it breaks all branches if at least one of them does not fit on a single line.&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;(* with if-then-else = compact *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; foo &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
    a &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; b
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; foo &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;(* with if-then-else = fit-or-vertical *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; foo &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
    a &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; b
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; foo &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#check-mode&quot; aria-label=&quot;check mode permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Check mode&lt;/h1&gt;
&lt;p&gt;A new &lt;code&gt;--check&lt;/code&gt; flag has been added.
It checks whether the input files already are formatted.
This flag is mutually exclusive with &lt;code&gt;--inplace&lt;/code&gt; and &lt;code&gt;--output&lt;/code&gt;.
It returns &lt;code&gt;0&lt;/code&gt; if the input files are indeed already formatted, or &lt;code&gt;1&lt;/code&gt; otherwise.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#break-function-declarations&quot; aria-label=&quot;break function declarations permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Break function declarations&lt;/h1&gt;
&lt;p&gt;The new option &lt;code&gt;break-fun-decl&lt;/code&gt; controls the style for function declarations and types.
&lt;code&gt;break-fun-decl=wrap&lt;/code&gt; breaks only if necessary, this is the default value.
&lt;code&gt;break-fun-decl=fit-or-vertical&lt;/code&gt; vertically breaks arguments if they do not fit on a single line.
&lt;code&gt;break-fun-decl=smart&lt;/code&gt; is like &lt;code&gt;fit-or-vertical&lt;/code&gt; but try to fit arguments on their line if they fit.
The &lt;code&gt;wrap-fun-args&lt;/code&gt; option now only controls the style for function calls, and no more for function declarations.&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;(* with break-fun-decl = wrap *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; ffffffffffffffffffff aaaaaaaaaaaaaaaaaaaaaa bbbbbbbbbbbbbbbbbbbbbb
    cccccccccccccccccccccc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  g

&lt;span class=&quot;token comment&quot;&gt;(* with break-fun-decl = fit-or-vertical *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; ffffffffffffffffffff
    aaaaaaaaaaaaaaaaaaaaaa
    bbbbbbbbbbbbbbbbbbbbbb
    cccccccccccccccccccccc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  g

&lt;span class=&quot;token comment&quot;&gt;(* with break-fun-decl = smart *)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; ffffffffffffffffffff
    aaaaaaaaaaaaaaaaaaaaaa bbbbbbbbbbbbbbbbbbbbbb cccccccccccccccccccccc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  g&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#disable-configuration-in-files-and-attributes&quot; aria-label=&quot;disable configuration in files and attributes permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Disable configuration in files and attributes&lt;/h1&gt;
&lt;p&gt;Two new options have been added so that &lt;code&gt;.ocamlformat&lt;/code&gt; configuration files and attributes in OCaml files do not change the
configuration.
These options can be useful if you use some preset profile
and you do not want attributes and &lt;code&gt;.ocamlformat&lt;/code&gt; files to interfere with your preset configuration.
&lt;code&gt;--disable-conf-attrs&lt;/code&gt; disables the configuration in attributes,
and &lt;code&gt;--disable-conf-files&lt;/code&gt; disables &lt;code&gt;.ocamlformat&lt;/code&gt; configuration files.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#preserve-module-items-spacing&quot; aria-label=&quot;preserve module items spacing permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Preserve module items spacing&lt;/h1&gt;
&lt;p&gt;There is a new value for the option &lt;code&gt;module-item-spacing&lt;/code&gt;: &lt;code&gt;preserve&lt;/code&gt;,
that will not leave open lines between one-liners of similar sorts unless there is an open line in the input.&lt;/p&gt;
&lt;p&gt;For example the line breaks are preserved in the following code:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; cmos_rtc_seconds &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0x00&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; cmos_rtc_seconds_alarm &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0x01&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; cmos_rtc_minutes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0x02&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; o

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; log_other &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0x000001&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; log_cpu &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0x000002&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; log_fpu &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0x000004&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#breaking-changes&quot; aria-label=&quot;breaking changes permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Breaking changes&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;When &lt;code&gt;--disable-outside-detected-project&lt;/code&gt; is set, disable ocamlformat when no &lt;code&gt;.ocamlformat&lt;/code&gt; file is found.&lt;/li&gt;
&lt;li&gt;Files are not parsed when ocamlformat is disabled.&lt;/li&gt;
&lt;li&gt;Disallow &lt;code&gt;-&lt;/code&gt; with other input files.&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;wrap-fun-args&lt;/code&gt; option now only controls the style for function calls, and no more for function declarations.&lt;/li&gt;
&lt;li&gt;The default profile is now named &lt;code&gt;ocamlformat&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;The deprecated syntax for &lt;code&gt;.ocamlformat&lt;/code&gt; files: &lt;code&gt;option value&lt;/code&gt; is no more supported anymore and you should use the &lt;code&gt;option = value&lt;/code&gt; syntax instead.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#miscellaneous-bugfixes&quot; aria-label=&quot;miscellaneous bugfixes permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Miscellaneous bugfixes&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Preserve shebang (e.g. &lt;code&gt;#!/usr/bin/env ocaml&lt;/code&gt;) at the beginning of a file.&lt;/li&gt;
&lt;li&gt;Improve the formatting when &lt;code&gt;ocp-indent-compat&lt;/code&gt; is set.&lt;/li&gt;
&lt;li&gt;UTF8 characters are now correctly printed in comments.&lt;/li&gt;
&lt;li&gt;Add parentheses around a constrained any-pattern (e.g. &lt;code&gt;let (_ : int) = x1&lt;/code&gt;).&lt;/li&gt;
&lt;li&gt;Emacs: the temporary buffer is now killed.&lt;/li&gt;
&lt;li&gt;Emacs: add the keybinding in tuareg's map instead of merlin's.&lt;/li&gt;
&lt;li&gt;Lots of improvements on the comments, docstrings, attributes formatting.&lt;/li&gt;
&lt;li&gt;Lots of improvements on the formatting of modules.&lt;/li&gt;
&lt;li&gt;Lots of improvements in the Reason support.&lt;/li&gt;
&lt;li&gt;Do not rely on the file-system to format sources.&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;--debug&lt;/code&gt; mode is more user-friendly.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#credits&quot; aria-label=&quot;credits permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Credits&lt;/h1&gt;
&lt;p&gt;This release also contains many other changes and bug fixes that we cannot detail here.&lt;/p&gt;
&lt;p&gt;Special thanks to our maintainers and contributors for this release: Jules Aguillon, Mathieu Barbin, Josh Berdine, J&amp;eacute;r&amp;eacute;mie Dimino, Hugo Heuzard, Ludwig Pacifici, Guillaume Petiot, Nathan Rebours and Louis Roch&amp;eacute;.&lt;/p&gt;
&lt;p&gt;If you wish to get involved with OCamlFormat development or file an issue,
please read the &lt;a href=&quot;https://github.com/ocaml-ppx/ocamlformat/blob/master/CONTRIBUTING.md&quot;&gt;contributing guide&lt;/a&gt;,
any contribution is welcomed.&lt;/p&gt;</content><id>https://tarides.com/blog/2019-03-29-release-of-ocamlformat-0-9</id><title type="text">Release of OCamlFormat 0.9</title><updated>2019-03-29T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2019-02-08-release-of-base64" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;MirageOS is a library operating system written from the ground up in OCaml.
It has an impossible and incredibly huge goal to re-implement all of the
world! Looking back at the work accomplished by the MirageOS team, it appears that's
what happened for several years. Re-implementing the entire stack, in particular
the lower layers that we often take for granted, requires a great attention to
detail. While it may seem reasonably easy to implement a given RFC, a huge
amount of work is often hidden under the surface.&lt;/p&gt;
&lt;p&gt;In this article, we will explain the development process we went through, as we
updated a small part of the MirageOS stack: the library &lt;code&gt;ocaml-base64&lt;/code&gt;. It's a
suitable example as the library is small (few hundreds lines of code), but it
needs ongoing development to ensure good quality and to be able to trust it for
higher level libraries (like &lt;a href=&quot;https://github.com/mirage/mrmime&quot;&gt;mrmime&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;Updating the library was instigated by a problem I ran into with the existing
base64 implementation while working on the e-mail stack. Indeed, we got some
errors when we tried to compute an &lt;em&gt;encoded-word&lt;/em&gt; according to the &lt;a href=&quot;https://www.ietf.org/rfc/rfc2047.txt&quot;&gt;RFC
2047&lt;/a&gt;. So after several years of not being touched, we decided to
update &lt;a href=&quot;https://github.com/mirage/ocaml-base64&quot;&gt;&lt;code&gt;ocaml-base64&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-critique-of-pure-reason&quot; aria-label=&quot;the critique of pure reason permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Critique of Pure Reason&lt;/h1&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-first-problem&quot; aria-label=&quot;the first problem permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The first problem&lt;/h2&gt;
&lt;p&gt;We started by attempting to use &lt;code&gt;ocaml-base64&lt;/code&gt; on some examples extracted from
actual e-mails, and we quickly ran into cases where the library failed. This
highlighted that reality is much more complex than you can imagine from reading
an RFC. In this situation, what do you do: try to implement a best-effort
strategy and continue parsing? Or stick to the letter of the RFC and fail? In
the context of e-mails, which has accumulated a lot of baggage over time, you
cannot get around implementing a best-effort strategy.&lt;/p&gt;
&lt;p&gt;The particular error we were seeing was a &lt;code&gt;Not_found&lt;/code&gt; exception when decoding an
&lt;em&gt;encoded-word&lt;/em&gt;. This exception appeared because the implementation relied on
&lt;code&gt;String.contains&lt;/code&gt;, and the input contained a character which was not part of the
base64 alphabet.&lt;/p&gt;
&lt;p&gt;This was the first reason why we thought it necessary to rewrite &lt;code&gt;ocaml-base64&lt;/code&gt;.
Of course, we could just catch the exception and continue the initial
computation, but then another reason appeared.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-second-problem&quot; aria-label=&quot;the second problem permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The second problem&lt;/h2&gt;
&lt;p&gt;As &lt;a href=&quot;https://github.com/clecat&quot;&gt;@clecat&lt;/a&gt; and I reviewed RFC 2045, we noticed the
following requirement:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The encoded output stream must be represented in lines of no more than 76
characters each.&lt;/p&gt;
&lt;p&gt;See RFC 2045, section 6.8&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Pretty specific, but general to e-mails, we should never have more than 78
characters per line according to &lt;a href=&quot;https://www.ietf.org/rfc/rfc822.txt&quot;&gt;RFC 822&lt;/a&gt;, nor more than 998 characters
according to &lt;a href=&quot;https://www.ietf.org/rfc/rfc2822.txt&quot;&gt;RFC 2822&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Having a decoder that abided RFC 2045 more closely, including the requirement
above, further spurred us to implement a new decoder.&lt;/p&gt;
&lt;p&gt;As part of the new implementation, we decided to implement tests and fuzzers to
ensure correctness. This also had the benefit, that we could run the fuzzer on
the existing codebase. When fuzzing an encoder/decoder pair, an excellent check
is whether the following isomorphism holds:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; iso0 input &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;decode &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;encode input&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; input&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; iso1 input &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;encode &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;decode input&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; input&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;However, at this point &lt;a href=&quot;https://github.com/hannesm&quot;&gt;@hannesm&lt;/a&gt; ran into another error (see
&lt;a href=&quot;https://github.com/mirage/ocaml-base64/issues/20&quot;&gt;#20&lt;/a&gt;).&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#the-third-problem&quot; aria-label=&quot;the third problem permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The third problem&lt;/h2&gt;
&lt;p&gt;We started to review the &lt;a href=&quot;https://github.com/mirleft/ocaml-nocrypto&quot;&gt;&lt;code&gt;nocrypto&lt;/code&gt;&lt;/a&gt; implementation of base64, which
respects our requirements. We had some concerns about the performance of the
implementation though, so we decided to see if we would get a performance
regression by switching to this implementation.&lt;/p&gt;
&lt;p&gt;A quick benchmark based on random input revealed the opposite, however!
&lt;code&gt;nocrypto&lt;/code&gt;'s implementation was faster than &lt;code&gt;ocaml-base64&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;ocaml-base64&lt;span class=&quot;token string&quot;&gt;'s implementation on bytes (length: 5000): 466 272.34ns
nocrypto'&lt;/span&gt;s implementation on bytes &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;length: &lt;span class=&quot;token number&quot;&gt;5000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;: &lt;span class=&quot;token number&quot;&gt;137&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;406&lt;/span&gt;.04ns&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Based on all these observations, we thought there was sufficient reason to
reconsider the &lt;code&gt;ocaml-base64&lt;/code&gt; implementation. It's also worth mentioning that
the last real release (excluding &lt;code&gt;dune&lt;/code&gt;/&lt;code&gt;jbuilder&lt;/code&gt;/&lt;code&gt;topkg&lt;/code&gt; updates) is from Dec.
24 2014. So, it's pretty old code and the OCaml eco-system has improved a lot
since 2014.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#implementation--review&quot; aria-label=&quot;implementation  review permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Implementation &amp;amp; review&lt;/h1&gt;
&lt;p&gt;We started integrating the &lt;code&gt;nocrypto&lt;/code&gt; implementation. Of course, implementing
&lt;a href=&quot;https://www.ietf.org/rfc/rfc4648.txt&quot;&gt;RFC 4648&lt;/a&gt; is not as easy as just reading examples and trying to do
something which works. The devil is in the detail.&lt;/p&gt;
&lt;p&gt;@hannesm and &lt;a href=&quot;https://github.com/cfcs&quot;&gt;@cfcs&lt;/a&gt; decided to do a big review of expected behavior
according to the RFC, and another about implementation and security issues.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#canonicalization&quot; aria-label=&quot;canonicalization permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Canonicalization&lt;/h2&gt;
&lt;p&gt;The biggest problem about RFC 4648 is regarding canonical inputs. Indeed, there
are cases where two different inputs are associated with the same value:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Base64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;decode &lt;span class=&quot;token string&quot;&gt;&amp;quot;Zm9vCg==&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;foo\n&amp;quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Base64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;decode &lt;span class=&quot;token string&quot;&gt;&amp;quot;Zm9vCh==&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;foo\n&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is mostly because the base64 format encodes the input 6 bits at a time. The
result is that 4 base64 encoded bytes are equal to 3 decoded bytes (&lt;code&gt;6 * 4 = 8 * 3&lt;/code&gt;). Because of this, 2 base64 encoded bytes provide 1 byte plus 4 bits. What do
we need to do with these 4 bits? Nothing.&lt;/p&gt;
&lt;p&gt;That's why the last character in our example can be something else than &lt;code&gt;g&lt;/code&gt;. &lt;code&gt;g&lt;/code&gt;
is the canonical byte to indicate using the 2 bits afterward the 6 bits
delivered by &lt;code&gt;C&lt;/code&gt; (and make a byte - 8 bits). But &lt;code&gt;h&lt;/code&gt; can be used where we just
need 2 bits at the end.&lt;/p&gt;
&lt;p&gt;Due to this behavior, the check used for fuzzing changes: from a canonical
input, we should check isomorphism.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#invalid-character&quot; aria-label=&quot;invalid character permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Invalid character&lt;/h2&gt;
&lt;p&gt;As mentioned above (&amp;quot;The first problem&amp;quot;), how should invalid characters be
handled? This happens when decoding a byte which is not a part of the base64
alphabet. In the old version, &lt;code&gt;ocaml-base64&lt;/code&gt; would simply leak a &lt;code&gt;Not_found&lt;/code&gt;
exception from &lt;code&gt;String.contains&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The MirageOS team has taken &lt;a href=&quot;https://mirage.io/wiki/mirage-3.0-errors&quot;&gt;a stance on exceptions&lt;/a&gt;, which is
to &amp;quot;use exceptions for exceptional conditions&amp;quot; - invalid input is hardly one of
those. This is to avoid any exception leaks, as it can be really hard to track
the origin of an exception in a unikernel. Because of this, several packages
have been updated to return a &lt;code&gt;result&lt;/code&gt; type instead, and we wanted the new
implementation to follow suit.&lt;/p&gt;
&lt;p&gt;On the other hand, exceptions can be useful when considered as a more
constrained form of assembly jump. Of course, they break the control flow, but
from a performance point of view, it's interesting to use this trick:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;exception&lt;/span&gt; Found

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; contains str chr &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; idx &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ref &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; len &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length str &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;idx &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; len
      &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;unsafe_get str &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;idx &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; chr &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; raise Found &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; incr idx &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      None
  &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Found &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; Some &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;idx&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This kind of code for example is ~20% faster than &lt;code&gt;String.contains&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;As such, exceptions can be a useful tool for performance optimizations, but we
need to be extra careful not to expose them to the users of the library. This
code needs to be hidden behind a fancy functional interface. With this in mind,
we should assert that our &lt;code&gt;decode&lt;/code&gt; function never leaks an exception. We'll
describe how we've adressed this problem later.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#special-cases&quot; aria-label=&quot;special cases permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Special cases&lt;/h2&gt;
&lt;p&gt;RFC 4648 has some detailed cases and while we would sometimes like to work in a
perfect world where we will never need to deal with such errors, from our
experience, we cannot imagine what the end-user will do to formats, protocols
and such.&lt;/p&gt;
&lt;p&gt;Even though the RFC has detailed examples, we have to read between lines to know
special cases and how to deal with them.&lt;/p&gt;
&lt;p&gt;@hannesm noticed one of these cases, where padding (&lt;code&gt;=&lt;/code&gt; sign at the end of
input) is not mandatory:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The pad character &amp;quot;=&amp;quot; is typically percent-encoded when used in an URI [9],
but if the data length is known implicitly, this can be avoided by skipping
the padding; see section 3.2.&lt;/p&gt;
&lt;p&gt;See RFC 4648, section 5&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;That mostly means that the following kind of input can be valid:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Base64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;decode &lt;span class=&quot;token label property&quot;&gt;~pad&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;Zm9vCg&amp;quot;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;foo\n&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It's only valid in a specific context though: when &lt;em&gt;length is known implicitly&lt;/em&gt;.
Only the caller of &lt;code&gt;decode&lt;/code&gt; can determine whether the length is implicitly known
such that padding can be omitted. To that end, we've added a new optional
argument &lt;code&gt;?pad&lt;/code&gt; to the function &lt;code&gt;Base64.decode&lt;/code&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#allocation-sub-off-and-len&quot; aria-label=&quot;allocation sub off and len permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Allocation, &lt;code&gt;sub&lt;/code&gt;, &lt;code&gt;?off&lt;/code&gt; and &lt;code&gt;?len&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;Xavier Leroy has described the garbage collector in the following way:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;You see, the Caml garbage collector is like a god from ancient mythology:
mighty, but very irritable. If you mess with it, it'll make you suffer in
surprising ways.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;That's probably why my experience with improving the allocation policy of
(&lt;code&gt;ocaml-git&lt;/code&gt;)&lt;a href=&quot;https://github.com/mirage/ocaml-git&quot;&gt;ocaml-git&lt;/a&gt; was quite a nightmare. Allowing the user to control
allocation is important for efficiency, and we wanted to &lt;code&gt;ocaml-base64&lt;/code&gt; to be a
good citizen.&lt;/p&gt;
&lt;p&gt;At the beginning, &lt;code&gt;ocaml-base64&lt;/code&gt; had a very simple API:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; decode &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; string
&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; encode &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; string&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This API forces allocations in two ways.&lt;/p&gt;
&lt;p&gt;Firstly, if the caller needs to encode a part of a string, this part needs to be
extracted, e.g. using &lt;code&gt;String.sub&lt;/code&gt;, which will allocate a new string. To avoid
this, two new optional arguments have been added to &lt;code&gt;encode&lt;/code&gt;: &lt;code&gt;?off&lt;/code&gt; and &lt;code&gt;?len&lt;/code&gt;,
which specifies the substring to encode. Here's an example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;(* We want to encode the part 'foo' without prefix or suffix *)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;(* Old API -- forces allocation *)&lt;/span&gt;
Base64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;encode &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sub &lt;span class=&quot;token string&quot;&gt;&amp;quot;prefix foo suffix&amp;quot;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;Zm9v&amp;quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;(* New API -- avoids allocation *)&lt;/span&gt;
Base64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;encode &lt;span class=&quot;token label property&quot;&gt;~off&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;token label property&quot;&gt;~len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;prefix foo suffix&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;Zm9v&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Secondly, a new string is allocated to hold the resulting string. We can
calculate a bound on the length of this string in the following manner:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; x y &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; raise Division_by_zero &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; encode input &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; res &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Bytes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;create &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length input &lt;span class=&quot;token operator&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; decode input &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; res &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Bytes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;create &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length input &lt;span class=&quot;token operator&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Unfortunately we cannot know the exact length of the result prior to computing
it. This forces a call to &lt;code&gt;String.sub&lt;/code&gt; at the end of the computation to return a
string of the correct length. This means we have two allocations rather than
one. To avoid the additional allocation, [@avsm][avsm] proposed to provide a new
type &lt;code&gt;sub = string * int * int&lt;/code&gt;. This lets the user call &lt;code&gt;String.sub&lt;/code&gt; if
required (and allocate a new string), or use simply use the returned &lt;code&gt;sub&lt;/code&gt; for
_blit_ting to another buffer or similar.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#fuzz-everything&quot; aria-label=&quot;fuzz everything permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Fuzz everything!&lt;/h1&gt;
&lt;p&gt;There's a strong trend of fuzzing libraries for MirageOS, which is quite easy
thanks to the brilliant work by &lt;a href=&quot;https://github.com/yomimono&quot;&gt;@yomimono&lt;/a&gt; and &lt;a href=&quot;https://github.com/stedolan&quot;&gt;@stedolan&lt;/a&gt;!
The integrated fuzzing in OCaml builds on &lt;a href=&quot;http://lcamtuf.coredump.cx/afl/&quot;&gt;American fuzzy lop&lt;/a&gt;, which is
very smart about discarding paths of execution that have already been tested and
generating unseen inputs which break your assumptions. My first experience with
fuzzing was with the library &lt;a href=&quot;https://github.com/mirage/decompress&quot;&gt;&lt;code&gt;decompress&lt;/code&gt;&lt;/a&gt;, and I was impressed by
&lt;a href=&quot;https://github.com/mirage/decompress/pull/34&quot;&gt;precise error&lt;/a&gt; it found about a name clash.&lt;/p&gt;
&lt;p&gt;Earlier in this article, I listed some properties we wanted to check for
&lt;code&gt;ocaml-base64&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The functions &lt;code&gt;encode&lt;/code&gt; and &lt;code&gt;decode&lt;/code&gt; should be be isomorphic taking
canonicalization into account:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; iso0 input &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; Base64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;decode &lt;span class=&quot;token label property&quot;&gt;~pad&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt; input &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Error &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; fail &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Ok result0 &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; result1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Base64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;encode_exn result0 &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; Base64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;decode &lt;span class=&quot;token label property&quot;&gt;~pad&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; result1 &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Error &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; fail &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Ok result2 &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; check_eq result0 result2

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; iso1 input &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Base64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;encode_exn input &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; Base64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;decode &lt;span class=&quot;token label property&quot;&gt;~pad&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; result0 &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Error &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; fail &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Ok result1 &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; result2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Base64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;encode_exn result1 &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
    check_eq result0 result2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;The function &lt;code&gt;decode&lt;/code&gt; should &lt;em&gt;never&lt;/em&gt; raise an exception, but rather return a
result type:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; no_exn input &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; ignore &lt;span class=&quot;token operator&quot;&gt;@@&lt;/span&gt; Base64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;decode input &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; fail &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;And finally, we should randomize &lt;code&gt;?off&lt;/code&gt; and &lt;code&gt;?len&lt;/code&gt; arguments to ensure that we
don't get an &lt;code&gt;Out_of_bounds&lt;/code&gt; exception when accessing input.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Just because we've applied fuzzing to the new implementation for a long time, it
doesn't mean that the code is completely infallible. People can use our library
in an unimaginable way (and it's mostly what happens in the real world) and get
an unknowable error.&lt;/p&gt;
&lt;p&gt;But, with the fuzzer, we've managed to test some properties across a very wide
range of input instead of unit testing with random (or not so random) inputs
from our brains. This development process allows &lt;em&gt;fixing the semantics&lt;/em&gt; of
implementations (even if it's &lt;strong&gt;not&lt;/strong&gt; a formal definition of semantics), but
it's better than nothing or outdated documentation.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;Based on our recent update to &lt;code&gt;ocaml-base64&lt;/code&gt;, this blog post explains our
development process as go about rewriting the world to MirageOS, one bit at a
time. There's an important point to be made though:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ocaml-base64&lt;/code&gt; is a small project. Currently, the implementation is about 250
lines of code. So it's a really small project. But as stated in the
introduction, we are fortunate enough to push the restart button of the computer
world - yes, we want to make a new operating system.&lt;/p&gt;
&lt;p&gt;That's a massive task, and we shouldn't make it any harder on ourselves than
necessary. As such, we need to justify any step, any line of code, and why we
decided to spend our time on any change (why we decided to re-implement &lt;code&gt;git&lt;/code&gt;
for example). So before committing any time to projects, we try to do a deep
analysis of the problem, get feedback from others, and find a consensus between
what we already know, what we want and what we should have (in the case of
&lt;code&gt;ocaml-base64&lt;/code&gt;, @hannesm did a look on the PHP implementation and the Go
implementation).&lt;/p&gt;
&lt;p&gt;Indeed, this is a hard question which nobody can answer perfectly in isolation.
So, the story of this update to &lt;code&gt;ocaml-base64&lt;/code&gt; is an invitation for you to enter
the arcanas of the computer world through MirageOS :) ! Don't be afraid!&lt;/p&gt;</content><id>https://tarides.com/blog/2019-02-08-release-of-base64</id><title type="text">Release of Base64</title><updated>2019-02-08T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://dune.build/blog/configurator-constants/" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Dune comes with a library to query OS-specific information, called configurator.
It is able to evaluate C expressions and turn them into OCaml value.
Surprisingly, it even works when compiling for a different architecture. How can
it do that?&lt;/p&gt;</content><id>https://dune.build/blog/configurator-constants/</id><title type="text">How configurator reads C constants</title><updated>2019-01-03T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://www.youtube.com/watch?v=urG5BjvjW18" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Presentation about MirageOS in Lambda World Cad&amp;igrave;z on October 26th&lt;/p&gt;</content><id>https://www.youtube.com/watch?v=urG5BjvjW18</id><title type="text">MirageOS, towards a smaller and safer OS</title><updated>2018-12-06T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2018-10-19-ocaml-git-2-0" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;I'm very happy to announce a new major release of &lt;code&gt;ocaml-git&lt;/code&gt; (2.0).
This release is a 2-year effort to get a revamped
streaming API offering a full control over memory
allocation. This new version also adds production-ready implementations of
the wire protocol: &lt;code&gt;git push&lt;/code&gt; and &lt;code&gt;git pull&lt;/code&gt; now work very reliably
using the raw Git and smart HTTP protocol (SSH support will come
soon). &lt;code&gt;git gc&lt;/code&gt; is also implemented, and all of the basic bricks are
now available to create Git servers. MirageOS support is available
out-of-the-box.&lt;/p&gt;
&lt;p&gt;Two years ago, we decided to rewrite &lt;code&gt;ocaml-git&lt;/code&gt; and split it into
standalone libraries. More details about these new libraries are also
given below.&lt;/p&gt;
&lt;p&gt;But first, let's focus on &lt;code&gt;ocaml-git&lt;/code&gt;'s new design. The primary goal was
to fix memory consumption issues that our users noticed with the previous version,
and to make &lt;code&gt;git push&lt;/code&gt; work reliably. We also took care about
not breaking the API too much, to ease the transition for current users.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#controlled-allocations&quot; aria-label=&quot;controlled allocations permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Controlled allocations&lt;/h2&gt;
&lt;p&gt;There is a big difference in the way &lt;code&gt;ocaml-git&lt;/code&gt; and &lt;code&gt;git&lt;/code&gt;
are designed: &lt;code&gt;git&lt;/code&gt; is a short-lived command-line tool which does not
care that much about allocation policies, whereas we wanted to build a
library that can be linked with long-lived Git client and/or server
applications. We had to make some (performance) compromises to support
that use-case, at the benefit of tighter allocation policies &amp;mdash; and hence
more predictable memory consumption patterns.
Other Git libraries such as &lt;a href=&quot;https://libgit2.org/&quot;&gt;libgit2&lt;/a&gt;
also have to &lt;a href=&quot;https://libgit2.org/security/&quot;&gt;deal&lt;/a&gt; with similar concerns.&lt;/p&gt;
&lt;p&gt;In order to keep a tight control on the allocated memory, we decided to
use &lt;a href=&quot;https://github.com/mirage/decompress&quot;&gt;decompress&lt;/a&gt; instead of
&lt;code&gt;camlzip&lt;/code&gt;. &lt;code&gt;decompress&lt;/code&gt; allows the users to provide their own buffer
instead of allocating dynamically. This allowed us to keep a better
control on memory consumption. See below for more details on &lt;code&gt;decompress&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We also used &lt;a href=&quot;https://github.com/inhabitedtype/angstrom&quot;&gt;angstrom&lt;/a&gt; and
&lt;a href=&quot;https://github.com/mirage/encore&quot;&gt;encore&lt;/a&gt; to provide a streaming interface
to encode and decode Git objects. The streaming API is currently hidden
to the end-user, but it helped us a lot to build abstraction and, again, on
managing the allocation policy of the library.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#complete-pack-file-support-including-gc&quot; aria-label=&quot;complete pack file support including gc permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Complete PACK file support (including GC)&lt;/h2&gt;
&lt;p&gt;In order to find the right abstraction for manipulating pack files in
a long-lived application, we experimented with
&lt;a href=&quot;https://github.com/dinosaure/sirodepac&quot;&gt;various&lt;/a&gt;
&lt;a href=&quot;https://github.com/dinosaure/carton&quot;&gt;prototypes&lt;/a&gt;. We haven't found the
right abstractions just yet, but we believe the PACK format could be useful
to store any kind of data in the future (and not especially Git objects).&lt;/p&gt;
&lt;p&gt;We implemented &lt;code&gt;git gc&lt;/code&gt; by following the same heuristics as
&lt;a href=&quot;https://github.com/git/git/blob/master/Documentation/technical/pack-heuristics.txt&quot;&gt;Git&lt;/a&gt;
to compress pack files and
we produce something similar in size &amp;mdash; &lt;code&gt;decompress&lt;/code&gt; has a good ratio about
compression &amp;mdash; and we are using &lt;code&gt;duff&lt;/code&gt;, our own implementation of &lt;code&gt;xdiff&lt;/code&gt;, the
binary diff algorithm used by Git (more details on &lt;code&gt;duff&lt;/code&gt; below).
We also had to re-implement the streaming algorithm to reconstruct &lt;code&gt;idx&lt;/code&gt; files on
the fly, when receiving pack file on the network.&lt;/p&gt;
&lt;p&gt;One notable feature of our compression algorithms is they work without
the assumption that the underlying system implements POSIX: hence,
they can work fully in-memory, in a browser using web storage or
inside a MirageOS unikernel with &lt;a href=&quot;https://github.com/mirage/wodan&quot;&gt;wodan&lt;/a&gt;.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#production-ready-push-and-pull&quot; aria-label=&quot;production ready push and pull permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Production-ready push and pull&lt;/h2&gt;
&lt;p&gt;We re-implemented and abstracted the &lt;a href=&quot;https://github.com/git/git/blob/master/Documentation/technical/http-protocol.txt&quot;&gt;Git Smart protocol&lt;/a&gt;, and used that
abstraction to make &lt;code&gt;git push&lt;/code&gt; and &lt;code&gt;git pull&lt;/code&gt; work over HTTP.  By
default we provide a &lt;a href=&quot;https://github.com/mirage/cohttp&quot;&gt;cohttp&lt;/a&gt;
implementation but users can use their own &amp;mdash; for instance based on
&lt;a href=&quot;https://github.com/inhabitedtype/httpaf&quot;&gt;httpaf&lt;/a&gt;.
As proof-of-concept, the &lt;a href=&quot;https://github.com/mirage/ocaml-git/pull/227&quot;&gt;initial
pull-request&lt;/a&gt; of &lt;code&gt;ocaml-git&lt;/code&gt; 2.0 was
created using this new implementation; moreover, we wrote a
prototype of a Git client compiled with &lt;code&gt;js_of_ocaml&lt;/code&gt;, which was able
to run &lt;code&gt;git pull&lt;/code&gt; over HTTP inside a browser!&lt;/p&gt;
&lt;p&gt;Finally, that implementation will allow MirageOS unikernels to synchronize their
internal state with external Git stores (hosted for instance on GitHub)
using push/pull mechanisms. We also expect to release a server-side implementation
of the smart HTTP protocol, so that the state of any unikernel can be inspected
via &lt;code&gt;git pull&lt;/code&gt;. Stay tuned for more updates on that topic!&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#standalone-dependencies&quot; aria-label=&quot;standalone dependencies permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Standalone Dependencies&lt;/h2&gt;
&lt;p&gt;Below you can find the details of the new stable releases of libraries that are
used by &lt;code&gt;ocaml-git&lt;/code&gt; 2.0.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#optint-and-checkseum&quot; aria-label=&quot;optint and checkseum permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code&gt;optint&lt;/code&gt; and &lt;code&gt;checkseum&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;In some parts of &lt;code&gt;ocaml-git&lt;/code&gt;, we need to compute a Circular
Redundancy Check value. It is 32-bit integer value. &lt;code&gt;optint&lt;/code&gt; provides
an abstraction of it but structurally uses an unboxed integer or a
boxed &lt;code&gt;int32&lt;/code&gt; value depending on target (32 bit or 64 bit architecture).&lt;/p&gt;
&lt;p&gt;&lt;code&gt;checkseum&lt;/code&gt; relies on &lt;code&gt;optint&lt;/code&gt; and provides 3 implementations of CRC:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Adler32 (used by &lt;code&gt;zlib&lt;/code&gt; format)&lt;/li&gt;
&lt;li&gt;CRC32 (used by &lt;code&gt;gzip&lt;/code&gt; format and &lt;code&gt;git&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;CRC32-C (used by &lt;code&gt;wodan&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;checkseum&lt;/code&gt; uses the &lt;em&gt;linking trick&lt;/em&gt;: this means that users of the
library program against an abstract API (only the &lt;code&gt;cmi&lt;/code&gt; is provided);
at link-time, users have to select which implementation to use:
&lt;code&gt;checkseum.c&lt;/code&gt; (the C implementation) or &lt;code&gt;checkseum.ocaml&lt;/code&gt; (the OCaml
implementation). The process is currently a bit cumbersome but upcoming
&lt;code&gt;dune&lt;/code&gt; release will make that process much more transparent to the users.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#encore-angkor&quot; aria-label=&quot;encore angkor permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code&gt;encore&lt;/code&gt; (/&lt;em&gt;angkor&lt;/em&gt;/)&lt;/h3&gt;
&lt;p&gt;In &lt;code&gt;git&lt;/code&gt;, we work with Git &lt;em&gt;objects&lt;/em&gt; (&lt;em&gt;tree&lt;/em&gt;, &lt;em&gt;blob&lt;/em&gt; or
&lt;em&gt;commit&lt;/em&gt;). These objects are encoded in a specific format. Then,
the hash of these objects are computed from the encoded
result to get a unique identifier. For example, the hash of your last commit is:
&lt;code&gt;sha1(encode(commit))&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;A common operation in &lt;code&gt;git&lt;/code&gt; is to decode Git objects from an encoded
representation of them (especially in &lt;code&gt;.git/objects/*&lt;/code&gt; as a &lt;em&gt;loose&lt;/em&gt;
file) and restore them in another part of your Git repository (like in a
PACK file or on the command-line).&lt;/p&gt;
&lt;p&gt;Hence, we need to ensure that encoding is always deterministic, and
that decoding an encoded Git object is always the identity, e.g. there is
an &lt;em&gt;isomorphism&lt;/em&gt; between the decoder and the encoder.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; decoder &lt;span class=&quot;token operator&quot;&gt;&amp;lt;.&amp;gt;&lt;/span&gt; encoder &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; id
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; encoder &lt;span class=&quot;token operator&quot;&gt;&amp;lt;.&amp;gt;&lt;/span&gt; decoder &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; string &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; id&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/mirage/encore&quot;&gt;encore&lt;/a&gt; is a library in which you
can describe a format (like Git format) and from it, we can derive a
streaming decoder &lt;strong&gt;and&lt;/strong&gt; encoder that are isomorphic by
construction.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#duff&quot; aria-label=&quot;duff permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code&gt;duff&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/mirage/duff&quot;&gt;duff&lt;/a&gt; is a pure implementation in
OCaml of the &lt;code&gt;xdiff&lt;/code&gt; algorithm.
Git has an optimized representation of your Git repository. It's a
PACK file. This format uses a binary diff algorithm called &lt;code&gt;xdiff&lt;/code&gt;
to compress binary data. &lt;code&gt;xdiff&lt;/code&gt; takes a source A and a target B and try
to find common sub-strings between A and B.&lt;/p&gt;
&lt;p&gt;This is done by a Rabin's fingerprint of the source A applied to the
target B. The fingerprint can then be used to produce a lightweight
representation of B in terms of sub-strings of A.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;duff&lt;/code&gt; implements this algorithm (with additional Git's constraints,
regarding the size of the sliding windows) in OCaml. It provides a
small binary &lt;code&gt;xduff&lt;/code&gt; that complies with the format of Git without the &lt;code&gt;zlib&lt;/code&gt;
layer.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ xduff &lt;span class=&quot;token function&quot;&gt;diff&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;source&lt;/span&gt; target &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; target.xduff
$ xduff patch &lt;span class=&quot;token builtin class-name&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; target.xduff &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; target.new
$ &lt;span class=&quot;token function&quot;&gt;diff&lt;/span&gt; target target.new
$ &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$?&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#decompress&quot; aria-label=&quot;decompress permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code&gt;decompress&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/mirage/decompress&quot;&gt;decompress&lt;/a&gt;
is a pure implementation in OCaml of &lt;code&gt;zlib&lt;/code&gt; and
&lt;code&gt;rfc1951&lt;/code&gt;. You can compress and decompress data flows and, obviously,
Git does this compression in &lt;em&gt;loose&lt;/em&gt; files and PACK files.&lt;/p&gt;
&lt;p&gt;It provides a non-blocking interface and is easily usable in a server
context. Indeed, the implementation never allocates and only relies on
what the user provides (&lt;code&gt;window&lt;/code&gt;, input and output buffer). Then, the
distribution provides an easy example of how to use &lt;code&gt;decompress&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; inflate&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;level&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;int &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; string &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; string
&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; deflate&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; string &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; string&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#digestif&quot; aria-label=&quot;digestif permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code&gt;digestif&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/mirage/digestif&quot;&gt;digestif&lt;/a&gt; is a toolbox providing
many implementations of hash algorithms such as:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MD5&lt;/li&gt;
&lt;li&gt;SHA1&lt;/li&gt;
&lt;li&gt;SHA224&lt;/li&gt;
&lt;li&gt;SHA256&lt;/li&gt;
&lt;li&gt;SHA384&lt;/li&gt;
&lt;li&gt;SHA512&lt;/li&gt;
&lt;li&gt;BLAKE2B&lt;/li&gt;
&lt;li&gt;BLAKE2S&lt;/li&gt;
&lt;li&gt;RIPEMD160&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Like &lt;code&gt;checkseum&lt;/code&gt;, &lt;code&gt;digestif&lt;/code&gt; uses the linking trick too: from a
shared interface, it provides 2 implementations, in C (&lt;code&gt;digestif.c&lt;/code&gt;)
and OCaml (&lt;code&gt;digestif.ocaml&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Regarding Git, we use the SHA1 implementation and we are ready to
migrate &lt;code&gt;ocaml-git&lt;/code&gt; to BLAKE2{B,S} as the Git core team expects - and,
in the OCaml world, it is just a &lt;em&gt;functor&lt;/em&gt; application with
another implementation.&lt;/p&gt;
&lt;h3 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#eqaf&quot; aria-label=&quot;eqaf permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code&gt;eqaf&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;Some applications require that secret values are compared in constant
time. Functions like &lt;code&gt;String.equal&lt;/code&gt; do not have this property, so we
have decided to provide a small package &amp;mdash; &lt;a href=&quot;https://github.com/mirage/eqaf&quot;&gt;eqaf&lt;/a&gt; &amp;mdash;
providing a &lt;em&gt;constant-time&lt;/em&gt; &lt;code&gt;equal&lt;/code&gt; function.
&lt;code&gt;digestif&lt;/code&gt; uses it to check equality of hashes &amp;mdash; it also exposes
&lt;code&gt;unsafe_compare&lt;/code&gt; if you don't care about timing attacks in your application.&lt;/p&gt;
&lt;p&gt;Of course, the biggest work on this package is not about the
implementation of the &lt;code&gt;equal&lt;/code&gt; function but a way to check the
constant-time assumption on this function. Using this, we did a
&lt;a href=&quot;https://github.com/mirage/eqaf/tree/master/test&quot;&gt;benchmark&lt;/a&gt; on Linux,
Windows and Mac to check it.&lt;/p&gt;
&lt;p&gt;An interesting fact is that after various experiments, we replaced the
initial implementation in C (extracted from OpenBSD's &lt;a href=&quot;https://man.openbsd.org/timingsafe_bcmp.3&quot;&gt;timingsafe_memcmp&lt;/a&gt;) with an OCaml
implementation behaving in a much more predictable way on all the
tested platforms.&lt;/p&gt;
&lt;h2 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;The upcoming version 2.0 of &lt;a href=&quot;https://irmin.org&quot;&gt;Irmin&lt;/a&gt; is using ocaml-git
to create small applications that &lt;a href=&quot;https://github.com/mirage/irmin/blob/master/examples/push.ml&quot;&gt;push and pull their state
to GitHub&lt;/a&gt;.
We think that Git offers a very nice model to persist data for distributed
applications and we hope that more people will use ocaml-git to experiment
and manipulate application data in Git. Please
&lt;a href=&quot;https://github.com/mirage/ocaml-git/issues&quot;&gt;send us&lt;/a&gt; your feedback!&lt;/p&gt;</content><id>https://tarides.com/blog/2018-10-19-ocaml-git-2-0</id><title type="text">ocaml-git 2.0</title><updated>2018-10-19T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2018-10-17-ocamlformat-0-8" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;We are proud to announce the release of OCamlFormat 0.8 (available on opam). To ease the transition from the previous 0.7 release here are some highlights of the new features of this release. The &lt;a href=&quot;https://github.com/ocaml-ppx/ocamlformat/blob/v0.8/CHANGES.md#08-2018-10-09&quot;&gt;full changelog&lt;/a&gt; is available on the project repository.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#precedence-of-options&quot; aria-label=&quot;precedence of options permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Precedence of options&lt;/h1&gt;
&lt;p&gt;In the previous version you could override command line options with &lt;code&gt;.ocamlformat&lt;/code&gt; files configuration. 0.8 fixed this so that the OCamlFormat configuration is first established by reading &lt;code&gt;.ocamlformat&lt;/code&gt; and &lt;code&gt;.ocp-indent&lt;/code&gt; files:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;margin = 77
wrap-comments = true&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By default, these files in current and all ancestor directories for each input file are used, as well as the global configuration defined in &lt;code&gt;$XDG_CONFIG_HOME/ocamlformat&lt;/code&gt;. The global &lt;code&gt;$XDG_CONFIG_HOME/ocamlformat&lt;/code&gt; configuration has the lowest priority, then the closer the directory is to the processed file, the higher the priority. In each directory, both &lt;code&gt;.ocamlformat&lt;/code&gt; and &lt;code&gt;.ocp-indent&lt;/code&gt; files are read, with &lt;code&gt;.ocamlformat&lt;/code&gt; files having the higher priority.&lt;/p&gt;
&lt;p&gt;For now &lt;code&gt;ocp-indent&lt;/code&gt; options support is very partial and is expected to be extended in the future.&lt;/p&gt;
&lt;p&gt;Then the parameters can be overriden with the &lt;code&gt;OCAMLFORMAT&lt;/code&gt; environment variable:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;OCAMLFORMAT=field-space=tight,type-decl=compact&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and finally the parameters can be overriden again with the command lines parameters.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#reading-input-from-stdin&quot; aria-label=&quot;reading input from stdin permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reading input from stdin&lt;/h1&gt;
&lt;p&gt;It is now possible to read the input from stdin instead of OCaml files. The following command invokes OCamlFormat that reads its input from the pipe:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;echo &amp;quot;let f x = x + 1&amp;quot; | ocamlformat --name a.ml -&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;-&lt;/code&gt; on the command line indicates that &lt;code&gt;ocamlformat&lt;/code&gt; should read from stdin instead of expecting input files. It is then necessary to use the &lt;code&gt;--name&lt;/code&gt; option to designate the input (&lt;code&gt;a.ml&lt;/code&gt; here).&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#preset-profiles&quot; aria-label=&quot;preset profiles permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Preset profiles&lt;/h1&gt;
&lt;p&gt;Preset profiles allow you to have a consistent configuration without needing to tune every option.&lt;/p&gt;
&lt;p&gt;Preset profiles set all options, overriding lower priority configuration. A preset profile can be set using the &lt;code&gt;--profile&lt;/code&gt; (or &lt;code&gt;-p&lt;/code&gt;) option. You can pass the option &lt;code&gt;--profile=&amp;lt;name&amp;gt;&lt;/code&gt; on the command line or add &lt;code&gt;profile = &amp;lt;name&amp;gt;&lt;/code&gt; in an &lt;code&gt;.ocamlformat&lt;/code&gt; configuration file.&lt;/p&gt;
&lt;p&gt;The available profiles are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;default&lt;/code&gt; sets each option to its default value&lt;/li&gt;
&lt;li&gt;&lt;code&gt;compact&lt;/code&gt; sets options for a generally compact code style&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sparse&lt;/code&gt; sets options for a generally sparse code style&lt;/li&gt;
&lt;li&gt;&lt;code&gt;janestreet&lt;/code&gt; is the profile used at JaneStreet&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To get a better feel of it, here is the formatting of the &lt;a href=&quot;https://github.com/ocaml/ocaml/blob/trunk/typing/env.ml#L227-L234&quot;&gt;&lt;code&gt;mk_callback&lt;/code&gt;&lt;/a&gt; function from the OCaml compiler with the &lt;code&gt;compact&lt;/code&gt; profile:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let mk_callback rest name desc = function
  | None -&amp;gt; nothing
  | Some f -&amp;gt; (
      fun () -&amp;gt;
        match rest with
        | [] -&amp;gt; f name None
        | (hidden, _) :: _ -&amp;gt; f name (Some (desc, hidden)) )&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;then the same function formatted with the &lt;code&gt;sparse&lt;/code&gt; profile:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let mk_callback rest name desc = function
  | None -&amp;gt;
      nothing
  | Some f -&amp;gt;
      fun () -&amp;gt;
        ( match rest with
        | [] -&amp;gt;
            f name None
        | (hidden, _) :: _ -&amp;gt;
            f name (Some (desc, hidden)) )&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#project-root&quot; aria-label=&quot;project root permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Project root&lt;/h1&gt;
&lt;p&gt;The project root of an input file is taken to be the nearest ancestor directory that contains a &lt;code&gt;.git&lt;/code&gt; or &lt;code&gt;.hg&lt;/code&gt; or &lt;code&gt;dune-project&lt;/code&gt; file.
If the new option &lt;code&gt;--disable-outside-detected-project&lt;/code&gt; is set, &lt;code&gt;.ocamlformat&lt;/code&gt; configuration files are not read outside of the current project. If no configuration file is found, formatting is disabled.&lt;/p&gt;
&lt;p&gt;A new option, &lt;code&gt;--root&lt;/code&gt; allows to specify the root directory for a project. If specified, OCamlFormat only takes into account &lt;code&gt;.ocamlformat&lt;/code&gt; configuration files inside the root directory and its subdirectories.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#credits&quot; aria-label=&quot;credits permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Credits&lt;/h1&gt;
&lt;p&gt;This release also contains many other changes and bug fixes that we cannot detail here. Check out the &lt;a href=&quot;https://github.com/ocaml-ppx/ocamlformat/blob/v0.8/CHANGES.md#08-2018-10-09&quot;&gt;full changelog&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Special thanks to our maintainers and contributors for this release: David Allsopp, Josh Berdine, Hugo Heuzard, Brandon Kase, Anil Madhavapeddy and Guillaume Petiot.&lt;/p&gt;</content><id>https://tarides.com/blog/2018-10-17-ocamlformat-0-8</id><title type="text">OCamlFormat 0.8</title><updated>2018-10-17T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://icfp18.sigplan.org/track/ocaml-2018-papers#program" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;The OCaml Users and Developers Workshop brings together industrial
users of OCaml with academics and hackers who are working on extending
the language, type system and tools. OCaml 2018 was held on September
27th, 2018 in St. Louis, Missouri, USA, colocated with ICFP 2018.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Check Tarides' talks: &lt;a href=&quot;https://docs.google.com/presentation/d/e/2PACX-1vRnRiGeBWC6ctpSge0gTFuxprNTiS2qtNpvax_A8pD6Ob5ySfL9_SlPKCIoLDCbmsYjTAkMFnlUwqSl/pub?start=false&amp;amp;loop=false&amp;amp;delayms=3000&amp;amp;slide=id.p1&quot;&gt;RFCs, all the way down!&lt;/a&gt; and &lt;a href=&quot;https://speakerdeck.com/avsm/the-ocaml-platform-1-dot-0-2018&quot;&gt;The OCaml Platform 1.0&lt;/a&gt;.
&lt;/strong&gt;&lt;/p&gt;</content><id>https://icfp18.sigplan.org/track/ocaml-2018-papers#program</id><title type="text">OCaml Workshop 2018</title><updated>2018-09-27T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tarides.com/blog/2018-09-06-dune-1-2-0" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;After a tiny but important patch release as 1.1.1, the dune team is thrilled to
announce the release of dune 1.2.0! Here are some highlights of the new
features in that version. The full list of changes can be found &lt;a href=&quot;https://github.com/ocaml/dune/blob/e3af33b43a87d7fa2d15f7b41d8bd942302742ec/CHANGES.md#120-14092018&quot;&gt;in the dune
repository&lt;/a&gt;.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#watch-mode&quot; aria-label=&quot;watch mode permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Watch mode&lt;/h1&gt;
&lt;p&gt;When developing, it is common to edit a file, run a build, read the error
message, and fix the error. Since this is a very tight loop and developers are
doing this hundreds or thousands times a day, it is crucial to have the
quickest feedback possible.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;dune build&lt;/code&gt; and &lt;code&gt;dune runtest&lt;/code&gt; now accept &lt;a href=&quot;https://dune.readthedocs.io/en/latest/usage.html#watch-mode&quot;&gt;a &lt;code&gt;-w&lt;/code&gt;
flag&lt;/a&gt; that will
watch the filesystem for changes, and trigger a new build.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#better-error-messages&quot; aria-label=&quot;better error messages permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Better error messages&lt;/h1&gt;
&lt;p&gt;Inspired by the great work done in
&lt;a href=&quot;http://elm-lang.org/blog/compiler-errors-for-humans&quot;&gt;Elm&lt;/a&gt; and
&lt;a href=&quot;https://reasonml.github.io/blog/2017/08/25/way-nicer-error-messages.html&quot;&gt;bucklescript&lt;/a&gt;,
dune now displays the relevant file in error messages.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt; % cat dune
(executable
 (name my_program)
 (librarys cmdliner)
)
 % dune build
File &amp;quot;dune&amp;quot;, line 3, characters 2-10:
3 |  (librarys cmdliner)
      ^^^^^^^^
Error: Unknown field librarys
Hint: did you mean libraries?&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Many messages have also been improved, in particular to help users &lt;a href=&quot;https://dune.readthedocs.io/en/latest/migration.html#check-list&quot;&gt;switching
from the &lt;code&gt;jbuild&lt;/code&gt; format to the &lt;code&gt;dune&lt;/code&gt;
format&lt;/a&gt;.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#dune-unstable-fmt&quot; aria-label=&quot;dune unstable fmt permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;dune unstable-fmt&lt;/h1&gt;
&lt;p&gt;Are you confused about how to format S-expressions? You are not alone.
That is why we are gradually introducing a formatter for &lt;code&gt;dune&lt;/code&gt; files. It can
transform a valid but ugly &lt;code&gt;dune&lt;/code&gt; into one that is consistently formatted.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt; % cat dune
(executable( name ls) (libraries cmdliner)
(preprocess (pps ppx_deriving.std)))
 % dune unstable-fmt dune
(executable
 (name ls)
 (libraries cmdliner)
 (preprocess
  (pps ppx_deriving.std)
 )
)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This feature is not ready yet for the end user (hence the &lt;code&gt;unstable&lt;/code&gt; part),
and in particular the concrete syntax is not stable yet.
But having it already in the code base will make it possible to build useful
integrations with &lt;code&gt;dune&lt;/code&gt; itself (to automatically reformat all dune files in a
project, for example) and common editors, so that they format &lt;code&gt;dune&lt;/code&gt; files on
save.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#first-class-support-of-findlib-plugins&quot; aria-label=&quot;first class support of findlib plugins permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;First class support of findlib plugins&lt;/h1&gt;
&lt;p&gt;It is now easy to support findlib plugins by just adding the &lt;code&gt;findlib.dynload&lt;/code&gt;
library dependency. Then you can use &lt;code&gt;Fl_dynload&lt;/code&gt; module in your code which
will automatically do the right thing. &lt;a href=&quot;https://dune.readthedocs.io/en/latest/advanced-topics.html#dynamic-loading-of-packages&quot;&gt;A complete example can be found in the
dune manual&lt;/a&gt;.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#promote-only-certain-files&quot; aria-label=&quot;promote only certain files permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Promote only certain files&lt;/h1&gt;
&lt;p&gt;The &lt;code&gt;dune promote&lt;/code&gt; command now accept a list of files. This is useful to
promote just the file that is opened in a text editor for example. Some emacs
bindings are provided to do this, which works particularly well with
&lt;a href=&quot;https://dune.readthedocs.io/en/latest/tests.html#inline-expectation-tests&quot;&gt;inline expectation tests&lt;/a&gt;.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#deprecation-message-for-wrapped-modes&quot; aria-label=&quot;deprecation message for wrapped modes permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Deprecation message for (wrapped) modes&lt;/h1&gt;
&lt;p&gt;By default, libraries are &lt;code&gt;(wrapped true)&lt;/code&gt;, which means that they expose a
single OCaml module (source files are exposed as submodules of this main
module). This is usually desired as it makes link-time name collisions less
likely. However, a lot of libraries are using &lt;code&gt;(wrapped false)&lt;/code&gt; (expose all
source files as modules) to keep compatibility.&lt;/p&gt;
&lt;p&gt;It can be challenging to transition from &lt;code&gt;(wrapped false)&lt;/code&gt; to &lt;code&gt;(wrapped true)&lt;/code&gt;
because it breaks compatibility. That is why we have added &lt;code&gt;(wrapped (transition &amp;quot;message&amp;quot;))&lt;/code&gt; which will generate wrapped modules but keep unwrapped
modules with a deprecation message to help coordinate the change.&lt;/p&gt;
&lt;h1 style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;https://tarides.com/feed.xml#credits&quot; aria-label=&quot;credits permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Credits&lt;/h1&gt;
&lt;p&gt;Special thanks to our contributors for this release: @aantron, @anuragsoni,
@bobot, @ddickstein, @dra27, @drjdn, @hongchangwu, @khady, @kodek16,
@prometheansacrifice and @ryyppy.&lt;/p&gt;</content><id>https://tarides.com/blog/2018-09-06-dune-1-2-0</id><title type="text">Dune 1.2.0</title><updated>2018-09-06T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://stationf.co/" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;We are thrilled to have been accepted into the Founders Progam's 3rd
batch at &lt;a href=&quot;https://stationf.co/&quot;&gt;Station F&lt;/a&gt;! Station F is
&amp;quot;the only startup campus gathering a whole entrepreneurial ecosystem
under one roof&amp;quot; and is providing 3000+ desks and 26 international
startup programs. Our Paris offices are now located in that incredible
place, close to &amp;quot;m&amp;eacute;tro Chevaleret&amp;quot; (Paris 13).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;If you are in Paris, drop us an email to visit
&lt;a href=&quot;%20https://stationf.co/campus/&quot;&gt;our beautiful campus&lt;/a&gt;!&lt;/strong&gt;&lt;/p&gt;</content><id>https://stationf.co/</id><title type="text">Station F</title><updated>2018-07-17T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://tezos.foundation" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;We are excited to announce that the &lt;a href=&quot;https://tezos.foundation&quot;&gt;Tezos Foundation&lt;/a&gt;
will trust Tarides to package Tezos nodes as MirageOS unikernel, which will help participants
establish nodes on the Tezos network in a more efficient and secure manner.&lt;/p&gt;</content><id>https://tezos.foundation/</id><title type="text">MirageOS + Tezos funding</title><updated>2018-05-23T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://www.meetup.com/ocaml-paris/events/250836568/" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Thomas Gazagnaire gave a presentation on MirageOS to the
&lt;a href=&quot;https://www.meetup.com/ocaml-paris/&quot;&gt;OCaml meetup in Paris&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Check the &lt;a href=&quot;http://gazagnaire.org/pub/2018.05.OUPS.pdf&quot;&gt;slides&lt;/a&gt;
for more details.&lt;/strong&gt;&lt;/p&gt;</content><id>https://www.meetup.com/ocaml-paris/events/250836568/</id><title type="text">OCaml Users in Paris (OUPS)</title><updated>2018-05-23T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="https://discuss.ocaml.org/t/irmin-usability-enhancements/2017" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Zach Shipko is working on improving the UI/UX for Irmin.
He is looking for &lt;a href=&quot;https://discuss.ocaml.org/t/irmin-usability-enhancements/2017&quot;&gt;feedback&lt;/a&gt;
to make Irmin more accessible to potential users and clean up the rough edges for existing users.&lt;/p&gt;</content><id>https://discuss.ocaml.org/t/irmin-usability-enhancements/2017</id><title type="text">Irmin usability enhancements</title><updated>2018-05-18T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="http://www.di.ens.fr/~pouzet/cours/systeme/" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Thomas Gazagnaire gave an invited lecture at
&lt;a href=&quot;http://www.di.ens.fr/&quot;&gt;the computer science department of ENS&lt;/a&gt;,
in Paris. This was part of the system and network L3 course.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Check the &lt;a href=&quot;http://gazagnaire.org/ens/mirage.pdf&quot;&gt;slides&lt;/a&gt; (in english)
and the &lt;a href=&quot;http://gazagnaire.org/ens/mirage.tar.gz&quot;&gt;exercices&lt;/a&gt; (in french).&lt;/strong&gt;&lt;/p&gt;</content><id>http://www.di.ens.fr/~pouzet/cours/systeme/</id><title type="text">Invited lecture at ENS</title><updated>2018-05-17T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="http://infocom2018.ieee-infocom.org/content/workshop-hotpost-hot-topics-pervasive-mobile-and-online-social-networking-program" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Anil Madhavapeddy and Gemma Gordon presented our new operating system for
connected buildings: &lt;a href=&quot;http://kcsrk.info/papers/osmose_feb_18.pdf&quot;&gt;OSMOSE&lt;/a&gt;
to &lt;a href=&quot;http://hotpost18.weebly.com/&quot;&gt;HotPOST&amp;rsquo;18&lt;/a&gt;. OSMOSE is based on
MirageOS and Irmin and we hope to explore that area more in the coming months!&lt;/p&gt;</content><id>http://infocom2018.ieee-infocom.org/content/workshop-hotpost-hot-topics-pervasive-mobile-and-online-social-networking-program</id><title type="text">HotPOST'18</title><updated>2018-04-16T00:00:00-00:00</updated><author><name>tarides</name></author></entry><entry><link href="http://kcsrk.info/papers/osmose_feb_18.pdf" rel="alternate"/><contributor><uri>https://tarides.com/feed.xml</uri><name>tarides</name></contributor><content type="html">&lt;p&gt;Position paper on
&lt;a href=&quot;http://kcsrk.info/papers/osmose_feb_18.pdf&quot;&gt;&amp;ldquo;An Architecture for Interspatial Communication&amp;rdquo;&lt;/a&gt;
accepted to &lt;a href=&quot;http://hotpost18.weebly.com/&quot;&gt;HotPOST&amp;rsquo;18&lt;/a&gt;.&lt;/p&gt;</content><id>http://kcsrk.info/papers/osmose_feb_18.pdf</id><title type="text">An Architecture for Interspatial Communication</title><updated>2018-02-14T00:00:00-00:00</updated><author><name>tarides</name></author></entry></feed>