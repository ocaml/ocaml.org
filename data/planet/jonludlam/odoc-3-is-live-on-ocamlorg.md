---
title: Odoc 3 is live on OCaml.org!
description:
url: https://jon.recoil.org/blog/2025/07/odoc-3-live-on-ocaml-org.html
date: 2025-07-14T00:00:00-00:00
preview_image:
authors:
- Jon Ludlam
source:
ignore:
---

<section><h1><a href="https://jon.recoil.org/atom.xml#odoc-3-is-live-on-ocaml.org!" class="anchor"></a>Odoc 3 is live on OCaml.org!</h1><ul class="at-tags"><li class="published"><span class="at-tag">published</span> <p>2025-07-14</p></li></ul><p>As of today, Odoc 3 is now live on OCaml.org! This is a major update to odoc, and has brought a whole host of new features and improvements to the documentation pages.</p><p>Some of the highlights include:</p><ul><li>Source code rendering</li><li>Hierarchical manual pages</li><li>Image, video and audio support</li><li>Separation of API docs by library</li></ul><p>A huge amount of work went into the <a href="https://discuss.ocaml.org/t/ann-odoc-3-0-released/16339">Odoc 3.0 release</a>, and I'd like to thank my colleagues at Tarides, in particular <a href="https://github.com/panglesd">Paul-Elliot</a> and <a href="https://github.com/julow/">Jules</a> for the work they put into this.</p><p>But the odoc release happened months ago, so why is it only going live now? So, the doc tool itself is only one small part of getting the docs onto ocaml.org. Odoc works on the <a href="https://discuss.ocaml.org/t/cmt-cmti-question/5308">cmt and cmti</a> files that are produced during the build process, and so part of the process of building docs is to build the packages, so we have to, at minimum, attempt to build all 17,000 or so distinct versions of the packages in opam-repository. The <a href="https://github.com/ocurrent">ocurrent</a> tool <a href="https://github.com/ocurrent/ocaml-docs-ci">ocaml-docs-ci</a>, which I've previously <a href="https://jon.recoil.org/05/docs-progress.html" title="docs-progress">written</a> <a href="https://jon.recoil.org/04/ocaml-docs-ci-and-odoc-3.html" title="ocaml-docs-ci-and-odoc-3">about</a>, is responsible for these builds and in this new release has demonstrated a new approach to this task, where we attempt to do the build in as efficient a way as possible by effectively building binary packages once for each required package in a specific 'universe' of dependencies. For example, many packages require e.g. <a href="https://erratique.ch/software/cmdliner">cmdliner.1.3.0</a> to build, and some require a specific version of OCaml too. So we'll build cmdliner.1.3.0 once against each version of OCaml required -- but <i>only once</i>, which is in contrast to how some of the other tools in the ocurrent suite work, e.g. <a href="https://github.com/ocurrent/opam-repo-ci">opam-repo-ci</a>. Once the packages are built, we then run the new tool <a href="https://ocaml.github.io/odoc/odoc-driver/index.html">odoc_driver</a> to actually build the HTML docs. In addition to this, a new feature of Odoc 3 is to be able to link to packages that are your direct dependencies - so for example, the docs of odoc contain links to the docs of odoc_driver, even though odoc_driver depends upon odoc. This, whilst sounding easy enough, required some radical changes in the docs ci, which I promise I will write about later!</p><p>The builds and the generation of the docs is all done on a single blade server, called <a href="https://sage.caelum.ci.dev">sage</a> with 40 threads, 2 8TiB spinning drives and a 1.8TiB SSD cache, and it produces about 1 TiB of data over the course of a couple of days. The changes required to this part of the process since odoc 2.x were primarily myself and <a href="https://tunbury.org">Mark Elvers</a></p><p>Once the docs are built, how do they get onto ocaml.org? Odoc itself knows nothing about the layout and styling of ocaml.org, so the HTML it produces isn't suitable to be just rendered when a user requests particular docs. What happens is that odoc produces, as well as a self-contained HTML file, a json file with the body of the page, the sidebars, the breadcrumbs and so on as structured data, one per HTML page, which are then served from sage over HTTP. When a user requests a particular docs page, the ocaml.org server will request that json file from sage, then render this with the ocaml.org styling, then send it back to the user.</p><p>As odoc 3 moved a fair bit of logic from ocaml.org into odoc itself, there were quite a few changes that needed to be made to the ocaml.org server to integrate this into the site. This work was mostly done by <a href="https://github.com/panglesd">Paul-Elliot</a> and myself, with a lot of help from the <a href="https://github.com/ocaml/ocaml.org?tab=readme-ov-file#maintainers">ocaml.org team</a>, in particular <a href="https://jon.recoil.org/atom.xml">Sabine Schmaltz</a> and <a href="https://github.com/cuihtlauac">Cuihtlauac Alvarado</a>.</p><p>So, quite a lot of integration and infrastructure work was required to get the new docs site up and running, and I'm very happy to see this particular task concluded!</p></section><p>Continue reading <a href="https://jon.recoil.org/blog/2025/07/odoc-3-live-on-ocaml-org.html">here</a></p>
