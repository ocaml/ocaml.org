---
title: 'Sandmark: Boosting Multicore Projects with Performance Benchmarking'
description: "Introduction In the realm of software development, continuous improvement
  is paramount. When it comes to Multicore projects, the need for\u2026"
url: https://tarides.com/blog/2023-07-19-sandmark-boosting-multicore-projects-with-performance-benchmarking
date: 2023-07-19T00:00:00-00:00
preview_image: https://tarides.com/static/0b47a4b3a13a66551f3822644c95fd12/2070e/sandmark.jpg
authors:
- Tarides
source:
---

<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#introduction" aria-label="introduction permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h3>
<p>In the realm of software development, continuous improvement is paramount. When it comes to Multicore projects, the need for thorough benchmarking becomes even more critical. This is where <a href="https://github.com/ocaml-bench/sandmark">Sandmark</a> comes into play. Sandmark, developed for the OCaml programming language, has proven to be an invaluable tool for optimising performance and aiding in upstreaming efforts. In this blog post, we will explore the benefits of using Sandmark and its role in the development of Multicore projects.</p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#enhancing-upstreaming-efforts" aria-label="enhancing upstreaming efforts permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Enhancing Upstreaming Efforts</h3>
<p>Sandmark has been extensively used in Multicore projects to assist with upstreaming. Its impact can be witnessed in the OCaml community, where it helped demonstrate that sequential programs running on OCaml 5 performed nearly as efficiently as those running on OCaml 4. For instance, the results achieved in the <a href="https://github.com/ocaml/ocaml/pull/10831">Multicore PR (pull request)</a> merge were accomplished using Sandmark. Additionally, the findings presented in <a href="https://kcsrk.info/papers/retro-parallel_icfp_20.pdf">the ICFP'20 paper</a> were all obtained through the utilisation of Sandmark. This tool has played a crucial role in showcasing the progress made tracking performance regressions in the OCaml compiler.</p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#ongoing-compiler-development" aria-label="ongoing compiler development permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ongoing Compiler Development</h3>
<p>Even after the Multicore merge, Sandmark remains actively employed with a <a href="https://sandmark.tarides.com/">dashboard</a> for the compiler development. Its significance is evident in the multitude of pull requests related to Sandmark in the OCaml repository. For example, consider the <a href="https://github.com/ocaml/ocaml/issues/11589">issue #11589</a>, where an idle processing domain slows down major garbage collection (GC) cycles. The comparison of parallel benchmarks between the fix in the PR and the current development version of the compiler in the illustration shows the speedup comparisons. This highlights the continued reliance on Sandmark as a vital tool in the compiler development process.</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <a href="https://tarides.com/static/b88afc8641047a24afdc28a2a1a36f47/95e59/sandmark1.png" class="gatsby-resp-image-link" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 139.41176470588235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAAAsTAAALEwEAmpwYAAACa0lEQVR42pWV647qMAyEef8HRbtQ2ubmxLl0jsYFfqyQTqhkNSV0Yn8Zp5dSCty+wzuHGCNSSnDOIYRgd4b33qLWiv9dl2VZcByHRUwRrbX3JMc2NwZGU8xcl/v9jqIFIXhULafIGGgqqJqhWRCjR9Y6J8iSt3WBiEC1QqKHW+9IMSCLILodOeepct+C5BXCyY8vcxxDtDEX4jwXmC6ZnHAM9FafDA/kFGwBXr1mi2lB/rnmYLzIsYqHFEVtDb3E6Q0xQdWC6LaTkzZE76y8UhQlCyQ4JOM7ucsUov9iTIjBGzN6jtw4RzF6kRv3FcPRCjR/9mEt0fhOCT4eD+N0dMXgy6o4RrPguOWA3us8w1KyeS0lgUiGxICwLQj7A0WSPXO3PzF8dZi55CVIfsF6WBC8M25RTnGWnJ8+lRTnMrzdbicvFeTkPzLsmk4v9mGZMrgwcYktLvbM3y/ruhqnF8NWybBi1IRa5Mn3ZJizgJvIYCI/Pz8W1+sV23Za71KrIkWPmLhKsQ7x62KHBfmyVB8idLaXmS77WZ7m5SEg7OGc0Wq1bhFhyWVO8Pf39/0weGz9YThGRytfCO77bkIfBWtFLwHH6PM+7L2bzyhMqBRk69FOFOTdOW9YpgRP0xZoURPjAuT4GlNUS3lX8TVDivz14TfXhSeJZp7UCVmSZUdhBsdc4PU8Jcgs3Lpgud+wbwuSMXNvpvaZdW7+m8INaL3b8ZTC/szwQH9m+MputnRjePQGlfDeCLDVWkbTjO8IApfgPXLYMJhlH4h+x7Zv2HxESGLG/pqhpAQeEvQc228nwyc3tiTnyHNG8B/GKJpQsvBIWAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"></span>
  <img src="https://tarides.com/static/b88afc8641047a24afdc28a2a1a36f47/c5bb3/sandmark1.png" class="gatsby-resp-image-image" alt="Speed Comparisons" title="" srcset="/static/b88afc8641047a24afdc28a2a1a36f47/04472/sandmark1.png 170w,
/static/b88afc8641047a24afdc28a2a1a36f47/9f933/sandmark1.png 340w,
/static/b88afc8641047a24afdc28a2a1a36f47/c5bb3/sandmark1.png 680w,
/static/b88afc8641047a24afdc28a2a1a36f47/b12f7/sandmark1.png 1020w,
/static/b88afc8641047a24afdc28a2a1a36f47/b5a09/sandmark1.png 1360w,
/static/b88afc8641047a24afdc28a2a1a36f47/95e59/sandmark1.png 1460w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async"/>
  </a>
    </span></p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#nightly-benchmarking" aria-label="nightly benchmarking permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Nightly Benchmarking</h3>
<p>One of the key aspects of Sandmark is its nightly benchmarking feature. Sandmark ensures that benchmarks are run regularly on diverse x86 servers, namely Turing (Intel Xeon Gold with 56 cores) and Navajo (AMD EPYC 7551 with 128 cores). This practice serves as a proactive measure to continuously identify and address performance regressions promptly. The nightly runs cover both sequential and parallel benchmarks, providing comprehensive insights into the program's behaviour under different scenarios for different inputs.</p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#sandmark-nightly-config" aria-label="sandmark nightly config permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sandmark Nightly Config</h3>
<p>To simplify the process of requesting development branches for nightly benchmarking, Sandmark offers a convenient service called <a href="https://github.com/ocaml-bench/sandmark-nightly-config">&quot;Sandmark Nightly Config&quot;</a>. This service streamlines simplifies the configuration setup for benchmarking, thereby reducing the steps required to initiate the benchmark runs. Compiler developers only need to provide their development branch URL for the configuration, and the nightly service will execute both the sequential and parallel benchmarks. By automating this process, developers can focus on their core tasks while still benefiting from gaining insights from the regular benchmark runsing insights.</p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#permalinks-for-easy-sharing-and-discussion" aria-label="permalinks for easy sharing and discussion permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Permalinks for Easy Sharing and Discussion</h3>
<p>A remarkable feature of Sandmark is the provision of permalinks. These permalinks enable users to easily share benchmark results and engage in meaningful discussions. You can specify more than two development branches across dates, and even different hosts for comparison. This capability is a game-changer for collaborative development, as it facilitates efficient communication and fosters a deeper understanding of the pull request changes using the benchmarking outcomes. The permalinks in Sandmark allow for specific results to be referenced and examined in detail.</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <a href="https://tarides.com/static/9edc683cbfcced150fcd016fa8ab28d9/e4900/sandmark2.png" class="gatsby-resp-image-link" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 69.41176470588235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhElEQVR42pWTWY/cIAyA+f//rjtHun2bZmYTjhAgGLCdoyKRtjMPW22tTw4OOPGBxcdHdzpfL8376Xw9na4/3s7nS/N2ujQ/fzXNewRgZvpChHPu3j7a9t718vHoul5KqfpeKmW0Nsy8fS1iHMfb7XfXy7a9325tKWX7togYwbkQQsSCiMQ881yZ5+UfcD2xiAjZTylMKSPnwinjM/Bq/n2fSsoosvcQJgAgomVZtv8RAbszz0tKmYjXdXsGkZZl3baN90A/3Y5dAakY67UZB+tjKpDwIEKNzYeotI1QIBWlrVRWVj0Y62vYMUKERDwTz/zKPC+Qcil4mIWYnqgFg5TN4PTglBn379Hrn0GbMUJJmVwAH8CF6APUAmcS1tquk237kFLd71Wv6/rdgqWc055bCHGKNUxIuaYwLweItX+f5sFRRcFEiBSmOE1RaeND0HpQyvRSS6WlMs6FcXTaWGPsvhicD0dTxdFeImZmRGSqer9tWEp91MHAOgYF8ZgHRDyc/wClOCitI5hhtwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"></span>
  <img src="https://tarides.com/static/9edc683cbfcced150fcd016fa8ab28d9/c5bb3/sandmark2.png" class="gatsby-resp-image-image" alt="Benchmarks" title="" srcset="/static/9edc683cbfcced150fcd016fa8ab28d9/04472/sandmark2.png 170w,
/static/9edc683cbfcced150fcd016fa8ab28d9/9f933/sandmark2.png 340w,
/static/9edc683cbfcced150fcd016fa8ab28d9/c5bb3/sandmark2.png 680w,
/static/9edc683cbfcced150fcd016fa8ab28d9/e4900/sandmark2.png 988w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async"/>
  </a>
    </span></p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#importance-of-perfstat-output" aria-label="importance of perfstat output permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Importance of Perfstat Output</h3>
<p>Sandmark offers perfstat output, which plays a vital role in accurately evaluating program performance. Modern machines exhibit varying raw running times due to their complex nature. However, &ldquo;instructions retired&rdquo; provide a more stable and reliable metric, especially when assessing the impact of compiler optimisations. This feature ensures that performance analysis is based on consistent and meaningful measurements.</p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#looking-towards-the-future" aria-label="looking towards the future permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Looking Towards the Future</h3>
<p>Sandmark continues to evolve, with ongoing developments in the Multicore release. The efforts put into enhancing Sandmark reflect the commitment to improving Multicore programming in OCaml. As the OCaml community pushes the boundaries of Multicore development, Sandmark will undoubtedly play a crucial role in optimising performance, tracking regressions, and ensuring the stability of the language.</p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#conclusion" aria-label="conclusion permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h3>
<p>Sandmark has emerged as an indispensable tool for the OCaml community, particularly in the realm of Multicore projects. Its ability to benchmark performance, catch regressions, simplify configuration, and facilitate discussions through permalinks has greatly contributed to the OCaml compiler development process. The commitment to ongoing improvements and enhancements will help measure, monitor and track the compiler development as the OCaml language evolves. We encourage you to try the above services, and share any feedback or file new feature requests or GitHub issues for the Sandmark project.</p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#references" aria-label="references permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>References</h3>
<ul>
<li>Sandmark. <a href="https://github.com/ocaml-bench/sandmark">https://github.com/ocaml-bench/sandmark</a></li>
<li>Multicore OCaml PR merge. <a href="https://github.com/ocaml/ocaml/pull/10831">https://github.com/ocaml/ocaml/pull/10831</a></li>
<li>Retrofitting Parallelism onto OCaml. <a href="https://kcsrk.info/papers/retro-parallel_icfp_20.pdf">https://kcsrk.info/papers/retro-parallel_icfp_20.pdf</a></li>
<li>Sandmark Dashboard. <a href="https://sandmark.tarides.com/">https://sandmark.tarides.com/</a></li>
<li>Idle Domain Slows Down GC Cycles. <a href="https://github.com/ocaml/ocaml/issues/11589">https://github.com/ocaml/ocaml/issues/11589</a></li>
<li>Sandmark-nightly-config. <a href="https://github.com/ocaml-bench/sandmark-nightly-config">https://github.com/ocaml-bench/sandmark-nightly-config</a></li>
</ul>
