---
title: What are Data Races? And do They Threaten Your Business?
description: "Imagine you have a brand-new coffee machine. One morning, you traipse
  excitedly down the stairs only to discover that, alas, your appliance\u2026"
url: https://tarides.com/blog/2024-01-17-what-are-data-races-and-do-they-threaten-your-business
date: 2024-01-17T00:00:00-00:00
preview_image: https://tarides.com/static/7a1f116c59d462b95296e8d7770a69a2/d0eb8/dataracehurdle.png
featured:
authors:
- Tarides
source:
---

<p>Imagine you have a brand-new coffee machine. One morning, you traipse excitedly down the stairs only to discover that, alas, your appliance has turned into a potato. The next day, it turns back into a coffee machine.</p>
<p>And so it continues: on some days, it dispenses you perfect, frothy coffee; on other days, it dispenses Coca-Cola; and on some days, it doggedly persists with being a root vegetable. Overall, how satisfied would you be with your new coffee machine? Sure, sometimes the beverage you receive is perfect, but you can never be confident about what you will get.</p>
<p>Software users, just like coffee drinkers, value reliability. Your product could be excellent, but its value quickly diminishes if you can&rsquo;t guarantee that it will meet your users&rsquo; expectations every time. This uncertainty is what data races do to code. Data races are a type of bug that introduces unpredictability into software programs, with potentially dire effects if not eliminated.</p>
<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#what-is-a-data-race" aria-label="what is a data race permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What is a Data Race?</h2>
<p>The term &lsquo;<a href="https://coderrect.com/data-races-what-are-they-and-why-are-they-evil-part-1/#:~:text=So,%20in%20contrast%20to%20a,so%20it%20is%20a%20BUG">data race</a>&rsquo; describes a problem that can occur in programs that use multiple threads (also known as parallel programming). Multiple threads allow several operations to be performed simultaneously, significantly boosting the performance of programs, applications, and software.</p>
<p>Parallel programming introduces complexity that needs to be skillfully managed to ensure it does not have negative implications. For example, say two operations are happening simultaneously. If two threads try to write to the same memory location in parallel (and there are no rules that manage the event), there is no telling which access might be recorded, if any, or which might be dropped and why.</p>
<p>This is what a data race looks like. Formally, a data race occurs when two conflicting memory accesses are accessing the same piece of memory, are performed concurrently, at least one is a <code>write</code>, and both are ungoverned by synchronisation or locks.</p>
<p>If code allows data races to occur, it introduces an element of randomness that can make programs act unpredictably. Critically, problems caused by data races are not deterministic &ndash; you can have your program crash upon launch one day and start-up seemingly normally on the next. This randomness makes it hard for developers to debug data races and frustrating for the end users who cannot predict the behaviour of the software they&rsquo;re using.</p>
<p>In languages such as C, C++, Go, and unsafe Rust, this unpredictability causes crashes, memory corruption, and a variety of strange behaviours by the program. Importantly, this is <strong>not</strong> the case in OCaml.</p>
<p>In practice, data races undermine the trustworthiness of programs and data. Tech-savvy users may call the reliability of a program into question for even allowing data races &ndash; this happened in 2020 when the <a href="https://coderrect.com/data-races-what-are-they-and-why-are-they-evil-part-1/">accuracy of Covid-19 simulation software</a> was debated online due to the suspected presence of data races in the code. Even users who are unaware of what data races are notice their effects, such as random crashes and unexpected behaviours, which damage their perception of the program.</p>
<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#how-we-help-our-partners-avoid-the-perils-of-data-races" aria-label="how we help our partners avoid the perils of data races permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How we Help Our Partners Avoid the Perils of Data Races</h2>
<p>Now that you know what data races are and why they are undesirable let me tell you how Tarides manages the risks of data races and helps our partners avoid their pitfalls.</p>
<p>We use the programming language <a href="https://ocaml.org/">OCaml</a> to power our solutions. There are many reasons why we have chosen to use OCaml, one of the most significant ones being its <a href="https://tarides.com/blog/2023-07-05-zero-day-attacks-what-are-they-and-can-a-language-like-ocaml-protect-you/">strong safety guarantees</a>. The language is type- and memory- safe, avoiding the security vulnerabilities that would otherwise occur as a result of <a href="https://tarides.com/blog/2023-08-17-your-programming-language-and-its-impact-on-the-cybersecurity-of-your-application/">memory safety issues</a>. OCaml&rsquo;s expressive type system also catches many bugs for the developer at compile time, making debugging easier.</p>
<p>Thanks to the rigorous safety measures extant in OCaml, data races are also less destructive than in languages like C or C++. Furthermore, data races in OCaml do not result in crashes, and its <a href="https://v2.ocaml.org/manual/memorymodel.html">memory model</a> guarantees that memory safety is preserved even for programs with data races. These factors already mitigate two of the biggest problems brought about by data races: crashes and memory corruption.</p>
<p>Still, data races can create surprises for the developer, even in OCaml. This is because data races can cause behaviours that cannot be explained by mere interleavings of operations from different threads. Put simply, the code doesn&rsquo;t operate in a way that makes it easy to reason about its behaviour. Developers who are unfamiliar with the symptoms will struggle when faced with a data race.</p>
<p>OCaml helps developers reason about unpredictable behaviours by imposing limits on the unpredictability. The <a href="https://v2.ocaml.org/manual/memorymodel.html">OCaml Memory Model</a> offers strong guarantees even for programs with data races. For example, data races cannot result in <a href="https://tarides.com/blog/2023-10-18-off-to-the-races-using-threadsanitizer-in-ocaml/">out-of-thin-air values</a>, meaning that the only values that can be observed are those that have been previously written to &ndash; so no nasty surprises. OCaml offers what is known as a <em>Local Data Race Freedom Sequential Consistency</em> (LDRF-SC) guarantee. It helps the developer reason about a parallel program, guaranteeing that even if it has data races, the rest of it will follow predictable patterns.</p>
<p>These factors help the developer be more productive as they face fewer headaches. Yet, we still want to give programmers an easy way to find and eliminate data races in their OCaml programs. Even though data races in OCaml are less unpredictable than those in other languages, it is still good to eliminate them whenever possible. To this end, we have brought the data race detector <a href="https://clang.llvm.org/docs/ThreadSanitizer.html">ThreadSanitizer</a> to OCaml.</p>
<p>For a deep dive into this topic, I recommend checking out <a href="https://kcsrk.info/papers/pldi18-memory.pdf">this paper</a> for more technical background on the OCaml Memory Model.</p>
<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#bringing-threadsanitizer-and-its-benefits-to-ocaml" aria-label="bringing threadsanitizer and its benefits to ocaml permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bringing ThreadSanitizer and its Benefits to OCaml</h2>
<p>ThreadSanitizer, or TSan, is an open-source tool that reliably detects data races at runtime. TSan can be enabled, alert the developer of any data races in their code, and then disabled. This allows users to quickly identify and remove data race bugs without introducing overhead.</p>
<p>Tarides is one of the largest maintainers of OCaml libraries and related tools, and our team members <a href="https://tarides.com/blog/2023-10-18-off-to-the-races-using-threadsanitizer-in-ocaml/">worked hard to help bring TSan support to OCaml</a>. With TSan support, users now have a comprehensive and straightforward way to detect and eliminate data races from their code. TSan makes the developer experience in OCaml smoother &ndash; less time spent bug-hunting makes for happier developers who can use their time and energy on better (and more fun!) things.</p>
<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#the-main-message" aria-label="the main message permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Main Message</h2>
<p>We build our technologies in the programming language OCaml, which brings several benefits to our partners. OCaml has always been known for its high levels of security, which is one of the reasons why the trading firm <a href="https://www.janestreet.com/">Jane Street</a> uses the language for its services. The OCaml 5 update introduced Multicore support, drastically increasing the performance potential of programs and applications using OCaml. By bringing TSan to OCaml, we&rsquo;re helping both the community and our partners benefit from the security and performance of Multicore OCaml with minimal headaches.</p>
<p>If you want to discover how we can leverage OCaml to your advantage, please <a href="https://tarides.com/contact/">contact us</a>, and we will be happy to chat. You can also follow us on <a href="https://twitter.com/tarides_">X</a> (formerly Twitter) and <a href="https://www.linkedin.com/company/tarides">LinkedIn</a> to stay up to date on what we&rsquo;re up to!</p>
