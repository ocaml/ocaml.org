---
title: Reflections on the MirageOS Retreat in Morocco
description: "Introduction Since we are a hybrid remote and distributed company, everyone
  at Tarides knows first-hand how important in-person retreats are\u2026"
url: https://tarides.com/blog/2023-07-27-reflections-on-the-mirageos-retreat-in-morocco
date: 2023-07-27T00:00:00-00:00
preview_image: https://tarides.com/static/a7b0459f133a235efeb8a9ef3dc7616f/0132d/market.jpg
authors:
- Tarides
source:
---

<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#introduction" aria-label="introduction permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h2>
<p>Since we are a hybrid remote and distributed company, everyone at Tarides knows first-hand how important in-person retreats are for collaborating on software development. They give us a chance to focus more deeply on our work, collaborate closely, and learn from one another. We are particularly enthusiastic about the MirageOS retreats, which are organised by <a href="https://github.com/hannesm">@hannesm</a> from <a href="https://robur.coop/">Robur</a> and happen once to twice a year. These retreats bring together OCaml programmers and MirageOS enthusiasts from all over the world to share ideas and work on projects.</p>
<p>For those unacquainted with it, <a href="https://mirage.io/">MirageOS</a> is a library operating system that lets users create 'unikernels' &ndash; light-weight, single-purpose machine images designed for secure, efficient, high-performance applications. MirageOS unikernels are written in OCaml, which is a functional, semantically-rich, and type-safe programming language.</p>
<p>This blog post offers a glimpse into our journey to the recent MirageOS retreat, which took us to Morocco. We will share our most memorable experiences from the retreat - the personal stories, the community bonding, the projects we worked on, and the things we learned. So, buckle up and join us as we reminisce on a journey of technical exploration and personal growth under the Moroccan sky.</p>
<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#the-journey-to-morocco" aria-label="the journey to morocco permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Journey to Morocco</h2>
<p>Our experience of the MirageOS retreat was as much about the journey as it was about the destination. Some of us started our trip with a train ride to La Feria in Seville. It's a big spring festival in Spain that we were excited to experience. From there, we headed to Cadiz, another city in Spain known for its history and food.</p>
<p>Our final destination was Marrakech, Morocco. We stayed at a traditional Moroccan house called a riad, named the Queen of the Medina. The owner of the riad was very welcoming, and the house was comfortable and filled with local art. During our stay, we shared rooms and meals, growing closer to the rest of the community.</p>
<p>Right outside our riad was the famous Jemaa el-Fnaa square. It's a busy marketplace and a UNESCO World Heritage site, filled with music, food stalls, and plenty of action &ndash; especially in the evenings.</p>
<p>The journey to Morocco and the experiences we had along the way helped set the stage for a productive and enjoyable retreat.</p>
<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#the-mirageos-retreat-experiences" aria-label="the mirageos retreat experiences permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The MirageOS Retreat Experiences</h2>
<p>At the heart of the retreat was the daily 'circle'. Each day, we gathered together to share our experiences and discuss what we had been working on. These discussions provided insights into the different projects, and it was inspiring to hear about the progress that each person was making, often with the help of other participants at the retreat.</p>
<p>One highlight of the retreat was the night-time presentations. These covered various subjects, and not all were directly related to OCaml or MirageOS. The diversity of topics always sparked interesting conversations and created opportunities for us to learn from each other.</p>
<p>Throughout the retreat, a topic that came up often was how to increase the adoption of MirageOS. This spurred a lot of creative thinking, as we brainstormed new ways to promote the wider use of MirageOS.</p>
<p>And of course, we also had the opportunity to work on personal projects. Two of us, for instance, added the Git server commands to the <code>ocaml-git</code> library. Another project played music from a bare-metal Raspberry Pi 4!</p>
<p>But the retreat wasn't all work. We also found time for fun and relaxation. One memorable activity was the contact improvisation dance  accompanied by live music, in which several retreat participants took part. After the week-long retreat ended, some of us stayed in Morocco to visit the Atlas Mountains, climb Jbel Toubkal, and go surfing in Imsouane.</p>
<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#projects-and-collaborations" aria-label="projects and collaborations permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Projects and Collaborations</h2>
<p>During the retreat, we split into small groups of one or two engineers to work on different projects. The projects let us explore different aspects of Mirage that we found interesting and test the boundaries of what Mirage can do. Some of our projects included:</p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#midi-over-bare-metal-raspberry-pi" aria-label="midi over bare metal raspberry pi permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MIDI over Bare-Metal Raspberry Pi</h3>
<p><em>Contributors: <a href="https://github.com/pitag-ha">@pitag-ha</a>, <a href="https://github.com/Engil">@Engil</a></em></p>
<p>We set out to explore the capabilities of a Raspberry Pi (RPi) in handling MIDI signals. We had a host of adapters at our disposal, including a GPIO board with MIDI DIN plugs and an adapter that could transform MIDI DIN to USB. Our colleague <a href="https://github.com/engil">@Engil</a>, who was one of the two main people working on this project, brought a synthesiser, enabling us to establish a direct connection to the GPIO board of the RPi. Additionally, the DIN-USB cable allowed us to connect our computers to the RPi for debugging purposes, using a program called <a href="https://github.com/surfacepatterns/midisnoop">Midisnoop</a>.</p>
<p>Our primary objective was to send MIDI output from the RPi, which proved to be a straightforward task. We made use of <a href="https://github.com/Dinosaure">@Dinosaure</a>'s bare-metal RPi toolchain, <a href="https://github.com/%5B@dinosaure%5D(https://github.com/Dinosaure)/gilbraltar">Gibraltar</a>, which already had UART write support for logging. Since MIDI operates on a serial protocol, we decided to send it over UART as well. We adjusted the baudrate, converted some music into MIDI bytes, and sent it to the UART. Thanks to the functionalities already present in Gibraltar, we managed to play the intro of &quot;Mr Sandman&quot;!</p>
<p>We also attempted to receive MIDI signals. After some troubleshooting and experiments, we concluded that the GPIO board's MIDI Out DIN connector was faulty. We confirmed our theory by installing Linux on the RPi and running a Python program for MIDI output provided by the GPIO board's provider, but to no avail. It's amusing to note that it took us a whole day to install Linux and run a single program, compared to the ease and speed of booting a bare-metal MirageOS unikernel &#129299;.</p>
<p>We had envisioned implementing MIDI In support to create a &quot;bare-metal OCaml drum machine.&quot; The idea was to convert incoming MIDI signals into drum samples, similar to how synthesisers operate. The intention was to load drum samples into the unikernel's memory and generate the corresponding drum sounds upon receiving a MIDI event.</p>
<p>In a bid to broaden our experimentation, we also wanted to explore how we could send audio from the unikernel to the host system. The solution involved writing music to the unikernel's <code>stdout</code> and piping the unikernel into an ALSA function, which then played the received music. Although this wasn't typical usage of a unikernel, it proved to be a really fun experiment.</p>
<p>This project served as a testament to the flexibility and creative applications of unikernels, and we're excited about the further possibilities that this experiment will inspire.</p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#adding-git-server-commands-to-the-ocaml-git" aria-label="adding git server commands to the ocaml git permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adding Git Server Commands to the <code>ocaml-git</code></h3>
<p><em>Contributors: <a href="https://github.com/panglesd">@panglesd</a>, <a href="https://github.com/Julow">@Julow</a></em></p>
<p>The primary goal of our project was to create a unikernel that could act as a Git server. We needed several components in order to accomplish this, including an OCaml implementation of the SSH protocol and an OCaml implementation of the Git protocol. For the SSH protocol, everything we needed was implemented in <code>awa-ssh</code>, but for <code>ocaml-git</code> things were a bit more complicated.</p>
<p><code>ocaml-git</code> implements the Git format and part of the protocol. It is also used as a backend for Irmin and for fetching data in a unikernel. However, the server side part of the protocol that we needed was missing. It had not been needed in <code>ocaml-git</code> use cases before.</p>
<p>Our main challenge was that programming in <code>ocaml-git</code> can be really hard! There were a lot of monads at the same time, as well as Higher Kinded Types. Abstractions were necessary to support all the use cases we wanted, which were to use it in a Unix program or in a unikernel, as an Irmin backend, and as a library by a unikernel. We also needed to decipher some slightly vague documentation for the Git protocol, so there was some trial and error and reverse engineering of Git going on.</p>
<p>We were lucky enough to get some great help from several people. <a href="https://github.com/Dinosaure">@Dinosaure</a> walked us through the code of <code>ocaml-git</code> and answered many of our questions about Git's protocol, whereas <a href="https://github.com/reynir">@reynir</a> helped us write a unikernel and answered our questions about SSH.</p>
<p>We implemented the project in a series of steps, starting by writing a 'cat' SSH unikernel as a basis for our server. We then implemented a server-side fetch protocol called <code>upload-pack</code>. We needed to do a lot of iterations and experimentation before we got it right, as the protocol was full of hidden details. We were finally able to create a <code>git-clone</code> that was answered by our server. It was just in time as well, as it was the last night of the retreat!</p>
<p>The next steps would be to implement the missing features like shallow clones for <code>upload-pack</code>, implement the server-side of <code>push</code> which is called <code>receive-pack</code>, and integrate all of this into a unikernel! If you'd like to help or just check out our project, you can <a href="https://github.com/mirage/ocaml-git/pull/618">look at the PR on GitHub.</a></p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#exploring-solo5-and-multicore" aria-label="exploring solo5 and multicore permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Exploring Solo5 and Multicore</h3>
<p><em>Contributors: <a href="https://github.com/haesbaert">@haesbaert</a>, <a href="https://github.com/fabbing">@fabbing</a></em></p>
<p>We were experimenting with <a href="https://github.com/Solo5/solo5">Solo5</a> and Multicore. <a href="https://github.com/haesbaert">@haesbaert</a> was trying to figure out how Unikraft booted and what parts of SMP it already had, as well as understanding what people expect from something like Unikraft. This involved checking the reservations and so on. Together with <a href="https://github.com/kit-ty-kate">@kit-ty-kate</a>, we tried to fix halting on Google Compute for Mirage, which involved diving into OpenBSD to see how they managed halting. After a lot of investigation, it seemed that in order to fix halting, we would need a proper ACPI implementation and some minor table parsing to achieve proper shutdown. <a href="https://github.com/haesbaert">@haesbaert</a> also collaborated with Hannesm to fix an Eio bug in FreeBSD.</p>
<p><a href="https://github.com/fabbing">@fabbing</a> was also working with <a href="https://github.com/Dinosaure">@Dinosaure</a> to learn about Solo5 and how to get multiple CPUs running. While they were working on Solo5 together, <a href="https://github.com/Dinosaure">@Dinosaure</a> went through and <a href="https://github.com/Solo5/solo5/pull/558">updated the Solo5 documentation.</a></p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#ocaml-splashscreen" aria-label="ocaml splashscreen permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>OCaml Splashscreen</h3>
<p><em>Contributors: <a href="https://github.com/MisterDA">@MisterDA</a></em></p>
<p>We started by wanting to explore <a href="https://www.rfc-editor.org/info/rfc9230">DNS over HTTPS</a> with MirageOS, and we managed to deploy a DNS server locally! However, with all of the exciting things going on all around us, we got distracted and started to work on smaller projects. We learned about generating OCaml bindings to C libraries with <a href="https://github.com/yallop/ocaml-ctypes"><code>ctypes</code></a> and started to expand the coverage of <a href="https://github.com/savonet/ocaml-posix/pull/12"><code>ocaml-posix</code></a>. We set an informal goal to write a binding for FUSE with <code>ctypes</code>, which is still a work in progress. We also explored the steps involved with building MirageOS and OCaml on macOS, and found and fixed a couple of bugs.</p>
<p>We then started on a really fun project! It was all about splashscreens, or the windows that are shown when a program starts. We based it on the first chronophotography of a camel walking. <a href="https://github.com/MisterDA">@MisterDA</a> extracted the camel using GIMP and turned it into a computer animation, displayed with the OCaml binding to <a href="https://github.com/fccm/OCamlSDL2">SDL2</a>. We then added a futuristic soundtrack, composed by <a href="https://github.com/engil">@Engil</a>, before being ready to present the <a href="https://github.com/MisterDA/ocamlwalk">OCamlWalk</a> project.</p>
<p>It also acts as a wrapper around <code>ocamlrun</code> that you can use to launch OCaml bytecode executables. The camel walks, and OCaml runs!</p>
<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#conclusion" aria-label="conclusion permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2>
<p>The retreat was a great opportunity to meet other developers who are enthusiastic about MirageOS. We had some great discussions and brainstorming sessions, sharing ideas and insights with each other. Morocco provided an amazing setting for the retreat, with beautiful nature and historic cultural landmarks.</p>
<p>We're happy to be part of a vibrant community with a lot of passionate people, and we're already looking forward to the next opportunity to get together!</p>
<blockquote>
<p>If you're interested in exploring how to use Mirage to build highly-secure unikernels, for commercial uses, or even as a side project, do <a href="mailto:contact@tarides.com">reach out to us</a>. We'll be happy to help!</p>
</blockquote>
