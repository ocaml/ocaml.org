---
title: OCaml write-only
description:
url: https://misterpingouin.blogspot.com/2008/02/ocaml-write-only.html
date: 2008-02-03T21:23:00-00:00
preview_image:
authors:
- mrpingouin
source:
---

J'ai d&eacute;couvert un petit site sympa suite &agrave; une annonce sur la Caml-list: <a href="http://golf.shinh.org/">Anarchy Golf</a>. Au golf, on fini un parcours en un nombre minimum de coups. Ici, on r&eacute;sout un probl&egrave;me en un nombre minimum d'octets de code. De nombreux langages sont disponibles, dont OCaml.<br/><br/>Le probl&egrave;me annonc&eacute; sur la Caml-list laisse r&ecirc;veur: trouver un <em>Quine</em> qui soit aussi un palindrome. En clair: un programme dont l'ex&eacute;cution affiche le code du programme, et dont le code est un palindrome, i.e. identique qu'on le lise de droite &agrave; gauche ou le contraire. Il est assez simple d'&eacute;crire un Quine, quel que soit le langage. J'ai &eacute;crit un palindrome en Caml, c'est d&eacute;ja un peu plus ardu. Mais satisfaire aux deux contraintes en m&ecirc;me temps est d&eacute;courageant. Alors j'ai perdu mon temps sur d'autres probl&egrave;mes plus simples, en attendant de voir les solutions &agrave; celui-ci (le 08 F&eacute;vrier, 01:46:39 heure japonaise).<br/><br/>La contrainte de concision force &agrave; faire des choses illisibles. Par exemple, ma solution pour le probl&egrave;me <a href="http://golf.shinh.org/p.rb?rot13">rot13</a>:<br/><pre>let rec(!)?(c=input_byte stdin)x=output_byte stdout[|c;c;65+c mod x;97+(c-6)mod x|].(c/32);!x;;!26<br/></pre><br/>&Agrave; ce stade vient l'expression consacr&eacute;e &agrave; Perl: ce code est <em>write-only</em>. Et encore c'est assez lisible compar&eacute; aux solutions du champion de Golf en OCaml: <code>ksk</code>.<br/><br/>La concision force &agrave; faire des choses qu'on ne pourrait qualifier de bonnes pratiques de programmation. Cela dit, il faut en g&eacute;n&eacute;ral r&eacute;fl&eacute;chir &agrave; un algorithme pas trop con pour pouvoir pr&eacute;tendre au podium. Par exemple, m&ecirc;me en d&eacute;ployant toutes les ruses de compression possibles, je sentais bien que je n'atteindrais pas les 54 octets de <code>ksk</code> pour &eacute;crire un <a href="http://golf.shinh.org/p.rb?Minimal%20scheme%20interpreter">interp&eacute;teur Scheme minimal</a>. Apr&egrave;s la fin du d&eacute;fi, quand <a href="http://golf.shinh.org/reveal.rb?Minimal%20scheme%20interpreter/ksk/1201104485&amp;ml">son code</a> a &eacute;t&eacute; publi&eacute;, j'ai pu constater qu'il avait rus&eacute;:<br/><pre>print_string[|&quot;3&quot;;&quot;24&quot;;&quot;5<br/>8<br/>58&quot;|].(-Obj.magic(@)mod 3)<br/></pre><br/>De l&agrave; &agrave; comprendre la ruse, ce n'est pas si simple. Tout repose sur le fait que le code ne doit pas vraiment impl&eacute;menter un interpr&eacute;teur Scheme: il suffit qu'il donne les bonnes r&eacute;ponses pour trois entr&eacute;es diff&eacute;rentes, toujours les m&ecirc;mes. La plupart des participants ont utilis&eacute; cette &quot;faille&quot; pour r&eacute;pondre, par exemple <code>m.ukai</code>, class&eacute; second en OCaml:<br/><pre>print_string[|&quot;24&quot;;&quot;3&quot;;&quot;5<br/>8<br/>58&quot;|].(String.length(read_line())-16)<br/></pre><br/>Ici, la r&eacute;ponse est choisie en fonction de la longueur de la premi&egrave;re ligne de l'entr&eacute;e, cette information &eacute;tant suffisante pour distinguer les tests. La solution de <code>ksk</code> reste incompr&eacute;hensible: il n'y a aucune instruction de lecture, aucun test d&eacute;pendant de l'entr&eacute;e. Pire: si vous prenez son code et le compilez (en natif ou <em>bytecode</em>) vous obtiendrez un programme d&eacute;terministe (il affiche toujours <code>3</code> chez moi).<br/><br/>La cl&eacute; du myst&egrave;re ? Ex&eacute;cut&eacute; dans la boucle d'interaction <code>ocaml</code> comme le fait la proc&eacute;dure de v&eacute;rification du Code Golf, ce code a une sortie al&eacute;atoire. Selon les ex&eacute;cutions de <code>ocaml ksk.ml</code>, on re&ccedil;oit la r&eacute;ponse de l'un des trois tests. Le hasard r&eacute;side dans l'initialisation de la boucle d'interaction, qui fait que l'op&eacute;rateur de concat&eacute;nation <code>(@)</code>, transtyp&eacute; en un <code>int</code> par <code>Obj.magic</code> va avoir une valeur grosso-modo al&eacute;atoire. Je ne fais que constater, je ne comprends pas.<br/><br/>Mais cela ne r&eacute;pond toujours pas au probl&egrave;me... enfin, pas toujours. Il aura probablement fallu &agrave; <code>ksk</code> pas mal de patience pour soumettre et re-soumettre son code jusqu'&agrave; ce que le hasard renvoie les bonnes r&eacute;ponses aux bons tests, et le classe premier! Cette solution est vraiment <em>write-only</em>: c'est illisible, et m&ecirc;me son ex&eacute;cution laisse &agrave; d&eacute;sirer :)<br/><br/>Moi je trouve &ccedil;a un peu trop immoral, mais il faut avouer que &ccedil;a respecte les r&egrave;gles du jeu. Et on aura appris quelquechose. C'est moche, mais &ccedil;a marche.
