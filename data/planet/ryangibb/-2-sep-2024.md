---
title: ' 2 Sep 2024'
description:
url: https://ryan.freumh.org/2024-09-02.html
date: 2024-09-02T00:00:00-00:00
preview_image:
authors:
- Ryan Gibb
source:
---

<article>
    <div class="container">
        <span>  Previous: <a href="https://ryan.freumh.org/2024-08-26.html">26 Aug 2024</a>  </span>
        <span>  Next: <a href="https://ryan.freumh.org/2024-09-09.html"> 9 Sep 2024</a>  </span>
    </div>
    
    <section>
        <ol>
<li><p><span>Tue</span></p>
<ol>
<li><p><span>Try dumping the SAT graph to see how big we
make it</span></p></li>
<li><p><span>hmm, magic trace traces are
empty</span></p></li>
<li><p><span>Spent some trying to understand the SAT
solving</span></p></li>
</ol></li>
<li><p><span>Wed</span></p>
<pre><code>sat: TRYING: not(cargo-quote.1.0.32)
sat: enqueue: not(cargo-quote.1.0.32) (considering)
sat: TRYING: not(cargo-quote.1.0.33)
sat: enqueue: not(cargo-quote.1.0.33) (considering)
sat: TRYING: not(cargo-quote.1.0.34)
sat: enqueue: not(cargo-quote.1.0.34) (considering)
sat: TRYING: not(cargo-quote.1.0.35)
sat: enqueue: not(cargo-quote.1.0.35) (considering)
sat: TRYING: not(cargo-quote.1.0.36)
sat: enqueue: not(cargo-quote.1.0.36) (considering)
sat: TRYING: not(cargo-quote.1.0.37)
sat: enqueue: not(cargo-quote.1.0.37) (considering)
sat: TRYING: not()
sat: enqueue: not() (considering)
sat: enqueue: not(cargo-wasm-bindgen.0.2.66) (&lt;some: not(cargo-wasm-bindgen.0.2.66), , cargo-wasm-bindgen-macro.0.2.66&gt;)
sat: enqueue: not(cargo-wasm-bindgen.0.2.66) (&lt;some: not(cargo-wasm-bindgen.0.2.66), cargo-wasm-bindgen.0.2.66&gt;)
sat: TRYING: not()
sat: enqueue: not() (considering)
sat: TRYING: not(cargo-cfg-if.0.1.9)
sat: enqueue: not(cargo-cfg-if.0.1.9) (considering)
</code></pre>
<p><span>we’re trying a whole bunch of nots… I think our
problems might stem from the structure of the SAT problem rather than
it’s size</span></p>
<pre><code>time dune exec -- bin/main.exe --repo /dev/shm/opam-giga-repository/packages cargo-sauron-core.0.57.0
hooooo
ha
5116
flush
</code></pre>
<pre><code>time dune exec -- bin/main.exe --repo /dev/shm/opam-giga-repository/packages cargo-sauron-core.0.57.0
hooooo
ha
114649
flush
^C
</code></pre>
<p><span>that is a lot bigger a SAT problem… how do we build
the sat problem from roles and implementations? maybe we could do an
optimisation if a role only has one implementation?</span></p>
<p><span>ah! <code class="verbatim">Sat.at_most_one</code>
adds a clause</span></p>
<p><span><code class="verbatim">process_dep</code> adds a
clause for dependencies for every implementation</span></p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span><a href="https://ryan.freumh.org/atom.xml#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> implies problem ?reason first rest = at_least_one problem ?reason ((neg first) :: rest)</span></code></pre></div>
<p><span>so basically we’re creating separate dependency
info for every implementation now</span></p>
<p><span>okay, we’re down to 110816 with removing the
implementation clause when there’s only one implementation</span></p>
<ul>
<li>question: does this break anything?</li>
</ul>
<p><span>okay, we get to `cargo-thiserror.1.0.0` on line
219 with the o.g. solver compared to &gt;20k with the modified
solver</span></p>
<p><span>(there are many software deployment methodologies
out there but we can solve across them)</span></p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span><a href="https://ryan.freumh.org/atom.xml#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">(* A clause with only a single literal is represented</span></span>
<span><a href="https://ryan.freumh.org/atom.xml#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">   as an assignment rather than as a clause. *)</span></span></code></pre></div>
<p><span>okay, so clauses stored in literal watch lists? I
don’t think it’ll be as easy to print this as I thought</span></p>
<p><span>change <code class="verbatim">at_most_one</code>
to <code class="verbatim">at_least_one?</code> no, we might return
multiple versions</span></p>
<p><span>what if we just return the upper bound of every
dependency???</span></p>
<p><span>that did it!</span></p>
<p><span>tomorrow: Next up is supporting both of these in
one dependency tree, which might require adding a new flag to the cargo
opam files I mean if we’re solving dependencies that cross package
ecosystem lines, e.g. an opam package depending on a cargo package, or a
cargo package depending on a debian package. We would want to allow
multiple versions for the cargo package, but not the opam or debiain
packages. So if I have some flag associated with each package I can
choose whether to represent them in a way that allows multiple versions
(or not)</span></p></li>
<li><p><span>Thu</span></p>
<pre><code>Can't find all required versions.
Selected: opam-angstrom.0.16.0 opam-base.v0.17.1 opam-base-bigarray.base
          opam-base-domains.base opam-base-nnp.base opam-base-threads.base
          opam-base-unix.base opam-base64.3.5.1 opam-bigstringaf.0.10.0
          opam-csexp.1.5.2 opam-dune.3.16.0 opam-dune-configurator.3.16.0
          opam-host-arch-x86_64.1 opam-jsonm.1.0.2 opam-ocaml.4.14.3
          opam-ocaml.5.2.0 opam-ocaml.5.2.1 opam-ocaml.5.4.0
          opam-ocaml-base-compiler.5.2.0 opam-ocaml-compiler-libs.v0.17.0
          opam-ocaml-config.3 opam-ocaml-option-bytecode-only.1
          opam-ocaml-options-vanilla.1 opam-ocaml-syntax-shims.1.0.0
          opam-ocaml_intrinsics_kernel.v0.17.1 opam-ocamlbuild.0.15.0
          opam-ocamlfind.1.9.6 opam-ppx_derivers.1.2.1
          opam-ppx_sexp_conv.v0.17.0 opam-ppxlib.0.33.0
          opam-ppxlib_jane.v0.17.0 opam-re.1.11.0 opam-seq.base
          opam-sexplib0.v0.17.0 opam-stdlib-shims.0.3.0 opam-stringext.1.6.0
          opam-topkg.1.0.7 opam-uri.4.4.0 opam-uri-sexp.4.4.0 opam-uutf.1.0.3
          opam-cohttp.5.3.1 opam-cohttp.5.3.1 opam-ocaml.4.14.3
          opam-ocaml-base-compiler.5.2.0 opam-ocaml-option-bytecode-only.1
          opam-ocaml-base-compiler.5.2.0 opam-ocaml.5.4.0
          opam-base-domains.base opam-ocaml-base-compiler.5.2.0
          opam-ocaml.5.4.0
- opam-cohttp.5.3.1 -&gt; opam-cohttp.5.3.1
    User requested = 5.3.1
- opam-ocaml-variants.4.14.3+trunk -&gt; (problem)
    Rejected candidates:
      opam-ocaml-variants.4.14.3+trunk: In same conflict class (ocaml-core-compiler) as opam-ocaml-base-compiler.5.2.0
      opam-ocaml-variants.5.2.0+trunk: Availability condition not satisfied
      opam-ocaml-variants.5.1.1+trunk: Availability condition not satisfied
      opam-ocaml-variants.5.1.0+trunk: Availability condition not satisfied
      opam-ocaml-variants.5.0.0+trunk: Availability condition not satisfied
      ...
- opam-ocaml-variants.5.2.1+trunk -&gt; (problem)
    Rejected candidates:
      opam-ocaml-variants.5.2.1+trunk: In same conflict class (ocaml-core-compiler) as opam-ocaml-base-compiler.5.2.0
      opam-ocaml-variants.5.2.0+trunk: Availability condition not satisfied
      opam-ocaml-variants.5.1.1+trunk: Availability condition not satisfied
      opam-ocaml-variants.5.1.0+trunk: Availability condition not satisfied
      opam-ocaml-variants.5.0.0+trunk: Availability condition not satisfied
      ...
- opam-ocaml-variants.5.4.0+trunk -&gt; (problem)
    Rejected candidates:
      opam-ocaml-variants.5.4.0+trunk: In same conflict class (ocaml-core-compiler) as opam-ocaml-base-compiler.5.2.0
      opam-ocaml-variants.5.2.0+trunk: Availability condition not satisfied
      opam-ocaml-variants.5.1.1+trunk: Availability condition not satisfied
      opam-ocaml-variants.5.1.0+trunk: Availability condition not satisfied
      opam-ocaml-variants.5.0.0+trunk: Availability condition not satisfied
      ...
dune exec -- bin/main.exe --repo /dev/shm/opam-giga-repository/packages   18.89s user 1.72s system 99% cpu 20.629 tot
</code></pre>
<p><span>this is new</span></p>
<p><span><a href="https://github.com/RyanGibb/opam-0install-solver/commit/e396b5982ec954391670eea91173f896493a42d8">https://github.com/RyanGibb/opam-0install-solver/commit/e396b5982ec954391670eea91173f896493a42d8</a></span></p></li>
<li><p><span>Fri</span></p>
<ol>
<li><p><span><a href="https://docs.google.com/document/d/19HNnqMsETTdwwQd0I0zq2rg1IrJtaoFEA1B1OpJGNUg/edit">https://docs.google.com/document/d/19HNnqMsETTdwwQd0I0zq2rg1IrJtaoFEA1B1OpJGNUg/edit</a></span></p>
<ol>
<li><p><span><a href="https://news.ycombinator.com/item?id=12187888">https://news.ycombinator.com/item?id=12187888</a></span></p>
<ol>
<li><p><span>&gt; I’d suggest making some sort of
meta-system packaging system that works for all the languages, but xkcd
927 (and I wouldn’t use it myself, anyway, because it would probably not
install Ruby packages correctly and would solve things worse than NPM
already does).</span></p></li>
<li><p><span>&gt; Global installs are the root of a lot of
headaches when building software in the same way that global mutable
state is the root of a lot of headaches when developing
it.</span></p></li>
</ol></li>
<li><p><span><a href="https://github.com/rust-lang/cargo/issues/2064">https://github.com/rust-lang/cargo/issues/2064</a></span></p></li>
</ol></li>
<li><p><span>vs Nix? version resolution (using old versions
of packages) and using other ecosystems</span></p>
<ol>
<li><p><span>decentralized package managers?</span></p>
<ol>
<li><p><span>using domain names?</span></p></li>
<li><p><span><a href="https://archive.fosdem.org/2018/schedule/event/purl/">https://archive.fosdem.org/2018/schedule/event/purl/</a></span></p>
<ol>
<li><p><span><a href="https://github.com/package-url/purl-spec">https://github.com/package-url/purl-spec</a>
in OCaml?</span></p></li>
</ol></li>
</ol></li>
<li><p><span>immutable packages</span></p>
<ol>
<li><p><span>distrubuted append-only ledger? actually,
no…</span></p></li>
</ol></li>
<li><p><span><a href="https://archive.fosdem.org/2018/schedule/event/bazaarsandcathedrals/">https://archive.fosdem.org/2018/schedule/event/bazaarsandcathedrals/</a></span></p>
<ol>
<li><p><span>cathedral vs bazar</span></p></li>
<li><p><span>build or runtime</span></p></li>
<li><p><span>build, depends, pre-depends, recommends,
suggests, enhances, breaks, conflicts, obsolete</span></p></li>
<li><p><span>Sat solving</span></p></li>
</ol></li>
<li><p><span><a href="https://archive.fosdem.org/2018/schedule/event/packagemangementunites/">https://archive.fosdem.org/2018/schedule/event/packagemangementunites/</a></span></p>
<ol>
<li><p><span>different registries</span></p></li>
<li><p><span>a taxonomy of package
management</span></p></li>
<li><p><span><a href="https://dl.acm.org/doi/pdf/10.1145/3347446">https://dl.acm.org/doi/pdf/10.1145/3347446</a></span></p></li>
<li><p><span><a href="https://research.swtch.com/vgo-mvs">https://research.swtch.com/vgo-mvs</a></span></p></li>
</ol></li>
</ol></li>
</ol></li>
<li><p><span>Sat</span></p>
<p><span><a href="https://www-users.cselabs.umn.edu/classes/Fall-2019/csci5271/papers/SRL2003-02.pdf">https://www-users.cselabs.umn.edu/classes/Fall-2019/csci5271/papers/SRL2003-02.pdf</a>
<a href="https://dl.acm.org/doi/pdf/10.1145/3365199">https://dl.acm.org/doi/pdf/10.1145/3365199</a>
<a href="https://anil.recoil.org/papers/2018-hotpost-osmose.pdf">https://anil.recoil.org/papers/2018-hotpost-osmose.pdf</a>
<a href="https://dl.acm.org/doi/10.1145/356678.356682">https://dl.acm.org/doi/10.1145/356678.356682</a></span></p>
<p><span>idea: shark could parametise build software
configurations by domain name like nix could</span></p>
<p><span>get anil to deploy eon</span></p>
<p><span>what every happened to that shell over
capnp?</span></p></li>
<li><p><span>Sun</span></p>
<p><span>Swapnil says to sell the package management as the
LSP of package management. n*n -&gt; n</span></p></li>
</ol>
    </section>
</article>

