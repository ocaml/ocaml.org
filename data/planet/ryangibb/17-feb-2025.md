---
title: 17 Feb 2025
description:
url: https://ryan.freumh.org/2025-02-17.html
date: 2025-02-17T00:00:00-00:00
preview_image:
authors:
- Ryan Gibb
source:
---

<article>
    <div class="container">
        <span>  Previous: <a href="https://ryan.freumh.org/2025-02-10.html">10 Feb 2025</a>  </span>
        <span>  Next: <a href="https://ryan.freumh.org/2025-02-25.html">25 Feb 2025</a>  </span>
    </div>
    
    <section>
        <ol>
<li><p><span>Babel: opam repository with <a href="https://github.com/RyanGibb/pubgrub-opam">pubgrub-opam</a></span></p>
<ol>
<li><p><span><span class="done DONE">X</span> <a href="https://github.com/RyanGibb/pubgrub-opam/tree/main/example-repo">tests</a></span></p></li>
<li><p><span><span class="done DONE">X</span> <a href="https://crates.io/crates/pubgrub/0.3.0-alpha.1">PubGrub
0.3.0</a></span></p>
<ul>
<li><a href="https://github.com/astral-sh/uv">Uv</a> is using the
development branch of PubGrub.</li>
<li>There‚Äôs a lot of improvements to be had since the last release was 4
years ago.
<ul>
<li>The new version bounds will cleanly express version constraints,
e.g. stop converting <code class="example">&lt;= 1.0.0</code> to <code class="verbatim">&lt; 1.0.0.1</code></li>
<li>It looks like we might be able to manually add conflicts with <a href="https://github.com/pubgrub-rs/pubgrub/blob/23357967c6473b358ffb7c0092e9c3fc4e4c972b/src/internal/core.rs#L94"><code class="verbatim">add_incompatibility</code></a>
<ul>
<li>Ah, actually this is an internal thing.</li>
</ul></li>
</ul></li>
<li>Completed <a href="https://github.com/RyanGibb/pubgrub-opam/commit/d67fcfcfd02fc1e5fb720d5f89986d895693dce4">here</a>.</li>
</ul></li>
<li><p><span><span class="done DONE">X</span> conjunctions
and disjunctions in filtered package formula</span></p>
<p><span>Take <code class="verbatim">"D" { test &amp; &gt; "2.0.0"}</code> as an example. We
encode this as,</span></p>
<pre class="example"><code>(filtered-package-formula-variable-version, 1.0.0) -&gt; (D {(test &amp; = &gt;2.0.0)}, *)
(D {(test &amp; = &gt;2.0.0)}, false) -&gt; (`test`, false)
(D {(test &amp; = &gt;2.0.0)}, true) -&gt; (`test`, true), (A, &gt;1.0.0)
(`test`, false)
(`test`, true)
(A, 2.0.0) -&gt; ...
</code></pre>
<p><span>Note we introduce a proxy package that depends on
either the filter being false (with versions stripped out), or the
filter being true (with versions part of the equation, taking the union
on conjunctions and intersection on disjunctions).</span></p>
<p><span>Take <code class="verbatim">"A" { test | !test }</code> as an example. We encode
this as,</span></p>
<pre class="example"><code>(filtered-package-formula-or, 1.0.0) -&gt; (A {(test | !test)}, *)
(A {(test | !test)}, false) -&gt; (`test`, ‚àÖ)
(A {(test | !test)}, true) -&gt; (A {(test | !test)}, *)
(A {(test | !test)}, lhs) -&gt; (`test`, true), (A, *)
(`test`, true)
(A, 1.0.0) -&gt; ...
</code></pre>
<p><span>Note we combine the versions of the variable <code class="verbatim">test</code> with an intersection which leads to the
empty set.</span></p></li>
<li><p><span><span class="done DONE">X</span> comparison of
booleans</span></p>
<p><span>done <a href="https://github.com/RyanGibb/pubgrub-opam/commit/d92013104c134372c5bb46443a9301a7eb41e4c9">here</a>
e.g.</span></p>
<pre class="example"><code>(filtered-package-formula-equality, 1.0.0) -&gt; (A {(test = build)}, *)
versions of A {(test = build)}: false, true
(A {(test = build)}, false) -&gt; ({(test != build)}, *)
versions of {(test != build)}: lhs, rhs
({(test != build)}, lhs) -&gt; (`test`, true), (`build`, false)
versions of `test`: false, true
(`test`, true)
versions of `build`: false, true
(`build`, false)
</code></pre></li>
<li><p><span><span class="done DONE">X</span> add support
for a ‚Äòroot‚Äô package to support setting variable values</span></p>
<p><span>done <a href="https://github.com/RyanGibb/pubgrub-opam/commit/58d0cb69a22c8a396ebc6c42404b17b6a3e909dc">here</a></span></p></li>
<li><p><span><span class="done DONE">X</span> <code class="verbatim">ocaml-variants.5.3.1+trunk</code></span></p>
<p><span>I‚Äôm reproducing a <a href="https://github.com/ocaml/opam-repository/pull/27472/">bug</a> in
opam-repository‚Äôs constraints that Patrick found.</span></p>
<pre class="example"><code>$ opam sw create 5.3.1+trunk
&lt;&gt;&lt;&gt; Installing new switch packages &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;  üê´
Switch invariant: ["ocaml-variants" {= "5.3.1+trunk"}]
[ERROR] Could not determine which packages to install for this switch:
  * No agreement on the version of ocaml-variants:
    - (invariant) ‚Üí ocaml-variants = 5.3.1+trunk ‚Üí ocaml-compiler &lt; 5.3.0~alpha1 ‚Üí ocaml = 5.3.0 ‚Üí ocaml-variants &lt; 5.3.1~
    - (invariant) ‚Üí ocaml-variants = 5.3.1+trunk
    You can temporarily relax the switch invariant with `--update-invariant'
  * Incompatible packages:
    - (invariant) ‚Üí ocaml-variants = 5.3.1+trunk ‚Üí ocaml-compiler &lt; 5.3.0~alpha1 ‚Üí ocaml = 5.3.0 ‚Üí dkml-base-compiler &lt; 5.3.1~
    - (invariant) ‚Üí ocaml-variants = 5.3.1+trunk
  * Incompatible packages:
    - (invariant) ‚Üí ocaml-variants = 5.3.1+trunk ‚Üí ocaml-compiler &lt; 5.3.0~alpha1 ‚Üí ocaml = 5.3.0 ‚Üí ocaml-base-compiler &gt;= 5.3.0~
    - (invariant) ‚Üí ocaml-variants = 5.3.1+trunk
  * Missing dependency:
    - (invariant) ‚Üí ocaml-variants = 5.3.1+trunk ‚Üí ocaml-compiler &lt; 5.3.0~alpha1 ‚Üí ocaml = 5.3.0 ‚Üí ocaml-variants &lt; 5.3.1~ ‚Üí
      system-msvc
    unmet availability conditions: 'os = "win32"'
</code></pre>
<p><span>After <a href="https://github.com/RyanGibb/pubgrub-opam/commit/9ab1c0fcba010df7a782a40a13a33db8b01ebe5e">adding</a>
conflict-class support (which <a href="https://github.com/ocaml/opam-repository/blob/3f0fbcdd62029a20e3cefc8ce578e605f3bf22f8/packages/ocaml-variants/ocaml-variants.5.3.1+trunk/opam#L25C1-L25C38">are</a>
<a href="https://github.com/ocaml/opam-repository/blob/3f0fbcdd62029a20e3cefc8ce578e605f3bf22f8/packages/ocaml-system/ocaml-system.5.3.0/opam#L49">required</a>
for the ocaml compiler packages) we can reproduce the error:</span></p>
<pre class="example"><code>Because ocaml-system &gt;=5.3.0~, &lt;5.3.1~ depends on Conflict class ocaml-core-compiler ocaml-system and ((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~}) rhs depends on ocaml-system &gt;=5.3.0~, &lt;5.3.1~, ((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~}) rhs depends on Conflict class ocaml-core-compiler ocaml-system. (1)

Because ocaml-base-compiler &gt;=5.3.0~, &lt;5.3.1~ depends on Conflict class ocaml-core-compiler ocaml-base-compiler and (ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~}) lhs depends on ocaml-base-compiler &gt;=5.3.0~, &lt;5.3.1~, (ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~}) lhs depends on Conflict class ocaml-core-compiler ocaml-base-compiler.
And because (ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~}) &lt;lhs | &gt;lhs depends on ocaml-variants &gt;=5.3.0~, &lt;5.3.1~ and ((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~}) lhs depends on (ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~}), Conflict class ocaml-core-compiler Not ( ocaml-base-compiler ), ((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~}) lhs, ocaml-variants Not ( &gt;=5.3.0~, &lt;5.3.1~ ) are incompatible.
And because ((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~}) rhs depends on Conflict class ocaml-core-compiler ocaml-system (1), Conflict class ocaml-core-compiler Not ( ocaml-base-compiler | ocaml-system ), ((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~}) *, ocaml-variants Not ( &gt;=5.3.0~, &lt;5.3.1~ ) are incompatible.
And because (((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~})) | (dkml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) lhs depends on ((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~}) and (((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~})) | (dkml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) &lt;lhs | &gt;lhs depends on dkml-base-compiler &gt;=5.3.0~, &lt;5.3.1~, Conflict class ocaml-core-compiler Not ( ocaml-base-compiler | ocaml-system ), (((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~})) | (dkml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) *, ocaml-variants Not ( &gt;=5.3.0~, &lt;5.3.1~ ) are incompatible.
And because ocaml 5.3.0 depends on (((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~})) | (dkml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) and ocaml {(= 5.3.0 &amp; post)} true depends on ocaml 5.3.0, ocaml {(= 5.3.0 &amp; post)} true, Conflict class ocaml-core-compiler Not ( ocaml-base-compiler | ocaml-system ), ocaml-variants Not ( &gt;=5.3.0~, &lt;5.3.1~ ) are incompatible.
And because ocaml {(= 5.3.0 &amp; post)} false depends on `post` false and ocaml-compiler 5.3 depends on ocaml {(= 5.3.0 &amp; post)}, ocaml-compiler 5.3, Conflict class ocaml-core-compiler Not ( ocaml-base-compiler | ocaml-system ), `post` Not ( false ), ocaml-variants Not ( &gt;=5.3.0~, &lt;5.3.1~ ) are incompatible.
And because ocaml-variants 5.3.1+trunk depends on ocaml-compiler 5.3 and ocaml-variants 5.3.1+trunk depends on Conflict class ocaml-core-compiler ocaml-variants, ocaml-variants 5.3.1+trunk depends on `post` false.
And because Root  depends on `post` true and Root  depends on ocaml-variants 5.3.1+trunk, Root  is forbidden.
</code></pre>
<p><span>Let‚Äôs break this down.</span></p>
<pre class="example"> <code style="white-space: normal;">
Because ocaml-system &gt;=5.3.0~, &lt;5.3.1~ depends on Conflict class ocaml-core-compiler ocaml-system and ((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~}) rhs depends on ocaml-system &gt;=5.3.0~, &lt;5.3.1~, ((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~}) rhs depends on Conflict class ocaml-core-compiler ocaml-system. (1)
</code> </pre>

<p><span>Because <code class="verbatim">ocaml-system</code>
is in conflict class <code class="verbatim">ocaml-core-compiler</code>
and this formula‚Äôs right hand side (RHS) depends on <code class="verbatim">ocaml-system</code>, the RHS of the formula depends on
<code class="verbatim">ocaml-system</code> in the <code class="verbatim">ocaml-core-compiler</code> conflict class.</span></p>
<pre class="example"> <code style="white-space: normal;">
Because ocaml-base-compiler &gt;=5.3.0~, &lt;5.3.1~ depends on Conflict class ocaml-core-compiler ocaml-base-compiler and (ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~}) lhs depends on ocaml-base-compiler &gt;=5.3.0~, &lt;5.3.1~, (ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~}) lhs depends on Conflict class ocaml-core-compiler ocaml-base-compiler.
</code> </pre>

<p><span>Because <code class="verbatim">ocaml-base-compiler</code> is in conflict class <code class="verbatim">ocaml-core-compiler</code> and this formula‚Äôs left hand
side (LHS) depends on <code class="verbatim">ocaml-base-compiler</code>,
the LHS of the formula depends on <code class="verbatim">ocaml-base-compiler</code> in the <code class="verbatim">ocaml-core-compiler</code> conflict class.</span></p>
<pre class="example"> <code style="white-space: normal;">
And because (ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~}) <lhs |="">lhs depends on ocaml-variants &gt;=5.3.0~, &lt;5.3.1~ and ((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~}) lhs depends on (ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~}), Conflict class ocaml-core-compiler Not ( ocaml-base-compiler ), ((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~}) lhs, ocaml-variants Not ( &gt;=5.3.0~, &lt;5.3.1~ ) are incompatible.
</lhs></code> </pre>

<p><span>And because the parent formula‚Äôs LHS has it‚Äôs RHS
depends on <code class="verbatim">ocaml-variants</code>, and the
formula‚Äôs LHS depends on the formula‚Äôs LHS (duh), then we can‚Äôt select
the LHS of the formula (<code class="verbatim">ocaml-base-compiler</code> or <code class="verbatim">ocaml-variants</code>) and not select <code class="verbatim">ocaml-base-compiler</code> and not select
ocaml-variants (phew).</span></p>
<p><span>Basically, the LHS of the formula depends on
either <code class="verbatim">ocaml-base-compiler</code> or <code class="verbatim">ocaml-variants</code>.</span></p>
<pre class="example"> <code style="white-space: normal;">
And because ((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~}) rhs depends on Conflict class ocaml-core-compiler ocaml-system (1), Conflict class ocaml-core-compiler Not ( ocaml-base-compiler | ocaml-system ), ((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~}) *, ocaml-variants Not ( &gt;=5.3.0~, &lt;5.3.1~ ) are incompatible.
</code> </pre>

<p><span>Because the formula‚Äôs RHS selects <code class="verbatim">ocaml-system</code> in conflict class <code class="verbatim">ocaml-core-compiler</code>, then we can‚Äôt select
(either side of) the formula without selecting <code class="verbatim">ocaml-base-compiler</code> or <code class="verbatim">ocaml-system</code> in <code class="verbatim">ocaml-core-compiler</code>, and <code class="verbatim">ocam-variants</code>.</span></p>
<pre class="example"> <code style="white-space: normal;">
And because (((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~})) | (dkml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) lhs depends on ((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~}) and (((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~})) | (dkml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) <lhs |="">lhs depends on dkml-base-compiler &gt;=5.3.0~, &lt;5.3.1~, Conflict class ocaml-core-compiler Not ( ocaml-base-compiler | ocaml-system ), (((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~})) | (dkml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) *, ocaml-variants Not ( &gt;=5.3.0~, &lt;5.3.1~ ) are incompatible.
</lhs></code> </pre>

<p><span>We can‚Äôt select this formula without selecting
<code class="verbatim">ocaml-base-compiler</code> or <code class="verbatim">ocaml-system</code> in <code class="verbatim">ocaml-core-compiler</code>, and <code class="verbatim">ocam-variants</code>. Note <code class="verbatim">dkml-base-compiler</code> is ignored as there‚Äôs not
compatible versions.</span></p>
<pre class="example"> <code style="white-space: normal;">
And because ocaml 5.3.0 depends on (((ocaml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) | (ocaml-variants {= &gt;=5.3.0~, &lt;5.3.1~})) | (ocaml-system {= &gt;=5.3.0~, &lt;5.3.1~})) | (dkml-base-compiler {= &gt;=5.3.0~, &lt;5.3.1~}) and ocaml {(= 5.3.0 &amp; post)} true depends on ocaml 5.3.0, ocaml {(= 5.3.0 &amp; post)} true, Conflict class ocaml-core-compiler Not ( ocaml-base-compiler | ocaml-system ), ocaml-variants Not ( &gt;=5.3.0~, &lt;5.3.1~ ) are incompatible.
</code> </pre>

<p><span>If the proxy package associated with the filtered
package formula ocaml <code>ocaml {(= 5.3.0 &amp; post)}</code> is
selected (i.e. version <code class="verbatim">true</code>) then we must
have <code class="verbatim">ocaml-base-compiler</code> or <code class="verbatim">ocaml-system</code> in <code class="verbatim">ocaml-core-compiler</code>, and <code class="verbatim">ocam-variants</code>.</span></p>
<pre class="example"> <code style="white-space: normal;">
And because ocaml {(= 5.3.0 &amp; post)} false depends on `post` false and ocaml-compiler 5.3 depends on ocaml {(= 5.3.0 &amp; post)}, ocaml-compiler 5.3, Conflict class ocaml-core-compiler Not ( ocaml-base-compiler | ocaml-system ), `post` Not ( false ), ocaml-variants Not ( &gt;=5.3.0~, &lt;5.3.1~ ) are incompatible.
</code> </pre>

<p><span>If we don‚Äôt select this package formula, we need
post to be false, and <code class="verbatim">ocaml-compiler</code>
depends on this formula, so we can‚Äôt select ocaml-compiler with <code class="verbatim">post=true</code> without <code class="verbatim">ocaml-base-compiler</code> or <code class="verbatim">ocaml-system</code> in <code class="verbatim">ocaml-core-compiler</code>, and <code class="verbatim">ocam-variants</code>.</span></p>
<pre class="example"> <code style="white-space: normal;">
And because ocaml-variants 5.3.1+trunk depends on ocaml-compiler 5.3 and ocaml-variants 5.3.1+trunk depends on Conflict class ocaml-core-compiler ocaml-variants, ocaml-variants 5.3.1+trunk depends on `post` false.
</code> </pre>

<p><span>Because <code class="verbatim">ocaml-variants</code> depends on <code class="verbatim">ocaml-compiler</code> and is in conflict class <code class="verbatim">ocaml-core-compiler</code>, we can‚Äôt select it without
having <code class="verbatim">post=false</code>.</span></p>
<pre class="example"> <code style="white-space: normal;">
And because Root  depends on `post` true and Root  depends on ocaml-variants 5.3.1+trunk, Root  is forbidden.
</code> </pre>

<p><span>Since we set <code class="verbatim">post=true</code> at the root, we have a
conflict.</span></p>
<p><span>This is all a very roundabout way of telling us
that we have a conflict class. This provides a good example to explore
using a custom error provider for.</span></p>
<p><span>After applying the fix, we successfully solve the
dependencies:</span></p>
<pre class="example"><code>Solution Set:
        opam-version = 2.1.0
        (host-arch-arm64, 1)
        (base-domains, base)
        (ocaml, 5.3.1)
        (host-system-other, 1)
        (base-threads, base)
        os = macos
        (base-unix, base)
        (ocaml-compiler, 5.3)
        (base-bigarray, base)
        (ocaml-config, 3)
        (base-nnp, base)
        (base-effects, base)
        (ocaml-variants, 5.3.1+trunk)
        post = true
        arch = arm64

Resolved Dependency Graph:
        (base-bigarray, base)
        (base-domains, base) -&gt; (ocaml, 5.3.1)
        (base-effects, base) -&gt; (ocaml, 5.3.1)
        (base-nnp, base) -&gt; (base-domains, base)
        (base-threads, base)
        (base-unix, base)
        (host-arch-arm64, 1)
        (host-system-other, 1)
        (ocaml, 5.3.1) -&gt; (ocaml-config, 3), (ocaml-variants, 5.3.1+trunk)
        (ocaml-compiler, 5.3) -&gt; (`arch`, arm64), (`opam-version`, 2.1.0), (`os`, macos), (`post`, true), (base-bigarray, base), (base-domains, base), (base-effects, base), (base-nnp, base), (base-threads, base), (base-unix, base), (host-arch-arm64, 1), (host-system-other, 1), (ocaml, 5.3.1)
        (ocaml-config, 3) -&gt; (`os`, macos)
        (ocaml-variants, 5.3.1+trunk) -&gt; (`opam-version`, 2.1.0), (ocaml-compiler, 5.3)
</code></pre></li>
<li><p><span><span class="todo TODO">O</span> a
Debian/Alpine encoding in PubGrub, which I think should be much simpler
than Opam</span></p>
<ol>
<li><p><span><span class="todo TODO">O</span> and tie into
opam with depexts for cross-ecosystem resolutions</span></p></li>
</ol></li>
<li><p><span><span class="todo TODO">O</span> PubGrub
custom error provider</span></p>
<ul>
<li>look at <code class="verbatim">test_package_formula_or_error</code></li>
<li>look at <code class="verbatim">test_opam_repository_ocaml_variants</code></li>
</ul></li>
<li><p><span><span class="todo TODO">O</span> optional
dependencies</span></p></li>
<li><p><span><span class="todo TODO">O</span>
conflicts</span></p>
<p><span>tracking issue <a href="https://github.com/pubgrub-rs/pubgrub/issues/122">here</a></span></p></li>
<li><p><span><span class="todo TODO">O</span> boolean and
integer filter literals</span></p></li>
<li><p><span><span class="todo TODO">O</span> statically
configure possible variable values</span></p></li>
<li><p><span><span class="todo TODO">O</span> read up on
answer set programming</span></p>
<p><span><a href="https://pubgrub-rs-guide.pages.dev/internals/intro">https://pubgrub-rs-guide.pages.dev/internals/intro</a>
is a good starting point</span></p></li>
</ol></li>
<li><p><span>Teaching</span></p>
<ol>
<li><p><span>Supervision 2 of Robinson Computer
Networking</span></p></li>
</ol></li>
</ol>
    </section>
</article>

