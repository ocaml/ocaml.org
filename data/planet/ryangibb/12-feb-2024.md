---
title: 12 Feb 2024
description:
url: https://ryan.freumh.org/2024-02-12.html
date: 2024-02-12T00:00:00-00:00
preview_image:
authors:
- Ryan Gibb
source:
---

<article>
    <div class="container">
        <span>  Previous: <a href="https://ryan.freumh.org/2024-02-05.html"> 5 Feb 2024</a>  </span>
        <span>  Next: <a href="https://ryan.freumh.org/2024-02-19.html">19 Feb 2024</a>  </span>
    </div>
    
    <section>
        <h3>Capability DNS</h3>
<p><span>We have this nameserver that can
provision TLS certificates with ACME using the DNS challenge, and expose
a Cap’NP proto interface <a href="https://github.com/RyanGibb/eon/blob/a442c424ea06b2c819dd48c9e69838e09675b22b/bin/acme/capnp/service_api.capnp">https://github.com/RyanGibb/eon/blob/main/bin/acme/capnp/service_api.capnp</a>.
We also have logic to tunnel Cap’NP over DNS <a href="https://github.com/RyanGibb/eon/tree/a442c424ea06b2c819dd48c9e69838e09675b22b/lib/transport">https://github.com/RyanGibb/eon/tree/main/lib/transport</a>,
and indeed tunnel arbitrary data such as IP-traffic <a href="https://github.com/RyanGibb/eon/tree/a442c424ea06b2c819dd48c9e69838e09675b22b/bin/transport/tunnel">https://github.com/RyanGibb/eon/tree/main/bin/transport/tunnel</a>.
Two ideas we had relating to this were exposing a shell interface <a href="https://github.com/RyanGibb/eon/tree/a442c424ea06b2c819dd48c9e69838e09675b22b/bin/transport/sod">https://github.com/RyanGibb/eon/tree/main/bin/transport/sod</a>
over DNS and tunneling DNS traffic itself over DNS for query privacy a
la Oblivious DNS <a href="https://github.com/RyanGibb/eon/tree/a442c424ea06b2c819dd48c9e69838e09675b22b/bin/transport/dodo">https://github.com/RyanGibb/eon/tree/main/bin/transport/dodo</a>.</span></p>
<p><span>I’ve had a look for any related work
to ‘de-risk’ a paper. The most obvious is <a href="https://dl.acm.org/doi/pdf/10.1145/2377677.2377692">Signposts</a>,
which performs an ‘effectful’ name resolution to establish a
communication channel through features of edge networks that break the
end-to-end principle like NATs and proxies. It relies on DNSSEC to
secure these names.</span></p>
<p><span>Certificate are typically
automatically provisioned with purpose built ACME clients e.g.&nbsp;<a href="https://certbot.eff.org/">certbot</a> and <a href="https://github.com/go-acme/lego">lego</a>, or built-in application
certificate provisioning like <a href="https://caddyserver.com/docs/automatic-https">caddy</a> and <a href="https://stalw.art/docs/server/tls/acme/">stallwart</a>. The
simplest challenge for most of them is HTTP/ALPN, but is limited in the
deployment scenarios supported (<a href="https://mailarchive.ietf.org/arch/msg/acme/ZzgtWzZICj_HQ19geObENv12Lv8/">e.g.</a>.
Support for the DNS challenge is typically done with DNS UPDATES /
service-provider specific backends, which entails managing access
controls to the DNS, often with no granular access control. Some <a href="https://github.com/joohoi/acme-dns">custom nameservers</a> offer
granular access control for this purpose. However, Cap’NP provides us a
mechanism to selectively expose domains to a service for solely the
purpose of provisining a certificate, without having to run a local
certbot. All that needs to be done for an application to support this is
a lightweight language-agnostic Cap’NP client to request a certificate
with a callback for renewal.</span></p>
<p><span>Once the nameserver gains knowledge
of the services running on it, maybe we can start thinking about what
can be done with that knowledge and e.g.&nbsp;exposing them over a <a href="https://tailscale.com/kb/1100/services">VPN</a>.</span></p>
<h3>Lenscap</h3>
<p><span>Anil asked for instructions on how to
deployment the ACME cert provisioning nameserver in our last meeting. To
deploy Lenscap (Let’s Encrypt Nameserver Capability – we need a better
name), build it according to <a href="https://github.com/RyanGibb/eon/#building">https://github.com/RyanGibb/eon/#building</a>.</span></p>
<p><span>Find the binary at
<code>_build/install/default/bin/lenscap</code> or
<code>result/bin/lenscap</code> (depending on if build with opam or
nix).</span></p>
<p><span>On a machine with glue records for the
nameserver for <code>&lt;domain&gt;</code> run:</span></p>
<pre><code>$ lenscap --capnp-secret-key-file secret-key.pem --capnp-listen-address tcp:localhost:7000 --authorative &lt;domain&gt;</code></pre>
<p><span>Or pass in a zonefile for
<code>&lt;domain&gt;</code> with:</span></p>
<pre><code>$ lenscap --capnp-secret-key-file secret-key.pem --capnp-listen-address tcp:localhost:7000 --zonefile &lt;path&gt;/&lt;domain&gt;</code></pre>
<p><span>Get the root capability with:</span></p>
<pre><code>$ cat root.cap</code></pre>
<p><span>And provision a certificate with a client
using:</span></p>
<pre><code>$ ./lenscapc.exe &lt;root.cap contents&gt; &lt;acme account email e.g. ryan@freumh.org&gt; &lt;acme account org for inclusion in the x509 distinguished name e.g. Freumh&gt; &lt;domain e.g. freumh.org&gt;</code></pre>
<p><span>This is at an ‘alpha’ quality. Work to be
done includes using cert renewal with sturdy refs. Anil said to look at
OCurrent OCaml CI for this.</span></p>
<h3>Federated Identify</h3>
<p><span>Brainstormed with Jess about
(first) what I’m working on/thinking about:</span></p>
<p><img src="https://ryan.freumh.org/images/2024-02-08.jpg"></p>
<p><span>Then she explained her Identity
Service to me, and I get it now. It’s inverting the flow of ‘identify’
form a pull-based model to a pull based model. And any piece of
information (such as an age, email address, etc), can be tagged with a
cryptographic reference (e.g.&nbsp;with macaroons).</span></p>
<p><span>I think we need to understand
some matrix proposals to make an informed design of our federated
identity service, specifically:</span></p>
<ul>
<li><a href="https://matrix.org/blog/2020/06/02/introducing-p2p-matrix/">P2P</a>
which hosts a homeserver on every device and communicated via a
‘pinecone’ overlay network which emphasises local connectivity a la <a href="https://www.cl.cam.ac.uk/~jac22/haggle/5.pdf">haggle</a>. Really
cool!</li>
<li><a href="https://github.com/matrix-org/matrix-spec-proposals/blob/ae646ac6360ba691d8210057835ba45ed8da712d/proposals/4080-cryptographic-identities.md">CryptoIDs
MSC4080</a> provides a pre-requisite for account portability with
per-room PseudoIDs that can be managed by clients.</li>
<li><a href="https://github.com/matrix-org/matrix-spec-proposals/blob/e26c97c2bb69dc1f7ca5297abfa57786561505bb/proposals/2787-portable-identities.md">Portable
Identities MSC2787</a> describes how to enable account portability.
These two specs talk a lot about the crypto but I’m unsure how the user
identity resolution to a homeserver address will work. There is some <a href="https://github.com/matrix-org/matrix-spec/issues/246">talk</a> of
DIDs. It seems ActivityPub people are thinking about similar things with
‘Nomadic Identities’.</li>
<li><a href="https://spec.matrix.org/latest/#identity">3PIDs</a> Matrix
supports 3rd-party-ids (3PIDs) as a method to authenticate, identify and
discover users. Jess’ Tardis design seems like a great alternative
architecture to this, might necessitate protocol changes that our proxy
idea we floated wouldn’t.</li>
</ul>
<p><span>I skimmed <a href="https://arxiv.org/pdf/2402.03239.pdf">Bluesky and the AT Protocol:
Usable Decentralized Social Media</a> by Martin Kleppmann et.
all.</span></p>
<ul>
<li>It observers a difficulty with Mastodon/ActivityPub is that the
server’s domain name becomes part of a user’s username which hinders
mobility, and ‘only a small fraction of social media users have the
technical skills and inclination to [host their own]’.</li>
<li>(I think Eilean is one potential solution to this, but there is
still the issue of discoverability across servers and the cost of
self-hosting.)</li>
<li>It proposes a decentralised architecture instead of a federated one,
and ‘opening up the internals of a service’ for a ‘marketplace of
ideas’.</li>
<li>At this point in reading the introduction my question is, what
technical mechanisms prevent centralisation of a service?</li>
<li>Bluesky proposes a globally unique ‘handle’ per username which
requires some centralised authority, instead of Mastodon’s per-server
uniqueness.</li>
<li>They discuss using a blockchain based naming systems but want to
avoid requiring purchasing cryptocurrency.</li>
<li>Ah, they use DNS to provide unique names!</li>
<li>I think this is equivalent to proxying a personal domain to a hosted
mastodon server – which I’ve said should be possible for both mastodon
and matrix for a while (but afaik isn’t supported).</li>
<li>(Can you proxy with a .well-known?)</li>
<li>This makes DNSSEC all the more relevant.</li>
<li>They have some concept of multi-homing (organisations can allow
users to hang off an institutional domain).</li>
<li>I really agree with their algorithmic feed discussion, and this is
something I’ve though Mastodon should have since I started using
it.</li>
<li>They have a concept of Personal Data Servers (which remind me of
specialised <a href="https://anil.recoil.org/papers/2015-aarhus-databox.pdf">databoxes</a>),
and public indexing infrastructure analogous to search engines.</li>
<li>3.5 User Identity uses DID’s for account mobility, that are hung of
a domain name (or HTTP .well-known) and point back to a domain name
(bidirectionally).</li>
</ul>
<h3>VURL</h3>
<p><span>The idea is a DNS-inspired resolution to rrs
better suited to larger data types e.g.&nbsp;git, file, etc. Expanding
resolution to the whole URL. This could be stored in a store with the
path a hash of the contents for uniqueness a la Nix. The resolver would
keep bidirectional track of resolutions for provenance end replaying.
Maybe this is the resolution/replay/caching mechanism behind shark;
shark is a tree of URLs.</span></p>
<p><span>I should type up a brief doc describing
this.</span></p>
<h3>Eilean</h3>
<p><span>It looks like George Shammas from JS has
make his NixOS config public, and the <a href="https://github.com/georgyo/nix-conf/commit/0c54287d07917af96031343dd78f22c172fa3be4#diff-1f86bfe20707ca1714dd8919f49b3ab96c65b7c2b65dceb573ad91be33e5d091">matrix
bridges</a> might be useful for Eilean.</span></p>
<p><span>Speaking of Eilean, with ACME cert
provisioning and DNS record modification it could provide a 100% <a href="https://ryan.freumh.org/blog/fosdem/index.html#internet.nl">internet.nl</a> scoring
website &amp; mailserver out of the box. I’m thinking about whether this
could be a paper. Maybe as a use-case in the <a href="https://ryan.freumh.org/index.html#capability-dns">capability DNS</a> paper.</span></p>
<h2>MirageOS Retreat</h2>
<p><span>Patrick and I have signed up to
the MirageOS restreat with ideas to work on <a href="https://ryan.freumh.org/#hibernia">hibernia</a>, ocaml-dns authoritative server DNSSEC
support, a MirageOS PiHole.</span></p>
<h3>Teaching</h3>
<p><span>Supervised Robinson Part IB networking.
It’s really great teaching a course you know a lot about and are
passionate about. I’m trying to make it engaging by giving them some
(optional) practical homeworks.</span></p>
<blockquote>
<p><span>And then, completely optional practical
‘homeworks’ are:</span></p>
<ul>
<li><p><span>To traceroute analyse a path to a
website, say, freumh.org. Bonus points if you can tell me what country
it’s in.</span></p></li>
<li><p><span>To try deploying a website, from
scratch. What does from scratch mean I hear you say? Well, however far
you want to take it.</span></p>
<p><span>You could host it on a Virtual Private
Server <a href="https://ryan.freumh.org/atom.xml#fn1" class="footnote-ref" role="doc-noteref"><sup>1</sup></a> with a webserver like nginx/caddy.
Make it accessible over IPv6 for bonus point.</span></p>
<p><span>If you’re bold, could you use an old
laptop/raspberry pi? What problems might you run into?</span></p>
<p><span>You might want to get a domain name for
your website. You could even host the nameserver yourself with
e.g.&nbsp;bind9.</span></p>
<p><span>You can provision TLS certs with an ACME
CA <a href="https://ryan.freumh.org/atom.xml#fn2" class="footnote-ref" role="doc-noteref"><sup>2</sup></a> like Let’s Encrypt for
HTTPS.</span></p>
<p><span>Try using https://internet.nl/ to test
your new cyber-home. You might need to think about DNS
security.</span></p>
<p><span>Look at what traffic you get. Is there
any? Is it malicious? Are the clients humans are bots? Where are they
from? What clients are they using?</span></p></li>
</ul>
</blockquote>
<section class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li><p><span><a href="https://www.hetzner.com/cloud/">https://www.hetzner.com/cloud/</a></span><a href="https://ryan.freumh.org/atom.xml#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li><p><span><a href="https://www.rfc-editor.org/rfc/rfc8555">https://www.rfc-editor.org/rfc/rfc8555</a></span><a href="https://ryan.freumh.org/atom.xml#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
    </section>
</article>

