---
title: Unikernels
description:
url: https://anil.recoil.org/projects/unikernels
date: 2010-01-01T00:00:00-00:00
preview_image:
authors:
- Anil Madhavapeddy
source:
---

<div>
  <h1>Unikernels</h1>
  <p></p><p>I proposed the concept of "unikernels" -- single-purpose appliances that are compile-time specialised into standalone bootable kernels, and sealed against modification when deployed to a cloud platform. In return they offer significant reduction in image sizes, improved efficiency and security, and reduce operational costs. I also co-founded the MirageOS project which is one of the first complete unikernel frameworks, and also integrated them to create the Docker for Desktop apps that are used by hundreds of millions of users daily.</p>
<p>While working on <a href="https://anil.recoil.org/projects/perscon">Personal Containers</a> in late 2008, I had a need to run lots of distributed edge nodes holding personal data. The state of computer security is generally a disaster when it comes to leaving software unupgraded for even a few months, so building robust infrastructure that normal people could use was proving quite difficult.  Meanwhile, my PhD research in building <a href="https://anil.recoil.org/projects/melange">Functional Internet Services</a> had constructed really viable prototypes of network protocols written in pure OCaml, and I'd previously used OCaml industrially in the <a href="https://anil.recoil.org/projects/xen">Xen Hypervisor</a> hypervisor to write lots of system management code.</p>
<h2>The Early Days</h2>
<p>All of these ideas came crashing together in late 2009 and I decided to have a go at putting together a complete OCaml-based operating system.  The adventure began with grabbing the Xen mini-os and the C lwIP stack to provide networking and sqlite for persistent storage, and hacking for a few months until everything booted and was reasonably stable.  I then convinced <a href="https://github.com/samoht" class="contact">Thomas Gazagnaire</a> (then at Inria) to help me with storage integration with OCaml in <a href="https://anil.recoil.org/papers/2010-dyntype-wgt">Dynamics for ML using Meta-Programming</a> and we had a remarkably good prototype that we presented in <a href="https://anil.recoil.org/papers/2010-hotcloud-lamp">Turning Down the LAMP: Software Specialisation for the Cloud</a>.</p>
<p>I wrote up my early thoughts on <a href="https://anil.recoil.org/papers/2010-bcs-visions">Multiscale not multicore: efficient heterogeneous cloud computing</a> to describe this emerging idea of heterogenous cloud and edge computing combined into a single programming model. After realising that the prototype worked well, I started steadily removing C bindings (like lwIP) and replacing them with pure OCaml code all the way down to the VM Xen interface (e.g. like <a href="https://github.com/mirage/mirage-tcpip">mirage-tcpip</a>). These early heady days saw lots of prototypes and experimentation:</p>
<ul>
<li>I experimented with various models for edge computing for personal data handling, such as <a href="https://anil.recoil.org/papers/2011-icdcn-droplets">Unclouded vision</a> and <a href="https://anil.recoil.org/papers/2010-iswp-dustclouds">Using Dust Clouds to Enhance Anonymous Communication</a>.  These mechanisms are still surprisingly unrealised in the wild, with some aspects becoming popular (e.g. serverless functions), but not the aggregation networks.</li>
<li>In the office next door, @mrry and friends were doing their PhDs and building distributed execution engines. I helped with building out <a href="https://anil.recoil.org/papers/2011-nsdi-ciel">CIEL: A universal execution engine for distributed data-flow computing</a> and experimenting with what a functional interface would look like in <a href="https://anil.recoil.org/notes/datacaml-with-ciel">DataCaml: distributed dataflow programming in OCaml</a>. As of 2021, I'm revisiting this approach in the context of algebraic effects in our multicore OCaml project.</li>
<li>I looked into closer integration with hypervisors as well, via investigating <a href="https://anil.recoil.org/papers/2011-fccm-cloudfpga">Reconfigurable Data Processing for Clouds</a> (TL;DR -- too early, but happened a few years later in commercial clouds) and <a href="https://anil.recoil.org/papers/2012-oud-xen">Programming the Xen cloud using OCaml</a>.</li>
</ul>
<h2>Building MirageOS and figuring out unikernels</h2>
<p>One of the earliest decisions I made in MirageOS was to self-host as soon as possible. I registered openmirage.org in late 2009, and (joined by @mort and @djs55) we had a Xen-based website running in short order in 2010 (now <a href="https://github.com/mirage/mirage-www">mirage-www</a>).  A big boost to the project was winning a grant from the <a href="https://investor.verisign.com/news-releases/news-release-details/verisign-announces-winners-grants-aimed-strengthening-internet">Verisign Infrastructure Awards</a>, which was the first external validation that this thing might be of interest to other people.  As my <a href="https://anil.recoil.org/projects/ocamllabs">OCaml Labs</a> group grew in the University, more intrepid hackers joined the group and started making MirageOS work properly.</p>
<p>A year of intense work in 2012 turned the prototype into a fully-fleshed out paper which got soundly rejected by the OSDI review committee as we hadn't identified what the core systems research contribution was (as opposed to the impressive programming work, which they acknowledged in the rejection).  I'd just gone to visit Timothy Roscoe's group in ETH where they had been working on the Barrelfish multikernel OS, and the answer came right to me while in the pub with <a href="mailto:jon.crowcroft@cl.cam.ac.uk" class="contact">Jon Crowcroft</a>.  What MirageOS represented was a revival of the concept of library operating systems, but with the additional twist that it specialised the compilation into single-user mode. Thus, I settled on the term "unikernels" to describe this idea and rewrote the paper and duly published it in <a href="https://anil.recoil.org/papers/2013-asplos-mirage">Unikernels: library operating systems for the cloud</a>.</p>
<p>Publishing a major research paper in ASPLOS led to further momentum and interest:</p>
<ul>
<li><a href="https://github.com/djs55" class="contact">Dave Scott</a> and I published a note in the Communications of the ACM dubbed <a href="https://anil.recoil.org/papers/rise-of-libos">Unikernels: Rise of the Virtual Library Operating System</a> which was pretty widely read at the time.</li>
<li><a href="https://github.com/samoht" class="contact">Thomas Gazagnaire</a> moved to Cambridge and started building the storage stack that we'd wanted for years. It was initially called <a href="https://anil.recoil.org/papers/2014-oud-irminsule">Irminsule: a branch-consistent distributed library database</a> (later shortened to <a href="https://irmin.org">irmin</a>) and kicked off our interest in moving beyond CRDTs to <a href="https://anil.recoil.org/papers/2015-jfla-irmin">Mergeable persistent data structures</a>. Irmin picked up a life of its own and was later used by Arthur Breitman as the storage stack in the <a href="https://tezos.com">Tezos</a> proof-of-stack blockchain in 2017.</li>
<li><a href="http://www.skjegstad.com/about/" class="contact">Magnus Skjegstad</a> also returned to the group and we began hacking on real-time edge infrastructure using unikernels, such as <a href="https://anil.recoil.org/papers/2015-diynet-kadupul">Kadupul: Livin' on the Edge with Virtual Currencies and Time-Locked Puzzles</a>. Although this work got put on ice in 2015, I'm revisiting it in 2022 in the context of <a href="https://anil.recoil.org/projects/osmose">Interspatial OS</a>.</li>
<li><a href="https://github.com/https://roscidus.com" class="contact">Thomas Leonard</a>, <a href="https://anil.recoil.org/news.xml" class="contact">David Sheets</a> and <a href="https://github.com/balrajsingh" class="contact">Balraj Singh</a> joined our burgeoning group and we all prototyped the idea of real-time booting of edge unikernels in <a href="https://anil.recoil.org/papers/2015-nsdi-jitsu">Jitsu: Just-In-Time Summoning of Unikernels</a>. This represented the first time we'd booted VMs on ARM, as it was very much a niche architecture for virtualisation back then.</li>
<li>Meanwhile, in the <a href="https://mirageos.org/blog/ocaml-tls-api-internals-attacks-mitigation">beach in Mirleft</a> in Morrocco, <a href="https://anil.recoil.org/news.xml" class="contact">David Kaloper-Mer≈°injak</a> and <a href="https://github.com/hannesm" class="contact">Hannes Mehnert</a> built an entire TLS stack in OCaml which we published in <a href="https://anil.recoil.org/papers/2015-usenixsec-nqsb">Not-Quite-So-Broken TLS</a>.  This was a real turning point in the project as it represented an external open source contribution (with both of them joining the University subsequently) and also grew our belief that it wasn't a completely dumb idea to rebuild every Internet protocol in a functional language.</li>
</ul>
<p>MirageOS also gave us ideas for other top systems research, such as the filesystem verification idas in <a href="https://anil.recoil.org/papers/2015-sosp-sibylfs">SibylFS: formal specification and oracle-based testing for POSIX and real-world file systems</a> (which I still intend to use for a proper POSIX compatibility layer on top of Irmin at some point), and <a href="https://anil.recoil.org/papers/2016-usenix-flick">FLICK: Developing and Running Application-Specific Network Services</a> (to build domain-specific data processing platforms, something that I'm now working on in 2021 in <a href="https://anil.recoil.org/projects/4c">Trusted Carbon Credits</a>).</p>
<h2>To Unikernel Systems and Docker</h2>
<p>By this point, MirageOS was also a thriving open source community with regular IRC meetings and the beginning of hack retreats.  There were several organisations using it, and the overall OCaml community started using some of our protocol implementations independently of the unikernel ideas.  For example, the <a href="https://github.com/mirage/ocaml-cohttp">cohttp</a> was something I rapidly hacked together for the ASPLOS deadline, but the Unix/Lwt/Async backends are now used in quite a few major systems (including within Jane Street, no less).</p>
<p>We had to deal with all this growth, as a university isn't the easiest place to have a very large group. In 2015, <a href="https://github.com/balrajsingh" class="contact">Balraj Singh</a> (who had made huge contributions to the Mirage TCP/IP stack) <a href="https://github.com/samoht" class="contact">Thomas Gazagnaire</a> and myself founded Unikernel Systems along with <a href="https://www.cst.cam.ac.uk/people/jdy22" class="contact">Jeremy Yallop</a>, <a href="https://github.com/https://roscidus.com" class="contact">Thomas Leonard</a>, <a href="http://www.skjegstad.com/about/" class="contact">Magnus Skjegstad</a>, <a href="https://github.com/yomimono" class="contact">Mindy Preston</a>, <a href="https://github.com/justincormack" class="contact">Justin Cormack</a>, <a href="https://anil.recoil.org/news.xml" class="contact">David Sheets</a>, <a href="https://anil.recoil.org/news.xml" class="contact">Amir Chaudhry</a>, and <a href="https://github.com/djs55" class="contact">Dave Scott</a>.  After a fun few months pitching to west coast VCs in California (including fun chats with the likes of Jerry Yang), Peter Fenton from Benchmark convinced us to meet Solomon Hykes over at Docker.  This conversation changed the course of our careers, as he shared his vision for the future of containerisation and how unikernels could fit in there.</p>
<p>A short set of negotiations later, and <a href="https://techcrunch.com/2016/01/21/docker-acquires-unikernel-systems-as-it-looks-beyond-containers/">Unikernel Systems was acquired by Docker</a> in 2016. We spent a very fun couple of years commercialising the technology and incorporating it into Docker for Desktop.  Our work ended up shipping as Docker for Desktop which remains one of the most popular developer tools in the world, and I describe its architecture <a href="https://www.youtube.com/watch?v=zqFDEDl5Zes">in this talk</a>.</p>
<h2>Unikernels in 2021</h2>
<p>Our startup aside, the core development of MirageOS continued to be nicely distributed in several spinouts:</p>
<ul>
<li><a href="https://kcsrk.info" class="contact">KC Sivaramakrishnan</a> and <a href="https://anil.recoil.org/news.xml" class="contact">Gemma Gordon</a> founded <a href="https://ocamllabs.io">OCLC</a> in 2016 as a commercial spinout from the university group to drive OCaml tooling and core compiler development.</li>
<li><a href="https://github.com/hannesm" class="contact">Hannes Mehnert</a> setup the &lt;robur.io&gt; cooperative in late 2017 with a <a href="https://robur.coop/Our%20Work/Projects">large set of Mirage projects</a>.</li>
<li><a href="https://github.com/samoht" class="contact">Thomas Gazagnaire</a> founded <a href="https://tarides.com">Tarides</a> in 2018 after leaving Docker, where they maintain MirageOS and drive development of the Irmin storage stack in particular.</li>
</ul>
<p>The wider industry also saw a number of interesting spinouts, as many other communities also latched on to the ideas of unikernels and began their own language-specific and domain-specific versions. I joined the advisory boards of IncludeOS (now sadly defunct) and Zededa (now thankfully going from strength to strength in edge computing) to help guide strategy and adoption outside of just MirageOS.  Dr Pierre Oliver maintains a great list of <a href="https://github.com/olivierpierre/unikernel-papers">unikernel papers</a> where you can see the diversity and interest in unikernels. One of the most exciting implementations of a C-based unikernel can be found in <a href="https://www.unikraft.org/">Unikraft</a>.</p>
<p>As for my interest in unikernels moving forward? My heart always remains in finding the intersection of <em>safety</em> and <em>performance</em>, which means I mostly pay attention to language-based approaches. MirageOS continues to thrive (particularly with the effect system being integrated into OCaml in 2022, which will really change the way we develop OCaml code for embedded systems).  Since 2020, I've been investigating the application of DIFC to embedded infrastructure, for example via <a href="https://anil.recoil.org/papers/2019-edgesys-snape">Snape: The Dark Art of Handling Heterogeneous Enclaves</a>.</p>
<p>In 2025, we were also honoured to receive a <a href="https://anil.recoil.org/notes/unikernels-test-of-time">most influential paper</a> award from ASPLOS for the original paper.</p>
<p></p>
</div>

