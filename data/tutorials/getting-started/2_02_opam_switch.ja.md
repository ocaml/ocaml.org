---
id: opam-switch-introduction
title: opamスイッチ入門
description: |
  このページでは、opamスイッチの簡単な紹介、その用途、作成方法を説明します。
category: "Tooling"
language: Japanese
---

OCamlのパッケージマネージャーであるopamは、隔離されたOCaml環境である_スイッチ_という概念を導入しています。スイッチはOCaml初心者の間で混乱を引き起こすことが多いため、このドキュメントではopamスイッチとその依存関係管理やプロジェクト固有の設定に対する使用法をよりよく理解することを目的としています。

opamは「スイッチ」と呼ばれる複数の同時インストールプレフィックスを管理するように設計されています。Pythonの`virtualenv`と同様に、opamスイッチは隔離された環境を作成するツールです。スイッチは互いに独立しており、独自のインストール済みパッケージ、リポジトリ、設定オプションのセットを持っています。スイッチには独自のOCamlコンパイラ、ライブラリ、バイナリもあります。これにより、複数のコンパイラバージョンを同時に利用可能にできます。

## スイッチの一覧表示

以下のコマンドは、システムに設定されているopamスイッチを表示します。[OCamlのインストール](/docs/installing-ocaml?lang=ja)で説明されているようにOCamlのインストールを完了すると、`default`というスイッチが1つ作成されています。その時点でスイッチを一覧表示すると、そのスイッチのみが表示されます。

```shell
$ opam switch list
#   switch   compiler      description
->  default  ocaml.4.13.1  default
```

## 新しいスイッチの作成

新しいopamスイッチを作成するには、`opam switch`コマンドの後に目的のスイッチ名とオプションのOCamlコンパイラバージョンを指定します。例えば、特定のOCamlコンパイラバージョンで「my_project」という名前のスイッチを作成するには：

```
opam switch create my_project <compiler-version>
```

`<compiler-version>`を使用したいOCamlコンパイラのバージョン（例：`5.2.0`）に置き換えてください（利用可能なOCamlコンパイラバージョンのリストは`opam switch list-available`を参照）。

コンパイラを指定せず、`my_project`がディレクトリの場合、opamはデフォルトバージョンを選択します。`my_project`がディレクトリでない場合、opamはそれをプレーンな名前とみなし、同じ名前のコンパイラバージョンのインストールを試みます。

次に、新しいスイッチを**アクティブ化**します。これにより、現在選択されているスイッチとして設定され、OCaml関連の操作はすべてこのスイッチを使用します。以下を実行してアクティブ化できます：

```
opam switch my_project
```

`my_project`を新しいスイッチの名前に置き換えてください。

以下を実行してアクティブ化を**確認**します：

```
opam switch
```

出力が新しいスイッチの名前であれば、アクティブ化に成功しています！これで、OCamlプロジェクトに使用し、他のスイッチやシステム全体のOCaml環境に影響を与えることなく、このスイッチ固有のOCamlパッケージ、ライブラリ、依存関係をインストールできます。

## スイッチの種類

### グローバルスイッチ

グローバルスイッチは、システム全体のOCamlインストールによく使用され、特定のプロジェクトやディレクトリに関連付けられていません。スイッチはシステムレベルで作成・設定され、通常、OCamlとそのエコシステムをグローバルスケールで管理するために使用されます。

opamスイッチを作成する場合、他に設定しない限り、デフォルトでグローバルです。`--global`フラグを付けてopam switchコマンドを使用することで、明示的にグローバルスイッチを選択することもできます。

opamの**システムスイッチ**は、オペレーティングシステム上のOCamlインストールに関連付けられたグローバルスイッチです。システムスイッチはシステム全体からアクセスできます。

### ローカルスイッチ

一方、ローカルopamスイッチは特定のプロジェクトディレクトリに関連付けられています。プロジェクトのディレクトリまたはサブディレクトリ内に作成されるため、その特定のプロジェクトのコンテキスト内でのみOCamlとその依存関係を管理できます。

つまり、ローカルスイッチはプロジェクト固有のOCaml環境の隔離を提供し、システム全体や他のプロジェクト固有のOCamlインストールに干渉することなく、特定のプロジェクトに必要な特定のコンパイラバージョンとパッケージを定義・管理できます。

これは、プロジェクトがOCamlとそのパッケージの特定のバージョンを使用することを保証したい場合に特に便利です。

ローカルスイッチは現在の作業ディレクトリに基づいて自動的に選択されます。関連するローカルスイッチがあるディレクトリに移動すると、opamはそのディレクトリ内のOCaml関連の操作にそのスイッチを使用します。

## スイッチの選択

opamのほとんどのパッケージ関連コマンドは、選択されたスイッチのコンテキスト内で動作します。以下のいくつかの方法でスイッチを選択できます：

**グローバル選択**: `opam switch <switch>`コマンドを使用します。上書きされない限り、opamはこのスイッチをすべての後続コマンドに使用します。

**ローカル選択**: スイッチを含むディレクトリで作業している場合、自動的に選択されます。ローカルスイッチはopamルートの外部にあります。

**環境変数**: 単一のシェルセッション内でスイッチを選択するには、`OPAMSWITCH=<switch>`環境変数を設定します。シェル環境を適切に設定するには`eval $(opam env --switch <switch>)`を使用してください。

**コマンドラインフラグ**: 単一のコマンドにスイッチを指定するには、`--switch <switch>`コマンドラインフラグを使用します。

---

> opamスイッチの詳細と使い方については、[opamマニュアルのFile Hierarchiesページ](https://opam.ocaml.org/doc/Manual.html)（英語）と[スイッチ専用ページ](https://opam.ocaml.org/doc/man/opam-switch.html)（英語）を参照してください。
