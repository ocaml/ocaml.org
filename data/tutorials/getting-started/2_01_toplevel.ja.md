---
id: toplevel-introduction
title: OCamlトップレベル入門
description: |
  このページでは、OCamlトップレベルの簡単な紹介をします。
category: "Tooling"
language: Japanese
---

OCamlトップレベルは、ユーザーとOCamlの対話です。ユーザーがOCamlコードを書くと、UTopがそれを評価します。このため、Read-Eval-Print-Loop（REPL）とも呼ばれます。`ocaml`や`utop`など、いくつかのOCamlトップレベルが存在します。[OCaml Platform](/docs/platform)ツールチェインの一部であるUTopの使用をお勧めします。

UTopを実行するには、`utop`コマンドを使用します。以下のように表示されます：

```shell
$ utop
────────┬─────────────────────────────────────────────────────────────┬─────────
        │ Welcome to utop version 2.12.1 (using OCaml version 5.0.0)! │
        └─────────────────────────────────────────────────────────────┘

Type #utop_help for help about using utop.

─( 17:00:09 )─< command 0 >──────────────────────────────────────{ counter: 0 }─
utop #
```

`Ctrl-D`（ファイルの終わり）を押すか、`#quit;;`と入力して`utop`を終了します。

UTopはハッシュプロンプト`#`を表示します。これはCLIの`$`に似ています。この`#`は入力を待っていることを意味するので、プロンプトの後にコードを書き始めることができます。評価するには、式の終わりを示すためにダブルセミコロン`;;`を追加して`Enter`を押してください。

ダブルセミコロンで終わる行は、プロンプトとダブルセミコロンの間に入力されたすべてのものの構文解析、型チェック、評価をトリガーします。ダブルセミコロンの解釈はOCamlインタプリタではなく、UTopによって行われます。ダブルセミコロンで終了したエントリの評価が完了すると、REPLは別の入力を待ちます。

`#`で始まるコードサンプルは、UTopにコピー＆ペーストすることを意図しています。

例えば、以下のコードスニペットを考えてみましょう：

```ocaml
# 2 + 2;;
- : int = 4
```

上のコードスニペットでは、`2 + 2;;`がユーザーの入力で、`- : int = 4`がOCamlの出力です。

`Enter`を押す前にコードを修正する必要がある場合は、キーボードの左右の矢印キーを使用してテキスト内を移動できます。上下の矢印キーを使用すると、以前に評価された式をナビゲートできます。ダブルセミコロン`;;`なしで`Enter`を入力すると新しい行が作成されるため、この方法で複数行の式を書くことができます。

`#quit`や`#help`のようにハッシュ文字`#`で始まるコマンドは、OCamlでは評価されません。UTopによるコマンドとして解釈されます。

これでUTopでハッキングする準備ができました！トップレベルで問題が発生した場合は、遠慮なく[Discussで質問](https://discuss.ocaml.org/)してください。

> 注意：ダブルセミコロン`;;`はトップレベル以外のOCaml構文でも有効なトークンです。OCamlソースコード内では、[no-op](https://en.wikipedia.org/wiki/NOP_(code))（何もしない操作）であり、いかなる動作もトリガーしないため、コンパイラに無視されます。ファイルをコンパイルまたはスクリプトとして解釈する場合、OCamlで書くときにダブルセミコロンは省略でき、省略すべきです。残しておいてもエラーにはなりませんが、不要です。コンパイラはそれらを許容しますが、これはUTopからファイルへのコピー＆ペーストを、削除する必要なく行えるようにするためです。

## UTopでのパッケージの使用

### UTopでのライブラリの読み込み

現在のopamスイッチにインストールされたパッケージのライブラリをUTopで使用したい場合は、トップレベルに

```ocaml
# #require "<LIBRARY_NAME>";;
```

と入力して、ライブラリのすべての定義を利用可能にします。例えば、以下を試してみてください

```ocaml
# Str.quote {|"hello"|};;
Error: Unbound module Str

# #require "str";;

# Str.quote {|"hello"|};;
- : string = "\"hello\""
```

**ヒント**: UTopは利用可能なライブラリを認識しており、コード補完が機能します。`utop`の外では、`ocamlfind list`を使用してライブラリの完全なリストを表示できます。opamパッケージは複数のライブラリをバンドルでき、ライブラリは複数のモジュールをバンドルできることに注意してください。

### UTopでのプリプロセッサ拡張（PPX）の使用

プリプロセッサ拡張は、コードのアノテーションを通じてコード生成を可能にします
（例については、[「はじめてのOCamlプログラム」の「プリプロセッサを使用したコード生成」セクション](/docs/your-first-program#using-the-preprocessor-to-generate-code)を参照してください）。

UTopでPPXを有効にするには、対応するライブラリを読み込むだけです。

[`ppx_deriving`](https://ocaml.org/p/ppx_deriving/latest)パッケージがopamスイッチにインストールされている場合は、`#require "ppx_deriving.show"`を実行します。
