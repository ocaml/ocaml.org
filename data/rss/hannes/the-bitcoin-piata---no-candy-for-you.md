---
title: "The Bitcoin Pi\xF1ata - no candy for you"
description:
url: https://hannes.robur.coop/Posts/Pinata
date: 2018-04-18T11:38:17-00:00
preview_image:
featured:
---

<h2>History</h2>
<p>On February 10th 2015 David Kaloper-Mer&scaron;injak and Hannes Mehnert
<a href="https://mirage.io/announcing-bitcoin-pinata">launched</a> (read also <a href="http://amirchaudhry.com/bitcoin-pinata">Amir's
description</a>) our <a href="https://en.wikipedia.org/wiki/Bug_bounty_program">bug bounty
program</a> in the form of our
<a href="http://ownme.ipredator.se">Bitcoin Pi&ntilde;ata</a> MirageOS unikernel.  Thanks again to
<a href="https://ipredator.se">IPredator</a> for both hosting our services and lending us
the 10 Bitcoins!  We <a href="https://mirage.io/blog/bitcoin-pinata-results">analysed</a> a
bit more in depth after running it for five months.  Mindy recently wrote about
<a href="https://somerandomidiot.com/blog/2018/04/17/whacking-the-bitcoin-pinata/">whacking the Bitcoin
Pi&ntilde;ata</a>.</p>
<p>On March 18th 2018, after more than three years, IPredator, the lender of the Bitcoins, repurposed the 10 Bitcoins for other projects.  Initially, we thought that the Pi&ntilde;ata would maybe run for a month or two, but IPredator, David, and I decided to keep it running.  The update of the Pi&ntilde;ata's bounty is a good opportunity to reflect on the project.</p>
<p>The 10 Bitcoin in the Pi&ntilde;ata were fluctuating in price over time, at peak worth 165000&euro;.</p>
<p>From the start of the Pi&ntilde;ata project, we published the <a href="https://github.com/mirleft/btc-pinata">source code</a>, the virtual machine image, and the versions of the used libraries in a git repository.  Everybody could develop their exploits locally before launching them against our Pi&ntilde;ata.  The Pi&ntilde;ata provides TLS endpoints, which require private keys and certificates.  These are generated by the Pi&ntilde;ata at startup, and the secret for the Bitcoin wallet is provided as a command line argument.</p>
<p>Initially the Pi&ntilde;ata was deployed on a Linux/Xen machine, later it was migrated to a FreeBSD host using BHyve and VirtIO with <a href="https://github.com/solo5/solo5">solo5</a>, and in December 2017 it was migrated to native BHyve (<a href="https://hannes.robur.coop/Posts/Solo5">using <code>ukvm-bin</code> and solo5</a>).  We also changed the Pi&ntilde;ata code to accomodate for updates, such as the <a href="https://mirage.io/blog/announcing-mirage-30-release">MirageOS 3.0 release</a>, and the discontinuation of floating point numbers for timestamps (asn1-combinators 0.2.0, x509 0.6.0, tls 0.9.0).</p>
<h2>Motivation</h2>
<p>We built the Pi&ntilde;ata for many purposes: to attract security professionals to evaluate our <a href="https://mirage.io/blog/introducing-ocaml-tls">from-scratch developed TLS stack</a>, to gather empirical data for our <a href="https://usenix15.nqsb.io">Usenix Security 15 paper</a>, and as an improvement to current bug bounty programs.</p>
<p>Most bug bounty programs require communication via forms and long wait times for
human experts to evaluate the potential bug.  This evaluation is subjective,
intransparent, and often requires signing of non-disclosure agreements (NDA),
even before the evaluation starts.</p>
<p>Our Pi&ntilde;ata <em>automates</em> these parts, getting rid of wait times and NDAs.  To get
the private wallet key that holds the bounty, you need to successfully establish
an authenticated TLS session or find a flaw elsewhere in the stack, which allows
to read arbitrary memory.  Everyone can track transactions of the blockchain and
see if the wallet still contains the bounty.</p>
<p>Of course, the Pi&ntilde;ata can't prove that our stack is secure, and it can't prove
that the access to the wallet is actually inside.  But trust us, it is!</p>
<h2>Observations</h2>
<p>I still remember vividly the first nights in February 2015, being so nervous that I woke up every two hours and checked the blockchain.  Did the Pi&ntilde;ata still have the Bitcoins?  I was familiar with the code of the Pi&ntilde;ata and was afraid there might be a bug which allows to bypass authentication or leak the private key.  So far, this doesn't seem to be the case.</p>
<p>In April 2016 we stumbled upon an <a href="https://hannes.robur.coop/Posts/BadRecordMac">information disclosure in the virtual network
device driver for Xen in MirageOS</a>.  Given enough
bandwidth, this could have been used to access the private wallet key.  We
upgraded the Pi&ntilde;ata and released the <a href="https://mirage.io/blog/MSA00">MirageOS Security Advisory
00</a>.</p>
<p>We analysed the Pi&ntilde;ata's access logs to the and bucketed them into website traffic and bounty connections.  We are still wondering what happened in July 2015 and July 2017 where the graph shows spikes.  Could it be a presentation mentioning the Pi&ntilde;ata, or a new automated tool which tests for TLS vulnerabilities, or an increase in market price for Bitcoins?</p>
<p><img src="https://hannes.robur.coop/static/img/pinata_access_20180403.png" alt="Pi&ntilde;ata access"/> <img src="https://hannes.robur.coop/static/img/pinata_access_cumulative_20180403.png" alt="Pi&ntilde;ata access cumulative"/></p>
<p>The cumulative graph shows that more than 500,000 accesses to the Pi&ntilde;ata website, and more than 150,000 attempts at connecting to the Pi&ntilde;ata bounty.</p>
<p>You can short-circuit the client and server Pi&ntilde;ata endpoint and observe the private wallet key being transferred on your computer, TLS encrypted with the secret exchanged by client and server, using <code>socat -x TCP:ownme.ipredator.se:10000 TCP:ownme.ipredator.se:10002</code>.</p>
<p>If you attempted to exploit the Pi&ntilde;ata, please let us know what you tried!  Via
<strike><a href="https://twitter.com/h4nnes">twitter</a></strike>
<a href="http://mastodon.social/@hannesm">hannesm@mastodon.social</a> or via eMail.</p>
<p>Since <a href="https://hannes.robur.coop/Posts/DNS">the start of 2018</a> we are developing robust software and systems at <a href="http://robur.io">robur</a>.  If you like our work and want to support us with donations or development contracts, please get in touch with <code>team@robur.io</code>.  Robur is a project of the German non-profit <a href="https://techcultivation.org">Center for the cultivation of technology</a>.  Donations to robur are tax-deductible in Europe.</p>

