---
title: 'The MirageOS Retreat: A Journey of Food, Cats, and Unikernels'
description: "MirageOS is an OCaml ecosystem to construct unikernels, i.e., minimal
  operating systems. Here, we write about our social and technical\u2026"
url: https://tarides.com/blog/2022-10-28-the-mirageos-retreat-a-journey-of-food-cats-and-unikernels
date: 2022-10-28T00:00:00-00:00
preview_image: https://tarides.com/static/75aa6a08abad8cf90f73165784e4a324/2070e/mirageos.jpg
featured:
---

<p><a href="https://mirage.io/">MirageOS</a> is an OCaml ecosystem to construct <a href="https://en.wikipedia.org/wiki/Unikernel">unikernels</a>, i.e., minimal operating systems. Here, we write about our social and technical experience at the MirageOS retreat in Morocco, as well as the vibe and wonderful organisational details. To sum up the technical part, we worked on different facets of the MirageOS world: different kinds of unikernels, some groundwork for Raspberry Pi 4 bare-metal unikernels, and a workflow to leverage an existing deployment/orchestrating infrastructure. The MirageOS retreat was amazing!</p>
<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#about-our-journey" aria-label="about our journey permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>About Our Journey</h2>
<p>Our journey started in Agadir, a Moroccan city right on the coast of the Atlantic sea, just south of the Atlas mountains. In Agadir, we had the best fish in the world (according to some) and amazing &quot;cornes de gazelle,&quot; a delicious sample of Moroccan culture.</p>
<p>From Agadir, we went to Mirleft, a small town further south, full of square roads and beautiful reefs. That's where the MirageOS retreat took place. The venue had a kitchen and an amazing cook, a place for computers and presentations, a garden with a small pool, and a rooftop with dusty but nice views of the coast.</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <a href="https://tarides.com/static/5e247e5529e5f5a231665a5c9da5512d/d2602/mirleft_view.jpg" class="gatsby-resp-image-link" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 75.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUBAwT/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAv/aAAwDAQACEAMQAAAB1wgringhD//EABkQAAMBAQEAAAAAAAAAAAAAAAABAxECEv/aAAgBAQABBQLCk0xRmPs9M1n/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPwGq/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEB/9oACAECAQE/AZqP/8QAGxAAAgEFAAAAAAAAAAAAAAAAAAExEiFRgZH/2gAIAQEABj8CKWZ2Wb6SSf/EABsQAQACAwEBAAAAAAAAAAAAAAEAESFhkTFB/9oACAEBAAE/IQLUCtK1EmL2h18O4U+uwMwuz//aAAwDAQACAAMAAAAQ1y//xAAWEQADAAAAAAAAAAAAAAAAAAAQEVH/2gAIAQMBAT8QSB//xAAWEQEBAQAAAAAAAAAAAAAAAAABEDH/2gAIAQIBAT8QWdn/xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhUXHB/9oACAEBAAE/EDljey4Qkd7LfQ4XyUovoZtLvVStDI//2Q=='); background-size: cover; display: block;"></span>
  <img src="https://tarides.com/static/5e247e5529e5f5a231665a5c9da5512d/7bf67/mirleft_view.jpg" class="gatsby-resp-image-image" alt="Beautiful Mirleft Sunset" title="Beautiful Mirleft Sunset" srcset="/static/5e247e5529e5f5a231665a5c9da5512d/651be/mirleft_view.jpg 170w,
/static/5e247e5529e5f5a231665a5c9da5512d/d30a3/mirleft_view.jpg 340w,
/static/5e247e5529e5f5a231665a5c9da5512d/7bf67/mirleft_view.jpg 680w,
/static/5e247e5529e5f5a231665a5c9da5512d/990cb/mirleft_view.jpg 1020w,
/static/5e247e5529e5f5a231665a5c9da5512d/c44b8/mirleft_view.jpg 1360w,
/static/5e247e5529e5f5a231665a5c9da5512d/d2602/mirleft_view.jpg 4032w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async"/>
  </a>
    </span></p>
<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#about-the-retreat" aria-label="about the retreat permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>About the Retreat</h2>
<p>Both the venue and Mirleft as a whole were extremely inspiring in many ways. One of which included hacking on MirageOS, which was the main reason we came--of course, but we also enjoyed amazing food, saw old and new friends, and had a great time collaborating and creating with MirageOS.</p>
<p>At least once a year since the <a href="https://mirage.io/blog/2016-spring-hackathon">first MirageOS retreat in 2016</a> (with a Covid break in 2021), people get together and work on anything related to MirageOS. These retreats provide a great atmosphere, working environment, and everything else that's needed to be productive and to have a wonderful time.</p>
<p>Besides, the retreat is always a nice opportunity to <a href="https://en.wikipedia.org/wiki/Eating_your_own_dog_food">eat our own dog food</a>.</p>
<p>The organiser, <a href="https://twitter.com/h4nnes">Hannes</a> (among others), always makes sure that most of the infrastructure we rely on is running on MirageOS as much as possible. A welcome addition this year was a local <a href="https://hannes.robur.coop/Posts/OpamMirror">opam cache</a>, which allowed us to download and install packages without crushing the data allowance on the SIM card installed on our main access point.</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <a href="https://tarides.com/static/70b43054abaf1459bd1fdf211865935c/3acf0/Mirleft_venue.jpg" class="gatsby-resp-image-link" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 75.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAgX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABmX0MpCOD/8QAGRAAAgMBAAAAAAAAAAAAAAAAAgMAARES/9oACAEBAAEFAmNPoGGFsYTD1c1cug3/xAAXEQEBAQEAAAAAAAAAAAAAAAABAFER/9oACAEDAQE/AVcuuX//xAAYEQACAwAAAAAAAAAAAAAAAAAAEQFRYf/aAAgBAgEBPwFaKLP/xAAaEAACAwEBAAAAAAAAAAAAAAAAEQECITFB/9oACAEBAAY/Ak5R6ibacOmWP//EABsQAQACAwEBAAAAAAAAAAAAAAEAESExcVGR/9oACAEBAAE/Ib08syC4bCV0F6PIq3i8iu38l9hOM//aAAwDAQACAAMAAAAQVC//xAAXEQEBAQEAAAAAAAAAAAAAAAABABFh/9oACAEDAQE/EAOCui//xAAWEQEBAQAAAAAAAAAAAAAAAAABECH/2gAIAQIBAT8QA6wP/8QAGxABAAIDAQEAAAAAAAAAAAAAAQARITFBUeH/2gAIAQEAAT8QcpNCnWb1iBBXQXzyP8yoFw4biyxsKScFHxUUx3a+E//Z'); background-size: cover; display: block;"></span>
  <img src="https://tarides.com/static/70b43054abaf1459bd1fdf211865935c/7bf67/Mirleft_venue.jpg" class="gatsby-resp-image-image" alt="Lunch at the MirageOS Retreat" title="Lunch at the MirageOS Retreat" srcset="/static/70b43054abaf1459bd1fdf211865935c/651be/Mirleft_venue.jpg 170w,
/static/70b43054abaf1459bd1fdf211865935c/d30a3/Mirleft_venue.jpg 340w,
/static/70b43054abaf1459bd1fdf211865935c/7bf67/Mirleft_venue.jpg 680w,
/static/70b43054abaf1459bd1fdf211865935c/990cb/Mirleft_venue.jpg 1020w,
/static/70b43054abaf1459bd1fdf211865935c/c44b8/Mirleft_venue.jpg 1360w,
/static/70b43054abaf1459bd1fdf211865935c/3acf0/Mirleft_venue.jpg 2000w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async"/>
  </a>
    </span></p>
<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#about-mirageos" aria-label="about mirageos permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>About MirageOS</h2>
<p><a href="https://mirage.io/">MirageOS</a> is an ecosystem that constructs unikernels. In a superficial nutshell, a <a href="https://en.wikipedia.org/wiki/Unikernel">unikernel</a> is a machine image that contains one process and a minimal set of operating system features the process requires. Unikernels are designed to be secure, efficient, and small. MirageOS unikernels are written in OCaml, a functional, semantically rich and type-safe programming language.</p>
<p>MirageOS can be used in a wide range of settings, like robust reimplementations of core system services and protocols like (<a href="https://github.com/mirage/ocaml-dns">DNS</a>, <a href="https://github.com/mirage/awa-ssh">SSH</a>, <a href="https://github.com/mirleft/ocaml-tls">TLS</a>, and <a href="https://github.com/mirage/">many more</a>), as well as higher level applications like <a href="https://hannes.robur.coop/Posts/OpamMirror">web services</a>. It's also on its way to become a good candidate for bare-metal applications on various chipsets (e.g., a <a href="https://github.com/dinosaure/gilbraltar">good choice for the Raspberry Pi 4</a>. See also the section below on <em>Implementing a Jack Port Driver</em>)</p>
<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#our-projects--what-we-learned" aria-label="our projects  what we learned permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Our Projects &amp; What We Learned</h2>
<p>We worked on lots of interesting things, but let's start with the ones that directly relate to MirageOS.</p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#deploying-albatross-on-nixos-no-more-iptables-debugging" aria-label="deploying albatross on nixos no more iptables debugging permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deploying Albatross on Nixos: No More iptables Debugging</h3>
<p><a href="https://github.com/roburio/albatross">Albatross</a> is an orchestrator for MirageOS unikernels. It runs on a Linux system and manages unikernels using Solo5. It's made of several services, one of which is the remote TLS endpoint, which accepts requests from the network to manage the orchestrator.</p>
<p>Some of us wanted to run Albatross on our favourite Linux distribution, <a href="https://github.com/NixOS/nixpkgs">NixOS</a>, and we hoped to be able to hack around this quickly; however, it turned out to be harder than expected. We learned so much about systemd and networking while doing this project.</p>
<p>A Nix flake (a new way of defining packages, which comes with many rough edges) and a NixOS module are added to the main repository in <a href="https://github.com/roburio/albatross/pull/120">this PR</a>.
To test that it works and to play with it, we've written a <a href="https://github.com/Julow/albatross-nixos-example">small tutorial</a> that explains how to build a Qemu VM with Albatross and how to deploy a unikernel using the remote TLS endpoint.</p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#coffee-chat-bot-a-friendly-unikernel-for-a-friendly-work-environment" aria-label="coffee chat bot a friendly unikernel for a friendly work environment permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Coffee Chat Bot: a Friendly Unikernel for a Friendly Work Environment</h3>
<p>Some of us worked on deploying a coffee chat bot as a MirageOS unikernel. Contrary to how it sounds, it isn't a robot that serves coffee (which would be extremely awesome)! Instead, it's a Slack bot that lets people on our company's Slack channel to opt-in for a coffee chat with a colleague. The coffee chat bot then matches each opt-in randomly with another opt-in.</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 635px; ">
      <a href="https://tarides.com/static/22a41f031c11471c02727254a9ce489f/1ddef/mirleft_coffeebot.png" class="gatsby-resp-image-link" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 19.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA10lEQVQY02WPwU6DQBRF+f+1f2BcGhN3/oLVtMYUBSvpDAyTwvAIMZBGZjiGqStd3Jzcu3gvJ1HHnFIVaK3QSqGUwhiDSM84jjHzPBNCwHsfGcLCApfu598t4MNCcn1zxd39LdvdnuftjqfNhjRNKYoiHs+yjLquKXUZH1WVweic7OWB6ri/dFNRrvx8I7Gto3Yn3rNH0sOBD9tyVJqmaRiGARGh73ucc5FdJ7i2xupXxFWxi3R0IjhbkiwhcP4+Y22ObU60XxOuE6Zpikqr7r/4VZHIv/sPyz8rqqXYPT8AAAAASUVORK5CYII='); background-size: cover; display: block;"></span>
  <img src="https://tarides.com/static/22a41f031c11471c02727254a9ce489f/1ddef/mirleft_coffeebot.png" class="gatsby-resp-image-image" alt="Coffee Chat Bot" title="Coffee Chat Bot" srcset="/static/22a41f031c11471c02727254a9ce489f/04472/mirleft_coffeebot.png 170w,
/static/22a41f031c11471c02727254a9ce489f/9f933/mirleft_coffeebot.png 340w,
/static/22a41f031c11471c02727254a9ce489f/1ddef/mirleft_coffeebot.png 635w" sizes="(max-width: 635px) 100vw, 635px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async"/>
  </a>
    </span></p>
<p>This bot was already written in OCaml, and it's merely a single process. Due to its nature, it doesn't need to do any super complicated operating system stuff, so a natural question came to us: why not make a unikernel out of it?</p>
<p>So <a href="https://github.com/pitag-ha/slack_bot">we did</a>.</p>
<p>Making a unikernel out of a relatively simple application sounds rather straightforward. The first step was to get rid of all Unix operations. It's incredible how many small Unix calls we were doing without even noticing. For example, we were using <code>Unix.time</code> all over the place, such as scheduling, providing a seed for the random library, and giving timestamps to our database entries.</p>
<p>The database posed another problem. We had been using <code>irmin-unix</code>, which writes to disk using Unix. To fix that, now we use <code>irmin-mem</code>, which writes to memory. We persist (and inspect) the data by syncing our in-memory database with a GitHub repository. If you're not familiar with Irmin (a MirageOS library), its design follows the principles of the Git design and provides a library called <code>irmin-git</code> to bridge the two.</p>
<p>Providing the network stack needed for the Git (and also for the Slack API) communication is one of the typical tasks the operating system needs do. In our case, that's MirageOS. It has a concept called &quot;devices,&quot; which are the operating system features your unikernel might need. Examples of &quot;devices&quot; are network interfaces, network stacks, filesystems (which we didn't need), and monotonic time sources. MirageOS will provide a concrete implementation of such a device at your unikernel's compile time, as long as you declare the device in the MirageOS configuration file <code>config.ml</code>.</p>
<p>The things described were just a small part of our nice, educational journey making a coffee chat unikernel. One more detail that's worth mentioning:  the bot now uses <a href="https://github.com/dinosaure/paf-le-chien"><code>httpaf</code></a> for the Slack API interactions. Before, it was using <code>cohttp</code>, which is already independent from Unix (unlike, for example, the OCaml <code>curl</code> wrapper <code>curly</code>). Porting it to <code>httpaf</code> wasn't technically necessary, but it was a great way to get to know and test the latest &quot;cutting-edge&quot; unikernel features.</p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#implementing-a-jack-port-driver-or-how-to-make-a-unikernel-sing-bare-metal" aria-label="implementing a jack port driver or how to make a unikernel sing bare metal permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Implementing a Jack Port Driver, or How to Make a Unikernel Sing Bare-Metal</h3>
<p>We also went bare-metal during the retreat. &quot;Bare-metal&quot; sounds cool, doesn't it? Let us explain what we really mean by it. Often, the way to run a MirageOS unikernel is as follows:</p>
<ul>
<li>You have a Linux kernel on your machine and virtualize it via a hypervisor such as KVM.</li>
<li>That hypervisor is then abstracted further by a tool called Solo5 which integrates well with MirageOS unikernels.</li>
</ul>
<p>With this workflow, the communication between the unikernel and the hardware goes over several layers of abstraction. A &quot;bare-metal&quot; unikernel, on the contrary, communicates with the hardware directly, without any interfacing kernel such as Linux. The device we chose to do bare-metal work on is the Rasperry Pi 4 (RPi4).</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <a href="https://tarides.com/static/3bde74c117dc40ffd803f1a8e763ada3/3acf0/Mirleft_rpi4.jpg" class="gatsby-resp-image-link" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 66.47058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAgUA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAgP/2gAMAwEAAhADEAAAAZxqEqZjhT//xAAZEAADAQEBAAAAAAAAAAAAAAAAAQIDEjL/2gAIAQEAAQUClE9SzM08M//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABkQAAIDAQAAAAAAAAAAAAAAAAEQABFBYf/aAAgBAQAGPwKWMZHV/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFhUf/aAAgBAQABPyHxsqFgP01kPeypearDTNqrnYrZ/9oADAMBAAIAAwAAABAE/wD/xAAYEQACAwAAAAAAAAAAAAAAAAAAAREhMf/aAAgBAwEBPxDHRCP/xAAXEQADAQAAAAAAAAAAAAAAAAAAASEx/9oACAECAQE/ENVKf//EABwQAQADAAMBAQAAAAAAAAAAAAEAESExQVFxgf/aAAgBAQABPxAaxgnw4hzurMH5LgtrNuHMZUIgVVGnX7MMgnAJN56YCoUeXP/Z'); background-size: cover; display: block;"></span>
  <img src="https://tarides.com/static/3bde74c117dc40ffd803f1a8e763ada3/7bf67/Mirleft_rpi4.jpg" class="gatsby-resp-image-image" alt="Work set-up for RPi4 hacking" title="Work set-up for RPi4 hacking" srcset="/static/3bde74c117dc40ffd803f1a8e763ada3/651be/Mirleft_rpi4.jpg 170w,
/static/3bde74c117dc40ffd803f1a8e763ada3/d30a3/Mirleft_rpi4.jpg 340w,
/static/3bde74c117dc40ffd803f1a8e763ada3/7bf67/Mirleft_rpi4.jpg 680w,
/static/3bde74c117dc40ffd803f1a8e763ada3/990cb/Mirleft_rpi4.jpg 1020w,
/static/3bde74c117dc40ffd803f1a8e763ada3/c44b8/Mirleft_rpi4.jpg 1360w,
/static/3bde74c117dc40ffd803f1a8e763ada3/3acf0/Mirleft_rpi4.jpg 2000w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async"/>
  </a>
    </span></p>
<p>So we needed an RPi4 bare-metal OCaml runtime. Luckily, Dinosaure wrote one last year: <a href="https://github.com/dinosaure/gilbraltar">Gilbraltar</a>. It also dumps the text of OCaml print statements into the UART, which is a technical way of saying that we can send such text over USB (concretely over a USB to serial TTL cable) and see it. Quite useful for debugging!</p>
<p>As you can see, doing bare-metal work is quite restrictive and everything that tends to be taken for granted needs to be implemented, like drivers, for example.</p>
<p>So that's what we decided to do.</p>
<p>Last year, some colleagues already implemented a driver for LED strips and powered our office's <a href="https://twitter.com/Dinoosaure/status/1471128595154231300">Christmas tree</a> with a bare-metal OCaml RPi4! What is cooler than <a href="https://tarides.com/blog/2021-11-11-mirageos-workshop-working-with-the-raspberry-pi-4">making our bare-metal RPi4 Christmas tree sing</a>? Well, a lot of things are. Anyways, we love music, so we decided to implement a jack port driver.</p>
<p>Jack port drivers on a digital device are an interesting concept. Digital devices are digital, but jack ports expect analog data. One way the RPi4 can handle that is via a concept called PWM: Pulse Width Modulation. The PWM modulates analog signals (i.e., values between 0 and 1) by sending digital signals (i.e., either 0 or 1) really fast.</p>
<p>That modulation is done on the hardware side of the RPi4, concretely on a RPi4 <em>peripheral</em> also called PWM. <a href="https://datasheets.raspberrypi.com/bcm2711/bcm2711-peripherals.pdf">Peripherals</a> are RPi4 hardware devices that are mapped to specific address ranges in the RPi4's memory. You communicate with them by writing to or reading from those locations in memory. The address range of each peripheral is structured into registers. One example of a register of the PWM is the PWM FIFO, i.e., the hardware queue that stores the data flowing from the program to the jack port.</p>
<p><a href="https://github.com/pitag-ha/rpi/blob/jack-port-driver-on-interrupts/src/peripherals/pwm.ml">Our jack port driver</a> does two things--both by writing to and reading from the right places in the PWM memory range.</p>
<ol>
<li>It can initiate the RPi4 for jack port communication (e.g., it sets the RPi4's clock to the correct frequency at which the port reads data from the FIFO, and it configures the correct modes to ensure the right data flow).</li>
<li>It can send music to the jack port (by writing data to the FIFO--without overflowing it).</li>
</ol>
<p>To use the new driver, we convert music into the right binary format by simply using <code>ffmpeg</code>. Then we <a href="https://github.com/pitag-ha/rpi/blob/jack-port-driver-on-interrupts/test/bare-metal/jack_port/main.ml">write a program</a> with that music in-memory using the MirageOS tool <a href="https://github.com/mirage/ocaml-crunch"><code>ocaml-crunch</code></a>. That program just calls the driver to do the rest and is compiled for the RPi4 target with <code>gilbraltar</code>.</p>
<p>This work is strongly related to MirageOS in three ways. First, the program playing music bare-metal on the RPi4 is a unikernel written in OCaml. Second, the program is compiled with <code>gilbraltar</code>, which forms part of the MirageOS ecosystem and whose design and implementation is based on core tools in the MirageOS ecosystem, such as Solo5 and <code>ocaml-solo5</code>. Third, by adding one layer of abstraction to the jack port driver, we can make it a MirageOS &quot;device,&quot; so one could use the driver while also leveraging other MirageOS features that work bare-metal on a RPi4.</p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#monitoring-mirageio-and-chasing-memory-leaks" aria-label="monitoring mirageio and chasing memory leaks permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Monitoring mirage.io and Chasing Memory Leaks</h3>
<p>One of the MirageOS goals is to be able self host our infrastructure. At the retreat, many tools we used were based on the MirageOS ecosytem: a DNS resolver (<a href="https://github.com/mirage/ocaml-dns">mirage/ocaml-dns</a>), an opam repository cache (<a href="https://git.robur.io/robur/opam-mirror">robur/opam-mirror</a>), and a portable file transfer application (<a href="https://github.com/dinosaure/bob">dinosaure/bob</a>). It's not a surprise that the official website, <a href="https://mirage.io">mirage.io</a>, is a unikernel itself. However, in the past six months, we experienced two website crashes due to <code>Out_of_memory</code> exceptions. The unikernel is configured to run with 1GB of RAM, so that's a slow running memory leak that requires investigation.</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <a href="https://tarides.com/static/29c60ca463f3e469222eba820432f3a8/70ad2/mirleft_monitoring.png" class="gatsby-resp-image-link" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 69.41176470588235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB50lEQVQ4y21Ti27bMAz0///UXlgxDNgDQ9d0aIe1w4I2TZaHbUmkKOoGUnaaDhFwME1SR1E8dSKCUopDVTGGAGZ2e/Zxzu6b8wxEhJzzs8/ymNEN44haq6Nowbxmn608Ef7vt0+DoqogZ0LX9/2RjITctlPNsP8s4qRtcz2SqApUM7Qwai2e1233W6QcwULYxS1YGFLsGqTZKtiNO+QsUzGBFnISJ1O7llbECZebJd7fv8X1+grv7l5j8XSFTVjjcXjA7d8bXK6+4Xq1gIoAlYEq1izOLZtHt94+4cPtK3y+u8DHn29w+ecTfq1+4ObxOxbLr/hyf4GH3W9s+x02hw2GENGHgD6MCCkhxISYyJESoSMmUEzIlEAhQnxy1lZBLQpoRYoR/TgghBHjODhpIvIT2VVYq2aTTdkcp6vOmKZpdjHier7N0/a9ZdPTcfMLzMTqEzyfM+WpoJaIzAldSullcJaEBKgM0BJ9qi8lMxfSFhfTcmu9I+LnZJcENzLNrbL785HAfcqok3Ra7KRlZkJV8iQtqW04vSHTXmk5Fje7WGE7ncXmh2DCzrkRsiR/JZQNjJRTA8fJ15A4HeNxirW8+Z/RjTFgf9jj0O+xPxxgMjJJ2LCSSYl4Avl7bt/2tk9hpzPF/AMmUkeBiOZ0ZwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"></span>
  <img src="https://tarides.com/static/29c60ca463f3e469222eba820432f3a8/c5bb3/mirleft_monitoring.png" class="gatsby-resp-image-image" alt="Monitoring mirage.io" title="Monitoring mirage.io" srcset="/static/29c60ca463f3e469222eba820432f3a8/04472/mirleft_monitoring.png 170w,
/static/29c60ca463f3e469222eba820432f3a8/9f933/mirleft_monitoring.png 340w,
/static/29c60ca463f3e469222eba820432f3a8/c5bb3/mirleft_monitoring.png 680w,
/static/29c60ca463f3e469222eba820432f3a8/b12f7/mirleft_monitoring.png 1020w,
/static/29c60ca463f3e469222eba820432f3a8/b5a09/mirleft_monitoring.png 1360w,
/static/29c60ca463f3e469222eba820432f3a8/70ad2/mirleft_monitoring.png 1665w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async"/>
  </a>
    </span></p>
<p>The question is how to investigate such a leak.</p>
<h4 style="position:relative;"><a href="https://tarides.com/feed.xml#locally" aria-label="locally permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Locally?</h4>
<p>The initial attempt consisted in <em>tracing</em> memory allocations using <code>statmemprof</code> while bombarding the server with requests by using benchmarking tools such as ApacheBench (<code>ab</code>) or <code>wrk</code>. <code>statmemprof</code> is an implementation of <em>Statistical Memory Profiling</em> in the OCaml runtime. It enables sampling allocations at a fixed rate and tracing values until they are garbage collected. Using <a href="https://github.com/janestreet/memtrace_viewer">memtrace-viewer</a>, one can analyse the memory usage and see which values are still live when the program goes out of memory, for example. For a unikernel with network access, it's possible to add an endpoint to enable tracing on demand: <a href="https://github.com/roburio/memtrace-mirage">roburio/memtrace-mirage</a>.</p>
<p>Unfortunately, this setup didn't help us identify the leak. Indeed, we can still expect the server to work fine under normal conditions. Somehow we need to understand which rare event, leaking a small bit of memory at a time, is happening enough times to consume all available memory.</p>
<h4 style="position:relative;"><a href="https://tarides.com/feed.xml#monitoring-the-live-unikernel" aria-label="monitoring the live unikernel permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Monitoring the Live Unikernel</h4>
<p>Only the <em>Real&trade;</em> Internet would tell us the answer, so we monitored the live unikernel application. <a href="https://github.com/roburio/mirage-monitoring">roburio/mirage-monitoring</a> was of great help, as it enables two things:</p>
<ul>
<li>Reporting application-wide metrics to an InfluxDB endpoint, which can be displayed using Grafana</li>
<li>Changing logs level/metrics sources at runtime</li>
</ul>
<p>Adding <code>mirage-monitoring</code> to a unikernel was surprisingly easy. It was only a matter of updating the configuration file with some functoria voodoo: <a href="https://github.com/mirage/mirage-www/pull/767">https://github.com/mirage/mirage-www/pull/767</a>. At some point, it will upstreamed in the <code>mirage</code> tool so that adding monitoring is a single-line job. The hard part was providing the unikernel two network stacks to expose one to the internet while keeping the other for internal use only.</p>
<p>Next, we set up a typical Grafana deployment using InfluxDB/Telegraf for the metrics input and data storage. Logs were displayed using <code>albatross-client-local</code>.</p>
<h4 style="position:relative;"><a href="https://tarides.com/feed.xml#chasing-the-leak" aria-label="chasing the leak permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Chasing the Leak</h4>
<p>Now we can see the numbers for the live website. Memory usage, indeed, but also other metrics were included by default, such as the number of established connections in the TCP stack. There we found the source of the leak. Throughout the day, the number of established TCP connections kept increasing.</p>
<p>Finally at runtime, we temporarily changed the TCP stack's log level to <em>debug</em>, monitor the logs, and wait for the moment where the number of established TCP connections would increase without decreasing afterwards. These logs described what was going on in the TCP stack at the exact moment the connection leak happened. At this point, we figured out that it occurred when a client connected to the server but fail to perform the TLS handshake, so the server dropped the connection without <em>closing</em> it--hence leaking it <em>forever</em>.</p>
<p>Here we go: <a href="https://github.com/dinosaure/paf-le-chien/pull/72"><em>one less leak</em></a>.</p>
<h4 style="position:relative;"><a href="https://tarides.com/feed.xml#next-steps" aria-label="next steps permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Next Steps</h4>
<p>Matching <em>logs</em> and <em>metrics</em> to inspect them together has proven to be very useful. We used Grafana for metrics, so the next step would be to also provide logs because Grafana supports structured logging through the <a href="https://grafana.com/oss/loki/">Loki</a> logs aggregation system.</p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#miragehole---a-unikernel-dns-resolver-with-holes" aria-label="miragehole   a unikernel dns resolver with holes permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MirageHole - A Unikernel DNS Resolver with Holes</h3>
<p>One way to stop web trackers, advertisements, and malware is to block access to sites known to contain such things. A popular approach is through browser extensions like <a href="https://en.wikipedia.org/wiki/AdBlock">AdBlock</a> and <a href="https://en.wikipedia.org/wiki/Privacy_Badger">Privacy Badger</a>. Another approach known as <a href="https://en.wikipedia.org/wiki/DNS_sinkhole">a DNS sinkhole</a> involves installing a local DNS server that resolves bad domains to an invalid IP address. This approach has the advantage of working across different operating systems, browsers, and devices (laptops, smartphones, smart-TVs, etc.). For an added bonus, it can also save network bandwidth.</p>
<p>Another project initiated during this year's retreat was to implement <a href="https://github.com/jmid/mirage-hole">Mirage-hole</a>: a DNS sinkhole running as a Mirage Unikernel. It was inspired by <a href="https://en.wikipedia.org/wiki/Pi-hole">Pi-hole</a> for the Raspberry Pi. Starting from a DNS-stub example from <a href="https://github.com/roburio/dnsvizor">dnsvizor</a> (and after a bit of network debugging), we got a unikernel running that would block a single selected domain. We then extended this to fetch and parse <a href="https://github.com/blocklistproject/Lists">a blocklist</a> at start-up. Next, we worked on integrating a little webserver to serve statistics about the requested and blocked domains. Overall, the project was a nice opportunity to talk to and learn from several MirageOS contributors, and it served as a nice tour-de-force of several MirageOS networking libraries.</p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#tarides-map---serving-the-tarides-geographical-distribution-in-a-unikernel" aria-label="tarides map   serving the tarides geographical distribution in a unikernel permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tarides Map - Serving the Tarides Geographical Distribution in a Unikernel</h3>
<p>Tarides Map is a project intended to show the geographic distribution of all Tarides collaborators as a website. At the retreat, we explored deploying the site in a unikernel. To do this, we had to decide how to serve the files on the server and integrate it into a unikernel. We had two options use <code>ocaml-crunch</code> or Docteur.</p>
<p>We initially used <a href="https://github.com/dinosaure/docteur">Docteur</a> due to an inspiration from a different project called <a href="https://github.com/dinosaure/pasteur">Pasteur</a>, which uses Docteur and is deployed in a unikernel as a static site, which was exactly what we were aiming to do with Tarides Map. However, integrating Docteur into the project proved to be more difficult than we had expected. One reason was that Solo5 isn't currently supported on MacOS, the operating system used to write the project at the retreat. After compiling to Unix instead and numerous hours debugging, we were eventually able to generate the disk image; however, we still had issues deploying it in a unikernel, so we decided to try using <a href="https://github.com/mirage/ocaml-crunch">ocaml-crunch</a> instead.</p>
<p>Using <code>ocaml-crunch</code> proved to be a more straightforward option. We merely had to move some files around so that the directory structure could be turned into a standalone OCaml module to serve the file contents without requiring an external filesystem to be present. After doing this, we were successfully able to deploy the site <a href="https://github.com/SaySayo/tarides_map_static_website">here</a>.</p>
<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#what-we-dreamed-about" aria-label="what we dreamed about permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What We Dreamed About</h2>
<p>Another very interesting part of the retreat were the <em>dreaming sessions</em> organized by Hannes. The central idea behind this exercice was to allow ourselves to dream about how we envision the MirageOS project in the future, no matter how untangible and seemingly unrealistic. We talked about those dreams in two sessions.</p>
<p>The initial session revolved around gathering these dreams and ideas, without discussing how to achieve them, and let our mind go free with what we wanted to accomplish with MirageOS. Often times, those dreams would be shared with other participants. Some dreamed about replacing their whole software infrastructure by MirageOS, if not their main operating system! Others dreamed of artistic applications for Mirage, like using it as a backbone for musical endeavors.</p>
<p>The subsequent session revolved around <em>how</em> we could reach those dreams. This facilitated a more practical discussion around the challenges we may face along the way. Interestingly enough, in some instances, it turned out some dreams were either already achieved (like reverse-debugging Solo5!) or were close to being achievable.</p>
<p>A beautiful example of the attendees' dedication is that it did not take long for some to start working on projects like MirageOS-OS, a hypervisor for MirageOS unikernels and written with MirageOS, or to successfully implement a jack port driver for the Raspberry Pi 4, bringing us closer to MirageOS powered synthesisers and to MirageOS midi interfaces!</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <a href="https://tarides.com/static/45ef29c8b49ef9d490e6ccdeec689ed5/3acf0/Mirleft_reefs.jpg" class="gatsby-resp-image-link" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 75.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABAAD/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQAC/9oADAMBAAIQAxAAAAFGZZkxLL//xAAcEAADAAEFAAAAAAAAAAAAAAAAAQIDBBITFCH/2gAIAQEAAQUC5x6lI7MkxLLxeTtU/wD/xAAXEQEAAwAAAAAAAAAAAAAAAAAAAQIS/9oACAEDAQE/AYoy/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAEDEv/aAAgBAgEBPwF0Ns//xAAZEAADAAMAAAAAAAAAAAAAAAAAARAhMUH/2gAIAQEABj8Cm0dZlT//xAAbEAADAQADAQAAAAAAAAAAAAAAAREhQWFxwf/aAAgBAQABPyGOhS7DFfcUPhcEN4VPCBc8P//aAAwDAQACAAMAAAAQVz//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREx/9oACAEDAQE/EGayD//EABcRAAMBAAAAAAAAAAAAAAAAAAEQESH/2gAIAQIBAT8QrgR//8QAGxABAQADAQEBAAAAAAAAAAAAAREAITGRQVH/2gAIAQEAAT8QR+esaBqzuWQCliUeGNk2CsFvAz8bccN4TbsoAdZ//9k='); background-size: cover; display: block;"></span>
  <img src="https://tarides.com/static/45ef29c8b49ef9d490e6ccdeec689ed5/7bf67/Mirleft_reefs.jpg" class="gatsby-resp-image-image" alt="Mirleft's Beautiful Reefs" title="Mirleft's Beautiful Reefs" srcset="/static/45ef29c8b49ef9d490e6ccdeec689ed5/651be/Mirleft_reefs.jpg 170w,
/static/45ef29c8b49ef9d490e6ccdeec689ed5/d30a3/Mirleft_reefs.jpg 340w,
/static/45ef29c8b49ef9d490e6ccdeec689ed5/7bf67/Mirleft_reefs.jpg 680w,
/static/45ef29c8b49ef9d490e6ccdeec689ed5/990cb/Mirleft_reefs.jpg 1020w,
/static/45ef29c8b49ef9d490e6ccdeec689ed5/c44b8/Mirleft_reefs.jpg 1360w,
/static/45ef29c8b49ef9d490e6ccdeec689ed5/3acf0/Mirleft_reefs.jpg 2000w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async"/>
  </a>
    </span></p>
<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#inventing-ocamlwave-serenading-cats-and-christening-dogs" aria-label="inventing ocamlwave serenading cats and christening dogs permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Inventing OCamlwave, Serenading Cats, and Christening Dogs</h2>
<p>As mentioned above, the retreat was extremely inspiring, even with respect to topics less related to MirageOS than the ones mentioned here. The one we're most proud of is <a href="https://www.youtube.com/playlist?list=PLmaiK3-DyqMy3kNjdHIPUEo-Gkltha3mT">our Mirleft MirageOS EP</a> that contains five tracks (<em>five</em> in the spirit of Solo<em>5</em> and OCaml <em>5.0</em>, of course). Its genre might be better described as <em>OCamlwave</em>! On our EP, you will find many musical oddities ranging from an on-premise recorded drum solo (with glasses, cloth-racks, and flip-flops) to a cat-powered cover of <em>Mr Sandman</em> (as an hommage to our time singing to Morroco's many, <em>many</em> cute cats.) to the occasional dramatic rendition of controversial pull requests on the OCaml compiler.</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <a href="https://tarides.com/static/c9cafec3abe45e91bbbaec46eb95c169/f8beb/mirleft_cats.jpg" class="gatsby-resp-image-link" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFAv/EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAABVfm4Krkwy//EABwQAAMAAQUAAAAAAAAAAAAAAAECAwASEyEiMv/aAAgBAQABBQK57TudvXQ5Xln9LVwP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFREBAQAAAAAAAAAAAAAAAAAAACH/2gAIAQIBAT8BV//EABwQAAEDBQAAAAAAAAAAAAAAAAABAhARITJxgf/aAAgBAQAGPwIbovVI4ZH/xAAZEAEAAwEBAAAAAAAAAAAAAAABABEhUTH/2gAIAQEAAT8hrHpkp4mcaw32uBCBfJkB4CpXRVP/2gAMAwEAAgADAAAAECTf/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAEhEf/aAAgBAwEBPxCtU1H/xAAZEQABBQAAAAAAAAAAAAAAAAAAAREhMVH/2gAIAQIBAT8QqEG0f//EAB0QAQACAgIDAAAAAAAAAAAAAAEAESExQYGhscH/2gAIAQEAAT8QMVonJA4sQENGL8QCvW0K6imbr7j1oQHBUDHjQ0+5/9k='); background-size: cover; display: block;"></span>
  <img src="https://tarides.com/static/c9cafec3abe45e91bbbaec46eb95c169/7bf67/mirleft_cats.jpg" class="gatsby-resp-image-image" alt="Cute street kittens in Mirleft" title="Cute street kittens in Mirleft" srcset="/static/c9cafec3abe45e91bbbaec46eb95c169/651be/mirleft_cats.jpg 170w,
/static/c9cafec3abe45e91bbbaec46eb95c169/d30a3/mirleft_cats.jpg 340w,
/static/c9cafec3abe45e91bbbaec46eb95c169/7bf67/mirleft_cats.jpg 680w,
/static/c9cafec3abe45e91bbbaec46eb95c169/990cb/mirleft_cats.jpg 1020w,
/static/c9cafec3abe45e91bbbaec46eb95c169/c44b8/mirleft_cats.jpg 1360w,
/static/c9cafec3abe45e91bbbaec46eb95c169/f8beb/mirleft_cats.jpg 3421w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async"/>
  </a>
    </span></p>
<p>However, not everything in Mirleft was about music and animals. Some things were also about the beauitful waves.</p>
<p>Mirleft is a paradise for surfing, both for beginners and advanced surfers! We went to a nice sandy beach with perfect conditions to get started with surfing. Advanced surfers would probably go to one of the reefs for surfing, which we, in turn, found amazing for a peaceful walk, sometimes with and sometimes without company from a street dog we christened <code>null</code>.</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 401px; ">
      <a href="https://tarides.com/static/49d62c1c5afdf2143a1efb9b0cb7bc1b/9144d/mirleft_dog.png" class="gatsby-resp-image-link" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 128.23529411764707%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;"></span>
  <img src="https://tarides.com/static/49d62c1c5afdf2143a1efb9b0cb7bc1b/9144d/mirleft_dog.png" class="gatsby-resp-image-image" alt="Sweet null, our new friend!" title="Sweet null, our new friend!" srcset="/static/49d62c1c5afdf2143a1efb9b0cb7bc1b/04472/mirleft_dog.png 170w,
/static/49d62c1c5afdf2143a1efb9b0cb7bc1b/9f933/mirleft_dog.png 340w,
/static/49d62c1c5afdf2143a1efb9b0cb7bc1b/9144d/mirleft_dog.png 401w" sizes="(max-width: 401px) 100vw, 401px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async"/>
  </a>
    </span></p>
<p>And, well, talking about <code>null</code> (apart from naming street animals), we also had plenty of other computer science related conversations at the retreat. All of them were extremely enriching! A couple of examples include exception backtracing in LWT programs and BGP intrinsics.</p>
<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#thanks-for-all-the-fish" aria-label="thanks for all the fish permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Thanks for All the Fish!</h2>
<p>As this lengthy report can attest, our experience was an amazing one for all. The MirageOS Hack Retreats are always an otherworldly space, where amazing individuals gather to exchange thoughts and create new (and better) software. Friends are made along the way, some bugs are fixed, new ones are found, and great new ideas emerges.</p>
<p>This very special sense of community is rare, so we would like to thank everyone who organized, attended, and tended to the event. Thank you to our delightful hosts, who've been with us since the first retreat in 2016! Thank you as well to <a href="https://robur.io">Hannes and Robur</a> for organizing those retreats and spending time instilling the same inspiration in the great project that is MirageOS! Finally, thank you to old and new friends, as well as old and new MirageOS hackers, for this amazing week of happy banter and hacking!</p>
<p>PD: Some of the pics in this post were shared among us via <a href="https://github.com/dinosaure/bob">bob</a>, a MirageOS unikernel to share files.</p>
