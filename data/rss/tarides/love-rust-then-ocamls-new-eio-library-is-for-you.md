---
title: Love Rust? Then OCaml's New Eio Library is for You
description: "We\u2019ve come to expect a lot from the programming languages we use.
  We want the memory safety of Java, the performance of C/C++, and the\u2026"
url: https://tarides.com/blog/2022-12-27-love-rust-then-ocaml-s-new-eio-library-is-for-you
date: 2022-12-27T00:00:00-00:00
preview_image: https://tarides.com/static/21e8c4795a21a77b1e7978361ea10c0c/0132d/charlotte-coneybeer-L9VXW4A9QZM-unsplash.jpg
featured:
---

<p>We&rsquo;ve come to expect a lot from the programming languages we use. We want the memory safety of Java, the performance of C/C++, and the concurrency of Go. On top of this, we need robust cybersecurity tools to protect us from the many risks and vulnerabilities in the world, all in an intuitive and easy-to-use package for programmers.</p>
<p>You can expect all of the above with OCaml 5. The new library <a href="https://github.com/ocaml-multicore/eio">Eio</a> introduces some great new features that let the programmer write concurrent code in a way that best suits them. Eio is fast, solves the <a href="https://journal.stuffwithstuff.com/2015/02/01/what-color-is-your-function/">function colouring problem</a>, and can use effect handlers to let the developer customise the scheduling algorithm rather than baking it in at runtime. If you&rsquo;re a fan of how Rust delivers fast and high performing concurrent code, OCaml 5&rsquo;s Eio is a close match, with some additional features.</p>
<p>Eio gives OCaml a new edge on speed, ease-of-use, portability, and security. It matches Rust&rsquo;s reputed performance on the same points, making the two languages more comparable when it comes to concurrent programming. Let me know what you think of my comparison on <a href="https://discuss.ocaml.org">Discuss</a> or <a href="https://twitter.com/tarides_">Twitter</a>.</p>
<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#how-eio-makes-concurrent-code-quick-and-easy" aria-label="how eio makes concurrent code quick and easy permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How Eio Makes Concurrent Code Quick and Easy</h2>
<p>Rust is a <a href="https://codilime.com/blog/why-is-rust-programming-language-so-popular/">popular programming language</a> that solves a lot of problems for programmers. One of Rust&rsquo;s strengths is the way it delivers concurrent code in a quick and safe manner.</p>
<p>According to a <a href="https://codilime.com/blog/why-is-rust-programming-language-so-popular/">recent blog post</a>, &ldquo;Rust solves problems that C/C++ developers have been struggling with for a long time: memory errors and concurrent programming. This is seen as its main benefit.&rdquo;</p>
<p>Eio makes writing concurrent code in OCaml much easier, resolving earlier pain points and providing significant benefits. OCaml is also a type- and memory-safe language with a low-latency and high-throughput concurrent garbage collector that doesn't get in the way of application code execution.</p>
<p>Below is an overview of the biggest changes Eio brings to concurrent programming in OCaml. With these improvements, OCaml provides a concurrent programming experience comparable to Rust.</p>
<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#key-benefits-of-eio" aria-label="key benefits of eio permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Key Benefits of Eio</h2>
<p><em>Performance</em>
Eio brings big performance improvements to concurrent code in OCaml, making use cases like web servers serving requests from users a lot faster. In a speed test comparing Eio&rsquo;s performance to Go&rsquo;s <code>net/http</code> and Rust&rsquo;s <code>hyper</code>, the results show that Eio outperforms Go and closely matches Rust. Eio can reliably serve over one million requests per second on a few cores. Being such a close match in terms of performance, OCaml is a strong contender for users looking to expand beyond using Rust.</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <a href="https://tarides.com/static/9f0b97bdb5cfc231e1a387bb218f08c4/133ae/http_load1.png" class="gatsby-resp-image-link" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 66.47058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAByElEQVQ4y5VTy44bIRD0//9YrqtcfbB2I9vzZGiG96N6BWPP2NlDlJZKQNOUugo4Abgxs2Hm9X+BY05gTgB+nWoixsDjLLibiaVceBxHFkKwc46tte9w2+is5eAdk7bcLyujFGbm36cQAlnreBq6Mt//4Ha743w+Y5omgBl/RynlkWYonzGTxjSNOedG+HEiIpqnmWc5YjIdunuHy+WCZVnAW1SCjeIRLhUI0jAkwE4g6aWknDdCpRRViVpr1GQ9V0qp2Dt8EqVcsEgCzQOKleAc2p4PsaSUDsK+H9gY8zyLB/aukCNWOUGMPaKWYOS2UR613ruDUGvdOlzXdT+/R13liEIDgtot+BHxtcPq4TAMTXJz+kUi+xVFTyAvoZKBjRYmaphoduikseil5KeHlbB2WCWX7eo5RgstvyDVFRRWqKCgvIJLDjbZN5hkII08CNd1pWHcPKwZYWdcl09otyA/vPxXvEmOMZIixYsUmMzY8FL7tPLHewQfNjv3cint2xSwkAJf909EHyGEQL0kKSWqt8+xQimFqoaI2rq+V2PMIRkAPbsJPiKXjBACvPe4Xq/o+x7DMDTUedd1jSzGiJy32u0FNRkf34aR8jrbGkXDAAAAAElFTkSuQmCC'); background-size: cover; display: block;"></span>
  <img src="https://tarides.com/static/9f0b97bdb5cfc231e1a387bb218f08c4/c5bb3/http_load1.png" class="gatsby-resp-image-image" alt="EioImage" title="EioImage" srcset="/static/9f0b97bdb5cfc231e1a387bb218f08c4/04472/http_load1.png 170w,
/static/9f0b97bdb5cfc231e1a387bb218f08c4/9f933/http_load1.png 340w,
/static/9f0b97bdb5cfc231e1a387bb218f08c4/c5bb3/http_load1.png 680w,
/static/9f0b97bdb5cfc231e1a387bb218f08c4/b12f7/http_load1.png 1020w,
/static/9f0b97bdb5cfc231e1a387bb218f08c4/b5a09/http_load1.png 1360w,
/static/9f0b97bdb5cfc231e1a387bb218f08c4/133ae/http_load1.png 1424w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async"/>
  </a>
    </span></p>
<p><em>Ease-of-Use</em>
One of Rust&rsquo;s strengths is its user friendliness, meaning it&rsquo;s easy to use and code in. With the OCaml 5 update, Eio makes OCaml a much easier language for writing concurrent code.</p>
<p>Eio offers an alternative to monadic I/O, which used to be the only way to write concurrent code in OCaml. Now, with OCaml 5, the developer experience is greatly simplified and will feel familiar to anyone who knows OCaml.</p>
<p>Patrick Ferris, a developer at Tarides, emphasises that with Eio:</p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#normal-ocaml-features-just-work-out-of-the-box-like-exception-backtraces-which-are-crucial-for-writing-new-libraries-using-tools-and-debugging-programs" aria-label="normal ocaml features just work out of the box like exception backtraces which are crucial for writing new libraries using tools and debugging programs permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>&ldquo;Normal OCaml features just work out of the box, like exception backtraces, which are crucial for writing new libraries, using tools, and debugging programs.&rdquo;</h3>
<p>Being able to use backtraces is a big improvement, as they can show the developer a form of &lsquo;history&rsquo; of what interventions have been made to a program. Using it in Eio lets developers debug and troubleshoot more quickly. Having access to standard OCaml features also means that the more difficult parts of concurrent programming, such as cancellations, cleaning up resources, reporting errors, and testing are a lot easier to perform with Eio.</p>
<p>The biggest change users will notice is the resolution of the &lsquo;code colouring problem.&rsquo; In the past, synchronous code could not exist alongside asynchronous code without breaking, requiring the developer to use a special calling convention to invoke asynchronous code. With Eio, that is no longer a problem, as both just appear as normal OCaml functions. This significantly improves developer experience and productivity and is unique to Eio. Currently, in Rust&rsquo;s I/O library the &lsquo;code colouring problem&rsquo; still exists, and developers have to spend time resolving conflicts between code types.</p>
<p><em>Portability</em>
Both Rust and OCaml offer excellent portability, and with Eio OCaml gets several quality-of-life updates that lets developers create programs in different environments with several different features.</p>
<p>Operating systems have changed a lot in the last decade, benefiting from continuous development and modernisation. Thanks to its flexibility, Eio is able to take advantage of modern OS features (such as Linux&rsquo;s <a href="https://github.com/axboe/liburing">io_uring</a> to boost its own performance.</p>
<p>In turn, different backends for various platforms (such as Linux, MacOS, Windows, Mirage, etc.) can also implement the standard environment Eio expects to run programs. This adds an element of predictability to developer workflow, minimising the amount of task-switching and time spent outside of programming.</p>
<p>On the topic of Eio&rsquo;s flexibility, Thomas Leonard, the creator and lead maintainer of Eio, highlights that:</p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#eio-can-also-run-existing-lwt-and-async-code-alongside-new-code-allowing-existing-projects-to-be-upgraded-piece-by-piece-keeping-the-tests-passing-throughout-the-migration-a-couple-of-lines-of-code-is-all-it-takes-to-make-an-existing-lwt-application-run-on-eio-and-from-there-any-new-code-can-use-eio-directly" aria-label="eio can also run existing lwt and async code alongside new code allowing existing projects to be upgraded piece by piece keeping the tests passing throughout the migration a couple of lines of code is all it takes to make an existing lwt application run on eio and from there any new code can use eio directly permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>&ldquo;Eio can also run existing Lwt and Async code alongside new code, allowing existing projects to be upgraded piece by piece, keeping the tests passing throughout the migration. A couple of lines of code is all it takes to make an existing Lwt application run on Eio, and from there any new code can use Eio directly.&rdquo;</h3>
<p>Instead of having to pick one I/O tool to learn, Eio&rsquo;s library can run all three in the same program which is completely new.</p>
<p><em>Security</em>
Both Rust and OCaml offer strong safety features. According to the blog <a href="https://codilime.com/blog/why-is-rust-programming-language-so-popular/">Codilime</a>, &ldquo;High performance and safety are the features that made Rust so appealing.&rdquo; Well, Eio adds even more security features to OCaml&rsquo;s already long list.</p>
<p>Eio allows developers to implement measures with great specificity, which has great significance when it comes to security. For example, Eio lets a developer program a web server to serve files only from within specified directory trees, removing the possibility that it could be tricked into serving other files. This ensures that the I/O only shares what it&rsquo;s intended to do without being bypassed, which is a common security problem with web servers.</p>
<h2 style="position:relative;"><a href="https://tarides.com/feed.xml#conclusion" aria-label="conclusion permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2>
<p>Many businesses and programmers love Rust, and for good reason! What OCaml 5 and Eio can offer is an alternative that matches Rust on performance and user friendliness, includes new cutting-edge features, and delivers on safety in a way that is uniquely OCaml. With its new Eio library, concurrent programming in OCaml becomes more similar to Rust, and out of the two only OCaml solves the function colouring problem. If you&rsquo;re looking to complement your use of Rust with a robust functional programming language &ndash; without sacrificing performance &ndash; OCaml 5 is the language for you.</p>
<p><a href="https://tarides.com/company">Contact us</a> and learn more about how OCaml can transform your business. You can also find us on <a href="https://github.com/tarides">GitHub</a>, the OCaml <a href="https://discuss.ocaml.org">Discuss</a>  forum, and <a href="https://twitter.com/tarides_">Twitter</a></p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#acknowledgements" aria-label="acknowledgements permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Acknowledgements</h3>
<p>With thanks to Thomas Leonard, creator and lead maintainer of Eio, and Patrick Ferris, a developer at Tarides, for their expertise and input that made this article possible.</p>
<h3 style="position:relative;"><a href="https://tarides.com/feed.xml#sources" aria-label="sources permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sources</h3>
<ul>
<li>
<p><a href="https://codilime.com/blog/why-is-rust-programming-language-so-popular/">Codilime</a> blog</p>
</li>
<li>
<p><a href="https://serokell.io/blog/rust-guide">Serokell</a> blog</p>
</li>
</ul>
