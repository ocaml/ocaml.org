<div><div class="odoc-spec"><div class="spec type" id="type-native_obj_config" class="anchored"><a href="#type-native_obj_config" class="anchor"></a><code><span><span class="keyword">type</span> native_obj_config</span><span> = </span><span>{</span></code><table><tr id="type-native_obj_config.flambda" class="anchored"><td class="def record field"><a href="#type-native_obj_config.flambda" class="anchor"></a><code><span>flambda : bool;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>native object files have a format and magic number that depend on certain native-compiler configuration parameters. This configuration space is expressed by the <code>native_obj_config</code> type.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-native_obj_config" class="anchored"><a href="#val-native_obj_config" class="anchor"></a><code><span><span class="keyword">val</span> native_obj_config : <a href="#type-native_obj_config">native_obj_config</a></span></code></div><div class="spec-doc"><p>the native object file configuration of the active/configured compiler.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-version" class="anchored"><a href="#type-version" class="anchor"></a><code><span><span class="keyword">type</span> version</span><span> = int</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-kind" class="anchored"><a href="#type-kind" class="anchor"></a><code><span><span class="keyword">type</span> kind</span><span> = </span></code><table><tr id="type-kind.Exec" class="anchored"><td class="def variant constructor"><a href="#type-kind.Exec" class="anchor"></a><code><span>| </span><span><span class="constructor">Exec</span></span></code></td></tr><tr id="type-kind.Cmi" class="anchored"><td class="def variant constructor"><a href="#type-kind.Cmi" class="anchor"></a><code><span>| </span><span><span class="constructor">Cmi</span></span></code></td></tr><tr id="type-kind.Cmo" class="anchored"><td class="def variant constructor"><a href="#type-kind.Cmo" class="anchor"></a><code><span>| </span><span><span class="constructor">Cmo</span></span></code></td></tr><tr id="type-kind.Cma" class="anchored"><td class="def variant constructor"><a href="#type-kind.Cma" class="anchor"></a><code><span>| </span><span><span class="constructor">Cma</span></span></code></td></tr><tr id="type-kind.Cmx" class="anchored"><td class="def variant constructor"><a href="#type-kind.Cmx" class="anchor"></a><code><span>| </span><span><span class="constructor">Cmx</span> <span class="keyword">of</span> <a href="#type-native_obj_config">native_obj_config</a></span></code></td></tr><tr id="type-kind.Cmxa" class="anchored"><td class="def variant constructor"><a href="#type-kind.Cmxa" class="anchor"></a><code><span>| </span><span><span class="constructor">Cmxa</span> <span class="keyword">of</span> <a href="#type-native_obj_config">native_obj_config</a></span></code></td></tr><tr id="type-kind.Cmxs" class="anchored"><td class="def variant constructor"><a href="#type-kind.Cmxs" class="anchor"></a><code><span>| </span><span><span class="constructor">Cmxs</span></span></code></td></tr><tr id="type-kind.Cmt" class="anchored"><td class="def variant constructor"><a href="#type-kind.Cmt" class="anchor"></a><code><span>| </span><span><span class="constructor">Cmt</span></span></code></td></tr><tr id="type-kind.Ast_impl" class="anchored"><td class="def variant constructor"><a href="#type-kind.Ast_impl" class="anchor"></a><code><span>| </span><span><span class="constructor">Ast_impl</span></span></code></td></tr><tr id="type-kind.Ast_intf" class="anchored"><td class="def variant constructor"><a href="#type-kind.Ast_intf" class="anchor"></a><code><span>| </span><span><span class="constructor">Ast_intf</span></span></code></td></tr></table></div></div><div class="odoc-spec"><div class="spec type" id="type-info" class="anchored"><a href="#type-info" class="anchor"></a><code><span><span class="keyword">type</span> info</span><span> = </span><span>{</span></code><table><tr id="type-info.kind" class="anchored"><td class="def record field"><a href="#type-info.kind" class="anchor"></a><code><span>kind : <a href="#type-kind">kind</a>;</span></code></td></tr><tr id="type-info.version" class="anchored"><td class="def record field"><a href="#type-info.version" class="anchor"></a><code><span>version : <a href="#type-version">version</a>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Note: some versions of the compiler use the same <code>version</code> suffix for all kinds, but others use different versions counters for different kinds. We may only assume that versions are growing monotonically (not necessarily always by one) between compiler versions.</p><span class="comment-delim">*)</span></td></tr></table><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-raw" class="anchored"><a href="#type-raw" class="anchor"></a><code><span><span class="keyword">type</span> raw</span><span> = string</span></code></div><div class="spec-doc"><p>the type of raw magic numbers, such as &quot;Caml1999A027&quot; for the .cma files of OCaml 4.10</p></div></div><h4 id="parsing-magic-numbers"><a href="#parsing-magic-numbers" class="anchor"></a>Parsing magic numbers</h4><div class="odoc-spec"><div class="spec type" id="type-parse_error" class="anchored"><a href="#type-parse_error" class="anchor"></a><code><span><span class="keyword">type</span> parse_error</span><span> = </span></code><table><tr id="type-parse_error.Truncated" class="anchored"><td class="def variant constructor"><a href="#type-parse_error.Truncated" class="anchor"></a><code><span>| </span><span><span class="constructor">Truncated</span> <span class="keyword">of</span> string</span></code></td></tr><tr id="type-parse_error.Not_a_magic_number" class="anchored"><td class="def variant constructor"><a href="#type-parse_error.Not_a_magic_number" class="anchor"></a><code><span>| </span><span><span class="constructor">Not_a_magic_number</span> <span class="keyword">of</span> string</span></code></td></tr></table></div></div><div class="odoc-spec"><div class="spec value" id="val-explain_parse_error" class="anchored"><a href="#val-explain_parse_error" class="anchor"></a><code><span><span class="keyword">val</span> explain_parse_error : <span><span><a href="#type-kind">kind</a> option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-parse_error">parse_error</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Produces an explanation for a parse error. If no kind is provided, we use an unspecific formulation suggesting that any compiler-produced object file would have been satisfying.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-parse" class="anchored"><a href="#val-parse" class="anchor"></a><code><span><span class="keyword">val</span> parse : <span><a href="#type-raw">raw</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-info">info</a>, <a href="#type-parse_error">parse_error</a>)</span> <a href="../../Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p>Parses a raw magic number</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_info" class="anchored"><a href="#val-read_info" class="anchor"></a><code><span><span class="keyword">val</span> read_info : <span><a href="../../Stdlib/index.html#type-in_channel">in_channel</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-info">info</a>, <a href="#type-parse_error">parse_error</a>)</span> <a href="../../Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p>Read a raw magic number from an input channel.</p><p>If the data read <code>str</code> is not a valid magic number, it can be recovered from the <code>Truncated str | Not_a_magic_number str</code> payload of the <code>Error parse_error</code> case.</p><p>If parsing succeeds with an <code>Ok info</code> result, we know that exactly <code>magic_length</code> bytes have been consumed from the input_channel.</p><p>If you also wish to enforce that the magic number is at the current version, see <a href="#val-read_current_info"><code>read_current_info</code></a> below.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-magic_length" class="anchored"><a href="#val-magic_length" class="anchor"></a><code><span><span class="keyword">val</span> magic_length : int</span></code></div><div class="spec-doc"><p>all magic numbers take the same number of bytes</p></div></div><h4 id="checking-that-magic-numbers-are-current"><a href="#checking-that-magic-numbers-are-current" class="anchor"></a>Checking that magic numbers are current</h4><div class="odoc-spec"><div class="spec type" id="type-unexpected" class="anchored"><a href="#type-unexpected" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a unexpected</span></span><span> = </span><span>{</span></code><table><tr id="type-unexpected.expected" class="anchored"><td class="def record field"><a href="#type-unexpected.expected" class="anchor"></a><code><span>expected : <span class="type-var">'a</span>;</span></code></td></tr><tr id="type-unexpected.actual" class="anchored"><td class="def record field"><a href="#type-unexpected.actual" class="anchor"></a><code><span>actual : <span class="type-var">'a</span>;</span></code></td></tr></table><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-unexpected_error" class="anchored"><a href="#type-unexpected_error" class="anchor"></a><code><span><span class="keyword">type</span> unexpected_error</span><span> = </span></code><table><tr id="type-unexpected_error.Kind" class="anchored"><td class="def variant constructor"><a href="#type-unexpected_error.Kind" class="anchor"></a><code><span>| </span><span><span class="constructor">Kind</span> <span class="keyword">of</span> <span><a href="#type-kind">kind</a> <a href="#type-unexpected">unexpected</a></span></span></code></td></tr><tr id="type-unexpected_error.Version" class="anchored"><td class="def variant constructor"><a href="#type-unexpected_error.Version" class="anchor"></a><code><span>| </span><span><span class="constructor">Version</span> <span class="keyword">of</span> <a href="#type-kind">kind</a> * <span><a href="#type-version">version</a> <a href="#type-unexpected">unexpected</a></span></span></code></td></tr></table></div></div><div class="odoc-spec"><div class="spec value" id="val-check_current" class="anchored"><a href="#val-check_current" class="anchor"></a><code><span><span class="keyword">val</span> check_current : <span><a href="#type-kind">kind</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-info">info</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <a href="#type-unexpected_error">unexpected_error</a>)</span> <a href="../../Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>check_current kind info</code> checks that the provided magic <code>info</code> is the current version of <code>kind</code>'s magic header.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-explain_unexpected_error" class="anchored"><a href="#val-explain_unexpected_error" class="anchor"></a><code><span><span class="keyword">val</span> explain_unexpected_error : <span><a href="#type-unexpected_error">unexpected_error</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Provides an explanation of the <code>unexpected_error</code>.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-error" class="anchored"><a href="#type-error" class="anchor"></a><code><span><span class="keyword">type</span> error</span><span> = </span></code><table><tr id="type-error.Parse_error" class="anchored"><td class="def variant constructor"><a href="#type-error.Parse_error" class="anchor"></a><code><span>| </span><span><span class="constructor">Parse_error</span> <span class="keyword">of</span> <a href="#type-parse_error">parse_error</a></span></code></td></tr><tr id="type-error.Unexpected_error" class="anchored"><td class="def variant constructor"><a href="#type-error.Unexpected_error" class="anchor"></a><code><span>| </span><span><span class="constructor">Unexpected_error</span> <span class="keyword">of</span> <a href="#type-unexpected_error">unexpected_error</a></span></code></td></tr></table></div></div><div class="odoc-spec"><div class="spec value" id="val-read_current_info" class="anchored"><a href="#val-read_current_info" class="anchor"></a><code><span><span class="keyword">val</span> read_current_info : <span>expected_kind:<span><a href="#type-kind">kind</a> option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Stdlib/index.html#type-in_channel">in_channel</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-info">info</a>, <a href="#type-error">error</a>)</span> <a href="../../Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p>Read a magic number as <code>read_info</code>, and check that it is the current version as its kind. If the <code>expected_kind</code> argument is <code>None</code>, any kind is accepted.</p></div></div><h4 id="information-on-magic-numbers"><a href="#information-on-magic-numbers" class="anchor"></a>Information on magic numbers</h4><div class="odoc-spec"><div class="spec value" id="val-string_of_kind" class="anchored"><a href="#val-string_of_kind" class="anchor"></a><code><span><span class="keyword">val</span> string_of_kind : <span><a href="#type-kind">kind</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>a user-printable string for a kind, eg. &quot;exec&quot; or &quot;cmo&quot;, to use in error messages.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-human_name_of_kind" class="anchored"><a href="#val-human_name_of_kind" class="anchor"></a><code><span><span class="keyword">val</span> human_name_of_kind : <span><a href="#type-kind">kind</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>a user-meaningful name for a kind, eg. &quot;executable file&quot; or &quot;bytecode object file&quot;, to use in error messages.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-current_raw" class="anchored"><a href="#val-current_raw" class="anchor"></a><code><span><span class="keyword">val</span> current_raw : <span><a href="#type-kind">kind</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-raw">raw</a></span></code></div><div class="spec-doc"><p>the current magic number of each kind</p></div></div><div class="odoc-spec"><div class="spec value" id="val-current_version" class="anchored"><a href="#val-current_version" class="anchor"></a><code><span><span class="keyword">val</span> current_version : <span><a href="#type-kind">kind</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-version">version</a></span></code></div><div class="spec-doc"><p>the current version of each kind</p></div></div><h4 id="raw-representations"><a href="#raw-representations" class="anchor"></a>Raw representations</h4><p>Mainly for internal usage and testing.</p><div class="odoc-spec"><div class="spec type" id="type-raw_kind" class="anchored"><a href="#type-raw_kind" class="anchor"></a><code><span><span class="keyword">type</span> raw_kind</span><span> = string</span></code></div><div class="spec-doc"><p>the type of raw magic numbers kinds, such as &quot;Caml1999A&quot; for .cma files</p></div></div><div class="odoc-spec"><div class="spec value" id="val-parse_kind" class="anchored"><a href="#val-parse_kind" class="anchor"></a><code><span><span class="keyword">val</span> parse_kind : <span><a href="#type-raw_kind">raw_kind</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-kind">kind</a> option</span></span></code></div><div class="spec-doc"><p>parse a raw kind into a kind</p></div></div><div class="odoc-spec"><div class="spec value" id="val-raw_kind" class="anchored"><a href="#val-raw_kind" class="anchor"></a><code><span><span class="keyword">val</span> raw_kind : <span><a href="#type-kind">kind</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-raw_kind">raw_kind</a></span></code></div><div class="spec-doc"><p>the current raw representation of a kind.</p><p>In some cases the raw representation of a kind has changed over compiler versions, so other files of the same kind may have different raw kinds. Note that all currently known cases are parsed correctly by <code>parse_kind</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-raw" class="anchored"><a href="#val-raw" class="anchor"></a><code><span><span class="keyword">val</span> raw : <span><a href="#type-info">info</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-raw">raw</a></span></code></div><div class="spec-doc"><p>A valid raw representation of the magic number.</p><p>Due to past and future changes in the string representation of magic numbers, we cannot guarantee that the raw strings returned for past and future versions actually match the expectations of those compilers. The representation is accurate for current versions, and it is correctly parsed back into the desired version by the parsing functions above.</p></div></div></div>