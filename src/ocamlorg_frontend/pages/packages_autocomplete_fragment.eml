let render
~search
~total
(packages : Package_intf.package list)
=
<div class="mx-2 mb-2">
  <span class="font-semibold">Packages:</span>
  <% if total = 0 then ( %>
  <p class="break-words">
    We didn't find a match for "<%s search %>".
  </p>
  <% ) else ( %>
  <p class="break-words">
    <%s (if total = List.length packages then "" else "Showing top " ^ string_of_int (List.length packages) ^ " out of ")
    ^ string_of_int total ^ (if total = 1 then " search result" else " search results") %>:
  </p>
  <% ); %>

  <ol class="flex flex-col" x-init="row = null; col = 0">
  <% packages |> List.iteri (fun i (package : Package_intf.package) -> %>
    <li class="flex flex-row">
      <a
        x-init="max=<%s string_of_int i %>"
        id="package-autocomplete-<%s string_of_int i %>-0"
        :aria-selected="row == <%s string_of_int i %> && col == 0"
        href="<%s Url.package_with_version package.name %>"
        :class='{ "border-primary-600": row == <%s string_of_int i %> && col == 0}'
        class="border flex-grow px-2 py-2 leading-6 font-semibold hover:bg-primary-100 text-primary-600 inline-block"
      >
        <%s! Search.highlight_search_terms ~class_:"bg-background-light-blue text-gray-800 font-normal" ~search package.name %>
      </a>
      <a 
        id="package-autocomplete-<%s string_of_int i %>-1"
        :aria-selected="row == <%s string_of_int i %> && col == 1"
        href="<%s Url.package_doc package.name %>"
        :class='{ "border-primary-600": row == <%s string_of_int i %> && col == 1}'
        class="border justify-self-end px-2 py-2 leading-6 font-semibold hover:bg-primary-100">
        docs
      </a>
    </li>
  <% ); %>
  </ol>
  <% if List.length packages > 0 then ( %>
  <a class="font-semibold hover:bg-primary-100 px-2 py-2 flex text-right" href="<%s Url.packages_search %>?q=<%s Dream.to_percent_encoded search %>">see more...</a>
  <% ); %>
</div>
