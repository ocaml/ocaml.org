type path_item = 
  | Library of string
  | Module of string
  | ModuleType of string
  | FunctorArgument of int * string
  | Class of string
  | ClassType of string

let kind_tag (m : path_item) = match m with
  | Library _ -> ""
  | Module _ ->
    <span class="breadcrumbs-tag module-tag text-white">Module</span>
  | ModuleType _ ->
    <span class="breadcrumbs-tag module-type-tag text-white">Module type</span>
  | FunctorArgument (number, _) ->
    <span class="breadcrumbs-tag argument-tag text-white"><%s "Parameter #" ^ (Int.to_string number) %></span>
  | Class _ ->
    <span class="breadcrumbs-tag class-tag text-white">Class</span>
  | ClassType _ ->
    <span class="breadcrumbs-tag class-type-tag text-white">Class type</span>

let path_item_name (m: path_item) = match m with
  | Library name
  | Module name
  | ModuleType name
  | FunctorArgument (_, name) -> name
  | Class name -> name
  | ClassType name -> name

type breadcrumb = {
  text : string;
  href : string;
}

let rec breadcrumbs_from_path (reversed_module_path: path_item list) prefix : ( breadcrumb list ) = match reversed_module_path with
  | [] -> []
  | x::[] -> [{ text = path_item_name x; href = prefix ^ "index.html"}]
  | x::xs ->
    let new_prefix = prefix ^ "../" in
    { text = path_item_name x ; href = prefix ^ "index.html" } :: breadcrumbs_from_path xs new_prefix

let render_sidebar_breadcrumbs (module_path : path_item list) =
  let (reversed_module_path : path_item list) = List.rev module_path in
  let breadcrumbs = breadcrumbs_from_path reversed_module_path "" in
  let render_breadcrumb b = 
    <span>
      <a href="<%s! b.href %>" class="font-medium text-gray-800 transition-colors hover:text-orange-600"><%s b.text %></a>
    </span>
  in
    <%s! String.concat "<span>.</span>" (breadcrumbs |> List.rev |> List.map render_breadcrumb)  %>

let render (module_path:path_item list) =
  let (reversed_module_path : path_item list) = List.rev module_path in
  let breadcrumbs = breadcrumbs_from_path reversed_module_path "" in
  let render_breadcrumb b =
    <span>
      <a href="<%s! b.href %>" class="ml-1 text-2xl font-medium text-gray-800 transition-colors hover:text-orange-600"><%s b.text %></a>
    </span>
  in
  <div class="flex flex-wrap pb-4">
    <%s! if module_path != [] then kind_tag (List.hd reversed_module_path) else "" %>
    <%s! String.concat "<span class=\"ml-1 text-2xl\">.</span>" (breadcrumbs |> List.rev |> List.map render_breadcrumb); %>
  </div>
