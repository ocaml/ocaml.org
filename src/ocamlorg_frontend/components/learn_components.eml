type difficulty = Beginner | Intermediate | Advanced

let color_for_difficulty = function
  | Beginner -> "bg-secondary"
  | Intermediate -> "bg-[#3882B7]"
  | Advanced -> "bg-primary"

let string_from_difficulty = function
  | Beginner -> "Beginner"
  | Intermediate -> "Intermediate"
  | Advanced -> "Advanced"

let skill_tag difficulty =
  <div class="px-3 inline-block <%s color_for_difficulty difficulty %> rounded-3xl font-semibold text-center text-white tracking-widest">
    <%s string_from_difficulty difficulty %>
  </div>

let beginner_section_icon =
  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="10" cy="10" r="10" fill="#2B7866"/>
  </svg>

let intermediate_section_icon =
  <svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M0.5 6.5C0.5 3.18629 3.18629 0.5 6.5 0.5H18.5C21.8137 0.5 24.5 3.18629 24.5 6.5V18.5C24.5 21.8137 21.8137 24.5 18.5 24.5H6.5C3.18629 24.5 0.5 21.8137 0.5 18.5V6.5Z" fill="#3882B7"/>
  </svg>

let advanced_section_icon =
  <svg width="26" height="23" viewBox="0 0 26 23" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M11.268 1.5C12.0378 0.166665 13.9622 0.166667 14.7321 1.5L25.1244 19.5C25.8942 20.8333 24.9319 22.5 23.3923 22.5H2.60769C1.06809 22.5 0.105844 20.8333 0.875645 19.5L11.268 1.5Z" fill="#D54000"/>
  </svg>

let little_down_arrow_icon =
  <svg width="18" height="32" viewBox="0 0 18 32" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M13 16.6L9 20.6M9 20.6L5 16.6M9 20.6V11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>

let download_icon class_ =
  <svg xmlns="http://www.w3.org/2000/svg" class="<%s class_ %>" fill="none" viewBox="0 0 24 24" stroke-width="0.5" stroke="currentColor" class="w-6 h-6" aria-hidden="true">
    <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 7.5h-.75A2.25 2.25 0 004.5 9.75v7.5a2.25 2.25 0 002.25 2.25h7.5a2.25 2.25 0 002.25-2.25v-7.5a2.25 2.25 0 00-2.25-2.25h-.75m-6 3.75l3 3m0 0l3-3m-3 3V1.5m6 9h.75a2.25 2.25 0 012.25 2.25v7.5a2.25 2.25 0 01-2.25 2.25h-7.5a2.25 2.25 0 01-2.25-2.25v-.75" />
  </svg>

let command_line_icon class_ =
  <svg xmlns="http://www.w3.org/2000/svg" class="<%s class_ %>" fill="none" viewBox="0 0 24 24" stroke-width="0.5" stroke="currentColor" class="w-6 h-6" aria-hidden="true">
    <path stroke-linecap="round" stroke-linejoin="round" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
  </svg>

let hero_button ~left_icon ~right_icon ~text ~href =
  <a href="<%s href %>" class="group whitespace-nowrap flex p-3 gap-2 items-center bg-white hover:bg-primary hover:text-white drop-shadow hover:drop-shadow-xl border-primary border-2 rounded-lg px-4 text-text_title">
    <span class="group-hover:text-white text-primary"><%s! left_icon %></span>
    <span class="flex-grow"><%s text %></span>
    <%s! right_icon %>
  </a>

type link = {href : string; title : string}

let block_heading ~icon ~title ~heading =
  <div class="pt-4 text-text_content text-sm font-medium leading-7 tracking-widest flex gap-2 items-center">
    <%s! icon %>
    <%s title %>
  </div>
  <h2 class="mt-2 text-text_title text-2xl font-bold leading-7"><%s heading %></h2>

let block_container ~icon ~title ~heading inner_html =
  <div class="bg-legacy-default">
    <div class="max-w-sm md:max-w-full md:w-[32rem] flex flex-col">
      <%s! block_heading ~icon ~title ~heading %>
      <%s! inner_html %>
    </div>
  </div>

let tutorial_block ~icon ~title ~heading ~description ~(tutorial_links: link list) ~see_more  =
  block_container ~icon ~title ~heading @@
  <div class="mt-4 text-text_content text-base font-normal leading-7 max-w-prose"> <%s description %> </div>
  <ul class="flex flex-col gap-4 mt-5">
    <% tutorial_links |> List.iter (fun link -> %>
    <li class="w-full">
      <a href="<%s link.href %>" class="bg-white text-text_title hover:bg-primary hover:text-white drop-shadow hover:drop-shadow-xl flex gap-2 border-primary border-2 rounded-lg p-2.5 text-md font-bold">
        <span class="flex-grow"><%s link.title  %></span>

        <%s! Icons.arrow_right_circle "w-6 h-6" %>
      </a>
    </li>
    <% ); %>
  </ul>
  <a href="<%s see_more.href %>" class="mt-4 text-primary hover:underline items-center leading-10">
    <%s see_more.title %>
  </a>

let book_cover ~free cover_src = 
  <div class="relative">
    <% (if free then %>
    <div class="absolute -mt-8 ml-3 w-16 h-16">
      <div class="bg-primary rotate-[-10deg] rounded-full w-16 h-16 flex items-center justify-center" style="filter: drop-shadow(-4px -2px 4px rgb(0 0 0 / 0.25));">
        <div class="text-center text-white text-base font-bold leading-7 tracking-wide">
          FREE
        </div>
      </div>
    </div>
    <% ); %>
    <img src="<%s Ocamlorg_static.Media.url cover_src %>"
      class="w-full border z-10"
      alt="">
  </div>

let book_recommendation ~(link : link) (book: Data.Book.t) =
  let icon_for_difficulty difficulty = match difficulty with
  | Data.Book.Beginner -> beginner_section_icon
  | Intermediate -> intermediate_section_icon
  | Advanced -> advanced_section_icon
  in
  block_container ~icon:(icon_for_difficulty book.difficulty) ~title:"RECOMMENDED BOOK" ~heading:book.title @@
    <div class="mt-6 grid grid-cols-2 gap-6 pt-6">
      <%s! book_cover ~free:(book.pricing = "free") book.cover %>
      <div class="">
        <%s! skill_tag (match book.difficulty with | Data.Book.Beginner -> Beginner | Intermediate -> Intermediate | Advanced -> Advanced) %>
        <% (match book.recommendation with None -> () | Some recommendation -> %>
        <p class="mt-2 text-gray-700 text-sm font-normal whitespace-normal max-w-prose"> <%s recommendation %> </p>
        <% ); %>
      </div>
    </div>
    <a href="<%s link.href %>" class="pt-4 text-primary hover:underline items-center leading-10">
      <%s link.title %>
    </a>

let lang_manual_banner =
  <div class="bg-gradient-to-r from-[#D54000] to-[#e66f01] md:to-[#EF8901] rounded-3xl">
    <div class="bg-[url('/img/learn/banner-background.svg')] bg-cover w-full items-center flex flex-col md:flex-row gap-6 py-4 px-7 md:py-4 md:pl-14 md:pr-14 lg:pr-24">
      <div class="flex flex-col flex-grow my-6">
        <div class="text-white text-sm font-medium tracking-widest leading-10">GUIDE</div>
        <h2 class="text-white text-3xl font-bold leading-10">
          Language Manual
        </h3>
        <p class="mt-4 text-white font-normal max-w-xl text-base leading-7">
          The OCaml language manual is a comprehensive guide covering syntax, features, and usage. It assists developers and learners in understanding capabilities, best practices, and language features.
        </p>
        <a href="<%s Url.manual %>" class="w-full md:w-80 mt-6 py-2 bg-white rounded-xl text-center text-primary font-bold text-lg">
          Take Me There
        </a>
      </div>
      <img class="hidden md:block w-[200px] h-[200px] md:w-72 md:h-72 rounded-full" src="<%s Ocamlorg_static.Asset.url "img/learn/language_manual_camel.png" %>" alt="A friendly-looking camel">
    </div>
  </div>

let exercise_card (exercise: Data.Exercise.t) =
  <a class="flex flex-col p-5 card" href="<%s Url.exercises %>#<%s exercise.slug %>">
    <div class="flex-grow">
      <%s exercise.description %>
    </div>
    <div class="my-2.5">
      <%s! skill_tag (match exercise.difficulty with | Data.Exercise.Beginner -> Beginner | Intermediate -> Intermediate | Advanced -> Advanced) %>
    </div>
  </a>

let exercises_block ~icon ~heading (exercises: Data.Exercise.t list) =
  <div class="bg-legacy-default flex flex-col">
    <div class="max-w-sm md:max-w-full lg:w-full flex flex-col">
      <%s! block_heading ~icon ~title:"EXERCISES" ~heading %>
      <div class="mt-6 grid gap-6 md:gap-10 md:grid-cols-2 lg:grid-cols-4">
        <% exercises |> List.iter (fun (exercise: Data.Exercise.t) -> %>
        <%s! exercise_card exercise %>
        <% ); %>
      </div>
    </div>
    <a href="<%s Url.exercises %>" class="pt-4 text-primary hover:underline items-center leading-10">
      View all Exercises
    </a>
  </div>

let tool_card ~img_src ~title ~text ~url =
  <a class="group p-5 flex flex-col card max-w-[32rem]" href="<%s url %>">
    <h3 class="flex gap-3 text-text_heading text-base font-bold">
      <img src="<%s! Ocamlorg_static.Asset.url img_src %>" alt="">
      <%s title %>
    </h3>
    <p class="text-text_content py-6">
      <%s text %>
    </p>
    <div class="flex gap-2 items-center text-sm text-primary group-hover:underline">
      Get Started
      <%s! Icons.arrow_right_circle "h-5 w-5" %></div>
  </a>

let contribute_footer ~href ~description =
  <div class="pt-10 mt-16 border-t border-slate-200 lg:grid lg:grid-cols-3 gap-4 text-slate-500">
    <div class="lg:col-span-1">
      <h2 class="mt-0 mb-4 text-base font-semibold leading-6 lg:text-base">Help Improve Our Documentation</h2>
      <p class="text-sm mt-0 mb-4 max-w-xs"><%s description %></p>
      <a
        class="inline-block relative py-1 px-4 font-medium no-underline align-middle bg-transparent rounded-md border border-solid appearance-none cursor-pointer select-none whitespace-no-wrap hover:no-underline"
        href="<%s href %>"
      >
        <%s! Icons.github_pull_request "inline-block overflow-visible mr-0 align-text-bottom select-none" %>
        Contribute</a
      >
    </div>
    <div class="mt-4 lg:mt-0 lg:col-span-1 lg:col-start-3">
      <h2 class="mt-0 mb-4 text-base font-semibold leading-6 lg:text-base">Still need help?</h2>
      <div class="text-sm mb-2">
        <a href="https://discuss.ocaml.org/" class="font-semibold no-underline bg-transparent cursor-pointer hover:underline">
          <%s! Icons.community "inline h-4 w-4" %>
          Ask the OCaml Community</a
        >
      </div>
      <div class="text-sm mb-2">
        <a href="https://github.com/ocaml/ocaml.org/issues/new" class="font-semibold no-underline bg-transparent cursor-pointer hover:underline">
          <%s! Icons.github_issue "inline h-4 w-4" %>
          Open an Issue</a
        >
      </div>
    </div>
  </div>